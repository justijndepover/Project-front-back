!function(){angular.module("app",[])}(),function(){var t=function(t,e,a,i){t.LCShow=a.getLCShow;var o=function(){e.emit("pcconnect",null)};t.room="",e.on("requestRoom",function(e){t.room=e}),e.on("deviceOrientation",function(t){var e=(t.username,{});e.gamma=t.gamma,e.beta=t.beta,e.alpha=t.alpha}),t.usernames={},t.checkUserCount=!1,e.on("updateusers",function(e){i.setPlayers(e),t.usernames=e,t.checkUserCount=Object.keys(t.usernames).length<0}),t.startGame=function(){e.emit("startGame",null),a.setLCShow(!1),a.setPCShow(!0)},function(){o()}()};angular.module("app").controller("loginController",["$scope","socketService","displayService","playerService",t])}(),function(){"use strict";var t=function(t,e,a,i,o,n){function r(t,e){return e.username==t.userName?!0:!1}function s(){g.length>0&&(g[0].speed=0),u.clearRect(0,0,p.width,p.height);var t=p.width/100;if(0!=d.length){var e=p.width/100,a=e*d[0].image.height/d[0].image.width;for(var i in d){var o=d[i];o.width=e,o.height=a,0==o.explodeStage?(u.save(),u.translate(o.x*t,o.y*t),u.rotate(o.rotation/180*Math.PI),u.drawImage(o.image,-e/2,-a/2,e,a),u.restore(),d[i].x=Math.cos((o.rotation-90)/180*Math.PI)+o.x,d[i].y=Math.sin((o.rotation-90)/180*Math.PI)+o.y):o.explodeStage<4&&(console.log(o.explosionImage),u.save(),u.translate(o.x*t,o.y*t),u.drawImage(o.explosionImage,-e,-e,2*e,2*e),u.restore())}}if(0!=g.length){var n=p.width/20,r=n*g[0].image.height/g[0].image.width;for(var s in g){var l=g[s];l.width=n,l.height=r,u.save(),u.translate(l.x*t,l.y*t),u.rotate(l.rotation/180*Math.PI),u.drawImage(l.image,-n/2,-r/2,n,r),l.damage>0&&u.drawImage(l.damageImage,-n/2,-r/2,n,r),u.restore(),g[s].x=Math.cos((l.rotation-90)/180*Math.PI)/10*l.speed+l.x,g[s].y=Math.sin((l.rotation-90)/180*Math.PI)/10*l.speed+l.y}}h(),c()}function h(){for(var t in d)(d[t].x<0||d[t].x>p.width||d[t].y<0||d[t].y>p.height)&&d.splice(t,1)}function c(){for(var t in g)for(var e in d)if(d[e].player!=g[t].userName){var a=Math.sqrt(2)/2*(d[e].height/2-d[e].width/2),i=(360-d[e].rotation)/180*Math.PI,o=d[e].x*p.width/100-a*Math.sin(i),n=d[e].y*p.width/100-a*Math.cos(i),r=g[t].x*p.width/100,s=g[t].y*p.width/100,h=Math.sqrt((o-r)*(o-r)+(n-s)*(n-s));if(h<d[e].width/2+g[t].width/2){var c=new Audio("../../assets/Bonus/sfx_lose.ogg");c.play(),g[t].increaseDamage(),d[e].explodeStage<4?d[e].explode():d.splice(e,1)}}}t.PCShow=o.getPCShow,t.startGame=!1;var l,p=document.getElementById("game"),u=p.getContext("2d"),g=new Array,d=new Array;i.on("initGame",function(){var t=n.getPlayers();for(var a in t){var i=t[a];g.push(new Spaceship(i.username,i.x,i.y,i.color,i.rotation))}l=e(s,10)}),i.on("userleft",function(t){var e=null;for(var a in g)1==r(g[a],t)&&(e=a);g.splice(e,1)}),i.on("updateGameData",function(t){var e=null;for(var a in g)1==r(g[a],t)&&(e=a);null!=e&&g[e].rotateSpaceshipRelative(t.orientation)}),i.on("playerShot",function(t){var e=null;for(var a in g)1==r(g[a],t)&&(e=a);if(null!=e){var i=g[e],o=(360-(i.rotation+180))/180*Math.PI,n=i.x+p.width/400*Math.sin(o),s=i.y+p.width/400*Math.cos(o);if(d.push(new Bullet(n,s,i.rotation,i.color,i.userName)),e%2==0)var h=new Audio("../../assets/Bonus/sfx_laser1.ogg");else var h=new Audio("../../assets/Bonus/sfx_laser2.ogg");h.play()}})};angular.module("app").controller("playController",["$scope","$interval","$window","socketService","displayService","playerService",t])}();var Bullet=function(t,e,a,i,o){this.x=t,this.y=e,this.rotation=a,this.image=new Image,this.color=i,this.width=0,this.height=0,this.player=o,this.explosionImage=new Image,this.explodeStage=0,"orange"==this.color&&(this.color="red"),this.image.src="../assets/PNG/Lasers/laser"+this.color.charAt(0).toUpperCase()+this.color.slice(1)+"01.png"};Bullet.prototype.explode=function(){if(this.explodeStage<4){this.explodeStage++;var t;t=this.explodeStage<3?1:2,this.explosionImage.src="../assets/PNG/Lasers/laser"+this.color.charAt(0).toUpperCase()+this.color.slice(1)+"Explode"+t+".png"}else this.explosionImage.src=""};var Spaceship=function(t,e,a,i,o){this.userName=t,this.x=e,this.y=a,this.speed=1,this.color=i,this.rotation=o,this.image=new Image,this.damage=0,this.width=0,this.height=0,this.damageImage=new Image,this.image.src="../assets/PNG/playerShip1_"+this.color+".png"};Spaceship.prototype.moveSpaceship=function(t,e){this.x=t,this.y=e},Spaceship.prototype.moveSpaceshipRelative=function(t,e){this.x=this.x+t,this.y=this.y+e},Spaceship.prototype.rotateSpaceship=function(t){this.rotation=t},Spaceship.prototype.rotateSpaceshipRelative=function(t){this.rotation=this.rotation+t/5,this.rotation<-360&&(this.rotation=this.rotation+720),this.rotation>360&&(this.rotation=this.rotation-720)},Spaceship.prototype.increaseDamage=function(){this.damage<4&&(this.damage+=1),this.damage<=3&&this.damage>0&&(this.damageImage.src="../assets/PNG/Damage/playerShip1_damage"+this.damage+".png")},Spaceship.prototype.decreaseDamage=function(){this.damage>0&&(this.damage-=1),this.damage<=3&&this.damage>0&&(this.damageImage.src="../assets/PNG/Damage/playerShip1_damage"+this.damage+".png")},function(){var t=function(t){function e(e,a,i){t.innerWidth<t.innerHeight?e.width=t.innerWidth-20:e.width=t.innerHeight-20,angular.element(t).bind("resize",function(){t.innerWidth<t.innerHeight?e.width=t.innerWidth-20:e.width=t.innerHeight-20,e.$digest()})}return{restrict:"E",link:e,replace:!0,template:'<canvas id="game" class="playArea" width="{{width}}" height="{{width}}" />'}};angular.module("app").directive("canvasDirective",["$window",t])}(),function(){var t=function(){var t=!0,e=!1;return{getLCShow:function(){return t},setLCShow:function(e){t=e},getPCShow:function(){return e},setPCShow:function(t){e=t}}};angular.module("app").factory("displayService",[t])}(),function(){var t=function(){var t=[];return{getPlayers:function(){return t},setPlayers:function(e){t=e}}};angular.module("app").factory("playerService",[t])}(),function(){var t=function(t){"use strict";var e=io.connect(window.location.host),a=function(a,i){e.on(a,function(){var a=arguments;t.$apply(function(){i.apply(e,a)})})},i=function(a,i,o){e.emit(a,i,function(){var a=arguments;t.$apply(function(){o&&o.apply(e,a)})})};return{on:a,emit:i,socket:e}};angular.module("app").factory("socketService",["$rootScope",t])}();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyIsImNvbnRyb2xsZXIvbG9naW5Db250cm9sbGVyLmpzIiwiY29udHJvbGxlci9wbGF5Q29udHJvbGxlci5qcyIsIm1vZGVscy9CdWxsZXQuanMiLCJtb2RlbHMvU3BhY2VzaGlwLmpzIiwiZGlyZWN0aXZlcy9jYW52YXNEaXJlY3RpdmUuanMiLCJzZXJ2aWNlcy9kaXNwbGF5U2VydmljZS5qcyIsInNlcnZpY2VzL3BsYXllclNlcnZpY2UuanMiLCJzZXJ2aWNlcy9zb2NrZXRTZXJ2aWNlLmpzIl0sIm5hbWVzIjpbImFuZ3VsYXIiLCJtb2R1bGUiLCJsb2dpbkNvbnRyb2xsZXIiLCIkc2NvcGUiLCJzb2NrZXRTZXJ2aWNlIiwiZGlzcGxheVNlcnZpY2UiLCJwbGF5ZXJTZXJ2aWNlIiwiTENTaG93IiwiZ2V0TENTaG93IiwibWFrZVJvb20iLCJlbWl0Iiwicm9vbSIsIm9uIiwiZGF0YSIsImRldmljZU9yaWVudGF0aW9uIiwidXNlcm5hbWUiLCJnYW1tYSIsImJldGEiLCJhbHBoYSIsInVzZXJuYW1lcyIsImNoZWNrVXNlckNvdW50Iiwic2V0UGxheWVycyIsIk9iamVjdCIsImtleXMiLCJsZW5ndGgiLCJzdGFydEdhbWUiLCJzZXRMQ1Nob3ciLCJzZXRQQ1Nob3ciLCJjb250cm9sbGVyIiwicGxheUNvbnRyb2xsZXIiLCIkaW50ZXJ2YWwiLCIkd2luZG93IiwiZmlsdGVyUGxheWVycyIsIm9iaiIsInVzZXJOYW1lIiwiZHJhdyIsIkFsbFBsYXllcnMiLCJzcGVlZCIsImN0eCIsImNsZWFyUmVjdCIsImNhbnYiLCJ3aWR0aCIsImhlaWdodCIsInJhdGlvIiwiQWxsQnVsbGV0cyIsIkJ1bGxldFdpZHRoIiwiQnVsbGV0SGVpZ2h0IiwiaW1hZ2UiLCJidWxsZXQiLCJiIiwiZXhwbG9kZVN0YWdlIiwic2F2ZSIsInRyYW5zbGF0ZSIsIngiLCJ5Iiwicm90YXRlIiwicm90YXRpb24iLCJNYXRoIiwiUEkiLCJkcmF3SW1hZ2UiLCJyZXN0b3JlIiwiY29zIiwic2luIiwiY29uc29sZSIsImxvZyIsImV4cGxvc2lvbkltYWdlIiwiU3BhY2VzaGlwV2lkdGgiLCJTcGFjZXNoaXBIZWlnaHQiLCJwbGF5ZXIiLCJwIiwiZGFtYWdlIiwiZGFtYWdlSW1hZ2UiLCJjaGVja0J1bGxldHMiLCJjb2xsaXNpb25EZXRlY3Rpb24iLCJzcGxpY2UiLCJyYWRpdXMiLCJzcXJ0IiwiYW5nbGUiLCJidWxsZXRIZWFkWCIsImJ1bGxldEhlYWRZIiwic3BhY2VTaGlwWCIsInNwYWNlU2hpcFkiLCJkaXN0YW5jZSIsImRhbWFnZXNvdW5kIiwiQXVkaW8iLCJwbGF5IiwiaW5jcmVhc2VEYW1hZ2UiLCJleHBsb2RlIiwiUENTaG93IiwiZ2V0UENTaG93IiwiY3ljbGUiLCJkb2N1bWVudCIsImdldEVsZW1lbnRCeUlkIiwiZ2V0Q29udGV4dCIsIkFycmF5IiwiQnVmZmVyUGxheWVyIiwiZ2V0UGxheWVycyIsInB1c2giLCJTcGFjZXNoaXAiLCJjb2xvciIsImkiLCJyb3RhdGVTcGFjZXNoaXBSZWxhdGl2ZSIsIm9yaWVudGF0aW9uIiwidGVtcCIsIkJ1bGxldCIsInNob3QiLCJ0aGlzIiwiSW1hZ2UiLCJzcmMiLCJjaGFyQXQiLCJ0b1VwcGVyQ2FzZSIsInNsaWNlIiwicHJvdG90eXBlIiwibnVtYmVyIiwibW92ZVNwYWNlc2hpcCIsIm1vdmVTcGFjZXNoaXBSZWxhdGl2ZSIsInJvdGF0ZVNwYWNlc2hpcCIsImRlZ3JlZSIsImRlY3JlYXNlRGFtYWdlIiwiY2FudmFzRGlyZWN0aXZlIiwibGluayIsInNjb3BlIiwiZWxlbWVudCIsImF0dHJzIiwiaW5uZXJXaWR0aCIsImlubmVySGVpZ2h0IiwiYmluZCIsIiRkaWdlc3QiLCJyZXN0cmljdCIsInJlcGxhY2UiLCJ0ZW1wbGF0ZSIsImRpcmVjdGl2ZSIsInZhbHVlIiwiZmFjdG9yeSIsInBsYXllcnMiLCJwbGF5ZXJzQXJyYXkiLCIkcm9vdFNjb3BlIiwic29ja2V0IiwiaW8iLCJjb25uZWN0Iiwid2luZG93IiwibG9jYXRpb24iLCJob3N0IiwiZXZlbnROYW1lIiwiY2FsbGJhY2siLCJhcmdzIiwiYXJndW1lbnRzIiwiJGFwcGx5IiwiYXBwbHkiXSwibWFwcGluZ3MiOiJDQUdBLFdBRUFBLFFBQUFDLE9BQUEsYUNEQSxXQUNBLEdBQUFDLEdBQUEsU0FBQUMsRUFBQUMsRUFBQUMsRUFBQUMsR0FFQUgsRUFBQUksT0FBQUYsRUFBQUcsU0FHQSxJQUFBQyxHQUFBLFdBQ0FMLEVBQUFNLEtBQUEsWUFBQSxNQUVBUCxHQUFBUSxLQUFBLEdBQ0FQLEVBQUFRLEdBQUEsY0FBQSxTQUFBQyxHQUNBVixFQUFBUSxLQUFBRSxJQUVBVCxFQUFBUSxHQUFBLG9CQUFBLFNBQUFDLEdBQ0EsR0FDQUMsSUFEQUQsRUFBQUUsWUFFQUQsR0FBQUUsTUFBQUgsRUFBQUcsTUFDQUYsRUFBQUcsS0FBQUosRUFBQUksS0FDQUgsRUFBQUksTUFBQUwsRUFBQUssUUFFQWYsRUFBQWdCLGFBQ0FoQixFQUFBaUIsZ0JBQUEsRUFDQWhCLEVBQUFRLEdBQUEsY0FBQSxTQUFBQyxHQUNBUCxFQUFBZSxXQUFBUixHQUNBVixFQUFBZ0IsVUFBQU4sRUFDQVYsRUFBQWlCLGVBQUFFLE9BQUFDLEtBQUFwQixFQUFBZ0IsV0FBQUssT0FBQSxJQUdBckIsRUFBQXNCLFVBQUEsV0FDQXJCLEVBQUFNLEtBQUEsWUFBQSxNQUNBTCxFQUFBcUIsV0FBQSxHQUNBckIsRUFBQXNCLFdBQUEsSUFJQSxXQUNBbEIsT0FLQVQsU0FBQUMsT0FBQSxPQUFBMkIsV0FBQSxtQkFBQSxTQUFBLGdCQUFBLGlCQUFBLGdCQUFBMUIsT0N6Q0EsV0FDQSxZQUNBLElBQUEyQixHQUFBLFNBQUExQixFQUFBMkIsRUFBQUMsRUFBQTNCLEVBQUFDLEVBQUFDLEdBaUVBLFFBQUEwQixHQUFBQyxFQUFBcEIsR0FDQSxNQUFBQSxHQUFBRSxVQUFBa0IsRUFBQUMsVUFDQSxHQUVBLEVBSUEsUUFBQUMsS0FDQUMsRUFBQVosT0FBQSxJQUNBWSxFQUFBLEdBQUFDLE1BQUEsR0FFQUMsRUFBQUMsVUFBQSxFQUFBLEVB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U0FBQUMsT0FBQSxPQUFBb0ksUUFBQSxpQkFBQSxhQUFBakkiLCJmaWxlIjoiYXBwLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQ3JlYXRlZCBieSBNaWNoaWVsIG9uIDI1LzExLzIwMTUuXG4gKi9cbihmdW5jdGlvbigpe1xuXG4gICAgdmFyIGFwcCA9IGFuZ3VsYXIubW9kdWxlKFwiYXBwXCIsW10pO1xufSkoKTsiLCIvKipcbiAqIENyZWF0ZWQgYnkgTWljaGllbCBvbiAxMS8xMi8yMDE1LlxuICovXG5cbihmdW5jdGlvbigpe1xuICAgIHZhciBsb2dpbkNvbnRyb2xsZXIgPSBmdW5jdGlvbigkc2NvcGUsIHNvY2tldFNlcnZpY2UsIGRpc3BsYXlTZXJ2aWNlLCBwbGF5ZXJTZXJ2aWNlKXtcblxuICAgICAgICAkc2NvcGUuTENTaG93ID0gZGlzcGxheVNlcnZpY2UuZ2V0TENTaG93O1xuXG4gICAgICAgIC8vZnVuY3Rpb25zXG4gICAgICAgIHZhciBtYWtlUm9vbSA9IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICBzb2NrZXRTZXJ2aWNlLmVtaXQoXCJwY2Nvbm5lY3RcIiwgbnVsbCk7XG4gICAgICAgIH07XG4gICAgICAgICRzY29wZS5yb29tID0gXCJcIjtcbiAgICAgICAgc29ja2V0U2VydmljZS5vbigncmVxdWVzdFJvb20nLGZ1bmN0aW9uKGRhdGEpe1xuICAgICAgICAgICAgJHNjb3BlLnJvb20gPSBkYXRhO1xuICAgICAgICB9KTtcbiAgICAgICAgc29ja2V0U2VydmljZS5vbignZGV2aWNlT3JpZW50YXRpb24nLCBmdW5jdGlvbihkYXRhKXtcbiAgICAgICAgICAgIHZhciB1c2VybmFtZSA9IGRhdGEudXNlcm5hbWU7XG4gICAgICAgICAgICB2YXIgZGV2aWNlT3JpZW50YXRpb24gPSB7fTtcbiAgICAgICAgICAgIGRldmljZU9yaWVudGF0aW9uLmdhbW1hID0gZGF0YS5nYW1tYTtcbiAgICAgICAgICAgIGRldmljZU9yaWVudGF0aW9uLmJldGEgPSBkYXRhLmJldGE7XG4gICAgICAgICAgICBkZXZpY2VPcmllbnRhdGlvbi5hbHBoYSA9IGRhdGEuYWxwaGE7XG4gICAgICAgIH0pO1xuICAgICAgICAkc2NvcGUudXNlcm5hbWVzID0ge307XG4gICAgICAgICRzY29wZS5jaGVja1VzZXJDb3VudCA9IGZhbHNlO1xuICAgICAgICBzb2NrZXRTZXJ2aWNlLm9uKCd1cGRhdGV1c2VycycsIGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBwbGF5ZXJTZXJ2aWNlLnNldFBsYXllcnMoZGF0YSk7XG4gICAgICAgICAgICAkc2NvcGUudXNlcm5hbWVzID0gZGF0YTtcbiAgICAgICAgICAgICRzY29wZS5jaGVja1VzZXJDb3VudCA9IE9iamVjdC5rZXlzKCRzY29wZS51c2VybmFtZXMpLmxlbmd0aCA8IDA7XG4gICAgICAgIH0pO1xuXG4gICAgICAgICRzY29wZS5zdGFydEdhbWU9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHNvY2tldFNlcnZpY2UuZW1pdChcInN0YXJ0R2FtZVwiLCBudWxsKTtcbiAgICAgICAgICAgIGRpc3BsYXlTZXJ2aWNlLnNldExDU2hvdyhmYWxzZSk7XG4gICAgICAgICAgICBkaXNwbGF5U2VydmljZS5zZXRQQ1Nob3codHJ1ZSk7XG4gICAgICAgIH07XG5cblxuICAgICAgICAoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBtYWtlUm9vbSgpO1xuICAgICAgICB9KSgpO1xuXG4gICAgfTtcblxuICAgIGFuZ3VsYXIubW9kdWxlKFwiYXBwXCIpLmNvbnRyb2xsZXIoXCJsb2dpbkNvbnRyb2xsZXJcIiwgW1wiJHNjb3BlXCIsIFwic29ja2V0U2VydmljZVwiICwgXCJkaXNwbGF5U2VydmljZVwiLCBcInBsYXllclNlcnZpY2VcIiwgbG9naW5Db250cm9sbGVyXSk7XG59KSgpOyIsIi8qKlxuICogQ3JlYXRlZCBieSBNaWNoaWVsIG9uIDE2LzEyLzIwMTUuXG4gKi9cblxuKGZ1bmN0aW9uKCl7XG4gICAgXCJ1c2Ugc3RyaWN0XCI7XG4gICAgdmFyIHBsYXlDb250cm9sbGVyID0gZnVuY3Rpb24oJHNjb3BlLCAkaW50ZXJ2YWwsICR3aW5kb3csIHNvY2tldFNlcnZpY2UsIGRpc3BsYXlTZXJ2aWNlLCBwbGF5ZXJTZXJ2aWNlKXtcbiAgICAgICAgJHNjb3BlLlBDU2hvdyA9IGRpc3BsYXlTZXJ2aWNlLmdldFBDU2hvdztcbiAgICAgICAgJHNjb3BlLnN0YXJ0R2FtZSA9IGZhbHNlO1xuICAgICAgICB2YXIgY2FudiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdnYW1lJyk7XG4gICAgICAgIHZhciBjdHggPSBjYW52LmdldENvbnRleHQoJzJkJyk7XG5cbiAgICAgICAgdmFyIEFsbFBsYXllcnMgPSBuZXcgQXJyYXkoKTtcbiAgICAgICAgdmFyIEFsbEJ1bGxldHMgPSBuZXcgQXJyYXkoKTtcblxuICAgICAgICB2YXIgY3ljbGU7XG5cbiAgICAgICAgc29ja2V0U2VydmljZS5vbihcImluaXRHYW1lXCIsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgQnVmZmVyUGxheWVyID0gcGxheWVyU2VydmljZS5nZXRQbGF5ZXJzKCk7XG4gICAgICAgICAgICBmb3IodmFyIHBsYXllciBpbiBCdWZmZXJQbGF5ZXIpe1xuICAgICAgICAgICAgICAgIHZhciBwID0gQnVmZmVyUGxheWVyW3BsYXllcl07XG4gICAgICAgICAgICAgICAgQWxsUGxheWVycy5wdXNoKG5ldyBTcGFjZXNoaXAocC51c2VybmFtZSwgcC54LCBwLnksIHAuY29sb3IsIHAucm90YXRpb24pKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgY3ljbGUgPSAkaW50ZXJ2YWwoZHJhdywgMTApO1xuICAgICAgICB9KTtcblxuICAgICAgICBzb2NrZXRTZXJ2aWNlLm9uKFwidXNlcmxlZnRcIiwgZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgIHZhciBwID0gbnVsbDtcbiAgICAgICAgICAgIGZvcih2YXIgaSBpbiBBbGxQbGF5ZXJzKXtcbiAgICAgICAgICAgICAgICBpZihmaWx0ZXJQbGF5ZXJzKEFsbFBsYXllcnNbaV0sZGF0YSkgPT0gdHJ1ZSl7XG4gICAgICAgICAgICAgICAgICAgIHAgPSBpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIEFsbFBsYXllcnMuc3BsaWNlKHAsMSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHNvY2tldFNlcnZpY2Uub24oXCJ1cGRhdGVHYW1lRGF0YVwiLCBmdW5jdGlvbihkYXRhKXtcbiAgICAgICAgICAgIHZhciBwID0gbnVsbDtcbiAgICAgICAgICAgIGZvcih2YXIgaSBpbiBBbGxQbGF5ZXJzKXtcbiAgICAgICAgICAgICAgICBpZihmaWx0ZXJQbGF5ZXJzKEFsbFBsYXllcnNbaV0sZGF0YSkgPT0gdHJ1ZSl7XG4gICAgICAgICAgICAgICAgICAgIHAgPSBpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmKHAgIT0gbnVsbCl7XG4gICAgICAgICAgICAgICAgQWxsUGxheWVyc1twXS5yb3RhdGVTcGFjZXNoaXBSZWxhdGl2ZShkYXRhLm9yaWVudGF0aW9uKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgc29ja2V0U2VydmljZS5vbihcInBsYXllclNob3RcIiwgZnVuY3Rpb24oZGF0YSl7XG4gICAgICAgICAgICB2YXIgcCA9IG51bGw7XG4gICAgICAgICAgICBmb3IodmFyIGkgaW4gQWxsUGxheWVycyl7XG4gICAgICAgICAgICAgICAgaWYoZmlsdGVyUGxheWVycyhBbGxQbGF5ZXJzW2ldLGRhdGEpID09IHRydWUpe1xuICAgICAgICAgICAgICAgICAgICBwID0gaTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZihwICE9IG51bGwpe1xuICAgICAgICAgICAgICAgIHZhciB0ZW1wID0gQWxsUGxheWVyc1twXTtcbiAgICAgICAgICAgICAgICB2YXIgYW5nbGUgPSAoMzYwIC0odGVtcC5yb3RhdGlvbiArIDE4MCkpLzE4MCpNYXRoLlBJO1xuICAgICAgICAgICAgICAgIHZhciB4ID0gdGVtcC54ICsgKGNhbnYud2lkdGgvNDAwICogTWF0aC5zaW4oYW5nbGUpKTtcbiAgICAgICAgICAgICAgICB2YXIgeSA9IHRlbXAueSArIChjYW52LndpZHRoLzQwMCAqIE1hdGguY29zKGFuZ2xlKSk7XG4gICAgICAgICAgICAgICAgQWxsQnVsbGV0cy5wdXNoKG5ldyBCdWxsZXQoeCwgeSwgdGVtcC5yb3RhdGlvbiwgdGVtcC5jb2xvciwgdGVtcC51c2VyTmFtZSkpO1xuICAgICAgICAgICAgICAgIGlmKHAlMiA9PSAwKXtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHNob3QgPSBuZXcgQXVkaW8oJy4uLy4uL2Fzc2V0cy9Cb251cy9zZnhfbGFzZXIxLm9nZycpO1xuICAgICAgICAgICAgICAgIH1lbHNle1xuICAgICAgICAgICAgICAgICAgICB2YXIgc2hvdCA9IG5ldyBBdWRpbygnLi4vLi4vYXNzZXRzL0JvbnVzL3NmeF9sYXNlcjIub2dnJyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHNob3QucGxheSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICBmdW5jdGlvbiBmaWx0ZXJQbGF5ZXJzKG9iaixkYXRhKXtcbiAgICAgICAgICAgIGlmKGRhdGEudXNlcm5hbWUgPT0gb2JqLnVzZXJOYW1lKXtcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIH1lbHNle1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGRyYXcoKXtcbiAgICAgICAgICAgIGlmKEFsbFBsYXllcnMubGVuZ3RoPjApe1xuICAgICAgICAgICAgICAgIEFsbFBsYXllcnNbMF0uc3BlZWQgPSAwO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY3R4LmNsZWFyUmVjdCgwLDAsY2Fudi53aWR0aCwgY2Fudi5oZWlnaHQpO1xuICAgICAgICAgICAgdmFyIHJhdGlvID0gY2Fudi53aWR0aC8xMDA7XG5cbiAgICAgICAgICAgIGlmKEFsbEJ1bGxldHMubGVuZ3RoICE9IDApe1xuICAgICAgICAgICAgICAgIHZhciBCdWxsZXRXaWR0aCA9IGNhbnYud2lkdGgvMTAwO1xuICAgICAgICAgICAgICAgIHZhciBCdWxsZXRIZWlnaHQgPSBCdWxsZXRXaWR0aCAqIEFsbEJ1bGxldHNbMF0uaW1hZ2UuaGVpZ2h0L0FsbEJ1bGxldHNbMF0uaW1hZ2Uud2lkdGg7XG5cbiAgICAgICAgICAgICAgICBmb3IodmFyIGJ1bGxldCBpbiBBbGxCdWxsZXRzKXtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGIgPSBBbGxCdWxsZXRzW2J1bGxldF07XG4gICAgICAgICAgICAgICAgICAgIGIud2lkdGggPSBCdWxsZXRXaWR0aDtcbiAgICAgICAgICAgICAgICAgICAgYi5oZWlnaHQgPSBCdWxsZXRIZWlnaHQ7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYoYi5leHBsb2RlU3RhZ2UgPT0gMCl7XG4gICAgICAgICAgICAgICAgICAgICAgICAvL0RyYXcgYnVsbGV0XG4gICAgICAgICAgICAgICAgICAgICAgICBjdHguc2F2ZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgY3R4LnRyYW5zbGF0ZShiLngqcmF0aW8sIGIueSpyYXRpbyk7XG4gICAgICAgICAgICAgICAgICAgICAgICBjdHgucm90YXRlKGIucm90YXRpb24vMTgwKk1hdGguUEkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgY3R4LmRyYXdJbWFnZShiLmltYWdlLCAtQnVsbGV0V2lkdGgvMiwgLUJ1bGxldEhlaWdodC8yLCBCdWxsZXRXaWR0aCwgQnVsbGV0SGVpZ2h0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5yZXN0b3JlKCk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIEFsbEJ1bGxldHNbYnVsbGV0XS54ID0gTWF0aC5jb3MoKGIucm90YXRpb24gLSA5MCkvMTgwKk1hdGguUEkpICsgYi54O1xuICAgICAgICAgICAgICAgICAgICAgICAgQWxsQnVsbGV0c1tidWxsZXRdLnkgPSBNYXRoLnNpbigoYi5yb3RhdGlvbiAtIDkwKS8xODAqTWF0aC5QSSkrIGIueTtcbiAgICAgICAgICAgICAgICAgICAgfWVsc2UgaWYoYi5leHBsb2RlU3RhZ2UgPCA0KXtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vRHJhdyBleHBsb3Npb25cbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGIuZXhwbG9zaW9uSW1hZ2UpO1xuICAgICAgICAgICAgICAgICAgICAgICAgY3R4LnNhdmUoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGN0eC50cmFuc2xhdGUoYi54KnJhdGlvLCBiLnkqcmF0aW8pO1xuICAgICAgICAgICAgICAgICAgICAgICAgY3R4LmRyYXdJbWFnZShiLmV4cGxvc2lvbkltYWdlLCAtQnVsbGV0V2lkdGgsIC1CdWxsZXRXaWR0aCwgQnVsbGV0V2lkdGgqMiwgQnVsbGV0V2lkdGgqMik7XG4gICAgICAgICAgICAgICAgICAgICAgICBjdHgucmVzdG9yZSgpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZihBbGxQbGF5ZXJzLmxlbmd0aCAhPSAwKXtcbiAgICAgICAgICAgICAgICB2YXIgU3BhY2VzaGlwV2lkdGggPSBjYW52LndpZHRoLzIwO1xuICAgICAgICAgICAgICAgIHZhciBTcGFjZXNoaXBIZWlnaHQgPSBTcGFjZXNoaXBXaWR0aCAqIEFsbFBsYXllcnNbMF0uaW1hZ2UuaGVpZ2h0LyBBbGxQbGF5ZXJzWzBdLmltYWdlLndpZHRoO1xuXG4gICAgICAgICAgICAgICAgZm9yKHZhciBwbGF5ZXIgaW4gQWxsUGxheWVycyl7XG4gICAgICAgICAgICAgICAgICAgIHZhciBwID0gQWxsUGxheWVyc1twbGF5ZXJdO1xuICAgICAgICAgICAgICAgICAgICBwLndpZHRoID0gU3BhY2VzaGlwV2lkdGg7XG4gICAgICAgICAgICAgICAgICAgIHAuaGVpZ2h0ID0gU3BhY2VzaGlwSGVpZ2h0O1xuICAgICAgICAgICAgICAgICAgICBjdHguc2F2ZSgpO1xuICAgICAgICAgICAgICAgICAgICBjdHgudHJhbnNsYXRlKHAueCpyYXRpbywgcC55KnJhdGlvKTtcbiAgICAgICAgICAgICAgICAgICAgY3R4LnJvdGF0ZShwLnJvdGF0aW9uLzE4MCpNYXRoLlBJKTtcbiAgICAgICAgICAgICAgICAgICAgY3R4LmRyYXdJbWFnZShwLmltYWdlLCAtU3BhY2VzaGlwV2lkdGgvMiwgLVNwYWNlc2hpcEhlaWdodC8yLCBTcGFjZXNoaXBXaWR0aCwgU3BhY2VzaGlwSGVpZ2h0KTtcbiAgICAgICAgICAgICAgICAgICAgaWYocC5kYW1hZ2UgPiAwKXtcbiAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5kcmF3SW1hZ2UocC5kYW1hZ2VJbWFnZSwgLVNwYWNlc2hpcFdpZHRoLzIsIC1TcGFjZXNoaXBIZWlnaHQvMiwgU3BhY2VzaGlwV2lkdGgsIFNwYWNlc2hpcEhlaWdodCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgY3R4LnJlc3RvcmUoKTtcbiAgICAgICAgICAgICAgICAgICAgQWxsUGxheWVyc1twbGF5ZXJdLnggPSBNYXRoLmNvcygocC5yb3RhdGlvbiAtIDkwKS8xODAqTWF0aC5QSSkvMTAqIHAuc3BlZWQgKyBwLng7XG4gICAgICAgICAgICAgICAgICAgIEFsbFBsYXllcnNbcGxheWVyXS55ID0gTWF0aC5zaW4oKHAucm90YXRpb24gLSA5MCkvMTgwKk1hdGguUEkpLzEwKiBwLnNwZWVkICsgcC55O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgY2hlY2tCdWxsZXRzKCk7XG5cbiAgICAgICAgICAgIGNvbGxpc2lvbkRldGVjdGlvbigpO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gY2hlY2tCdWxsZXRzKCl7XG5cbiAgICAgICAgICAgIGZvcih2YXIgYiBpbiBBbGxCdWxsZXRzKXtcbiAgICAgICAgICAgICAgICBpZihBbGxCdWxsZXRzW2JdLnggPCAwIHx8IEFsbEJ1bGxldHNbYl0ueCA+IGNhbnYud2lkdGggfHwgQWxsQnVsbGV0c1tiXS55IDwgMCB8fCBBbGxCdWxsZXRzW2JdLnkgPiBjYW52LmhlaWdodCl7XG4gICAgICAgICAgICAgICAgICAgIEFsbEJ1bGxldHMuc3BsaWNlKGIsIDEpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gY29sbGlzaW9uRGV0ZWN0aW9uKCl7XG4gICAgICAgICAgICBmb3IodmFyIHAgaW4gQWxsUGxheWVycyl7XG4gICAgICAgICAgICAgICAgZm9yKHZhciBiIGluIEFsbEJ1bGxldHMpe1xuICAgICAgICAgICAgICAgICAgICBpZihBbGxCdWxsZXRzW2JdLnBsYXllciAhPSBBbGxQbGF5ZXJzW3BdLnVzZXJOYW1lKXtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciByYWRpdXMgPSBNYXRoLnNxcnQoMikvMiooQWxsQnVsbGV0c1tiXS5oZWlnaHQvMiAtIEFsbEJ1bGxldHNbYl0ud2lkdGgvMik7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgYW5nbGUgPSAoMzYwIC0oQWxsQnVsbGV0c1tiXS5yb3RhdGlvbikpLzE4MCpNYXRoLlBJO1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGJ1bGxldEhlYWRYID0gKEFsbEJ1bGxldHNbYl0ueCpjYW52LndpZHRoLzEwMCAtIChyYWRpdXMgKiBNYXRoLnNpbihhbmdsZSkpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBidWxsZXRIZWFkWSA9IChBbGxCdWxsZXRzW2JdLnkqY2Fudi53aWR0aC8xMDAgLSAocmFkaXVzICogTWF0aC5jb3MoYW5nbGUpKSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzcGFjZVNoaXBYID0gQWxsUGxheWVyc1twXS54KmNhbnYud2lkdGgvMTAwO1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHNwYWNlU2hpcFkgPSBBbGxQbGF5ZXJzW3BdLnkqY2Fudi53aWR0aC8xMDA7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIC8qY3R4LnNhdmUoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5iZWdpblBhdGgoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5hcmMoc3BhY2VTaGlwWCwgc3BhY2VTaGlwWSwgQWxsUGxheWVyc1twXS53aWR0aC8yLCAwLCBNYXRoLlBJKjIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgY3R4LmxpbmVXaWR0aCA9IDE7XG4gICAgICAgICAgICAgICAgICAgICAgICBjdHguc3Ryb2tlU3R5bGUgPSAnIzAwMDBGRic7XG4gICAgICAgICAgICAgICAgICAgICAgICBjdHguc3Ryb2tlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBjdHgucmVzdG9yZSgpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBjdHguc2F2ZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgY3R4LmJlZ2luUGF0aCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgY3R4LmFyYyhidWxsZXRIZWFkWCwgYnVsbGV0SGVhZFksIEFsbEJ1bGxldHNbYl0ud2lkdGgvMiwgMCwgTWF0aC5QSSoyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5saW5lV2lkdGggPSAxO1xuICAgICAgICAgICAgICAgICAgICAgICAgY3R4LnN0cm9rZVN0eWxlID0gJyNGRjAwMDAnO1xuICAgICAgICAgICAgICAgICAgICAgICAgY3R4LnN0cm9rZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgY3R4LnJlc3RvcmUoKTsqL1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGRpc3RhbmNlID0gTWF0aC5zcXJ0KChidWxsZXRIZWFkWC1zcGFjZVNoaXBYKSooYnVsbGV0SGVhZFgtc3BhY2VTaGlwWCkgKyAoYnVsbGV0SGVhZFktc3BhY2VTaGlwWSkqKGJ1bGxldEhlYWRZLXNwYWNlU2hpcFkpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmKGRpc3RhbmNlIDwgKEFsbEJ1bGxldHNbYl0ud2lkdGgvMiArIEFsbFBsYXllcnNbcF0ud2lkdGgvMikpe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBkYW1hZ2Vzb3VuZCA9IG5ldyBBdWRpbygnLi4vLi4vYXNzZXRzL0JvbnVzL3NmeF9sb3NlLm9nZycpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhbWFnZXNvdW5kLnBsYXkoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBBbGxQbGF5ZXJzW3BdLmluY3JlYXNlRGFtYWdlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoQWxsQnVsbGV0c1tiXS5leHBsb2RlU3RhZ2UgPCA0KXtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQWxsQnVsbGV0c1tiXS5leHBsb2RlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfWVsc2V7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEFsbEJ1bGxldHMuc3BsaWNlKGIsIDEpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH07XG5cbiAgICBhbmd1bGFyLm1vZHVsZShcImFwcFwiKS5jb250cm9sbGVyKFwicGxheUNvbnRyb2xsZXJcIiwgW1wiJHNjb3BlXCIsIFwiJGludGVydmFsXCIsIFwiJHdpbmRvd1wiLCBcInNvY2tldFNlcnZpY2VcIiwgXCJkaXNwbGF5U2VydmljZVwiLCBcInBsYXllclNlcnZpY2VcIiwgcGxheUNvbnRyb2xsZXJdKVxufSkoKTsiLCIvKipcbiAqIENyZWF0ZWQgYnkganVzdGlqbmRlcG92ZXIgb24gMjIvMTIvMTUuXG4gKi9cblxudmFyIEJ1bGxldCA9IGZ1bmN0aW9uKHgsIHkscm90YXRpb24sIGNvbG9yLCBwbGF5ZXIpe1xuICAgIHRoaXMueCA9IHg7XG4gICAgdGhpcy55ID0geTtcbiAgICB0aGlzLnJvdGF0aW9uID0gcm90YXRpb247XG4gICAgdGhpcy5pbWFnZSA9IG5ldyBJbWFnZSgpO1xuICAgIHRoaXMuY29sb3IgPSBjb2xvcjtcbiAgICB0aGlzLndpZHRoID0gMDtcbiAgICB0aGlzLmhlaWdodCA9IDA7XG4gICAgdGhpcy5wbGF5ZXIgPSBwbGF5ZXI7XG4gICAgdGhpcy5leHBsb3Npb25JbWFnZSA9IG5ldyBJbWFnZSgpO1xuICAgIHRoaXMuZXhwbG9kZVN0YWdlID0gMDtcbiAgICBpZih0aGlzLmNvbG9yID09IFwib3JhbmdlXCIpe1xuICAgICAgICB0aGlzLmNvbG9yID0gJ3JlZCc7XG4gICAgfVxuICAgIHRoaXMuaW1hZ2Uuc3JjID0gJy4uL2Fzc2V0cy9QTkcvTGFzZXJzL2xhc2VyJysgdGhpcy5jb2xvci5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArIHRoaXMuY29sb3Iuc2xpY2UoMSkgKycwMS5wbmcnXG59O1xuXG5CdWxsZXQucHJvdG90eXBlLmV4cGxvZGUgPSBmdW5jdGlvbigpe1xuICAgIGlmKHRoaXMuZXhwbG9kZVN0YWdlIDwgNCl7XG4gICAgICAgIHRoaXMuZXhwbG9kZVN0YWdlKys7XG4gICAgICAgIHZhciBudW1iZXI7XG4gICAgICAgIGlmKHRoaXMuZXhwbG9kZVN0YWdlIDwgMyl7XG4gICAgICAgICAgIG51bWJlciA9IDFcbiAgICAgICAgfWVsc2V7XG4gICAgICAgICAgICBudW1iZXIgPSAyXG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5leHBsb3Npb25JbWFnZS5zcmMgPSAnLi4vYXNzZXRzL1BORy9MYXNlcnMvbGFzZXInICsgdGhpcy5jb2xvci5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArIHRoaXMuY29sb3Iuc2xpY2UoMSkgKyAnRXhwbG9kZScrIG51bWJlciArJy5wbmcnO1xuICAgIH1lbHNle1xuICAgICAgICB0aGlzLmV4cGxvc2lvbkltYWdlLnNyYyA9ICcnO1xuICAgIH1cbn07XG4iLCIvKipcbiAqIENyZWF0ZWQgYnkganVzdGlqbmRlcG92ZXIgb24gMDkvMTIvMTUuXG4gKi9cblxudmFyIFNwYWNlc2hpcCA9IGZ1bmN0aW9uKHVzZXJOYW1lLCB4LCB5LCBjb2xvciwgcm90YXRpb24pe1xuICAgIHRoaXMudXNlck5hbWUgPSB1c2VyTmFtZTtcbiAgICB0aGlzLnggPSB4O1xuICAgIHRoaXMueSA9IHk7XG4gICAgdGhpcy5zcGVlZCA9IDE7XG4gICAgdGhpcy5jb2xvciA9IGNvbG9yO1xuICAgIHRoaXMucm90YXRpb24gPSByb3RhdGlvbjtcbiAgICB0aGlzLmltYWdlID0gbmV3IEltYWdlKCk7XG4gICAgdGhpcy5kYW1hZ2UgPSAwO1xuICAgIHRoaXMud2lkdGggPSAwO1xuICAgIHRoaXMuaGVpZ2h0ID0gMDtcbiAgICB0aGlzLmRhbWFnZUltYWdlID0gbmV3IEltYWdlKCk7XG4gICAgdGhpcy5pbWFnZS5zcmMgPSAnLi4vYXNzZXRzL1BORy9wbGF5ZXJTaGlwMV8nKyB0aGlzLmNvbG9yICsnLnBuZydcbn07XG5cblNwYWNlc2hpcC5wcm90b3R5cGUubW92ZVNwYWNlc2hpcCA9IGZ1bmN0aW9uKHgsIHkpe1xuICAgIHRoaXMueCA9IHg7XG4gICAgdGhpcy55ID0geTtcbn07XG5cblNwYWNlc2hpcC5wcm90b3R5cGUubW92ZVNwYWNlc2hpcFJlbGF0aXZlID0gZnVuY3Rpb24oeCwgeSl7XG4gICAgdGhpcy54ID0gdGhpcy54K3g7XG4gICAgdGhpcy55ID0gdGhpcy55K3k7XG59O1xuXG5TcGFjZXNoaXAucHJvdG90eXBlLnJvdGF0ZVNwYWNlc2hpcCA9IGZ1bmN0aW9uKGRlZ3JlZSl7XG4gICAgdGhpcy5yb3RhdGlvbiA9IGRlZ3JlZTtcbn07XG5cblNwYWNlc2hpcC5wcm90b3R5cGUucm90YXRlU3BhY2VzaGlwUmVsYXRpdmUgPSBmdW5jdGlvbihkZWdyZWUpe1xuICAgIHRoaXMucm90YXRpb24gPSB0aGlzLnJvdGF0aW9uICsgZGVncmVlLzU7XG4gICAgaWYodGhpcy5yb3RhdGlvbiA8IC0zNjApe1xuICAgICAgICB0aGlzLnJvdGF0aW9uID0gdGhpcy5yb3RhdGlvbiArIDcyMDtcbiAgICB9XG4gICAgaWYodGhpcy5yb3RhdGlvbiA+IDM2MCl7XG4gICAgICAgIHRoaXMucm90YXRpb24gPSB0aGlzLnJvdGF0aW9uIC0gNzIwO1xuICAgIH1cbn07XG5cblNwYWNlc2hpcC5wcm90b3R5cGUuaW5jcmVhc2VEYW1hZ2UgPSBmdW5jdGlvbigpe1xuICAgIGlmKHRoaXMuZGFtYWdlIDwgNCl7XG4gICAgICAgIHRoaXMuZGFtYWdlICs9IDE7XG4gICAgfVxuXG4gICAgaWYodGhpcy5kYW1hZ2UgPD0gMyAmJiB0aGlzLmRhbWFnZSA+IDApe1xuICAgICAgICB0aGlzLmRhbWFnZUltYWdlLnNyYyA9ICcuLi9hc3NldHMvUE5HL0RhbWFnZS9wbGF5ZXJTaGlwMV9kYW1hZ2UnKyB0aGlzLmRhbWFnZSArICcucG5nJztcbiAgICB9XG59O1xuXG5TcGFjZXNoaXAucHJvdG90eXBlLmRlY3JlYXNlRGFtYWdlID0gZnVuY3Rpb24oKXtcbiAgICBpZih0aGlzLmRhbWFnZSA+IDApe1xuICAgICAgICB0aGlzLmRhbWFnZSAtPSAxO1xuICAgIH1cblxuICAgIGlmKHRoaXMuZGFtYWdlIDw9IDMgJiYgdGhpcy5kYW1hZ2UgPiAwKXtcbiAgICAgICAgdGhpcy5kYW1hZ2VJbWFnZS5zcmMgPSAnLi4vYXNzZXRzL1BORy9EYW1hZ2UvcGxheWVyU2hpcDFfZGFtYWdlJysgdGhpcy5kYW1hZ2UgKyAnLnBuZyc7XG4gICAgfVxufTtcblxuIiwiLyoqXG4gKiBDcmVhdGVkIGJ5IGp1c3Rpam5kZXBvdmVyIG9uIDE2LzEyLzE1LlxuICovXG4oZnVuY3Rpb24oKXtcbiAgICB2YXIgY2FudmFzRGlyZWN0aXZlID0gZnVuY3Rpb24oJHdpbmRvdyl7XG4gICAgICAgIHJldHVybntcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnRScsXG4gICAgICAgICAgICBsaW5rOmxpbmssXG4gICAgICAgICAgICByZXBsYWNlOnRydWUsXG4gICAgICAgICAgICB0ZW1wbGF0ZTonPGNhbnZhcyBpZD1cImdhbWVcIiBjbGFzcz1cInBsYXlBcmVhXCIgd2lkdGg9XCJ7e3dpZHRofX1cIiBoZWlnaHQ9XCJ7e3dpZHRofX1cIiAvPidcbiAgICAgICAgfTtcblxuICAgICAgICBmdW5jdGlvbiBsaW5rKHNjb3BlLCBlbGVtZW50LCBhdHRycyl7XG4gICAgICAgICAgICBpZigkd2luZG93LmlubmVyV2lkdGggPCAkd2luZG93LmlubmVySGVpZ2h0KXtcbiAgICAgICAgICAgICAgICBzY29wZS53aWR0aCA9ICR3aW5kb3cuaW5uZXJXaWR0aCAtIDIwO1xuICAgICAgICAgICAgfWVsc2V7XG4gICAgICAgICAgICAgICAgc2NvcGUud2lkdGggPSAkd2luZG93LmlubmVySGVpZ2h0IC0gMjA7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGFuZ3VsYXIuZWxlbWVudCgkd2luZG93KS5iaW5kKCdyZXNpemUnLCBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIGlmKCR3aW5kb3cuaW5uZXJXaWR0aCA8ICR3aW5kb3cuaW5uZXJIZWlnaHQpe1xuICAgICAgICAgICAgICAgICAgICBzY29wZS53aWR0aCA9ICR3aW5kb3cuaW5uZXJXaWR0aCAtIDIwO1xuICAgICAgICAgICAgICAgIH1lbHNle1xuICAgICAgICAgICAgICAgICAgICBzY29wZS53aWR0aCA9ICR3aW5kb3cuaW5uZXJIZWlnaHQgLSAyMDtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBzY29wZS4kZGlnZXN0KCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwJykuZGlyZWN0aXZlKFwiY2FudmFzRGlyZWN0aXZlXCIsIFtcIiR3aW5kb3dcIiwgY2FudmFzRGlyZWN0aXZlXSk7XG59KSgpOyIsIi8qKlxuICogQ3JlYXRlZCBieSBNaWNoaWVsIG9uIDE2LzEyLzIwMTUuXG4gKi9cbi8qKlxuICogQ3JlYXRlZCBieSBqdXN0aWpuZGVwb3ZlciBvbiAxNi8xMi8xNS5cbiAqL1xuXG5cbihmdW5jdGlvbigpe1xuICAgIHZhciBkaXNwbGF5U2VydmljZSA9IGZ1bmN0aW9uKCl7XG4gICAgICAgIC8vTG9naW4gQ29udHJvbGxlclxuICAgICAgICB2YXIgTENTaG93ID0gdHJ1ZTtcbiAgICAgICAgLy9QbGF5IGNvbnRyb2xsZXJcbiAgICAgICAgdmFyIFBDU2hvdyA9IGZhbHNlO1xuXG4gICAgICAgIHJldHVybntcbiAgICAgICAgICAgIGdldExDU2hvdzogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICByZXR1cm4gTENTaG93O1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHNldExDU2hvdzogZnVuY3Rpb24odmFsdWUpe1xuICAgICAgICAgICAgICAgIExDU2hvdyA9IHZhbHVlO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldFBDU2hvdzogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICByZXR1cm4gUENTaG93O1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHNldFBDU2hvdzogZnVuY3Rpb24odmFsdWUpe1xuICAgICAgICAgICAgICAgIFBDU2hvdyA9IHZhbHVlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfTtcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdhcHAnKS5mYWN0b3J5KCdkaXNwbGF5U2VydmljZScsIFtkaXNwbGF5U2VydmljZV0pO1xufSkoKTsiLCIvKipcbiAqIENyZWF0ZWQgYnkganVzdGlqbmRlcG92ZXIgb24gMTcvMTIvMTUuXG4gKi9cblxuKGZ1bmN0aW9uKCl7XG4gICAgdmFyIHBsYXllclNlcnZpY2UgPSBmdW5jdGlvbigpe1xuICAgICAgICAvL0xvZ2luIENvbnRyb2xsZXJcbiAgICAgICAgdmFyIHBsYXllcnMgPSBbXTtcblxuICAgICAgICByZXR1cm57XG4gICAgICAgICAgICBnZXRQbGF5ZXJzOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIHJldHVybiBwbGF5ZXJzO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHNldFBsYXllcnM6IGZ1bmN0aW9uKHBsYXllcnNBcnJheSl7XG4gICAgICAgICAgICAgICAgcGxheWVycyA9IHBsYXllcnNBcnJheTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH07XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwJykuZmFjdG9yeSgncGxheWVyU2VydmljZScsIFtwbGF5ZXJTZXJ2aWNlXSk7XG59KSgpOyIsIi8qKlxuICogQ3JlYXRlZCBieSBqdXN0aWpuZGVwb3ZlciBvbiAwOS8xMi8xNS5cbiAqL1xuXG4oZnVuY3Rpb24oKXtcblxuICAgIHZhciBzb2NrZXRTZXJ2aWNlID0gZnVuY3Rpb24oJHJvb3RTY29wZSl7XG4gICAgICAgIFwidXNlIHN0cmljdFwiO1xuICAgICAgICAvL3ByaXZhdGVcbiAgICAgICAgdmFyIHNvY2tldCA9IGlvLmNvbm5lY3Qod2luZG93LmxvY2F0aW9uLmhvc3QpO1xuICAgICAgICAvL2Z1bmN0aW9uc1xuICAgICAgICB2YXIgb24gPSBmdW5jdGlvbiAoZXZlbnROYW1lLCBjYWxsYmFjaykge1xuICAgICAgICAgICAgc29ja2V0Lm9uKGV2ZW50TmFtZSwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHZhciBhcmdzID0gYXJndW1lbnRzO1xuICAgICAgICAgICAgICAgICRyb290U2NvcGUuJGFwcGx5KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2suYXBwbHkoc29ja2V0LCBhcmdzKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBlbWl0ID0gZnVuY3Rpb24gKGV2ZW50TmFtZSwgZGF0YSwgY2FsbGJhY2spIHtcbiAgICAgICAgICAgIHNvY2tldC5lbWl0KGV2ZW50TmFtZSwgZGF0YSwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHZhciBhcmdzID0gYXJndW1lbnRzO1xuICAgICAgICAgICAgICAgICRyb290U2NvcGUuJGFwcGx5KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNhbGxiYWNrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFjay5hcHBseShzb2NrZXQsIGFyZ3MpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KVxuICAgICAgICB9O1xuXG4gICAgICAgIC8vcHVibGljXG4gICAgICAgIHJldHVybntcbiAgICAgICAgICAgIG9uOiBvbixcbiAgICAgICAgICAgIGVtaXQ6IGVtaXQsXG4gICAgICAgICAgICBzb2NrZXQ6IHNvY2tldFxuICAgICAgICB9XG4gICAgfTtcblxuICAgIGFuZ3VsYXIubW9kdWxlKFwiYXBwXCIpLmZhY3RvcnkoXCJzb2NrZXRTZXJ2aWNlXCIsIFtcIiRyb290U2NvcGVcIiwgc29ja2V0U2VydmljZV0pO1xuXG59KSgpOyJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
