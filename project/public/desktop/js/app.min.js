!function(){angular.module("app",[])}(),function(){var e=function(e,t,a,i){e.LCShow=a.getLCShow;var n=function(){t.emit("pcconnect",null)};e.room="",t.on("requestRoom",function(t){e.room=t}),t.on("deviceOrientation",function(e){var t=(e.username,{});t.gamma=e.gamma,t.beta=e.beta,t.alpha=e.alpha}),e.usernames={},e.checkUserCount=!1,t.on("updateusers",function(t){i.setPlayers(t),e.usernames=t,e.checkUserCount=Object.keys(e.usernames).length<0}),e.startGame=function(){t.emit("startGame",null),a.setLCShow(!1),a.setPCShow(!0)},function(){n()}()};angular.module("app").controller("loginController",["$scope","socketService","displayService","playerService",e])}(),function(){"use strict";var e=function(e,t,a,i,n,o){function r(e,t){return t.username==e.userName}function s(){d.length>0,m.clearRect(0,0,u.width,u.height);var e=u.width/100;if(0!=f.length){var t=u.width/100,a=t*f[0].image.height/f[0].image.width;for(var i in f){var n=f[i];n.width=t,n.height=a,0==n.explodeStage?(m.save(),m.translate(n.x*e,n.y*e),m.rotate(n.rotation/180*Math.PI),m.drawImage(n.image,-t/2,-a/2,t,a),m.restore(),f[i].x=Math.cos((n.rotation-90)/180*Math.PI)+n.x,f[i].y=Math.sin((n.rotation-90)/180*Math.PI)+n.y):n.explodeStage<4&&(console.log(n.explosionImage),m.save(),m.translate(n.x*e,n.y*e),m.drawImage(n.explosionImage,-t,-t,2*t,2*t),m.restore())}}if(0!=d.length){var o=u.width/20,r=o*d[0].image.height/d[0].image.width;for(var s in d){var l=d[s];l.width=o,l.height=r,m.save(),m.translate(l.x*e,l.y*e),m.rotate(l.rotation/180*Math.PI),m.drawImage(l.image,-o/2,-r/2,o,r),l.damage>0&&m.drawImage(l.damageImage,-o/2,-r/2,o,r),m.restore(),d[s].x=Math.cos((l.rotation-90)/180*Math.PI)/10*l.speed+l.x,d[s].y=Math.sin((l.rotation-90)/180*Math.PI)/10*l.speed+l.y}}h(),c()}function h(){for(var e in f)f[e].x<0||f[e].x>u.width||f[e].y<0||f[e].y>u.height?f.splice(e,1):f[e].explodeStage>0&&(f[e].explodeStage<4?f[e].explode():f.splice(e,1))}function c(){var e=[];for(var t in d){d[t].damage<4&&e.push(d[t]);for(var a in f)if(0==f[a].explodeStage&&f[a].player!=d[t].userName){var n=Math.sqrt(2)/2*(f[a].height/2-f[a].width/2),o=(360-f[a].rotation)/180*Math.PI,r=f[a].x*u.width/100-n*Math.sin(o),s=f[a].y*u.width/100-n*Math.cos(o),h=d[t].x*u.width/100,c=d[t].y*u.width/100,p=Math.sqrt((r-h)*(r-h)+(s-c)*(s-c));if(p<f[a].width/2+d[t].width/2){d[t].increaseDamage();var g={};g.username=d[t].userName,g.life=3-d[t].damage,i.emit("playerLife",g),f[a].explode()}}}1==e.length&&l(e)}function l(a){angular.isDefined(g)&&(t.cancel(g),g=void 0),e.endGame=!0,e.endGameText=a[0].userName+" is the winner!",i.emit("endGame",a[0].userName)}var p=[{x:10,y:10,rotation:135},{x:90,y:10,rotation:225},{x:90,y:90,rotation:315},{x:10,y:90,rotation:45}];e.PCShow=n.getPCShow,e.endGame=!1;var g,u=document.getElementById("game"),m=u.getContext("2d"),d=new Array,f=new Array;i.on("initGame",function(){var e=o.getPlayers(),a=0;for(var i in e){var n=e[i];d.push(new Spaceship(n.username,p[a].x,p[a].y,n.color,p[a].rotation)),a++}g=t(s,10)}),i.on("userleft",function(e){var t=null;for(var a in d)1==r(d[a],e)&&(t=a);d.splice(t,1)}),i.on("updateGameData",function(e){var t=null;for(var a in d)1==r(d[a],e)&&(t=a);null!=t&&d[t].rotateSpaceshipRelative(e.orientation)}),i.on("playerShot",function(t){if(0==e.endGame){var a=null;for(var i in d)1==r(d[i],t)&&(a=i);if(null!=a){var n=d[a],o=(360-(n.rotation+180))/180*Math.PI,s=n.x+u.width/400*Math.sin(o),h=n.y+u.width/400*Math.cos(o);f.push(new Bullet(s,h,n.rotation,n.color,n.userName));var c="../../assets/Bonus/sfx_laser2.ogg";a%2==0&&(c="../../assets/Bonus/sfx_laser1.ogg");var l=new Audio(c);l.play()}}}),e.restartGame=function(){e.endGame=!1;var a=0;for(var n in d)d[n].reset(p[a].x,p[a].y,p[a].rotation),a++;m.clearRect(0,0,u.width,u.height),i.emit("restartGame",null),g=t(s,10)}};angular.module("app").controller("playController",["$scope","$interval","$window","socketService","displayService","playerService",e])}();var Bullet=function(e,t,a,i,n){this.x=e,this.y=t,this.rotation=a,this.image=new Image,this.color=i,this.width=0,this.height=0,this.player=n,this.explosionImage=new Image,this.explodeStage=0,"orange"==this.color&&(this.color="red"),this.image.src="../assets/PNG/Lasers/laser"+this.color.charAt(0).toUpperCase()+this.color.slice(1)+"01.png"};Bullet.prototype.explode=function(){if(this.explodeStage<4){this.explodeStage++;var e;e=this.explodeStage<3?1:2,this.explosionImage.src="../assets/PNG/Lasers/laser"+this.color.charAt(0).toUpperCase()+this.color.slice(1)+"Explode"+e+".png"}else this.explosionImage.src=""};var Spaceship=function(e,t,a,i,n){this.userName=e,this.x=t,this.y=a,this.speed=1,this.color=i,this.rotation=n,this.image=new Image,this.damage=0,this.width=0,this.height=0,this.damageImage=new Image,this.image.src="../assets/PNG/playerShip1_"+this.color+".png"};Spaceship.prototype.reset=function(e,t,a){this.speed=1,this.damage=0,this.damageImage=new Image,this.image.src="../assets/PNG/playerShip1_"+this.color+".png",this.x=e,this.y=t,this.rotation=a},Spaceship.prototype.moveSpaceship=function(e,t){this.x=e,this.y=t},Spaceship.prototype.moveSpaceshipRelative=function(e,t){this.x=this.x+e,this.y=this.y+t},Spaceship.prototype.rotateSpaceship=function(e){this.rotation=e},Spaceship.prototype.rotateSpaceshipRelative=function(e){this.rotation=this.rotation+e/5,this.rotation<-360&&(this.rotation=this.rotation+720),this.rotation>360&&(this.rotation=this.rotation-720)},Spaceship.prototype.increaseDamage=function(){this.damage<4&&(this.damage+=1),this.damage<=3&&this.damage>0?this.damageImage.src="../assets/PNG/Damage/playerShip1_damage"+this.damage+".png":4==this.damage&&(this.damageImage.src="../assets/PNG/Damage/explode.gif")},Spaceship.prototype.decreaseDamage=function(){this.damage>0&&(this.damage-=1),this.damage<=3&&this.damage>0&&(this.damageImage.src="../assets/PNG/Damage/playerShip1_damage"+this.damage+".png")},function(){var e=function(e){function t(t,a,i){e.innerWidth<e.innerHeight?t.width=e.innerWidth-20:t.width=e.innerHeight-20,angular.element(e).bind("resize",function(){e.innerWidth<e.innerHeight?t.width=e.innerWidth-20:t.width=e.innerHeight-20,t.$digest()})}return{restrict:"E",link:t,replace:!0,template:'<canvas id="game" class="playArea" width="{{width}}" height="{{width}}" />'}};angular.module("app").directive("canvasDirective",["$window",e])}(),function(){var e=function(){var e=!0,t=!1;return{getLCShow:function(){return e},setLCShow:function(t){e=t},getPCShow:function(){return t},setPCShow:function(e){t=e}}};angular.module("app").factory("displayService",[e])}(),function(){var e=function(){var e=[];return{getPlayers:function(){return e},setPlayers:function(t){e=t}}};angular.module("app").factory("playerService",[e])}(),function(){var e=function(e){"use strict";var t=io.connect(window.location.host),a=function(a,i){t.on(a,function(){var a=arguments;e.$apply(function(){i.apply(t,a)})})},i=function(a,i,n){t.emit(a,i,function(){var a=arguments;e.$apply(function(){n&&n.apply(t,a)})})};return{on:a,emit:i,socket:t}};angular.module("app").factory("socketService",["$rootScope",e])}();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyIsImNvbnRyb2xsZXIvbG9naW5Db250cm9sbGVyLmpzIiwiY29udHJvbGxlci9wbGF5Q29udHJvbGxlci5qcyIsIm1vZGVscy9CdWxsZXQuanMiLCJtb2RlbHMvU3BhY2VzaGlwLmpzIiwiZGlyZWN0aXZlcy9jYW52YXNEaXJlY3RpdmUuanMiLCJzZXJ2aWNlcy9kaXNwbGF5U2VydmljZS5qcyIsInNlcnZpY2VzL3BsYXllclNlcnZpY2UuanMiLCJzZXJ2aWNlcy9zb2NrZXRTZXJ2aWNlLmpzIl0sIm5hbWVzIjpbImFuZ3VsYXIiLCJtb2R1bGUiLCJsb2dpbkNvbnRyb2xsZXIiLCIkc2NvcGUiLCJzb2NrZXRTZXJ2aWNlIiwiZGlzcGxheVNlcnZpY2UiLCJwbGF5ZXJTZXJ2aWNlIiwiTENTaG93IiwiZ2V0TENTaG93IiwibWFrZVJvb20iLCJlbWl0Iiwicm9vbSIsIm9uIiwiZGF0YSIsImRldmljZU9yaWVudGF0aW9uIiwidXNlcm5hbWUiLCJnYW1tYSIsImJldGEiLCJhbHBoYSIsInVzZXJuYW1lcyIsImNoZWNrVXNlckNvdW50Iiwic2V0UGxheWVycyIsIk9iamVjdCIsImtleXMiLCJsZW5ndGgiLCJzdGFydEdhbWUiLCJzZXRMQ1Nob3ciLCJzZXRQQ1Nob3ciLCJjb250cm9sbGVyIiwicGxheUNvbnRyb2xsZXIiLCIkaW50ZXJ2YWwiLCIkd2luZG93IiwiZmlsdGVyUGxheWVycyIsIm9iaiIsInVzZXJOYW1lIiwiZHJhdyIsIkFsbFBsYXllcnMiLCJjdHgiLCJjbGVhclJlY3QiLCJjYW52Iiwid2lkdGgiLCJoZWlnaHQiLCJyYXRpbyIsIkFsbEJ1bGxldHMiLCJCdWxsZXRXaWR0aCIsIkJ1bGxldEhlaWdodCIsImltYWdlIiwiYnVsbGV0IiwiYiIsImV4cGxvZGVTdGFnZSIsInNhdmUiLCJ0cmFuc2xhdGUiLCJ4IiwieSIsInJvdGF0ZSIsInJvdGF0aW9uIiwiTWF0aCIsIlBJIiwiZHJhd0ltYWdlIiwicmVzdG9yZSIsImNvcyIsInNpbiIsImNvbnNvbGUiLCJsb2ciLCJleHBsb3Npb25JbWFnZSIsIlNwYWNlc2hpcFdpZHRoIiwiU3BhY2VzaGlwSGVpZ2h0IiwicGxheWVyIiwicCIsImRhbWFnZSIsImRhbWFnZUltYWdlIiwic3BlZWQiLCJjaGVja0J1bGxldHMiLCJjb2xsaXNpb25EZXRlY3Rpb24iLCJzcGxpY2UiLCJleHBsb2RlIiwibGl2aW5nUGxheWVycyIsInB1c2giLCJyYWRpdXMiLCJzcXJ0IiwiYW5nbGUiLCJidWxsZXRIZWFkWCIsImJ1bGxldEhlYWRZIiwic3BhY2VTaGlwWCIsInNwYWNlU2hpcFkiLCJkaXN0YW5jZSIsImluY3JlYXNlRGFtYWdlIiwibGlmZSIsImVuZEdhbWUiLCJpc0RlZmluZWQiLCJjeWNsZSIsImNhbmNlbCIsInVuZGVmaW5lZCIsImVuZEdhbWVUZXh0IiwiZGVmYXVsdFZhcnMiLCJQQ1Nob3ciLCJnZXRQQ1Nob3ciLCJkb2N1bWVudCIsImdldEVsZW1lbnRCeUlkIiwiZ2V0Q29udGV4dCIsIkFycmF5IiwiQnVmZmVyUGxheWVyIiwiZ2V0UGxheWVycyIsInRlbGxlciIsIlNwYWNlc2hpcCIsImNvbG9yIiwiaSIsInJvdGF0ZVNwYWNlc2hpcFJlbGF0aXZlIiwib3JpZW50YXRpb24iLCJ0ZW1wIiwiQnVsbGV0IiwiYXVkaW9VcmwiLCJzaG90IiwiQXVkaW8iLCJwbGF5IiwicmVzdGFydEdhbWUiLCJyZXNldCIsInRoaXMiLCJJbWFnZSIsInNyYyIsImNoYXJBdCIsInRvVXBwZXJDYXNlIiwic2xpY2UiLCJwcm90b3R5cGUiLCJudW1iZXIiLCJtb3ZlU3BhY2VzaGlwIiwibW92ZVNwYWNlc2hpcFJlbGF0aXZlIiwicm90YXRlU3BhY2VzaGlwIiwiZGVncmVlIiwiZGVjcmVhc2VEYW1hZ2UiLCJjYW52YXNEaXJlY3RpdmUiLCJsaW5rIiwic2NvcGUiLCJlbGVtZW50IiwiYXR0cnMiLCJpbm5lcldpZHRoIiwiaW5uZXJIZWlnaHQiLCJiaW5kIiwiJGRpZ2VzdCIsInJlc3RyaWN0IiwicmVwbGFjZSIsInRlbXBsYXRlIiwiZGlyZWN0aXZlIiwidmFsdWUiLCJmYWN0b3J5IiwicGxheWVycyIsInBsYXllcnNBcnJheSIsIiRyb290U2NvcGUiLCJzb2NrZXQiLCJpbyIsImNvbm5lY3QiLCJ3aW5kb3ciLCJsb2NhdGlvbiIsImhvc3QiLCJldmVudE5hbWUiLCJjYWxsYmFjayIsImFyZ3MiLCJhcmd1bWVudHMiLCIkYXBwbHkiLCJhcHBseSJdLCJtYXBwaW5ncyI6IkNBR0EsV0FFQUEsUUFBQUMsT0FBQSxhQ0RBLFdBQ0EsR0FBQUMsR0FBQSxTQUFBQyxFQUFBQyxFQUFBQyxFQUFBQyxHQUVBSCxFQUFBSSxPQUFBRixFQUFBRyxTQUdBLElBQUFDLEdBQUEsV0FDQUwsRUFBQU0sS0FBQSxZQUFBLE1BRUFQLEdBQUFRLEtBQUEsR0FDQVAsRUFBQVEsR0FBQSxjQUFBLFNBQUFDLEdBQ0FWLEVBQUFRLEtBQUFFLElBRUFULEVBQUFRLEdBQUEsb0JBQUEsU0FBQUMsR0FDQSxHQUNBQyxJQURBRCxFQUFBRSxZQUVBRCxHQUFBRSxNQUFBSCxFQUFBRyxNQUNBRixFQUFBRyxLQUFBSixFQUFBSSxLQUNBSCxFQUFBSSxNQUFBTCxFQUFBSyxRQUVBZixFQUFBZ0IsYUFDQWhCLEVBQUFpQixnQkFBQSxFQUNBaEIsRUFBQVEsR0FBQSxjQUFBLFNBQUFDLEdBQ0FQLEVBQUFlLFdBQUFSLEdBQ0FWLEVBQUFnQixVQUFBTixFQUNBVixFQUFBaUIsZUFBQUUsT0FBQUMsS0FBQXBCLEVBQUFnQixXQUFBSyxPQUFBLElBR0FyQixFQUFBc0IsVUFBQSxXQUNBckIsRUFBQU0sS0FBQSxZQUFBLE1BQ0FMLEVBQUFxQixXQUFBLEdBQ0FyQixFQUFBc0IsV0FBQSxJQUlBLFdBQ0FsQixPQUtBVCxTQUFBQyxPQUFBLE9BQUEyQixXQUFBLG1CQUFBLFNBQUEsZ0JBQUEsaUJBQUEsZ0JBQUExQixPQ3pDQSxXQUNBLFlBQ0EsSUFBQTJCLEdBQUEsU0FBQTFCLEVBQUEyQixFQUFBQyxFQUFBM0IsRUFBQUMsRUFBQUMsR0FzRUEsUUFBQTBCLEdBQUFD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LFFBQUFDLE9BQUFDLFNBQUFDLE1BRUE3SSxFQUFBLFNBQUE4SSxFQUFBQyxHQUNBUCxFQUFBeEksR0FBQThJLEVBQUEsV0FDQSxHQUFBRSxHQUFBQyxTQUNBVixHQUFBVyxPQUFBLFdBQ0FILEVBQUFJLE1BQUFYLEVBQUFRLFFBS0FsSixFQUFBLFNBQUFnSixFQUFBN0ksRUFBQThJLEdBQ0FQLEVBQUExSSxLQUFBZ0osRUFBQTdJLEVBQUEsV0FDQSxHQUFBK0ksR0FBQUMsU0FDQVYsR0FBQVcsT0FBQSxXQUNBSCxHQUNBQSxFQUFBSSxNQUFBWCxFQUFBUSxPQU9BLFFBQ0FoSixHQUFBQSxFQUNBRixLQUFBQSxFQUNBMEksT0FBQUEsR0FJQXBKLFNBQUFDLE9BQUEsT0FBQStJLFFBQUEsaUJBQUEsYUFBQTVJIiwiZmlsZSI6ImFwcC5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIENyZWF0ZWQgYnkgTWljaGllbCBvbiAyNS8xMS8yMDE1LlxuICovXG4oZnVuY3Rpb24oKXtcblxuICAgIHZhciBhcHAgPSBhbmd1bGFyLm1vZHVsZShcImFwcFwiLFtdKTtcbn0pKCk7IiwiLyoqXHJcbiAqIENyZWF0ZWQgYnkgTWljaGllbCBvbiAxMS8xMi8yMDE1LlxyXG4gKi9cclxuXHJcbihmdW5jdGlvbigpe1xyXG4gICAgdmFyIGxvZ2luQ29udHJvbGxlciA9IGZ1bmN0aW9uKCRzY29wZSwgc29ja2V0U2VydmljZSwgZGlzcGxheVNlcnZpY2UsIHBsYXllclNlcnZpY2Upe1xyXG5cclxuICAgICAgICAkc2NvcGUuTENTaG93ID0gZGlzcGxheVNlcnZpY2UuZ2V0TENTaG93O1xyXG5cclxuICAgICAgICAvL2Z1bmN0aW9uc1xyXG4gICAgICAgIHZhciBtYWtlUm9vbSA9IGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgICAgIHNvY2tldFNlcnZpY2UuZW1pdChcInBjY29ubmVjdFwiLCBudWxsKTtcclxuICAgICAgICB9O1xyXG4gICAgICAgICRzY29wZS5yb29tID0gXCJcIjtcclxuICAgICAgICBzb2NrZXRTZXJ2aWNlLm9uKCdyZXF1ZXN0Um9vbScsZnVuY3Rpb24oZGF0YSl7XHJcbiAgICAgICAgICAgICRzY29wZS5yb29tID0gZGF0YTtcclxuICAgICAgICB9KTtcclxuICAgICAgICBzb2NrZXRTZXJ2aWNlLm9uKCdkZXZpY2VPcmllbnRhdGlvbicsIGZ1bmN0aW9uKGRhdGEpe1xyXG4gICAgICAgICAgICB2YXIgdXNlcm5hbWUgPSBkYXRhLnVzZXJuYW1lO1xyXG4gICAgICAgICAgICB2YXIgZGV2aWNlT3JpZW50YXRpb24gPSB7fTtcclxuICAgICAgICAgICAgZGV2aWNlT3JpZW50YXRpb24uZ2FtbWEgPSBkYXRhLmdhbW1hO1xyXG4gICAgICAgICAgICBkZXZpY2VPcmllbnRhdGlvbi5iZXRhID0gZGF0YS5iZXRhO1xyXG4gICAgICAgICAgICBkZXZpY2VPcmllbnRhdGlvbi5hbHBoYSA9IGRhdGEuYWxwaGE7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgJHNjb3BlLnVzZXJuYW1lcyA9IHt9O1xyXG4gICAgICAgICRzY29wZS5jaGVja1VzZXJDb3VudCA9IGZhbHNlO1xyXG4gICAgICAgIHNvY2tldFNlcnZpY2Uub24oJ3VwZGF0ZXVzZXJzJywgZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgcGxheWVyU2VydmljZS5zZXRQbGF5ZXJzKGRhdGEpO1xyXG4gICAgICAgICAgICAkc2NvcGUudXNlcm5hbWVzID0gZGF0YTtcclxuICAgICAgICAgICAgJHNjb3BlLmNoZWNrVXNlckNvdW50ID0gT2JqZWN0LmtleXMoJHNjb3BlLnVzZXJuYW1lcykubGVuZ3RoIDwgMDtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgJHNjb3BlLnN0YXJ0R2FtZT0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBzb2NrZXRTZXJ2aWNlLmVtaXQoXCJzdGFydEdhbWVcIiwgbnVsbCk7XHJcbiAgICAgICAgICAgIGRpc3BsYXlTZXJ2aWNlLnNldExDU2hvdyhmYWxzZSk7XHJcbiAgICAgICAgICAgIGRpc3BsYXlTZXJ2aWNlLnNldFBDU2hvdyh0cnVlKTtcclxuICAgICAgICB9O1xyXG5cclxuXHJcbiAgICAgICAgKGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICBtYWtlUm9vbSgpO1xyXG4gICAgICAgIH0pKCk7XHJcblxyXG4gICAgfTtcclxuXHJcbiAgICBhbmd1bGFyLm1vZHVsZShcImFwcFwiKS5jb250cm9sbGVyKFwibG9naW5Db250cm9sbGVyXCIsIFtcIiRzY29wZVwiLCBcInNvY2tldFNlcnZpY2VcIiAsIFwiZGlzcGxheVNlcnZpY2VcIiwgXCJwbGF5ZXJTZXJ2aWNlXCIsIGxvZ2luQ29udHJvbGxlcl0pO1xyXG59KSgpOyIsIi8qKlxyXG4gKiBDcmVhdGVkIGJ5IE1pY2hpZWwgb24gMTYvMTIvMjAxNS5cclxuICovXHJcblxyXG4oZnVuY3Rpb24oKXtcclxuICAgIFwidXNlIHN0cmljdFwiO1xyXG4gICAgdmFyIHBsYXlDb250cm9sbGVyID0gZnVuY3Rpb24oJHNjb3BlLCAkaW50ZXJ2YWwsICR3aW5kb3csIHNvY2tldFNlcnZpY2UsIGRpc3BsYXlTZXJ2aWNlLCBwbGF5ZXJTZXJ2aWNlKXtcclxuICAgICAgICB2YXIgZGVmYXVsdFZhcnMgPSBbe3g6MTAsIHk6MTAscm90YXRpb246MTM1fSx7eDo5MCwgeToxMCxyb3RhdGlvbjoyMjV9LHt4OjkwLCB5OjkwLHJvdGF0aW9uOjMxNX0se3g6MTAsIHk6OTAscm90YXRpb246NDV9XTtcclxuICAgICAgICAkc2NvcGUuUENTaG93ID0gZGlzcGxheVNlcnZpY2UuZ2V0UENTaG93O1xyXG4gICAgICAgICRzY29wZS5lbmRHYW1lID0gZmFsc2U7XHJcbiAgICAgICAgdmFyIGNhbnYgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZ2FtZScpO1xyXG4gICAgICAgIHZhciBjdHggPSBjYW52LmdldENvbnRleHQoJzJkJyk7XHJcblxyXG4gICAgICAgIHZhciBBbGxQbGF5ZXJzID0gbmV3IEFycmF5KCk7XHJcbiAgICAgICAgdmFyIEFsbEJ1bGxldHMgPSBuZXcgQXJyYXkoKTtcclxuXHJcbiAgICAgICAgdmFyIGN5Y2xlO1xyXG5cclxuICAgICAgICBzb2NrZXRTZXJ2aWNlLm9uKFwiaW5pdEdhbWVcIiwgZnVuY3Rpb24oKXtcclxuICAgICAgICAgICAgdmFyIEJ1ZmZlclBsYXllciA9IHBsYXllclNlcnZpY2UuZ2V0UGxheWVycygpO1xyXG4gICAgICAgICAgICB2YXIgdGVsbGVyPSAwO1xyXG4gICAgICAgICAgICBmb3IodmFyIHBsYXllciBpbiBCdWZmZXJQbGF5ZXIpe1xyXG4gICAgICAgICAgICAgICAgdmFyIHAgPSBCdWZmZXJQbGF5ZXJbcGxheWVyXTtcclxuICAgICAgICAgICAgICAgIEFsbFBsYXllcnMucHVzaChuZXcgU3BhY2VzaGlwKHAudXNlcm5hbWUsIGRlZmF1bHRWYXJzW3RlbGxlcl0ueCwgZGVmYXVsdFZhcnNbdGVsbGVyXS55LCBwLmNvbG9yLCBkZWZhdWx0VmFyc1t0ZWxsZXJdLnJvdGF0aW9uKSk7XHJcbiAgICAgICAgICAgICAgICB0ZWxsZXIrKztcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgY3ljbGUgPSAkaW50ZXJ2YWwoZHJhdywgMTApO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBzb2NrZXRTZXJ2aWNlLm9uKFwidXNlcmxlZnRcIiwgZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgdmFyIHAgPSBudWxsO1xyXG4gICAgICAgICAgICBmb3IodmFyIGkgaW4gQWxsUGxheWVycyl7XHJcbiAgICAgICAgICAgICAgICBpZihmaWx0ZXJQbGF5ZXJzKEFsbFBsYXllcnNbaV0sZGF0YSkgPT0gdHJ1ZSl7XHJcbiAgICAgICAgICAgICAgICAgICAgcCA9IGk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgQWxsUGxheWVycy5zcGxpY2UocCwxKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgc29ja2V0U2VydmljZS5vbihcInVwZGF0ZUdhbWVEYXRhXCIsIGZ1bmN0aW9uKGRhdGEpe1xyXG4gICAgICAgICAgICB2YXIgcCA9IG51bGw7XHJcbiAgICAgICAgICAgIGZvcih2YXIgaSBpbiBBbGxQbGF5ZXJzKXtcclxuICAgICAgICAgICAgICAgIGlmKGZpbHRlclBsYXllcnMoQWxsUGxheWVyc1tpXSxkYXRhKSA9PSB0cnVlKXtcclxuICAgICAgICAgICAgICAgICAgICBwID0gaTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZihwICE9IG51bGwpe1xyXG4gICAgICAgICAgICAgICAgQWxsUGxheWVyc1twXS5yb3RhdGVTcGFjZXNoaXBSZWxhdGl2ZShkYXRhLm9yaWVudGF0aW9uKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBzb2NrZXRTZXJ2aWNlLm9uKFwicGxheWVyU2hvdFwiLCBmdW5jdGlvbihkYXRhKXtcclxuICAgICAgICAgICAgaWYoJHNjb3BlLmVuZEdhbWU9PWZhbHNlKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgcCA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpIGluIEFsbFBsYXllcnMpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoZmlsdGVyUGxheWVycyhBbGxQbGF5ZXJzW2ldLCBkYXRhKSA9PSB0cnVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHAgPSBpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmIChwICE9IG51bGwpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgdGVtcCA9IEFsbFBsYXllcnNbcF07XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGFuZ2xlID0gKDM2MCAtICh0ZW1wLnJvdGF0aW9uICsgMTgwKSkgLyAxODAgKiBNYXRoLlBJO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciB4ID0gdGVtcC54ICsgKGNhbnYud2lkdGggLyA0MDAgKiBNYXRoLnNpbihhbmdsZSkpO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciB5ID0gdGVtcC55ICsgKGNhbnYud2lkdGggLyA0MDAgKiBNYXRoLmNvcyhhbmdsZSkpO1xyXG4gICAgICAgICAgICAgICAgICAgIEFsbEJ1bGxldHMucHVzaChuZXcgQnVsbGV0KHgsIHksIHRlbXAucm90YXRpb24sIHRlbXAuY29sb3IsIHRlbXAudXNlck5hbWUpKTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgYXVkaW9VcmwgPSAnLi4vLi4vYXNzZXRzL0JvbnVzL3NmeF9sYXNlcjIub2dnJztcclxuICAgICAgICAgICAgICAgICAgICBpZiAocCAlIDIgPT0gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBhdWRpb1VybCA9ICcuLi8uLi9hc3NldHMvQm9udXMvc2Z4X2xhc2VyMS5vZ2cnO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB2YXIgc2hvdCA9IG5ldyBBdWRpbyhhdWRpb1VybCk7XHJcbiAgICAgICAgICAgICAgICAgICAgc2hvdC5wbGF5KCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZmlsdGVyUGxheWVycyhvYmosZGF0YSl7XHJcbiAgICAgICAgICAgIHJldHVybiBkYXRhLnVzZXJuYW1lID09IG9iai51c2VyTmFtZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGRyYXcoKXtcclxuICAgICAgICAgICAgaWYoQWxsUGxheWVycy5sZW5ndGg+MCl7XHJcbiAgICAgICAgICAgICAgICAvL0FsbFBsYXllcnNbMF0uc3BlZWQgPSAwO1xyXG4gICAgICAgICAgICAgICAgLy9BbGxQbGF5ZXJzWzFdLnNwZWVkID0gMDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjdHguY2xlYXJSZWN0KDAsMCxjYW52LndpZHRoLCBjYW52LmhlaWdodCk7XHJcbiAgICAgICAgICAgIHZhciByYXRpbyA9IGNhbnYud2lkdGgvMTAwO1xyXG5cclxuICAgICAgICAgICAgaWYoQWxsQnVsbGV0cy5sZW5ndGggIT0gMCl7XHJcbiAgICAgICAgICAgICAgICB2YXIgQnVsbGV0V2lkdGggPSBjYW52LndpZHRoLzEwMDtcclxuICAgICAgICAgICAgICAgIHZhciBCdWxsZXRIZWlnaHQgPSBCdWxsZXRXaWR0aCAqIEFsbEJ1bGxldHNbMF0uaW1hZ2UuaGVpZ2h0L0FsbEJ1bGxldHNbMF0uaW1hZ2Uud2lkdGg7XHJcblxyXG4gICAgICAgICAgICAgICAgZm9yKHZhciBidWxsZXQgaW4gQWxsQnVsbGV0cyl7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGIgPSBBbGxCdWxsZXRzW2J1bGxldF07XHJcbiAgICAgICAgICAgICAgICAgICAgYi53aWR0aCA9IEJ1bGxldFdpZHRoO1xyXG4gICAgICAgICAgICAgICAgICAgIGIuaGVpZ2h0ID0gQnVsbGV0SGVpZ2h0O1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBpZihiLmV4cGxvZGVTdGFnZSA9PSAwKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy9EcmF3IGJ1bGxldFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjdHguc2F2ZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjdHgudHJhbnNsYXRlKGIueCpyYXRpbywgYi55KnJhdGlvKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY3R4LnJvdGF0ZShiLnJvdGF0aW9uLzE4MCpNYXRoLlBJKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY3R4LmRyYXdJbWFnZShiLmltYWdlLCAtQnVsbGV0V2lkdGgvMiwgLUJ1bGxldEhlaWdodC8yLCBCdWxsZXRXaWR0aCwgQnVsbGV0SGVpZ2h0KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY3R4LnJlc3RvcmUoKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIEFsbEJ1bGxldHNbYnVsbGV0XS54ID0gTWF0aC5jb3MoKGIucm90YXRpb24gLSA5MCkvMTgwKk1hdGguUEkpICsgYi54O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBBbGxCdWxsZXRzW2J1bGxldF0ueSA9IE1hdGguc2luKChiLnJvdGF0aW9uIC0gOTApLzE4MCpNYXRoLlBJKSsgYi55O1xyXG4gICAgICAgICAgICAgICAgICAgIH1lbHNlIGlmKGIuZXhwbG9kZVN0YWdlIDwgNCl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vRHJhdyBleHBsb3Npb25cclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coYi5leHBsb3Npb25JbWFnZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5zYXZlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGN0eC50cmFuc2xhdGUoYi54KnJhdGlvLCBiLnkqcmF0aW8pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjdHguZHJhd0ltYWdlKGIuZXhwbG9zaW9uSW1hZ2UsIC1CdWxsZXRXaWR0aCwgLUJ1bGxldFdpZHRoLCBCdWxsZXRXaWR0aCoyLCBCdWxsZXRXaWR0aCoyKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY3R4LnJlc3RvcmUoKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmKEFsbFBsYXllcnMubGVuZ3RoICE9IDApe1xyXG4gICAgICAgICAgICAgICAgdmFyIFNwYWNlc2hpcFdpZHRoID0gY2Fudi53aWR0aC8yMDtcclxuICAgICAgICAgICAgICAgIHZhciBTcGFjZXNoaXBIZWlnaHQgPSBTcGFjZXNoaXBXaWR0aCAqIEFsbFBsYXllcnNbMF0uaW1hZ2UuaGVpZ2h0LyBBbGxQbGF5ZXJzWzBdLmltYWdlLndpZHRoO1xyXG5cclxuICAgICAgICAgICAgICAgIGZvcih2YXIgcGxheWVyIGluIEFsbFBsYXllcnMpe1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBwID0gQWxsUGxheWVyc1twbGF5ZXJdO1xyXG4gICAgICAgICAgICAgICAgICAgIHAud2lkdGggPSBTcGFjZXNoaXBXaWR0aDtcclxuICAgICAgICAgICAgICAgICAgICBwLmhlaWdodCA9IFNwYWNlc2hpcEhlaWdodDtcclxuICAgICAgICAgICAgICAgICAgICBjdHguc2F2ZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIGN0eC50cmFuc2xhdGUocC54KnJhdGlvLCBwLnkqcmF0aW8pO1xyXG4gICAgICAgICAgICAgICAgICAgIGN0eC5yb3RhdGUocC5yb3RhdGlvbi8xODAqTWF0aC5QSSk7XHJcbiAgICAgICAgICAgICAgICAgICAgY3R4LmRyYXdJbWFnZShwLmltYWdlLCAtU3BhY2VzaGlwV2lkdGgvMiwgLVNwYWNlc2hpcEhlaWdodC8yLCBTcGFjZXNoaXBXaWR0aCwgU3BhY2VzaGlwSGVpZ2h0KTtcclxuICAgICAgICAgICAgICAgICAgICBpZihwLmRhbWFnZSA+IDApe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjdHguZHJhd0ltYWdlKHAuZGFtYWdlSW1hZ2UsIC1TcGFjZXNoaXBXaWR0aC8yLCAtU3BhY2VzaGlwSGVpZ2h0LzIsIFNwYWNlc2hpcFdpZHRoLCBTcGFjZXNoaXBIZWlnaHQpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBjdHgucmVzdG9yZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIEFsbFBsYXllcnNbcGxheWVyXS54ID0gTWF0aC5jb3MoKHAucm90YXRpb24gLSA5MCkvMTgwKk1hdGguUEkpLzEwKiBwLnNwZWVkICsgcC54O1xyXG4gICAgICAgICAgICAgICAgICAgIEFsbFBsYXllcnNbcGxheWVyXS55ID0gTWF0aC5zaW4oKHAucm90YXRpb24gLSA5MCkvMTgwKk1hdGguUEkpLzEwKiBwLnNwZWVkICsgcC55O1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBjaGVja0J1bGxldHMoKTtcclxuXHJcbiAgICAgICAgICAgIGNvbGxpc2lvbkRldGVjdGlvbigpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gY2hlY2tCdWxsZXRzKCl7XHJcbiAgICAgICAgICAgIGZvcih2YXIgYiBpbiBBbGxCdWxsZXRzKXtcclxuICAgICAgICAgICAgICAgIGlmKEFsbEJ1bGxldHNbYl0ueCA8IDAgfHwgQWxsQnVsbGV0c1tiXS54ID4gY2Fudi53aWR0aCB8fCBBbGxCdWxsZXRzW2JdLnkgPCAwIHx8IEFsbEJ1bGxldHNbYl0ueSA+IGNhbnYuaGVpZ2h0KXtcclxuICAgICAgICAgICAgICAgICAgICBBbGxCdWxsZXRzLnNwbGljZShiLCAxKTtcclxuICAgICAgICAgICAgICAgIH1lbHNlIGlmKEFsbEJ1bGxldHNbYl0uZXhwbG9kZVN0YWdlID4wKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKEFsbEJ1bGxldHNbYl0uZXhwbG9kZVN0YWdlIDwgNCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBBbGxCdWxsZXRzW2JdLmV4cGxvZGUoKTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBBbGxCdWxsZXRzLnNwbGljZShiLCAxKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGNvbGxpc2lvbkRldGVjdGlvbigpe1xyXG4gICAgICAgICAgICB2YXIgbGl2aW5nUGxheWVycz1bXTtcclxuICAgICAgICAgICAgZm9yKHZhciBwIGluIEFsbFBsYXllcnMpe1xyXG4gICAgICAgICAgICAgICAgaWYoQWxsUGxheWVyc1twXS5kYW1hZ2U8NCl7XHJcbiAgICAgICAgICAgICAgICAgICAgbGl2aW5nUGxheWVycy5wdXNoKEFsbFBsYXllcnNbcF0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZm9yKHZhciBiIGluIEFsbEJ1bGxldHMpe1xyXG4gICAgICAgICAgICAgICAgICAgIGlmKEFsbEJ1bGxldHNbYl0uZXhwbG9kZVN0YWdlID09IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKEFsbEJ1bGxldHNbYl0ucGxheWVyICE9IEFsbFBsYXllcnNbcF0udXNlck5hbWUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciByYWRpdXMgPSBNYXRoLnNxcnQoMikgLyAyICogKEFsbEJ1bGxldHNbYl0uaGVpZ2h0IC8gMiAtIEFsbEJ1bGxldHNbYl0ud2lkdGggLyAyKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBhbmdsZSA9ICgzNjAgLSAoQWxsQnVsbGV0c1tiXS5yb3RhdGlvbikpIC8gMTgwICogTWF0aC5QSTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBidWxsZXRIZWFkWCA9IChBbGxCdWxsZXRzW2JdLnggKiBjYW52LndpZHRoIC8gMTAwIC0gKHJhZGl1cyAqIE1hdGguc2luKGFuZ2xlKSkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGJ1bGxldEhlYWRZID0gKEFsbEJ1bGxldHNbYl0ueSAqIGNhbnYud2lkdGggLyAxMDAgLSAocmFkaXVzICogTWF0aC5jb3MoYW5nbGUpKSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHNwYWNlU2hpcFggPSBBbGxQbGF5ZXJzW3BdLnggKiBjYW52LndpZHRoIC8gMTAwO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHNwYWNlU2hpcFkgPSBBbGxQbGF5ZXJzW3BdLnkgKiBjYW52LndpZHRoIC8gMTAwO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8qY3R4LnNhdmUoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdHguYmVnaW5QYXRoKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3R4LmFyYyhzcGFjZVNoaXBYLCBzcGFjZVNoaXBZLCBBbGxQbGF5ZXJzW3BdLndpZHRoLzIsIDAsIE1hdGguUEkqMik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3R4LmxpbmVXaWR0aCA9IDE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3R4LnN0cm9rZVN0eWxlID0gJyMwMDAwRkYnO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5zdHJva2UoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdHgucmVzdG9yZSgpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdHguc2F2ZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5iZWdpblBhdGgoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdHguYXJjKGJ1bGxldEhlYWRYLCBidWxsZXRIZWFkWSwgQWxsQnVsbGV0c1tiXS53aWR0aC8yLCAwLCBNYXRoLlBJKjIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5saW5lV2lkdGggPSAxO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5zdHJva2VTdHlsZSA9ICcjRkYwMDAwJztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdHguc3Ryb2tlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3R4LnJlc3RvcmUoKTsqL1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGRpc3RhbmNlID0gTWF0aC5zcXJ0KChidWxsZXRIZWFkWCAtIHNwYWNlU2hpcFgpICogKGJ1bGxldEhlYWRYIC0gc3BhY2VTaGlwWCkgKyAoYnVsbGV0SGVhZFkgLSBzcGFjZVNoaXBZKSAqIChidWxsZXRIZWFkWSAtIHNwYWNlU2hpcFkpKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkaXN0YW5jZSA8IChBbGxCdWxsZXRzW2JdLndpZHRoIC8gMiArIEFsbFBsYXllcnNbcF0ud2lkdGggLyAyKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8qdmFyIGRhbWFnZXNvdW5kID0gbmV3IEF1ZGlvKCcuLi8uLi9hc3NldHMvQm9udXMvc2Z4X2xvc2Uub2dnJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGFtYWdlc291bmQucGxheSgpOyovXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQWxsUGxheWVyc1twXS5pbmNyZWFzZURhbWFnZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBkYXRhID0ge307XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YS51c2VybmFtZSA9IEFsbFBsYXllcnNbcF0udXNlck5hbWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YS5saWZlID0gMy1BbGxQbGF5ZXJzW3BdLmRhbWFnZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzb2NrZXRTZXJ2aWNlLmVtaXQoXCJwbGF5ZXJMaWZlXCIsZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQWxsQnVsbGV0c1tiXS5leHBsb2RlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYobGl2aW5nUGxheWVycy5sZW5ndGg9PTEpe1xyXG4gICAgICAgICAgICAgICAgZW5kR2FtZShsaXZpbmdQbGF5ZXJzKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZW5kR2FtZShsaXZpbmdQbGF5ZXJzKXtcclxuICAgICAgICAgICAgaWYgKGFuZ3VsYXIuaXNEZWZpbmVkKGN5Y2xlKSkge1xyXG4gICAgICAgICAgICAgICAgJGludGVydmFsLmNhbmNlbChjeWNsZSk7XHJcbiAgICAgICAgICAgICAgICBjeWNsZSA9IHVuZGVmaW5lZDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAkc2NvcGUuZW5kR2FtZT10cnVlO1xyXG4gICAgICAgICAgICAkc2NvcGUuZW5kR2FtZVRleHQ9IGxpdmluZ1BsYXllcnNbMF0udXNlck5hbWUgKyBcIiBpcyB0aGUgd2lubmVyIVwiXHJcbiAgICAgICAgICAgIHNvY2tldFNlcnZpY2UuZW1pdChcImVuZEdhbWVcIiwgbGl2aW5nUGxheWVyc1swXS51c2VyTmFtZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgICRzY29wZS5yZXN0YXJ0R2FtZSA9IGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgICAgICRzY29wZS5lbmRHYW1lPWZhbHNlO1xyXG4gICAgICAgICAgICB2YXIgdGVsbGVyPTA7XHJcbiAgICAgICAgICAgIGZvcih2YXIgcCBpbiBBbGxQbGF5ZXJzKXtcclxuICAgICAgICAgICAgICAgIEFsbFBsYXllcnNbcF0ucmVzZXQoZGVmYXVsdFZhcnNbdGVsbGVyXS54LGRlZmF1bHRWYXJzW3RlbGxlcl0ueSxkZWZhdWx0VmFyc1t0ZWxsZXJdLnJvdGF0aW9uKTtcclxuICAgICAgICAgICAgICAgIHRlbGxlcisrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGN0eC5jbGVhclJlY3QoMCwwLGNhbnYud2lkdGgsIGNhbnYuaGVpZ2h0KTtcclxuICAgICAgICAgICAgc29ja2V0U2VydmljZS5lbWl0KFwicmVzdGFydEdhbWVcIixudWxsKTtcclxuICAgICAgICAgICAgY3ljbGUgPSAkaW50ZXJ2YWwoZHJhdywgMTApO1xyXG4gICAgICAgIH07XHJcbiAgICB9O1xyXG5cclxuICAgIGFuZ3VsYXIubW9kdWxlKFwiYXBwXCIpLmNvbnRyb2xsZXIoXCJwbGF5Q29udHJvbGxlclwiLCBbXCIkc2NvcGVcIiwgXCIkaW50ZXJ2YWxcIiwgXCIkd2luZG93XCIsIFwic29ja2V0U2VydmljZVwiLCBcImRpc3BsYXlTZXJ2aWNlXCIsIFwicGxheWVyU2VydmljZVwiLCBwbGF5Q29udHJvbGxlcl0pXHJcbn0pKCk7IiwiLyoqXHJcbiAqIENyZWF0ZWQgYnkganVzdGlqbmRlcG92ZXIgb24gMjIvMTIvMTUuXHJcbiAqL1xyXG5cclxudmFyIEJ1bGxldCA9IGZ1bmN0aW9uKHgsIHkscm90YXRpb24sIGNvbG9yLCBwbGF5ZXIpe1xyXG4gICAgdGhpcy54ID0geDtcclxuICAgIHRoaXMueSA9IHk7XHJcbiAgICB0aGlzLnJvdGF0aW9uID0gcm90YXRpb247XHJcbiAgICB0aGlzLmltYWdlID0gbmV3IEltYWdlKCk7XHJcbiAgICB0aGlzLmNvbG9yID0gY29sb3I7XHJcbiAgICB0aGlzLndpZHRoID0gMDtcclxuICAgIHRoaXMuaGVpZ2h0ID0gMDtcclxuICAgIHRoaXMucGxheWVyID0gcGxheWVyO1xyXG4gICAgdGhpcy5leHBsb3Npb25JbWFnZSA9IG5ldyBJbWFnZSgpO1xyXG4gICAgdGhpcy5leHBsb2RlU3RhZ2UgPSAwO1xyXG4gICAgaWYodGhpcy5jb2xvciA9PSBcIm9yYW5nZVwiKXtcclxuICAgICAgICB0aGlzLmNvbG9yID0gJ3JlZCc7XHJcbiAgICB9XHJcbiAgICB0aGlzLmltYWdlLnNyYyA9ICcuLi9hc3NldHMvUE5HL0xhc2Vycy9sYXNlcicrIHRoaXMuY29sb3IuY2hhckF0KDApLnRvVXBwZXJDYXNlKCkgKyB0aGlzLmNvbG9yLnNsaWNlKDEpICsnMDEucG5nJ1xyXG59O1xyXG5cclxuQnVsbGV0LnByb3RvdHlwZS5leHBsb2RlID0gZnVuY3Rpb24oKXtcclxuICAgIGlmKHRoaXMuZXhwbG9kZVN0YWdlIDwgNCl7XHJcbiAgICAgICAgdGhpcy5leHBsb2RlU3RhZ2UrKztcclxuICAgICAgICB2YXIgbnVtYmVyO1xyXG4gICAgICAgIGlmKHRoaXMuZXhwbG9kZVN0YWdlIDwgMyl7XHJcbiAgICAgICAgICAgbnVtYmVyID0gMVxyXG4gICAgICAgIH1lbHNle1xyXG4gICAgICAgICAgICBudW1iZXIgPSAyXHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuZXhwbG9zaW9uSW1hZ2Uuc3JjID0gJy4uL2Fzc2V0cy9QTkcvTGFzZXJzL2xhc2VyJyArIHRoaXMuY29sb3IuY2hhckF0KDApLnRvVXBwZXJDYXNlKCkgKyB0aGlzLmNvbG9yLnNsaWNlKDEpICsgJ0V4cGxvZGUnKyBudW1iZXIgKycucG5nJztcclxuICAgIH1lbHNle1xyXG4gICAgICAgIHRoaXMuZXhwbG9zaW9uSW1hZ2Uuc3JjID0gJyc7XHJcbiAgICB9XHJcbn07XHJcbiIsIi8qKlxyXG4gKiBDcmVhdGVkIGJ5IGp1c3Rpam5kZXBvdmVyIG9uIDA5LzEyLzE1LlxyXG4gKi9cclxuXHJcbnZhciBTcGFjZXNoaXAgPSBmdW5jdGlvbih1c2VyTmFtZSwgeCwgeSwgY29sb3IsIHJvdGF0aW9uKXtcclxuICAgIHRoaXMudXNlck5hbWUgPSB1c2VyTmFtZTtcclxuICAgIHRoaXMueCA9IHg7XHJcbiAgICB0aGlzLnkgPSB5O1xyXG4gICAgdGhpcy5zcGVlZCA9IDE7XHJcbiAgICB0aGlzLmNvbG9yID0gY29sb3I7XHJcbiAgICB0aGlzLnJvdGF0aW9uID0gcm90YXRpb247XHJcbiAgICB0aGlzLmltYWdlID0gbmV3IEltYWdlKCk7XHJcbiAgICB0aGlzLmRhbWFnZSA9IDA7XHJcbiAgICB0aGlzLndpZHRoID0gMDtcclxuICAgIHRoaXMuaGVpZ2h0ID0gMDtcclxuICAgIHRoaXMuZGFtYWdlSW1hZ2UgPSBuZXcgSW1hZ2UoKTtcclxuICAgIHRoaXMuaW1hZ2Uuc3JjID0gJy4uL2Fzc2V0cy9QTkcvcGxheWVyU2hpcDFfJysgdGhpcy5jb2xvciArJy5wbmcnXHJcbn07XHJcblxyXG5TcGFjZXNoaXAucHJvdG90eXBlLnJlc2V0ID0gZnVuY3Rpb24gKHgsIHksIHJvdGF0aW9uKSB7XHJcbiAgICB0aGlzLnNwZWVkID0gMTtcclxuICAgIHRoaXMuZGFtYWdlID0gMDtcclxuICAgIHRoaXMuZGFtYWdlSW1hZ2UgPSBuZXcgSW1hZ2UoKTtcclxuICAgIHRoaXMuaW1hZ2Uuc3JjID0gJy4uL2Fzc2V0cy9QTkcvcGxheWVyU2hpcDFfJysgdGhpcy5jb2xvciArJy5wbmcnXHJcbiAgICB0aGlzLnggPSB4O1xyXG4gICAgdGhpcy55ID0geTtcclxuICAgIHRoaXMucm90YXRpb24gPSByb3RhdGlvbjtcclxufTtcclxuXHJcblNwYWNlc2hpcC5wcm90b3R5cGUubW92ZVNwYWNlc2hpcCA9IGZ1bmN0aW9uKHgsIHkpe1xyXG4gICAgdGhpcy54ID0geDtcclxuICAgIHRoaXMueSA9IHk7XHJcbn07XHJcblxyXG5TcGFjZXNoaXAucHJvdG90eXBlLm1vdmVTcGFjZXNoaXBSZWxhdGl2ZSA9IGZ1bmN0aW9uKHgsIHkpe1xyXG4gICAgdGhpcy54ID0gdGhpcy54K3g7XHJcbiAgICB0aGlzLnkgPSB0aGlzLnkreTtcclxufTtcclxuXHJcblNwYWNlc2hpcC5wcm90b3R5cGUucm90YXRlU3BhY2VzaGlwID0gZnVuY3Rpb24oZGVncmVlKXtcclxuICAgIHRoaXMucm90YXRpb24gPSBkZWdyZWU7XHJcbn07XHJcblxyXG5TcGFjZXNoaXAucHJvdG90eXBlLnJvdGF0ZVNwYWNlc2hpcFJlbGF0aXZlID0gZnVuY3Rpb24oZGVncmVlKXtcclxuICAgIHRoaXMucm90YXRpb24gPSB0aGlzLnJvdGF0aW9uICsgZGVncmVlLzU7XHJcbiAgICBpZih0aGlzLnJvdGF0aW9uIDwgLTM2MCl7XHJcbiAgICAgICAgdGhpcy5yb3RhdGlvbiA9IHRoaXMucm90YXRpb24gKyA3MjA7XHJcbiAgICB9XHJcbiAgICBpZih0aGlzLnJvdGF0aW9uID4gMzYwKXtcclxuICAgICAgICB0aGlzLnJvdGF0aW9uID0gdGhpcy5yb3RhdGlvbiAtIDcyMDtcclxuICAgIH1cclxufTtcclxuXHJcblNwYWNlc2hpcC5wcm90b3R5cGUuaW5jcmVhc2VEYW1hZ2UgPSBmdW5jdGlvbigpe1xyXG4gICAgaWYodGhpcy5kYW1hZ2UgPCA0KXtcclxuICAgICAgICB0aGlzLmRhbWFnZSArPSAxO1xyXG4gICAgfVxyXG5cclxuICAgIGlmKHRoaXMuZGFtYWdlIDw9IDMgJiYgdGhpcy5kYW1hZ2UgPiAwKXtcclxuICAgICAgICB0aGlzLmRhbWFnZUltYWdlLnNyYyA9ICcuLi9hc3NldHMvUE5HL0RhbWFnZS9wbGF5ZXJTaGlwMV9kYW1hZ2UnKyB0aGlzLmRhbWFnZSArICcucG5nJztcclxuICAgIH1lbHNlIGlmKHRoaXMuZGFtYWdlPT00KXtcclxuICAgICAgICB0aGlzLmRhbWFnZUltYWdlLnNyYyA9ICcuLi9hc3NldHMvUE5HL0RhbWFnZS9leHBsb2RlLmdpZic7XHJcbiAgICB9XHJcbn07XHJcblxyXG5TcGFjZXNoaXAucHJvdG90eXBlLmRlY3JlYXNlRGFtYWdlID0gZnVuY3Rpb24oKXtcclxuICAgIGlmKHRoaXMuZGFtYWdlID4gMCl7XHJcbiAgICAgICAgdGhpcy5kYW1hZ2UgLT0gMTtcclxuICAgIH1cclxuXHJcbiAgICBpZih0aGlzLmRhbWFnZSA8PSAzICYmIHRoaXMuZGFtYWdlID4gMCl7XHJcbiAgICAgICAgdGhpcy5kYW1hZ2VJbWFnZS5zcmMgPSAnLi4vYXNzZXRzL1BORy9EYW1hZ2UvcGxheWVyU2hpcDFfZGFtYWdlJysgdGhpcy5kYW1hZ2UgKyAnLnBuZyc7XHJcbiAgICB9XHJcbn07XHJcblxyXG4iLCIvKipcclxuICogQ3JlYXRlZCBieSBqdXN0aWpuZGVwb3ZlciBvbiAxNi8xMi8xNS5cclxuICovXHJcbihmdW5jdGlvbigpe1xyXG4gICAgdmFyIGNhbnZhc0RpcmVjdGl2ZSA9IGZ1bmN0aW9uKCR3aW5kb3cpe1xyXG4gICAgICAgIHJldHVybntcclxuICAgICAgICAgICAgcmVzdHJpY3Q6ICdFJyxcclxuICAgICAgICAgICAgbGluazpsaW5rLFxyXG4gICAgICAgICAgICByZXBsYWNlOnRydWUsXHJcbiAgICAgICAgICAgIHRlbXBsYXRlOic8Y2FudmFzIGlkPVwiZ2FtZVwiIGNsYXNzPVwicGxheUFyZWFcIiB3aWR0aD1cInt7d2lkdGh9fVwiIGhlaWdodD1cInt7d2lkdGh9fVwiIC8+J1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGxpbmsoc2NvcGUsIGVsZW1lbnQsIGF0dHJzKXtcclxuICAgICAgICAgICAgaWYoJHdpbmRvdy5pbm5lcldpZHRoIDwgJHdpbmRvdy5pbm5lckhlaWdodCl7XHJcbiAgICAgICAgICAgICAgICBzY29wZS53aWR0aCA9ICR3aW5kb3cuaW5uZXJXaWR0aCAtIDIwO1xyXG4gICAgICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgICAgIHNjb3BlLndpZHRoID0gJHdpbmRvdy5pbm5lckhlaWdodCAtIDIwO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBhbmd1bGFyLmVsZW1lbnQoJHdpbmRvdykuYmluZCgncmVzaXplJywgZnVuY3Rpb24oKXtcclxuICAgICAgICAgICAgICAgIGlmKCR3aW5kb3cuaW5uZXJXaWR0aCA8ICR3aW5kb3cuaW5uZXJIZWlnaHQpe1xyXG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLndpZHRoID0gJHdpbmRvdy5pbm5lcldpZHRoIC0gMjA7XHJcbiAgICAgICAgICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgICAgICAgICBzY29wZS53aWR0aCA9ICR3aW5kb3cuaW5uZXJIZWlnaHQgLSAyMDtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBzY29wZS4kZGlnZXN0KCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcblxyXG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcCcpLmRpcmVjdGl2ZShcImNhbnZhc0RpcmVjdGl2ZVwiLCBbXCIkd2luZG93XCIsIGNhbnZhc0RpcmVjdGl2ZV0pO1xyXG59KSgpOyIsIi8qKlxyXG4gKiBDcmVhdGVkIGJ5IE1pY2hpZWwgb24gMTYvMTIvMjAxNS5cclxuICovXHJcbi8qKlxyXG4gKiBDcmVhdGVkIGJ5IGp1c3Rpam5kZXBvdmVyIG9uIDE2LzEyLzE1LlxyXG4gKi9cclxuXHJcblxyXG4oZnVuY3Rpb24oKXtcclxuICAgIHZhciBkaXNwbGF5U2VydmljZSA9IGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgLy9Mb2dpbiBDb250cm9sbGVyXHJcbiAgICAgICAgdmFyIExDU2hvdyA9IHRydWU7XHJcbiAgICAgICAgLy9QbGF5IGNvbnRyb2xsZXJcclxuICAgICAgICB2YXIgUENTaG93ID0gZmFsc2U7XHJcblxyXG4gICAgICAgIHJldHVybntcclxuICAgICAgICAgICAgZ2V0TENTaG93OiBmdW5jdGlvbigpe1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIExDU2hvdztcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgc2V0TENTaG93OiBmdW5jdGlvbih2YWx1ZSl7XHJcbiAgICAgICAgICAgICAgICBMQ1Nob3cgPSB2YWx1ZTtcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgZ2V0UENTaG93OiBmdW5jdGlvbigpe1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIFBDU2hvdztcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgc2V0UENTaG93OiBmdW5jdGlvbih2YWx1ZSl7XHJcbiAgICAgICAgICAgICAgICBQQ1Nob3cgPSB2YWx1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH07XHJcblxyXG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcCcpLmZhY3RvcnkoJ2Rpc3BsYXlTZXJ2aWNlJywgW2Rpc3BsYXlTZXJ2aWNlXSk7XHJcbn0pKCk7IiwiLyoqXHJcbiAqIENyZWF0ZWQgYnkganVzdGlqbmRlcG92ZXIgb24gMTcvMTIvMTUuXHJcbiAqL1xyXG5cclxuKGZ1bmN0aW9uKCl7XHJcbiAgICB2YXIgcGxheWVyU2VydmljZSA9IGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgLy9Mb2dpbiBDb250cm9sbGVyXHJcbiAgICAgICAgdmFyIHBsYXllcnMgPSBbXTtcclxuXHJcbiAgICAgICAgcmV0dXJue1xyXG4gICAgICAgICAgICBnZXRQbGF5ZXJzOiBmdW5jdGlvbigpe1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHBsYXllcnM7XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIHNldFBsYXllcnM6IGZ1bmN0aW9uKHBsYXllcnNBcnJheSl7XHJcbiAgICAgICAgICAgICAgICBwbGF5ZXJzID0gcGxheWVyc0FycmF5O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuXHJcbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwJykuZmFjdG9yeSgncGxheWVyU2VydmljZScsIFtwbGF5ZXJTZXJ2aWNlXSk7XHJcbn0pKCk7IiwiLyoqXHJcbiAqIENyZWF0ZWQgYnkganVzdGlqbmRlcG92ZXIgb24gMDkvMTIvMTUuXHJcbiAqL1xyXG5cclxuKGZ1bmN0aW9uKCl7XHJcblxyXG4gICAgdmFyIHNvY2tldFNlcnZpY2UgPSBmdW5jdGlvbigkcm9vdFNjb3BlKXtcclxuICAgICAgICBcInVzZSBzdHJpY3RcIjtcclxuICAgICAgICAvL3ByaXZhdGVcclxuICAgICAgICB2YXIgc29ja2V0ID0gaW8uY29ubmVjdCh3aW5kb3cubG9jYXRpb24uaG9zdCk7XHJcbiAgICAgICAgLy9mdW5jdGlvbnNcclxuICAgICAgICB2YXIgb24gPSBmdW5jdGlvbiAoZXZlbnROYW1lLCBjYWxsYmFjaykge1xyXG4gICAgICAgICAgICBzb2NrZXQub24oZXZlbnROYW1lLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgYXJncyA9IGFyZ3VtZW50cztcclxuICAgICAgICAgICAgICAgICRyb290U2NvcGUuJGFwcGx5KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjay5hcHBseShzb2NrZXQsIGFyZ3MpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBlbWl0ID0gZnVuY3Rpb24gKGV2ZW50TmFtZSwgZGF0YSwgY2FsbGJhY2spIHtcclxuICAgICAgICAgICAgc29ja2V0LmVtaXQoZXZlbnROYW1lLCBkYXRhLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgYXJncyA9IGFyZ3VtZW50cztcclxuICAgICAgICAgICAgICAgICRyb290U2NvcGUuJGFwcGx5KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoY2FsbGJhY2spIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2suYXBwbHkoc29ja2V0LCBhcmdzKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAvL3B1YmxpY1xyXG4gICAgICAgIHJldHVybntcclxuICAgICAgICAgICAgb246IG9uLFxyXG4gICAgICAgICAgICBlbWl0OiBlbWl0LFxyXG4gICAgICAgICAgICBzb2NrZXQ6IHNvY2tldFxyXG4gICAgICAgIH1cclxuICAgIH07XHJcblxyXG4gICAgYW5ndWxhci5tb2R1bGUoXCJhcHBcIikuZmFjdG9yeShcInNvY2tldFNlcnZpY2VcIiwgW1wiJHJvb3RTY29wZVwiLCBzb2NrZXRTZXJ2aWNlXSk7XHJcblxyXG59KSgpOyJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
