!function(){angular.module("app",[])}(),function(){var e=function(e,t,a,i){e.LCShow=a.getLCShow;var o=function(){t.emit("pcconnect",null)};e.room="",t.on("requestRoom",function(t){e.room=t}),t.on("deviceOrientation",function(e){var t=(e.username,{});t.gamma=e.gamma,t.beta=e.beta,t.alpha=e.alpha}),e.usernames={},e.checkUserCount=!1,t.on("updateusers",function(t){i.setPlayers(t),e.usernames=t,e.checkUserCount=Object.keys(e.usernames).length<0}),e.startGame=function(){t.emit("startGame",null),a.setLCShow(!1),a.setPCShow(!0)},function(){o()}()};angular.module("app").controller("loginController",["$scope","socketService","displayService","playerService",e])}(),function(){"use strict";var e=function(e,t,a,i,o,n){function r(e,t){return t.username==e.userName}function s(){m.length>0&&(m[0].speed=0,m[1].speed=0),d.clearRect(0,0,u.width,u.height);var e=u.width/100;if(0!=f.length){var t=u.width/100,a=t*f[0].image.height/f[0].image.width;for(var i in f){var o=f[i];o.width=t,o.height=a,0==o.explodeStage?(d.save(),d.translate(o.x*e,o.y*e),d.rotate(o.rotation/180*Math.PI),d.drawImage(o.image,-t/2,-a/2,t,a),d.restore(),f[i].x=Math.cos((o.rotation-90)/180*Math.PI)+o.x,f[i].y=Math.sin((o.rotation-90)/180*Math.PI)+o.y):o.explodeStage<4&&(console.log(o.explosionImage),d.save(),d.translate(o.x*e,o.y*e),d.drawImage(o.explosionImage,-t,-t,2*t,2*t),d.restore())}}if(0!=m.length){var n=u.width/20,r=n*m[0].image.height/m[0].image.width;for(var s in m){var l=m[s];l.width=n,l.height=r,d.save(),d.translate(l.x*e,l.y*e),d.rotate(l.rotation/180*Math.PI),d.drawImage(l.image,-n/2,-r/2,n,r),l.damage>0&&d.drawImage(l.damageImage,-n/2,-r/2,n,r),d.restore(),m[s].x=Math.cos((l.rotation-90)/180*Math.PI)/10*l.speed+l.x,m[s].y=Math.sin((l.rotation-90)/180*Math.PI)/10*l.speed+l.y}}h(),c()}function h(){for(var e in f)f[e].x<0||f[e].x>u.width||f[e].y<0||f[e].y>u.height?f.splice(e,1):f[e].explodeStage>0&&(f[e].explodeStage<4?f[e].explode():f.splice(e,1))}function c(){var e=[];for(var t in m){m[t].damage<4&&e.push(m[t]);for(var a in f)if(0==f[a].explodeStage&&f[a].player!=m[t].userName){var o=Math.sqrt(2)/2*(f[a].height/2-f[a].width/2),n=(360-f[a].rotation)/180*Math.PI,r=f[a].x*u.width/100-o*Math.sin(n),s=f[a].y*u.width/100-o*Math.cos(n),h=m[t].x*u.width/100,c=m[t].y*u.width/100,p=Math.sqrt((r-h)*(r-h)+(s-c)*(s-c));if(p<f[a].width/2+m[t].width/2){var g=new Audio("../../assets/Bonus/sfx_lose.ogg");g.play(),m[t].increaseDamage();var d={};d.username=m[t].userName,d.life=3-m[t].damage,i.emit("playerLife",d),f[a].explode()}}}1==e.length&&l(e)}function l(a){angular.isDefined(g)&&(t.cancel(g),g=void 0),e.endGame=!0,e.endGameText=a[0].userName+" is the winner!"}var p=[{x:10,y:10,rotation:135},{x:90,y:10,rotation:225},{x:90,y:90,rotation:315},{x:10,y:90,rotation:45}];e.PCShow=o.getPCShow,e.endGame=!1;var g,u=document.getElementById("game"),d=u.getContext("2d"),m=new Array,f=new Array;i.on("initGame",function(){var e=n.getPlayers(),a=0;for(var i in e){var o=e[i];m.push(new Spaceship(o.username,p[a].x,p[a].y,o.color,p[a].rotation)),a++}g=t(s,10)}),i.on("userleft",function(e){var t=null;for(var a in m)1==r(m[a],e)&&(t=a);m.splice(t,1)}),i.on("updateGameData",function(e){var t=null;for(var a in m)1==r(m[a],e)&&(t=a);null!=t&&m[t].rotateSpaceshipRelative(e.orientation)}),i.on("playerShot",function(e){var t=null;for(var a in m)1==r(m[a],e)&&(t=a);if(null!=t){var i=m[t],o=(360-(i.rotation+180))/180*Math.PI,n=i.x+u.width/400*Math.sin(o),s=i.y+u.width/400*Math.cos(o);f.push(new Bullet(n,s,i.rotation,i.color,i.userName));var h="../../assets/Bonus/sfx_laser2.ogg";t%2==0&&(h="../../assets/Bonus/sfx_laser1.ogg");var c=new Audio(h);c.play()}}),e.restartGame=function(){e.endGame=!1;var t=0;for(var a in m)m[a].reset(p[t].x,p[t].y,p[t].rotation),t++}};angular.module("app").controller("playController",["$scope","$interval","$window","socketService","displayService","playerService",e])}(),function(){var e=function(e){function t(t,a,i){e.innerWidth<e.innerHeight?t.width=e.innerWidth-20:t.width=e.innerHeight-20,angular.element(e).bind("resize",function(){e.innerWidth<e.innerHeight?t.width=e.innerWidth-20:t.width=e.innerHeight-20,t.$digest()})}return{restrict:"E",link:t,replace:!0,template:'<canvas id="game" class="playArea" width="{{width}}" height="{{width}}" />'}};angular.module("app").directive("canvasDirective",["$window",e])}();var Bullet=function(e,t,a,i,o){this.x=e,this.y=t,this.rotation=a,this.image=new Image,this.color=i,this.width=0,this.height=0,this.player=o,this.explosionImage=new Image,this.explodeStage=0,"orange"==this.color&&(this.color="red"),this.image.src="../assets/PNG/Lasers/laser"+this.color.charAt(0).toUpperCase()+this.color.slice(1)+"01.png"};Bullet.prototype.explode=function(){if(this.explodeStage<4){this.explodeStage++;var e;e=this.explodeStage<3?1:2,this.explosionImage.src="../assets/PNG/Lasers/laser"+this.color.charAt(0).toUpperCase()+this.color.slice(1)+"Explode"+e+".png"}else this.explosionImage.src=""};var Spaceship=function(e,t,a,i,o){this.userName=e,this.x=t,this.y=a,this.speed=1,this.color=i,this.rotation=o,this.image=new Image,this.damage=0,this.width=0,this.height=0,this.damageImage=new Image,this.image.src="../assets/PNG/playerShip1_"+this.color+".png"};Spaceship.prototype.reset=function(e,t,a){this.speed=1,this.damage=0,this.damageImage=new Image,this.image.src="../assets/PNG/playerShip1_"+this.color+".png"},Spaceship.prototype.moveSpaceship=function(e,t){this.x=e,this.y=t},Spaceship.prototype.moveSpaceshipRelative=function(e,t){this.x=this.x+e,this.y=this.y+t},Spaceship.prototype.rotateSpaceship=function(e){this.rotation=e},Spaceship.prototype.rotateSpaceshipRelative=function(e){this.rotation=this.rotation+e/5,this.rotation<-360&&(this.rotation=this.rotation+720),this.rotation>360&&(this.rotation=this.rotation-720)},Spaceship.prototype.increaseDamage=function(){this.damage<4&&(this.damage+=1),this.damage<=3&&this.damage>0?this.damageImage.src="../assets/PNG/Damage/playerShip1_damage"+this.damage+".png":4==this.damage&&(this.damageImage.src="../assets/PNG/Damage/explode.gif")},Spaceship.prototype.decreaseDamage=function(){this.damage>0&&(this.damage-=1),this.damage<=3&&this.damage>0&&(this.damageImage.src="../assets/PNG/Damage/playerShip1_damage"+this.damage+".png")},function(){var e=function(){var e=!0,t=!1;return{getLCShow:function(){return e},setLCShow:function(t){e=t},getPCShow:function(){return t},setPCShow:function(e){t=e}}};angular.module("app").factory("displayService",[e])}(),function(){var e=function(){var e=[];return{getPlayers:function(){return e},setPlayers:function(t){e=t}}};angular.module("app").factory("playerService",[e])}(),function(){var e=function(e){"use strict";var t=io.connect(window.location.host),a=function(a,i){t.on(a,function(){var a=arguments;e.$apply(function(){i.apply(t,a)})})},i=function(a,i,o){t.emit(a,i,function(){var a=arguments;e.$apply(function(){o&&o.apply(t,a)})})};return{on:a,emit:i,socket:t}};angular.module("app").factory("socketService",["$rootScope",e])}();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyIsImNvbnRyb2xsZXIvbG9naW5Db250cm9sbGVyLmpzIiwiY29udHJvbGxlci9wbGF5Q29udHJvbGxlci5qcyIsImRpcmVjdGl2ZXMvY2FudmFzRGlyZWN0aXZlLmpzIiwibW9kZWxzL0J1bGxldC5qcyIsIm1vZGVscy9TcGFjZXNoaXAuanMiLCJzZXJ2aWNlcy9kaXNwbGF5U2VydmljZS5qcyIsInNlcnZpY2VzL3BsYXllclNlcnZpY2UuanMiLCJzZXJ2aWNlcy9zb2NrZXRTZXJ2aWNlLmpzIl0sIm5hbWVzIjpbImFuZ3VsYXIiLCJtb2R1bGUiLCJsb2dpbkNvbnRyb2xsZXIiLCIkc2NvcGUiLCJzb2NrZXRTZXJ2aWNlIiwiZGlzcGxheVNlcnZpY2UiLCJwbGF5ZXJTZXJ2aWNlIiwiTENTaG93IiwiZ2V0TENTaG93IiwibWFrZVJvb20iLCJlbWl0Iiwicm9vbSIsIm9uIiwiZGF0YSIsImRldmljZU9yaWVudGF0aW9uIiwidXNlcm5hbWUiLCJnYW1tYSIsImJldGEiLCJhbHBoYSIsInVzZXJuYW1lcyIsImNoZWNrVXNlckNvdW50Iiwic2V0UGxheWVycyIsIk9iamVjdCIsImtleXMiLCJsZW5ndGgiLCJzdGFydEdhbWUiLCJzZXRMQ1Nob3ciLCJzZXRQQ1Nob3ciLCJjb250cm9sbGVyIiwicGxheUNvbnRyb2xsZXIiLCIkaW50ZXJ2YWwiLCIkd2luZG93IiwiZmlsdGVyUGxheWVycyIsIm9iaiIsInVzZXJOYW1lIiwiZHJhdyIsIkFsbFBsYXllcnMiLCJzcGVlZCIsImN0eCIsImNsZWFyUmVjdCIsImNhbnYiLCJ3aWR0aCIsImhlaWdodCIsInJhdGlvIiwiQWxsQnVsbGV0cyIsIkJ1bGxldFdpZHRoIiwiQnVsbGV0SGVpZ2h0IiwiaW1hZ2UiLCJidWxsZXQiLCJiIiwiZXhwbG9kZVN0YWdlIiwic2F2ZSIsInRyYW5zbGF0ZSIsIngiLCJ5Iiwicm90YXRlIiwicm90YXRpb24iLCJNYXRoIiwiUEkiLCJkcmF3SW1hZ2UiLCJyZXN0b3JlIiwiY29zIiwic2luIiwiY29uc29sZSIsImxvZyIsImV4cGxvc2lvbkltYWdlIiwiU3BhY2VzaGlwV2lkdGgiLCJTcGFjZXNoaXBIZWlnaHQiLCJwbGF5ZXIiLCJwIiwiZGFtYWdlIiwiZGFtYWdlSW1hZ2UiLCJjaGVja0J1bGxldHMiLCJjb2xsaXNpb25EZXRlY3Rpb24iLCJzcGxpY2UiLCJleHBsb2RlIiwibGl2aW5nUGxheWVycyIsInB1c2giLCJyYWRpdXMiLCJzcXJ0IiwiYW5nbGUiLCJidWxsZXRIZWFkWCIsImJ1bGxldEhlYWRZIiwic3BhY2VTaGlwWCIsInNwYWNlU2hpcFkiLCJkaXN0YW5jZSIsImRhbWFnZXNvdW5kIiwiQXVkaW8iLCJwbGF5IiwiaW5jcmVhc2VEYW1hZ2UiLCJsaWZlIiwiZW5kR2FtZSIsImlzRGVmaW5lZCIsImN5Y2xlIiwiY2FuY2VsIiwidW5kZWZpbmVkIiwiZW5kR2FtZVRleHQiLCJkZWZhdWx0VmFycyIsIlBDU2hvdyIsImdldFBDU2hvdyIsImRvY3VtZW50IiwiZ2V0RWxlbWVudEJ5SWQiLCJnZXRDb250ZXh0IiwiQXJyYXkiLCJCdWZmZXJQbGF5ZXIiLCJnZXRQbGF5ZXJzIiwidGVsbGVyIiwiU3BhY2VzaGlwIiwiY29sb3IiLCJpIiwicm90YXRlU3BhY2VzaGlwUmVsYXRpdmUiLCJvcmllbnRhdGlvbiIsInRlbXAiLCJCdWxsZXQiLCJhdWRpb1VybCIsInNob3QiLCJyZXN0YXJ0R2FtZSIsInJlc2V0IiwiY2FudmFzRGlyZWN0aXZlIiwibGluayIsInNjb3BlIiwiZWxlbWVudCIsImF0dHJzIiwiaW5uZXJXaWR0aCIsImlubmVySGVpZ2h0IiwiYmluZCIsIiRkaWdlc3QiLCJyZXN0cmljdCIsInJlcGxhY2UiLCJ0ZW1wbGF0ZSIsImRpcmVjdGl2ZSIsInRoaXMiLCJJbWFnZSIsInNyYyIsImNoYXJBdCIsInRvVXBwZXJDYXNlIiwic2xpY2UiLCJwcm90b3R5cGUiLCJudW1iZXIiLCJtb3ZlU3BhY2VzaGlwIiwibW92ZVNwYWNlc2hpcFJlbGF0aXZlIiwicm90YXRlU3BhY2VzaGlwIiwiZGVncmVlIiwiZGVjcmVhc2VEYW1hZ2UiLCJ2YWx1ZSIsImZhY3RvcnkiLCJwbGF5ZXJzIiwicGxheWVyc0FycmF5IiwiJHJvb3RTY29wZSIsInNvY2tldCIsImlvIiwiY29ubmVjdCIsIndpbmRvdyIsImxvY2F0aW9uIiwiaG9zdCIsImV2ZW50TmFtZSIsImNhbGxiYWNrIiwiYXJncyIsImFyZ3VtZW50cyIsIiRhcHBseSIsImFwcGx5Il0sIm1hcHBpbmdzIjoiQ0FHQSxXQUVBQSxRQUFBQyxPQUFBLGFDREEsV0FDQSxHQUFBQyxHQUFBLFNBQUFDLEVBQUFDLEVBQUFDLEVBQUFDLEdBRUFILEVBQUFJLE9BQUFGLEVBQUFHLFNBR0EsSUFBQUMsR0FBQSxXQUNBTCxFQUFBTSxLQUFBLFlBQUEsTUFFQVAsR0FBQVEsS0FBQSxHQUNBUCxFQUFBUSxHQUFBLGNBQUEsU0FBQUMsR0FDQVYsRUFBQVEsS0FBQUUsSUFFQVQsRUFBQVEsR0FBQSxvQkFBQSxTQUFBQyxHQUNBLEdBQ0FDLElBREFELEVBQUFFLFlBRUFELEdBQUFFLE1BQUFILEVBQUFHLE1BQ0FGLEVBQUFHLEtBQUFKLEVBQUFJLEtBQ0FILEVBQUFJLE1BQUFMLEVBQUFLLFFBRUFmLEVBQUFnQixhQUNBaEIsRUFBQWlCLGdCQUFBLEVBQ0FoQixFQUFBUSxHQUFBLGNBQUEsU0FBQUMsR0FDQVAsRUFBQWUsV0FBQVIsR0FDQVYsRUFBQWdCLFVBQUFOLEVBQ0FWLEVBQUFpQixlQUFBRSxPQUFBQyxLQUFBcEIsRUFBQWdCLFdBQUFLLE9BQUEsSUFHQXJCLEVBQUFzQixVQUFBLFdBQ0FyQixFQUFBTSxLQUFBLFlBQUEsTUFDQUwsRUFBQXFCLFdBQUEsR0FDQXJCLEVBQUFzQixXQUFBLElBSUEsV0FDQWxCLE9BS0FULFNBQUFDLE9BQUEsT0FBQTJCLFdBQUEsbUJBQUEsU0FBQSxnQkFBQSxpQkFBQSxnQkFBQTFCLE9DekNBLFdBQ0EsWUFDQSxJQUFBMkIsR0FBQSxTQUFBMUIsRUFBQTJCLEVBQUFDLEVBQUEzQixFQUFBQyxFQUFBQyxHQW9F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QUFBVyxPQUFBLFdBQ0FILEVBQUFJLE1BQUFYLEVBQUFRLFFBS0FuSixFQUFBLFNBQUFpSixFQUFBOUksRUFBQStJLEdBQ0FQLEVBQUEzSSxLQUFBaUosRUFBQTlJLEVBQUEsV0FDQSxHQUFBZ0osR0FBQUMsU0FDQVYsR0FBQVcsT0FBQSxXQUNBSCxHQUNBQSxFQUFBSSxNQUFBWCxFQUFBUSxPQU9BLFFBQ0FqSixHQUFBQSxFQUNBRixLQUFBQSxFQUNBMkksT0FBQUEsR0FJQXJKLFNBQUFDLE9BQUEsT0FBQWdKLFFBQUEsaUJBQUEsYUFBQTdJIiwiZmlsZSI6ImFwcC5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIENyZWF0ZWQgYnkgTWljaGllbCBvbiAyNS8xMS8yMDE1LlxuICovXG4oZnVuY3Rpb24oKXtcblxuICAgIHZhciBhcHAgPSBhbmd1bGFyLm1vZHVsZShcImFwcFwiLFtdKTtcbn0pKCk7IiwiLyoqXHJcbiAqIENyZWF0ZWQgYnkgTWljaGllbCBvbiAxMS8xMi8yMDE1LlxyXG4gKi9cclxuXHJcbihmdW5jdGlvbigpe1xyXG4gICAgdmFyIGxvZ2luQ29udHJvbGxlciA9IGZ1bmN0aW9uKCRzY29wZSwgc29ja2V0U2VydmljZSwgZGlzcGxheVNlcnZpY2UsIHBsYXllclNlcnZpY2Upe1xyXG5cclxuICAgICAgICAkc2NvcGUuTENTaG93ID0gZGlzcGxheVNlcnZpY2UuZ2V0TENTaG93O1xyXG5cclxuICAgICAgICAvL2Z1bmN0aW9uc1xyXG4gICAgICAgIHZhciBtYWtlUm9vbSA9IGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgICAgIHNvY2tldFNlcnZpY2UuZW1pdChcInBjY29ubmVjdFwiLCBudWxsKTtcclxuICAgICAgICB9O1xyXG4gICAgICAgICRzY29wZS5yb29tID0gXCJcIjtcclxuICAgICAgICBzb2NrZXRTZXJ2aWNlLm9uKCdyZXF1ZXN0Um9vbScsZnVuY3Rpb24oZGF0YSl7XHJcbiAgICAgICAgICAgICRzY29wZS5yb29tID0gZGF0YTtcclxuICAgICAgICB9KTtcclxuICAgICAgICBzb2NrZXRTZXJ2aWNlLm9uKCdkZXZpY2VPcmllbnRhdGlvbicsIGZ1bmN0aW9uKGRhdGEpe1xyXG4gICAgICAgICAgICB2YXIgdXNlcm5hbWUgPSBkYXRhLnVzZXJuYW1lO1xyXG4gICAgICAgICAgICB2YXIgZGV2aWNlT3JpZW50YXRpb24gPSB7fTtcclxuICAgICAgICAgICAgZGV2aWNlT3JpZW50YXRpb24uZ2FtbWEgPSBkYXRhLmdhbW1hO1xyXG4gICAgICAgICAgICBkZXZpY2VPcmllbnRhdGlvbi5iZXRhID0gZGF0YS5iZXRhO1xyXG4gICAgICAgICAgICBkZXZpY2VPcmllbnRhdGlvbi5hbHBoYSA9IGRhdGEuYWxwaGE7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgJHNjb3BlLnVzZXJuYW1lcyA9IHt9O1xyXG4gICAgICAgICRzY29wZS5jaGVja1VzZXJDb3VudCA9IGZhbHNlO1xyXG4gICAgICAgIHNvY2tldFNlcnZpY2Uub24oJ3VwZGF0ZXVzZXJzJywgZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgcGxheWVyU2VydmljZS5zZXRQbGF5ZXJzKGRhdGEpO1xyXG4gICAgICAgICAgICAkc2NvcGUudXNlcm5hbWVzID0gZGF0YTtcclxuICAgICAgICAgICAgJHNjb3BlLmNoZWNrVXNlckNvdW50ID0gT2JqZWN0LmtleXMoJHNjb3BlLnVzZXJuYW1lcykubGVuZ3RoIDwgMDtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgJHNjb3BlLnN0YXJ0R2FtZT0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBzb2NrZXRTZXJ2aWNlLmVtaXQoXCJzdGFydEdhbWVcIiwgbnVsbCk7XHJcbiAgICAgICAgICAgIGRpc3BsYXlTZXJ2aWNlLnNldExDU2hvdyhmYWxzZSk7XHJcbiAgICAgICAgICAgIGRpc3BsYXlTZXJ2aWNlLnNldFBDU2hvdyh0cnVlKTtcclxuICAgICAgICB9O1xyXG5cclxuXHJcbiAgICAgICAgKGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICBtYWtlUm9vbSgpO1xyXG4gICAgICAgIH0pKCk7XHJcblxyXG4gICAgfTtcclxuXHJcbiAgICBhbmd1bGFyLm1vZHVsZShcImFwcFwiKS5jb250cm9sbGVyKFwibG9naW5Db250cm9sbGVyXCIsIFtcIiRzY29wZVwiLCBcInNvY2tldFNlcnZpY2VcIiAsIFwiZGlzcGxheVNlcnZpY2VcIiwgXCJwbGF5ZXJTZXJ2aWNlXCIsIGxvZ2luQ29udHJvbGxlcl0pO1xyXG59KSgpOyIsIi8qKlxyXG4gKiBDcmVhdGVkIGJ5IE1pY2hpZWwgb24gMTYvMTIvMjAxNS5cclxuICovXHJcblxyXG4oZnVuY3Rpb24oKXtcclxuICAgIFwidXNlIHN0cmljdFwiO1xyXG4gICAgdmFyIHBsYXlDb250cm9sbGVyID0gZnVuY3Rpb24oJHNjb3BlLCAkaW50ZXJ2YWwsICR3aW5kb3csIHNvY2tldFNlcnZpY2UsIGRpc3BsYXlTZXJ2aWNlLCBwbGF5ZXJTZXJ2aWNlKXtcclxuICAgICAgICB2YXIgZGVmYXVsdFZhcnMgPSBbe3g6MTAsIHk6MTAscm90YXRpb246MTM1fSx7eDo5MCwgeToxMCxyb3RhdGlvbjoyMjV9LHt4OjkwLCB5OjkwLHJvdGF0aW9uOjMxNX0se3g6MTAsIHk6OTAscm90YXRpb246NDV9XTtcclxuICAgICAgICAkc2NvcGUuUENTaG93ID0gZGlzcGxheVNlcnZpY2UuZ2V0UENTaG93O1xyXG4gICAgICAgICRzY29wZS5lbmRHYW1lID0gZmFsc2U7XHJcbiAgICAgICAgdmFyIGNhbnYgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZ2FtZScpO1xyXG4gICAgICAgIHZhciBjdHggPSBjYW52LmdldENvbnRleHQoJzJkJyk7XHJcblxyXG4gICAgICAgIHZhciBBbGxQbGF5ZXJzID0gbmV3IEFycmF5KCk7XHJcbiAgICAgICAgdmFyIEFsbEJ1bGxldHMgPSBuZXcgQXJyYXkoKTtcclxuXHJcbiAgICAgICAgdmFyIGN5Y2xlO1xyXG5cclxuICAgICAgICBzb2NrZXRTZXJ2aWNlLm9uKFwiaW5pdEdhbWVcIiwgZnVuY3Rpb24oKXtcclxuICAgICAgICAgICAgdmFyIEJ1ZmZlclBsYXllciA9IHBsYXllclNlcnZpY2UuZ2V0UGxheWVycygpO1xyXG4gICAgICAgICAgICB2YXIgdGVsbGVyPSAwO1xyXG4gICAgICAgICAgICBmb3IodmFyIHBsYXllciBpbiBCdWZmZXJQbGF5ZXIpe1xyXG4gICAgICAgICAgICAgICAgdmFyIHAgPSBCdWZmZXJQbGF5ZXJbcGxheWVyXTtcclxuICAgICAgICAgICAgICAgIEFsbFBsYXllcnMucHVzaChuZXcgU3BhY2VzaGlwKHAudXNlcm5hbWUsIGRlZmF1bHRWYXJzW3RlbGxlcl0ueCwgZGVmYXVsdFZhcnNbdGVsbGVyXS55LCBwLmNvbG9yLCBkZWZhdWx0VmFyc1t0ZWxsZXJdLnJvdGF0aW9uKSk7XHJcbiAgICAgICAgICAgICAgICB0ZWxsZXIrKztcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgY3ljbGUgPSAkaW50ZXJ2YWwoZHJhdywgMTApO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBzb2NrZXRTZXJ2aWNlLm9uKFwidXNlcmxlZnRcIiwgZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgdmFyIHAgPSBudWxsO1xyXG4gICAgICAgICAgICBmb3IodmFyIGkgaW4gQWxsUGxheWVycyl7XHJcbiAgICAgICAgICAgICAgICBpZihmaWx0ZXJQbGF5ZXJzKEFsbFBsYXllcnNbaV0sZGF0YSkgPT0gdHJ1ZSl7XHJcbiAgICAgICAgICAgICAgICAgICAgcCA9IGk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgQWxsUGxheWVycy5zcGxpY2UocCwxKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgc29ja2V0U2VydmljZS5vbihcInVwZGF0ZUdhbWVEYXRhXCIsIGZ1bmN0aW9uKGRhdGEpe1xyXG4gICAgICAgICAgICB2YXIgcCA9IG51bGw7XHJcbiAgICAgICAgICAgIGZvcih2YXIgaSBpbiBBbGxQbGF5ZXJzKXtcclxuICAgICAgICAgICAgICAgIGlmKGZpbHRlclBsYXllcnMoQWxsUGxheWVyc1tpXSxkYXRhKSA9PSB0cnVlKXtcclxuICAgICAgICAgICAgICAgICAgICBwID0gaTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZihwICE9IG51bGwpe1xyXG4gICAgICAgICAgICAgICAgQWxsUGxheWVyc1twXS5yb3RhdGVTcGFjZXNoaXBSZWxhdGl2ZShkYXRhLm9yaWVudGF0aW9uKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBzb2NrZXRTZXJ2aWNlLm9uKFwicGxheWVyU2hvdFwiLCBmdW5jdGlvbihkYXRhKXtcclxuICAgICAgICAgICAgdmFyIHAgPSBudWxsO1xyXG4gICAgICAgICAgICBmb3IodmFyIGkgaW4gQWxsUGxheWVycyl7XHJcbiAgICAgICAgICAgICAgICBpZihmaWx0ZXJQbGF5ZXJzKEFsbFBsYXllcnNbaV0sZGF0YSkgPT0gdHJ1ZSl7XHJcbiAgICAgICAgICAgICAgICAgICAgcCA9IGk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYocCAhPSBudWxsKXtcclxuICAgICAgICAgICAgICAgIHZhciB0ZW1wID0gQWxsUGxheWVyc1twXTtcclxuICAgICAgICAgICAgICAgIHZhciBhbmdsZSA9ICgzNjAgLSh0ZW1wLnJvdGF0aW9uICsgMTgwKSkvMTgwKk1hdGguUEk7XHJcbiAgICAgICAgICAgICAgICB2YXIgeCA9IHRlbXAueCArIChjYW52LndpZHRoLzQwMCAqIE1hdGguc2luKGFuZ2xlKSk7XHJcbiAgICAgICAgICAgICAgICB2YXIgeSA9IHRlbXAueSArIChjYW52LndpZHRoLzQwMCAqIE1hdGguY29zKGFuZ2xlKSk7XHJcbiAgICAgICAgICAgICAgICBBbGxCdWxsZXRzLnB1c2gobmV3IEJ1bGxldCh4LCB5LCB0ZW1wLnJvdGF0aW9uLCB0ZW1wLmNvbG9yLCB0ZW1wLnVzZXJOYW1lKSk7XHJcbiAgICAgICAgICAgICAgICB2YXIgYXVkaW9VcmwgPSAnLi4vLi4vYXNzZXRzL0JvbnVzL3NmeF9sYXNlcjIub2dnJztcclxuICAgICAgICAgICAgICAgIGlmKHAlMiA9PSAwKXtcclxuICAgICAgICAgICAgICAgICAgICBhdWRpb1VybCA9ICcuLi8uLi9hc3NldHMvQm9udXMvc2Z4X2xhc2VyMS5vZ2cnO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgdmFyIHNob3QgPSBuZXcgQXVkaW8oYXVkaW9VcmwpO1xyXG4gICAgICAgICAgICAgICAgc2hvdC5wbGF5KCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZmlsdGVyUGxheWVycyhvYmosZGF0YSl7XHJcbiAgICAgICAgICAgIHJldHVybiBkYXRhLnVzZXJuYW1lID09IG9iai51c2VyTmFtZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGRyYXcoKXtcclxuICAgICAgICAgICAgaWYoQWxsUGxheWVycy5sZW5ndGg+MCl7XHJcbiAgICAgICAgICAgICAgICBBbGxQbGF5ZXJzWzBdLnNwZWVkID0gMDtcclxuICAgICAgICAgICAgICAgIEFsbFBsYXllcnNbMV0uc3BlZWQgPSAwO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGN0eC5jbGVhclJlY3QoMCwwLGNhbnYud2lkdGgsIGNhbnYuaGVpZ2h0KTtcclxuICAgICAgICAgICAgdmFyIHJhdGlvID0gY2Fudi53aWR0aC8xMDA7XHJcblxyXG4gICAgICAgICAgICBpZihBbGxCdWxsZXRzLmxlbmd0aCAhPSAwKXtcclxuICAgICAgICAgICAgICAgIHZhciBCdWxsZXRXaWR0aCA9IGNhbnYud2lkdGgvMTAwO1xyXG4gICAgICAgICAgICAgICAgdmFyIEJ1bGxldEhlaWdodCA9IEJ1bGxldFdpZHRoICogQWxsQnVsbGV0c1swXS5pbWFnZS5oZWlnaHQvQWxsQnVsbGV0c1swXS5pbWFnZS53aWR0aDtcclxuXHJcbiAgICAgICAgICAgICAgICBmb3IodmFyIGJ1bGxldCBpbiBBbGxCdWxsZXRzKXtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgYiA9IEFsbEJ1bGxldHNbYnVsbGV0XTtcclxuICAgICAgICAgICAgICAgICAgICBiLndpZHRoID0gQnVsbGV0V2lkdGg7XHJcbiAgICAgICAgICAgICAgICAgICAgYi5oZWlnaHQgPSBCdWxsZXRIZWlnaHQ7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmKGIuZXhwbG9kZVN0YWdlID09IDApe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvL0RyYXcgYnVsbGV0XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5zYXZlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGN0eC50cmFuc2xhdGUoYi54KnJhdGlvLCBiLnkqcmF0aW8pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjdHgucm90YXRlKGIucm90YXRpb24vMTgwKk1hdGguUEkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjdHguZHJhd0ltYWdlKGIuaW1hZ2UsIC1CdWxsZXRXaWR0aC8yLCAtQnVsbGV0SGVpZ2h0LzIsIEJ1bGxldFdpZHRoLCBCdWxsZXRIZWlnaHQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjdHgucmVzdG9yZSgpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgQWxsQnVsbGV0c1tidWxsZXRdLnggPSBNYXRoLmNvcygoYi5yb3RhdGlvbiAtIDkwKS8xODAqTWF0aC5QSSkgKyBiLng7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIEFsbEJ1bGxldHNbYnVsbGV0XS55ID0gTWF0aC5zaW4oKGIucm90YXRpb24gLSA5MCkvMTgwKk1hdGguUEkpKyBiLnk7XHJcbiAgICAgICAgICAgICAgICAgICAgfWVsc2UgaWYoYi5leHBsb2RlU3RhZ2UgPCA0KXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy9EcmF3IGV4cGxvc2lvblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhiLmV4cGxvc2lvbkltYWdlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY3R4LnNhdmUoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY3R4LnRyYW5zbGF0ZShiLngqcmF0aW8sIGIueSpyYXRpbyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5kcmF3SW1hZ2UoYi5leHBsb3Npb25JbWFnZSwgLUJ1bGxldFdpZHRoLCAtQnVsbGV0V2lkdGgsIEJ1bGxldFdpZHRoKjIsIEJ1bGxldFdpZHRoKjIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjdHgucmVzdG9yZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYoQWxsUGxheWVycy5sZW5ndGggIT0gMCl7XHJcbiAgICAgICAgICAgICAgICB2YXIgU3BhY2VzaGlwV2lkdGggPSBjYW52LndpZHRoLzIwO1xyXG4gICAgICAgICAgICAgICAgdmFyIFNwYWNlc2hpcEhlaWdodCA9IFNwYWNlc2hpcFdpZHRoICogQWxsUGxheWVyc1swXS5pbWFnZS5oZWlnaHQvIEFsbFBsYXllcnNbMF0uaW1hZ2Uud2lkdGg7XHJcblxyXG4gICAgICAgICAgICAgICAgZm9yKHZhciBwbGF5ZXIgaW4gQWxsUGxheWVycyl7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHAgPSBBbGxQbGF5ZXJzW3BsYXllcl07XHJcbiAgICAgICAgICAgICAgICAgICAgcC53aWR0aCA9IFNwYWNlc2hpcFdpZHRoO1xyXG4gICAgICAgICAgICAgICAgICAgIHAuaGVpZ2h0ID0gU3BhY2VzaGlwSGVpZ2h0O1xyXG4gICAgICAgICAgICAgICAgICAgIGN0eC5zYXZlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgY3R4LnRyYW5zbGF0ZShwLngqcmF0aW8sIHAueSpyYXRpbyk7XHJcbiAgICAgICAgICAgICAgICAgICAgY3R4LnJvdGF0ZShwLnJvdGF0aW9uLzE4MCpNYXRoLlBJKTtcclxuICAgICAgICAgICAgICAgICAgICBjdHguZHJhd0ltYWdlKHAuaW1hZ2UsIC1TcGFjZXNoaXBXaWR0aC8yLCAtU3BhY2VzaGlwSGVpZ2h0LzIsIFNwYWNlc2hpcFdpZHRoLCBTcGFjZXNoaXBIZWlnaHQpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmKHAuZGFtYWdlID4gMCl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5kcmF3SW1hZ2UocC5kYW1hZ2VJbWFnZSwgLVNwYWNlc2hpcFdpZHRoLzIsIC1TcGFjZXNoaXBIZWlnaHQvMiwgU3BhY2VzaGlwV2lkdGgsIFNwYWNlc2hpcEhlaWdodCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGN0eC5yZXN0b3JlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgQWxsUGxheWVyc1twbGF5ZXJdLnggPSBNYXRoLmNvcygocC5yb3RhdGlvbiAtIDkwKS8xODAqTWF0aC5QSSkvMTAqIHAuc3BlZWQgKyBwLng7XHJcbiAgICAgICAgICAgICAgICAgICAgQWxsUGxheWVyc1twbGF5ZXJdLnkgPSBNYXRoLnNpbigocC5yb3RhdGlvbiAtIDkwKS8xODAqTWF0aC5QSSkvMTAqIHAuc3BlZWQgKyBwLnk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGNoZWNrQnVsbGV0cygpO1xyXG5cclxuICAgICAgICAgICAgY29sbGlzaW9uRGV0ZWN0aW9uKCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBjaGVja0J1bGxldHMoKXtcclxuICAgICAgICAgICAgZm9yKHZhciBiIGluIEFsbEJ1bGxldHMpe1xyXG4gICAgICAgICAgICAgICAgaWYoQWxsQnVsbGV0c1tiXS54IDwgMCB8fCBBbGxCdWxsZXRzW2JdLnggPiBjYW52LndpZHRoIHx8IEFsbEJ1bGxldHNbYl0ueSA8IDAgfHwgQWxsQnVsbGV0c1tiXS55ID4gY2Fudi5oZWlnaHQpe1xyXG4gICAgICAgICAgICAgICAgICAgIEFsbEJ1bGxldHMuc3BsaWNlKGIsIDEpO1xyXG4gICAgICAgICAgICAgICAgfWVsc2UgaWYoQWxsQnVsbGV0c1tiXS5leHBsb2RlU3RhZ2UgPjApIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoQWxsQnVsbGV0c1tiXS5leHBsb2RlU3RhZ2UgPCA0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIEFsbEJ1bGxldHNbYl0uZXhwbG9kZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIEFsbEJ1bGxldHMuc3BsaWNlKGIsIDEpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gY29sbGlzaW9uRGV0ZWN0aW9uKCl7XHJcbiAgICAgICAgICAgIHZhciBsaXZpbmdQbGF5ZXJzPVtdO1xyXG4gICAgICAgICAgICBmb3IodmFyIHAgaW4gQWxsUGxheWVycyl7XHJcbiAgICAgICAgICAgICAgICBpZihBbGxQbGF5ZXJzW3BdLmRhbWFnZTw0KXtcclxuICAgICAgICAgICAgICAgICAgICBsaXZpbmdQbGF5ZXJzLnB1c2goQWxsUGxheWVyc1twXSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBmb3IodmFyIGIgaW4gQWxsQnVsbGV0cyl7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYoQWxsQnVsbGV0c1tiXS5leHBsb2RlU3RhZ2UgPT0gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoQWxsQnVsbGV0c1tiXS5wbGF5ZXIgIT0gQWxsUGxheWVyc1twXS51c2VyTmFtZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHJhZGl1cyA9IE1hdGguc3FydCgyKSAvIDIgKiAoQWxsQnVsbGV0c1tiXS5oZWlnaHQgLyAyIC0gQWxsQnVsbGV0c1tiXS53aWR0aCAvIDIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGFuZ2xlID0gKDM2MCAtIChBbGxCdWxsZXRzW2JdLnJvdGF0aW9uKSkgLyAxODAgKiBNYXRoLlBJO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGJ1bGxldEhlYWRYID0gKEFsbEJ1bGxldHNbYl0ueCAqIGNhbnYud2lkdGggLyAxMDAgLSAocmFkaXVzICogTWF0aC5zaW4oYW5nbGUpKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgYnVsbGV0SGVhZFkgPSAoQWxsQnVsbGV0c1tiXS55ICogY2Fudi53aWR0aCAvIDEwMCAtIChyYWRpdXMgKiBNYXRoLmNvcyhhbmdsZSkpKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgc3BhY2VTaGlwWCA9IEFsbFBsYXllcnNbcF0ueCAqIGNhbnYud2lkdGggLyAxMDA7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgc3BhY2VTaGlwWSA9IEFsbFBsYXllcnNbcF0ueSAqIGNhbnYud2lkdGggLyAxMDA7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLypjdHguc2F2ZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5iZWdpblBhdGgoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdHguYXJjKHNwYWNlU2hpcFgsIHNwYWNlU2hpcFksIEFsbFBsYXllcnNbcF0ud2lkdGgvMiwgMCwgTWF0aC5QSSoyKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdHgubGluZVdpZHRoID0gMTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdHguc3Ryb2tlU3R5bGUgPSAnIzAwMDBGRic7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3R4LnN0cm9rZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5yZXN0b3JlKCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5zYXZlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3R4LmJlZ2luUGF0aCgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5hcmMoYnVsbGV0SGVhZFgsIGJ1bGxldEhlYWRZLCBBbGxCdWxsZXRzW2JdLndpZHRoLzIsIDAsIE1hdGguUEkqMik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3R4LmxpbmVXaWR0aCA9IDE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3R4LnN0cm9rZVN0eWxlID0gJyNGRjAwMDAnO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5zdHJva2UoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdHgucmVzdG9yZSgpOyovXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZGlzdGFuY2UgPSBNYXRoLnNxcnQoKGJ1bGxldEhlYWRYIC0gc3BhY2VTaGlwWCkgKiAoYnVsbGV0SGVhZFggLSBzcGFjZVNoaXBYKSArIChidWxsZXRIZWFkWSAtIHNwYWNlU2hpcFkpICogKGJ1bGxldEhlYWRZIC0gc3BhY2VTaGlwWSkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRpc3RhbmNlIDwgKEFsbEJ1bGxldHNbYl0ud2lkdGggLyAyICsgQWxsUGxheWVyc1twXS53aWR0aCAvIDIpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGRhbWFnZXNvdW5kID0gbmV3IEF1ZGlvKCcuLi8uLi9hc3NldHMvQm9udXMvc2Z4X2xvc2Uub2dnJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGFtYWdlc291bmQucGxheSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEFsbFBsYXllcnNbcF0uaW5jcmVhc2VEYW1hZ2UoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZGF0YSA9IHt9O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEudXNlcm5hbWUgPSBBbGxQbGF5ZXJzW3BdLnVzZXJOYW1lO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEubGlmZSA9IDMtQWxsUGxheWVyc1twXS5kYW1hZ2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc29ja2V0U2VydmljZS5lbWl0KFwicGxheWVyTGlmZVwiLGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEFsbEJ1bGxldHNbYl0uZXhwbG9kZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmKGxpdmluZ1BsYXllcnMubGVuZ3RoPT0xKXtcclxuICAgICAgICAgICAgICAgIGVuZEdhbWUobGl2aW5nUGxheWVycyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGVuZEdhbWUobGl2aW5nUGxheWVycyl7XHJcbiAgICAgICAgICAgIGlmIChhbmd1bGFyLmlzRGVmaW5lZChjeWNsZSkpIHtcclxuICAgICAgICAgICAgICAgICRpbnRlcnZhbC5jYW5jZWwoY3ljbGUpO1xyXG4gICAgICAgICAgICAgICAgY3ljbGUgPSB1bmRlZmluZWQ7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgJHNjb3BlLmVuZEdhbWU9dHJ1ZTtcclxuICAgICAgICAgICAgJHNjb3BlLmVuZEdhbWVUZXh0PSBsaXZpbmdQbGF5ZXJzWzBdLnVzZXJOYW1lICsgXCIgaXMgdGhlIHdpbm5lciFcIlxyXG4gICAgICAgIH1cclxuICAgICAgICAkc2NvcGUucmVzdGFydEdhbWUgPSBmdW5jdGlvbigpe1xyXG4gICAgICAgICAgICAkc2NvcGUuZW5kR2FtZT1mYWxzZTtcclxuICAgICAgICAgICAgdmFyIHRlbGxlcj0wO1xyXG4gICAgICAgICAgICBmb3IodmFyIHAgaW4gQWxsUGxheWVycyl7XHJcbiAgICAgICAgICAgICAgICBBbGxQbGF5ZXJzW3BdLnJlc2V0KGRlZmF1bHRWYXJzW3RlbGxlcl0ueCxkZWZhdWx0VmFyc1t0ZWxsZXJdLnksZGVmYXVsdFZhcnNbdGVsbGVyXS5yb3RhdGlvbik7XHJcbiAgICAgICAgICAgICAgICB0ZWxsZXIrKztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICB9O1xyXG5cclxuICAgIGFuZ3VsYXIubW9kdWxlKFwiYXBwXCIpLmNvbnRyb2xsZXIoXCJwbGF5Q29udHJvbGxlclwiLCBbXCIkc2NvcGVcIiwgXCIkaW50ZXJ2YWxcIiwgXCIkd2luZG93XCIsIFwic29ja2V0U2VydmljZVwiLCBcImRpc3BsYXlTZXJ2aWNlXCIsIFwicGxheWVyU2VydmljZVwiLCBwbGF5Q29udHJvbGxlcl0pXHJcbn0pKCk7IiwiLyoqXHJcbiAqIENyZWF0ZWQgYnkganVzdGlqbmRlcG92ZXIgb24gMTYvMTIvMTUuXHJcbiAqL1xyXG4oZnVuY3Rpb24oKXtcclxuICAgIHZhciBjYW52YXNEaXJlY3RpdmUgPSBmdW5jdGlvbigkd2luZG93KXtcclxuICAgICAgICByZXR1cm57XHJcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnRScsXHJcbiAgICAgICAgICAgIGxpbms6bGluayxcclxuICAgICAgICAgICAgcmVwbGFjZTp0cnVlLFxyXG4gICAgICAgICAgICB0ZW1wbGF0ZTonPGNhbnZhcyBpZD1cImdhbWVcIiBjbGFzcz1cInBsYXlBcmVhXCIgd2lkdGg9XCJ7e3dpZHRofX1cIiBoZWlnaHQ9XCJ7e3dpZHRofX1cIiAvPidcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBsaW5rKHNjb3BlLCBlbGVtZW50LCBhdHRycyl7XHJcbiAgICAgICAgICAgIGlmKCR3aW5kb3cuaW5uZXJXaWR0aCA8ICR3aW5kb3cuaW5uZXJIZWlnaHQpe1xyXG4gICAgICAgICAgICAgICAgc2NvcGUud2lkdGggPSAkd2luZG93LmlubmVyV2lkdGggLSAyMDtcclxuICAgICAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICAgICAgICBzY29wZS53aWR0aCA9ICR3aW5kb3cuaW5uZXJIZWlnaHQgLSAyMDtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgYW5ndWxhci5lbGVtZW50KCR3aW5kb3cpLmJpbmQoJ3Jlc2l6ZScsIGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgICAgICAgICBpZigkd2luZG93LmlubmVyV2lkdGggPCAkd2luZG93LmlubmVySGVpZ2h0KXtcclxuICAgICAgICAgICAgICAgICAgICBzY29wZS53aWR0aCA9ICR3aW5kb3cuaW5uZXJXaWR0aCAtIDIwO1xyXG4gICAgICAgICAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUud2lkdGggPSAkd2luZG93LmlubmVySGVpZ2h0IC0gMjA7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgc2NvcGUuJGRpZ2VzdCgpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG5cclxuICAgIGFuZ3VsYXIubW9kdWxlKCdhcHAnKS5kaXJlY3RpdmUoXCJjYW52YXNEaXJlY3RpdmVcIiwgW1wiJHdpbmRvd1wiLCBjYW52YXNEaXJlY3RpdmVdKTtcclxufSkoKTsiLCIvKipcclxuICogQ3JlYXRlZCBieSBqdXN0aWpuZGVwb3ZlciBvbiAyMi8xMi8xNS5cclxuICovXHJcblxyXG52YXIgQnVsbGV0ID0gZnVuY3Rpb24oeCwgeSxyb3RhdGlvbiwgY29sb3IsIHBsYXllcil7XHJcbiAgICB0aGlzLnggPSB4O1xyXG4gICAgdGhpcy55ID0geTtcclxuICAgIHRoaXMucm90YXRpb24gPSByb3RhdGlvbjtcclxuICAgIHRoaXMuaW1hZ2UgPSBuZXcgSW1hZ2UoKTtcclxuICAgIHRoaXMuY29sb3IgPSBjb2xvcjtcclxuICAgIHRoaXMud2lkdGggPSAwO1xyXG4gICAgdGhpcy5oZWlnaHQgPSAwO1xyXG4gICAgdGhpcy5wbGF5ZXIgPSBwbGF5ZXI7XHJcbiAgICB0aGlzLmV4cGxvc2lvbkltYWdlID0gbmV3IEltYWdlKCk7XHJcbiAgICB0aGlzLmV4cGxvZGVTdGFnZSA9IDA7XHJcbiAgICBpZih0aGlzLmNvbG9yID09IFwib3JhbmdlXCIpe1xyXG4gICAgICAgIHRoaXMuY29sb3IgPSAncmVkJztcclxuICAgIH1cclxuICAgIHRoaXMuaW1hZ2Uuc3JjID0gJy4uL2Fzc2V0cy9QTkcvTGFzZXJzL2xhc2VyJysgdGhpcy5jb2xvci5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArIHRoaXMuY29sb3Iuc2xpY2UoMSkgKycwMS5wbmcnXHJcbn07XHJcblxyXG5CdWxsZXQucHJvdG90eXBlLmV4cGxvZGUgPSBmdW5jdGlvbigpe1xyXG4gICAgaWYodGhpcy5leHBsb2RlU3RhZ2UgPCA0KXtcclxuICAgICAgICB0aGlzLmV4cGxvZGVTdGFnZSsrO1xyXG4gICAgICAgIHZhciBudW1iZXI7XHJcbiAgICAgICAgaWYodGhpcy5leHBsb2RlU3RhZ2UgPCAzKXtcclxuICAgICAgICAgICBudW1iZXIgPSAxXHJcbiAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICAgIG51bWJlciA9IDJcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5leHBsb3Npb25JbWFnZS5zcmMgPSAnLi4vYXNzZXRzL1BORy9MYXNlcnMvbGFzZXInICsgdGhpcy5jb2xvci5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArIHRoaXMuY29sb3Iuc2xpY2UoMSkgKyAnRXhwbG9kZScrIG51bWJlciArJy5wbmcnO1xyXG4gICAgfWVsc2V7XHJcbiAgICAgICAgdGhpcy5leHBsb3Npb25JbWFnZS5zcmMgPSAnJztcclxuICAgIH1cclxufTtcclxuIiwiLyoqXHJcbiAqIENyZWF0ZWQgYnkganVzdGlqbmRlcG92ZXIgb24gMDkvMTIvMTUuXHJcbiAqL1xyXG5cclxudmFyIFNwYWNlc2hpcCA9IGZ1bmN0aW9uKHVzZXJOYW1lLCB4LCB5LCBjb2xvciwgcm90YXRpb24pe1xyXG4gICAgdGhpcy51c2VyTmFtZSA9IHVzZXJOYW1lO1xyXG4gICAgdGhpcy54ID0geDtcclxuICAgIHRoaXMueSA9IHk7XHJcbiAgICB0aGlzLnNwZWVkID0gMTtcclxuICAgIHRoaXMuY29sb3IgPSBjb2xvcjtcclxuICAgIHRoaXMucm90YXRpb24gPSByb3RhdGlvbjtcclxuICAgIHRoaXMuaW1hZ2UgPSBuZXcgSW1hZ2UoKTtcclxuICAgIHRoaXMuZGFtYWdlID0gMDtcclxuICAgIHRoaXMud2lkdGggPSAwO1xyXG4gICAgdGhpcy5oZWlnaHQgPSAwO1xyXG4gICAgdGhpcy5kYW1hZ2VJbWFnZSA9IG5ldyBJbWFnZSgpO1xyXG4gICAgdGhpcy5pbWFnZS5zcmMgPSAnLi4vYXNzZXRzL1BORy9wbGF5ZXJTaGlwMV8nKyB0aGlzLmNvbG9yICsnLnBuZydcclxufTtcclxuXHJcblNwYWNlc2hpcC5wcm90b3R5cGUucmVzZXQgPSBmdW5jdGlvbiAoeCwgeSwgcm90YXRpb24pIHtcclxuICAgIHRoaXMuc3BlZWQgPSAxO1xyXG4gICAgdGhpcy5kYW1hZ2UgPSAwO1xyXG4gICAgdGhpcy5kYW1hZ2VJbWFnZSA9IG5ldyBJbWFnZSgpO1xyXG4gICAgdGhpcy5pbWFnZS5zcmMgPSAnLi4vYXNzZXRzL1BORy9wbGF5ZXJTaGlwMV8nKyB0aGlzLmNvbG9yICsnLnBuZydcclxufTtcclxuXHJcblNwYWNlc2hpcC5wcm90b3R5cGUubW92ZVNwYWNlc2hpcCA9IGZ1bmN0aW9uKHgsIHkpe1xyXG4gICAgdGhpcy54ID0geDtcclxuICAgIHRoaXMueSA9IHk7XHJcbn07XHJcblxyXG5TcGFjZXNoaXAucHJvdG90eXBlLm1vdmVTcGFjZXNoaXBSZWxhdGl2ZSA9IGZ1bmN0aW9uKHgsIHkpe1xyXG4gICAgdGhpcy54ID0gdGhpcy54K3g7XHJcbiAgICB0aGlzLnkgPSB0aGlzLnkreTtcclxufTtcclxuXHJcblNwYWNlc2hpcC5wcm90b3R5cGUucm90YXRlU3BhY2VzaGlwID0gZnVuY3Rpb24oZGVncmVlKXtcclxuICAgIHRoaXMucm90YXRpb24gPSBkZWdyZWU7XHJcbn07XHJcblxyXG5TcGFjZXNoaXAucHJvdG90eXBlLnJvdGF0ZVNwYWNlc2hpcFJlbGF0aXZlID0gZnVuY3Rpb24oZGVncmVlKXtcclxuICAgIHRoaXMucm90YXRpb24gPSB0aGlzLnJvdGF0aW9uICsgZGVncmVlLzU7XHJcbiAgICBpZih0aGlzLnJvdGF0aW9uIDwgLTM2MCl7XHJcbiAgICAgICAgdGhpcy5yb3RhdGlvbiA9IHRoaXMucm90YXRpb24gKyA3MjA7XHJcbiAgICB9XHJcbiAgICBpZih0aGlzLnJvdGF0aW9uID4gMzYwKXtcclxuICAgICAgICB0aGlzLnJvdGF0aW9uID0gdGhpcy5yb3RhdGlvbiAtIDcyMDtcclxuICAgIH1cclxufTtcclxuXHJcblNwYWNlc2hpcC5wcm90b3R5cGUuaW5jcmVhc2VEYW1hZ2UgPSBmdW5jdGlvbigpe1xyXG4gICAgaWYodGhpcy5kYW1hZ2UgPCA0KXtcclxuICAgICAgICB0aGlzLmRhbWFnZSArPSAxO1xyXG4gICAgfVxyXG5cclxuICAgIGlmKHRoaXMuZGFtYWdlIDw9IDMgJiYgdGhpcy5kYW1hZ2UgPiAwKXtcclxuICAgICAgICB0aGlzLmRhbWFnZUltYWdlLnNyYyA9ICcuLi9hc3NldHMvUE5HL0RhbWFnZS9wbGF5ZXJTaGlwMV9kYW1hZ2UnKyB0aGlzLmRhbWFnZSArICcucG5nJztcclxuICAgIH1lbHNlIGlmKHRoaXMuZGFtYWdlPT00KXtcclxuICAgICAgICB0aGlzLmRhbWFnZUltYWdlLnNyYyA9ICcuLi9hc3NldHMvUE5HL0RhbWFnZS9leHBsb2RlLmdpZic7XHJcbiAgICB9XHJcbn07XHJcblxyXG5TcGFjZXNoaXAucHJvdG90eXBlLmRlY3JlYXNlRGFtYWdlID0gZnVuY3Rpb24oKXtcclxuICAgIGlmKHRoaXMuZGFtYWdlID4gMCl7XHJcbiAgICAgICAgdGhpcy5kYW1hZ2UgLT0gMTtcclxuICAgIH1cclxuXHJcbiAgICBpZih0aGlzLmRhbWFnZSA8PSAzICYmIHRoaXMuZGFtYWdlID4gMCl7XHJcbiAgICAgICAgdGhpcy5kYW1hZ2VJbWFnZS5zcmMgPSAnLi4vYXNzZXRzL1BORy9EYW1hZ2UvcGxheWVyU2hpcDFfZGFtYWdlJysgdGhpcy5kYW1hZ2UgKyAnLnBuZyc7XHJcbiAgICB9XHJcbn07XHJcblxyXG4iLCIvKipcclxuICogQ3JlYXRlZCBieSBNaWNoaWVsIG9uIDE2LzEyLzIwMTUuXHJcbiAqL1xyXG4vKipcclxuICogQ3JlYXRlZCBieSBqdXN0aWpuZGVwb3ZlciBvbiAxNi8xMi8xNS5cclxuICovXHJcblxyXG5cclxuKGZ1bmN0aW9uKCl7XHJcbiAgICB2YXIgZGlzcGxheVNlcnZpY2UgPSBmdW5jdGlvbigpe1xyXG4gICAgICAgIC8vTG9naW4gQ29udHJvbGxlclxyXG4gICAgICAgIHZhciBMQ1Nob3cgPSB0cnVlO1xyXG4gICAgICAgIC8vUGxheSBjb250cm9sbGVyXHJcbiAgICAgICAgdmFyIFBDU2hvdyA9IGZhbHNlO1xyXG5cclxuICAgICAgICByZXR1cm57XHJcbiAgICAgICAgICAgIGdldExDU2hvdzogZnVuY3Rpb24oKXtcclxuICAgICAgICAgICAgICAgIHJldHVybiBMQ1Nob3c7XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIHNldExDU2hvdzogZnVuY3Rpb24odmFsdWUpe1xyXG4gICAgICAgICAgICAgICAgTENTaG93ID0gdmFsdWU7XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIGdldFBDU2hvdzogZnVuY3Rpb24oKXtcclxuICAgICAgICAgICAgICAgIHJldHVybiBQQ1Nob3c7XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIHNldFBDU2hvdzogZnVuY3Rpb24odmFsdWUpe1xyXG4gICAgICAgICAgICAgICAgUENTaG93ID0gdmFsdWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9O1xyXG5cclxuICAgIGFuZ3VsYXIubW9kdWxlKCdhcHAnKS5mYWN0b3J5KCdkaXNwbGF5U2VydmljZScsIFtkaXNwbGF5U2VydmljZV0pO1xyXG59KSgpOyIsIi8qKlxyXG4gKiBDcmVhdGVkIGJ5IGp1c3Rpam5kZXBvdmVyIG9uIDE3LzEyLzE1LlxyXG4gKi9cclxuXHJcbihmdW5jdGlvbigpe1xyXG4gICAgdmFyIHBsYXllclNlcnZpY2UgPSBmdW5jdGlvbigpe1xyXG4gICAgICAgIC8vTG9naW4gQ29udHJvbGxlclxyXG4gICAgICAgIHZhciBwbGF5ZXJzID0gW107XHJcblxyXG4gICAgICAgIHJldHVybntcclxuICAgICAgICAgICAgZ2V0UGxheWVyczogZnVuY3Rpb24oKXtcclxuICAgICAgICAgICAgICAgIHJldHVybiBwbGF5ZXJzO1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBzZXRQbGF5ZXJzOiBmdW5jdGlvbihwbGF5ZXJzQXJyYXkpe1xyXG4gICAgICAgICAgICAgICAgcGxheWVycyA9IHBsYXllcnNBcnJheTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH07XHJcblxyXG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcCcpLmZhY3RvcnkoJ3BsYXllclNlcnZpY2UnLCBbcGxheWVyU2VydmljZV0pO1xyXG59KSgpOyIsIi8qKlxyXG4gKiBDcmVhdGVkIGJ5IGp1c3Rpam5kZXBvdmVyIG9uIDA5LzEyLzE1LlxyXG4gKi9cclxuXHJcbihmdW5jdGlvbigpe1xyXG5cclxuICAgIHZhciBzb2NrZXRTZXJ2aWNlID0gZnVuY3Rpb24oJHJvb3RTY29wZSl7XHJcbiAgICAgICAgXCJ1c2Ugc3RyaWN0XCI7XHJcbiAgICAgICAgLy9wcml2YXRlXHJcbiAgICAgICAgdmFyIHNvY2tldCA9IGlvLmNvbm5lY3Qod2luZG93LmxvY2F0aW9uLmhvc3QpO1xyXG4gICAgICAgIC8vZnVuY3Rpb25zXHJcbiAgICAgICAgdmFyIG9uID0gZnVuY3Rpb24gKGV2ZW50TmFtZSwgY2FsbGJhY2spIHtcclxuICAgICAgICAgICAgc29ja2V0Lm9uKGV2ZW50TmFtZSwgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGFyZ3MgPSBhcmd1bWVudHM7XHJcbiAgICAgICAgICAgICAgICAkcm9vdFNjb3BlLiRhcHBseShmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2suYXBwbHkoc29ja2V0LCBhcmdzKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZW1pdCA9IGZ1bmN0aW9uIChldmVudE5hbWUsIGRhdGEsIGNhbGxiYWNrKSB7XHJcbiAgICAgICAgICAgIHNvY2tldC5lbWl0KGV2ZW50TmFtZSwgZGF0YSwgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGFyZ3MgPSBhcmd1bWVudHM7XHJcbiAgICAgICAgICAgICAgICAkcm9vdFNjb3BlLiRhcHBseShmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNhbGxiYWNrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrLmFwcGx5KHNvY2tldCwgYXJncyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgLy9wdWJsaWNcclxuICAgICAgICByZXR1cm57XHJcbiAgICAgICAgICAgIG9uOiBvbixcclxuICAgICAgICAgICAgZW1pdDogZW1pdCxcclxuICAgICAgICAgICAgc29ja2V0OiBzb2NrZXRcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG5cclxuICAgIGFuZ3VsYXIubW9kdWxlKFwiYXBwXCIpLmZhY3RvcnkoXCJzb2NrZXRTZXJ2aWNlXCIsIFtcIiRyb290U2NvcGVcIiwgc29ja2V0U2VydmljZV0pO1xyXG5cclxufSkoKTsiXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
