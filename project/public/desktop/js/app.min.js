!function(){angular.module("app",[])}(),function(){var t=function(t,e,a,i){t.LCShow=a.getLCShow;var o=function(){e.emit("pcconnect",null)};t.room="",e.on("requestRoom",function(e){t.room=e}),e.on("deviceOrientation",function(t){var e=(t.username,{});e.gamma=t.gamma,e.beta=t.beta,e.alpha=t.alpha}),t.usernames={},t.checkUserCount=!1,e.on("updateusers",function(e){i.setPlayers(e),t.usernames=e,t.checkUserCount=Object.keys(t.usernames).length<0}),t.startGame=function(){e.emit("startGame",null),a.setLCShow(!1),a.setPCShow(!0)},function(){o()}()};angular.module("app").controller("loginController",["$scope","socketService","displayService","playerService",t])}(),function(){"use strict";var t=function(t,e,a,i,o,n){function r(t,e){return e.username==t.userName?!0:!1}function s(){g.length>0&&(g[0].speed=0),u.clearRect(0,0,p.width,p.height);var t=p.width/100;if(0!=d.length){var e=p.width/100,a=e*d[0].image.height/d[0].image.width;for(var i in d){var o=d[i];o.width=e,o.height=a,0==o.explodeStage?(u.save(),u.translate(o.x*t,o.y*t),u.rotate(o.rotation/180*Math.PI),u.drawImage(o.image,-e/2,-a/2,e,a),u.restore(),d[i].x=Math.cos((o.rotation-90)/180*Math.PI)+o.x,d[i].y=Math.sin((o.rotation-90)/180*Math.PI)+o.y):o.explodeStage<4&&(console.log(o.explosionImage),u.save(),u.translate(o.x*t,o.y*t),u.drawImage(o.explosionImage,-e,-e,2*e,2*e),u.restore())}}if(0!=g.length){var n=p.width/20,r=n*g[0].image.height/g[0].image.width;for(var s in g){var l=g[s];l.width=n,l.height=r,u.save(),u.translate(l.x*t,l.y*t),u.rotate(l.rotation/180*Math.PI),u.drawImage(l.image,-n/2,-r/2,n,r),l.damage>0&&u.drawImage(l.damageImage,-n/2,-r/2,n,r),u.restore(),g[s].x=Math.cos((l.rotation-90)/180*Math.PI)/10*l.speed+l.x,g[s].y=Math.sin((l.rotation-90)/180*Math.PI)/10*l.speed+l.y}}h(),c()}function h(){for(var t in d)(d[t].x<0||d[t].x>p.width||d[t].y<0||d[t].y>p.height)&&d.splice(t,1)}function c(){for(var t in g)for(var e in d)if(d[e].player!=g[t].userName){var a=Math.sqrt(2)/2*(d[e].height/2-d[e].width/2),i=(360-d[e].rotation)/180*Math.PI,o=d[e].x*p.width/100-a*Math.sin(i),n=d[e].y*p.width/100-a*Math.cos(i),r=g[t].x*p.width/100,s=g[t].y*p.width/100,h=Math.sqrt((o-r)*(o-r)+(n-s)*(n-s));if(h<d[e].width/2+g[t].width/2){var c=new Audio("../../assets/Bonus/sfx_lose.ogg");c.play(),g[t].increaseDamage(),d[e].explodeStage<4?d[e].explode():d.splice(e,1)}}}t.PCShow=o.getPCShow,t.startGame=!1;var l,p=document.getElementById("game"),u=p.getContext("2d"),g=new Array,d=new Array;i.on("initGame",function(){var t=n.getPlayers();for(var a in t){var i=t[a];g.push(new Spaceship(i.username,i.x,i.y,i.color,i.rotation))}l=e(s,10)}),i.on("userleft",function(t){var e=null;for(var a in g)1==r(g[a],t)&&(e=a);g.splice(e,1)}),i.on("updateGameData",function(t){var e=null;for(var a in g)1==r(g[a],t)&&(e=a);null!=e&&g[e].rotateSpaceshipRelative(t.orientation)}),i.on("playerShot",function(t){var e=null;for(var a in g)1==r(g[a],t)&&(e=a);if(null!=e){var i=g[e],o=(360-(i.rotation+180))/180*Math.PI,n=i.x+p.width/400*Math.sin(o),s=i.y+p.width/400*Math.cos(o);if(d.push(new Bullet(n,s,i.rotation,i.color,i.userName)),e%2==0)var h=new Audio("../../assets/Bonus/sfx_laser1.ogg");else var h=new Audio("../../assets/Bonus/sfx_laser2.ogg");h.play()}})};angular.module("app").controller("playController",["$scope","$interval","$window","socketService","displayService","playerService",t])}();var Bullet=function(t,e,a,i,o){this.x=t,this.y=e,this.rotation=a,this.image=new Image,this.color=i,this.width=0,this.height=0,this.player=o,this.explosionImage=new Image,this.explodeStage=0,"orange"==this.color&&(this.color="red"),this.image.src="../assets/PNG/Lasers/laser"+this.color.charAt(0).toUpperCase()+this.color.slice(1)+"01.png"};Bullet.prototype.explode=function(){if(this.explodeStage<4){this.explodeStage++;var t;t=this.explodeStage<3?1:2,this.explosionImage.src="../assets/PNG/Lasers/laser"+this.color.charAt(0).toUpperCase()+this.color.slice(1)+"Explode"+t+".png"}else this.explosionImage.src=""};var Spaceship=function(t,e,a,i,o){this.userName=t,this.x=e,this.y=a,this.speed=1,this.color=i,this.rotation=o,this.image=new Image,this.damage=0,this.width=0,this.height=0,this.damageImage=new Image,this.image.src="../assets/PNG/playerShip1_"+this.color+".png"};Spaceship.prototype.moveSpaceship=function(t,e){this.x=t,this.y=e},Spaceship.prototype.moveSpaceshipRelative=function(t,e){this.x=this.x+t,this.y=this.y+e},Spaceship.prototype.rotateSpaceship=function(t){this.rotation=t},Spaceship.prototype.rotateSpaceshipRelative=function(t){this.rotation=this.rotation+t/5,this.rotation<-360&&(this.rotation=this.rotation+720),this.rotation>360&&(this.rotation=this.rotation-720)},Spaceship.prototype.increaseDamage=function(){this.damage<4&&(this.damage+=1),this.damage<=3&&this.damage>0&&(this.damageImage.src="../assets/PNG/Damage/playerShip1_damage"+this.damage+".png")},Spaceship.prototype.decreaseDamage=function(){this.damage>0&&(this.damage-=1),this.damage<=3&&this.damage>0&&(this.damageImage.src="../assets/PNG/Damage/playerShip1_damage"+this.damage+".png")},function(){var t=function(t){function e(e,a,i){t.innerWidth<t.innerHeight?e.width=t.innerWidth-20:e.width=t.innerHeight-20,angular.element(t).bind("resize",function(){t.innerWidth<t.innerHeight?e.width=t.innerWidth-20:e.width=t.innerHeight-20,e.$digest()})}return{restrict:"E",link:e,replace:!0,template:'<canvas id="game" class="playArea" width="{{width}}" height="{{width}}" />'}};angular.module("app").directive("canvasDirective",["$window",t])}(),function(){var t=function(){var t=!0,e=!1;return{getLCShow:function(){return t},setLCShow:function(e){t=e},getPCShow:function(){return e},setPCShow:function(t){e=t}}};angular.module("app").factory("displayService",[t])}(),function(){var t=function(){var t=[];return{getPlayers:function(){return t},setPlayers:function(e){t=e}}};angular.module("app").factory("playerService",[t])}(),function(){var t=function(t){"use strict";var e=io.connect(window.location.host),a=function(a,i){e.on(a,function(){var a=arguments;t.$apply(function(){i.apply(e,a)})})},i=function(a,i,o){e.emit(a,i,function(){var a=arguments;t.$apply(function(){o&&o.apply(e,a)})})};return{on:a,emit:i,socket:e}};angular.module("app").factory("socketService",["$rootScope",t])}();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyIsImNvbnRyb2xsZXIvbG9naW5Db250cm9sbGVyLmpzIiwiY29udHJvbGxlci9wbGF5Q29udHJvbGxlci5qcyIsIm1vZGVscy9CdWxsZXQuanMiLCJtb2RlbHMvU3BhY2VzaGlwLmpzIiwiZGlyZWN0aXZlcy9jYW52YXNEaXJlY3RpdmUuanMiLCJzZXJ2aWNlcy9kaXNwbGF5U2VydmljZS5qcyIsInNlcnZpY2VzL3BsYXllclNlcnZpY2UuanMiLCJzZXJ2aWNlcy9zb2NrZXRTZXJ2aWNlLmpzIl0sIm5hbWVzIjpbImFuZ3VsYXIiLCJtb2R1bGUiLCJsb2dpbkNvbnRyb2xsZXIiLCIkc2NvcGUiLCJzb2NrZXRTZXJ2aWNlIiwiZGlzcGxheVNlcnZpY2UiLCJwbGF5ZXJTZXJ2aWNlIiwiTENTaG93IiwiZ2V0TENTaG93IiwibWFrZVJvb20iLCJlbWl0Iiwicm9vbSIsIm9uIiwiZGF0YSIsImRldmljZU9yaWVudGF0aW9uIiwidXNlcm5hbWUiLCJnYW1tYSIsImJldGEiLCJhbHBoYSIsInVzZXJuYW1lcyIsImNoZWNrVXNlckNvdW50Iiwic2V0UGxheWVycyIsIk9iamVjdCIsImtleXMiLCJsZW5ndGgiLCJzdGFydEdhbWUiLCJzZXRMQ1Nob3ciLCJzZXRQQ1Nob3ciLCJjb250cm9sbGVyIiwicGxheUNvbnRyb2xsZXIiLCIkaW50ZXJ2YWwiLCIkd2luZG93IiwiZmlsdGVyUGxheWVycyIsIm9iaiIsInVzZXJOYW1lIiwiZHJhdyIsIkFsbFBsYXllcnMiLCJzcGVlZCIsImN0eCIsImNsZWFyUmVjdCIsImNhbnYiLCJ3aWR0aCIsImhlaWdodCIsInJhdGlvIiwiQWxsQnVsbGV0cyIsIkJ1bGxldFdpZHRoIiwiQnVsbGV0SGVpZ2h0IiwiaW1hZ2UiLCJidWxsZXQiLCJiIiwiZXhwbG9kZVN0YWdlIiwic2F2ZSIsInRyYW5zbGF0ZSIsIngiLCJ5Iiwicm90YXRlIiwicm90YXRpb24iLCJNYXRoIiwiUEkiLCJkcmF3SW1hZ2UiLCJyZXN0b3JlIiwiY29zIiwic2luIiwiY29uc29sZSIsImxvZyIsImV4cGxvc2lvbkltYWdlIiwiU3BhY2VzaGlwV2lkdGgiLCJTcGFjZXNoaXBIZWlnaHQiLCJwbGF5ZXIiLCJwIiwiZGFtYWdlIiwiZGFtYWdlSW1hZ2UiLCJjaGVja0J1bGxldHMiLCJjb2xsaXNpb25EZXRlY3Rpb24iLCJzcGxpY2UiLCJyYWRpdXMiLCJzcXJ0IiwiYW5nbGUiLCJidWxsZXRIZWFkWCIsImJ1bGxldEhlYWRZIiwic3BhY2VTaGlwWCIsInNwYWNlU2hpcFkiLCJkaXN0YW5jZSIsImRhbWFnZXNvdW5kIiwiQXVkaW8iLCJwbGF5IiwiaW5jcmVhc2VEYW1hZ2UiLCJleHBsb2RlIiwiUENTaG93IiwiZ2V0UENTaG93IiwiY3ljbGUiLCJkb2N1bWVudCIsImdldEVsZW1lbnRCeUlkIiwiZ2V0Q29udGV4dCIsIkFycmF5IiwiQnVmZmVyUGxheWVyIiwiZ2V0UGxheWVycyIsInB1c2giLCJTcGFjZXNoaXAiLCJjb2xvciIsImkiLCJyb3RhdGVTcGFjZXNoaXBSZWxhdGl2ZSIsIm9yaWVudGF0aW9uIiwidGVtcCIsIkJ1bGxldCIsInNob3QiLCJ0aGlzIiwiSW1hZ2UiLCJzcmMiLCJjaGFyQXQiLCJ0b1VwcGVyQ2FzZSIsInNsaWNlIiwicHJvdG90eXBlIiwibnVtYmVyIiwibW92ZVNwYWNlc2hpcCIsIm1vdmVTcGFjZXNoaXBSZWxhdGl2ZSIsInJvdGF0ZVNwYWNlc2hpcCIsImRlZ3JlZSIsImRlY3JlYXNlRGFtYWdlIiwiY2FudmFzRGlyZWN0aXZlIiwibGluayIsInNjb3BlIiwiZWxlbWVudCIsImF0dHJzIiwiaW5uZXJXaWR0aCIsImlubmVySGVpZ2h0IiwiYmluZCIsIiRkaWdlc3QiLCJyZXN0cmljdCIsInJlcGxhY2UiLCJ0ZW1wbGF0ZSIsImRpcmVjdGl2ZSIsInZhbHVlIiwiZmFjdG9yeSIsInBsYXllcnMiLCJwbGF5ZXJzQXJyYXkiLCIkcm9vdFNjb3BlIiwic29ja2V0IiwiaW8iLCJjb25uZWN0Iiwid2luZG93IiwibG9jYXRpb24iLCJob3N0IiwiZXZlbnROYW1lIiwiY2FsbGJhY2siLCJhcmdzIiwiYXJndW1lbnRzIiwiJGFwcGx5IiwiYXBwbHkiXSwibWFwcGluZ3MiOiJDQUdBLFdBRUFBLFFBQUFDLE9BQUEsYUNEQSxXQUNBLEdBQUFDLEdBQUEsU0FBQUMsRUFBQUMsRUFBQUMsRUFBQUMsR0FFQUgsRUFBQUksT0FBQUYsRUFBQUcsU0FHQSxJQUFBQyxHQUFBLFdBQ0FMLEVBQUFNLEtBQUEsWUFBQSxNQUVBUCxHQUFBUSxLQUFBLEdBQ0FQLEVBQUFRLEdBQUEsY0FBQSxTQUFBQyxHQUNBVixFQUFBUSxLQUFBRSxJQUVBVCxFQUFBUSxHQUFBLG9CQUFBLFNBQUFDLEdBQ0EsR0FDQUMsSUFEQUQsRUFBQUUsWUFFQUQsR0FBQUUsTUFBQUgsRUFBQUcsTUFDQUYsRUFBQUcsS0FBQUosRUFBQUksS0FDQUgsRUFBQUksTUFBQUwsRUFBQUssUUFFQWYsRUFBQWdCLGFBQ0FoQixFQUFBaUIsZ0JBQUEsRUFDQWhCLEVBQUFRLEdBQUEsY0FBQSxTQUFBQyxHQUNBUCxFQUFBZSxXQUFBUixHQUNBVixFQUFBZ0IsVUFBQU4sRUFDQVYsRUFBQWlCLGVBQUFFLE9BQUFDLEtBQUFwQixFQUFBZ0IsV0FBQUssT0FBQSxJQUdBckIsRUFBQXNCLFVBQUEsV0FDQXJCLEVBQUFNLEtBQUEsWUFBQSxNQUNBTCxFQUFBcUIsV0FBQSxHQUNBckIsRUFBQXNCLFdBQUEsSUFJQSxXQUNBbEIsT0FLQVQsU0FBQUMsT0FBQSxPQUFBMkIsV0FBQSxtQkFBQSxTQUFBLGdCQUFBLGlCQUFBLGdCQUFBMUIsT0N6Q0EsV0FDQSxZQUNBLElBQUEyQixHQUFBLFNBQUExQixFQUFBMkIsRUFBQUMsRUFBQTNCLEVBQUFDLEVBQUFDLEdBaUVBLFFBQUEwQixHQUFBQyxFQUFBcEIsR0FDQSxNQUFBQSxHQUFBRSxVQUFBa0IsRUFBQUMsVUFDQSxHQUVBLEVBSUEsUUFBQUMsS0FDQUMsRUFBQVosT0FBQSxJQUNBWSxFQUFBLEdBQUFDLE1BQUEsR0FFQUMsRUFBQUMsVUFBQSxFQUFBLEVB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U0FBQUMsT0FBQSxPQUFBb0ksUUFBQSxpQkFBQSxhQUFBakkiLCJmaWxlIjoiYXBwLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQ3JlYXRlZCBieSBNaWNoaWVsIG9uIDI1LzExLzIwMTUuXG4gKi9cbihmdW5jdGlvbigpe1xuXG4gICAgdmFyIGFwcCA9IGFuZ3VsYXIubW9kdWxlKFwiYXBwXCIsW10pO1xufSkoKTsiLCIvKipcclxuICogQ3JlYXRlZCBieSBNaWNoaWVsIG9uIDExLzEyLzIwMTUuXHJcbiAqL1xyXG5cclxuKGZ1bmN0aW9uKCl7XHJcbiAgICB2YXIgbG9naW5Db250cm9sbGVyID0gZnVuY3Rpb24oJHNjb3BlLCBzb2NrZXRTZXJ2aWNlLCBkaXNwbGF5U2VydmljZSwgcGxheWVyU2VydmljZSl7XHJcblxyXG4gICAgICAgICRzY29wZS5MQ1Nob3cgPSBkaXNwbGF5U2VydmljZS5nZXRMQ1Nob3c7XHJcblxyXG4gICAgICAgIC8vZnVuY3Rpb25zXHJcbiAgICAgICAgdmFyIG1ha2VSb29tID0gZnVuY3Rpb24oKXtcclxuICAgICAgICAgICAgc29ja2V0U2VydmljZS5lbWl0KFwicGNjb25uZWN0XCIsIG51bGwpO1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgJHNjb3BlLnJvb20gPSBcIlwiO1xyXG4gICAgICAgIHNvY2tldFNlcnZpY2Uub24oJ3JlcXVlc3RSb29tJyxmdW5jdGlvbihkYXRhKXtcclxuICAgICAgICAgICAgJHNjb3BlLnJvb20gPSBkYXRhO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHNvY2tldFNlcnZpY2Uub24oJ2RldmljZU9yaWVudGF0aW9uJywgZnVuY3Rpb24oZGF0YSl7XHJcbiAgICAgICAgICAgIHZhciB1c2VybmFtZSA9IGRhdGEudXNlcm5hbWU7XHJcbiAgICAgICAgICAgIHZhciBkZXZpY2VPcmllbnRhdGlvbiA9IHt9O1xyXG4gICAgICAgICAgICBkZXZpY2VPcmllbnRhdGlvbi5nYW1tYSA9IGRhdGEuZ2FtbWE7XHJcbiAgICAgICAgICAgIGRldmljZU9yaWVudGF0aW9uLmJldGEgPSBkYXRhLmJldGE7XHJcbiAgICAgICAgICAgIGRldmljZU9yaWVudGF0aW9uLmFscGhhID0gZGF0YS5hbHBoYTtcclxuICAgICAgICB9KTtcclxuICAgICAgICAkc2NvcGUudXNlcm5hbWVzID0ge307XHJcbiAgICAgICAgJHNjb3BlLmNoZWNrVXNlckNvdW50ID0gZmFsc2U7XHJcbiAgICAgICAgc29ja2V0U2VydmljZS5vbigndXBkYXRldXNlcnMnLCBmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICBwbGF5ZXJTZXJ2aWNlLnNldFBsYXllcnMoZGF0YSk7XHJcbiAgICAgICAgICAgICRzY29wZS51c2VybmFtZXMgPSBkYXRhO1xyXG4gICAgICAgICAgICAkc2NvcGUuY2hlY2tVc2VyQ291bnQgPSBPYmplY3Qua2V5cygkc2NvcGUudXNlcm5hbWVzKS5sZW5ndGggPCAwO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICAkc2NvcGUuc3RhcnRHYW1lPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHNvY2tldFNlcnZpY2UuZW1pdChcInN0YXJ0R2FtZVwiLCBudWxsKTtcclxuICAgICAgICAgICAgZGlzcGxheVNlcnZpY2Uuc2V0TENTaG93KGZhbHNlKTtcclxuICAgICAgICAgICAgZGlzcGxheVNlcnZpY2Uuc2V0UENTaG93KHRydWUpO1xyXG4gICAgICAgIH07XHJcblxyXG5cclxuICAgICAgICAoZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIG1ha2VSb29tKCk7XHJcbiAgICAgICAgfSkoKTtcclxuXHJcbiAgICB9O1xyXG5cclxuICAgIGFuZ3VsYXIubW9kdWxlKFwiYXBwXCIpLmNvbnRyb2xsZXIoXCJsb2dpbkNvbnRyb2xsZXJcIiwgW1wiJHNjb3BlXCIsIFwic29ja2V0U2VydmljZVwiICwgXCJkaXNwbGF5U2VydmljZVwiLCBcInBsYXllclNlcnZpY2VcIiwgbG9naW5Db250cm9sbGVyXSk7XHJcbn0pKCk7IiwiLyoqXHJcbiAqIENyZWF0ZWQgYnkgTWljaGllbCBvbiAxNi8xMi8yMDE1LlxyXG4gKi9cclxuXHJcbihmdW5jdGlvbigpe1xyXG4gICAgXCJ1c2Ugc3RyaWN0XCI7XHJcbiAgICB2YXIgcGxheUNvbnRyb2xsZXIgPSBmdW5jdGlvbigkc2NvcGUsICRpbnRlcnZhbCwgJHdpbmRvdywgc29ja2V0U2VydmljZSwgZGlzcGxheVNlcnZpY2UsIHBsYXllclNlcnZpY2Upe1xyXG4gICAgICAgICRzY29wZS5QQ1Nob3cgPSBkaXNwbGF5U2VydmljZS5nZXRQQ1Nob3c7XHJcbiAgICAgICAgJHNjb3BlLnN0YXJ0R2FtZSA9IGZhbHNlO1xyXG4gICAgICAgIHZhciBjYW52ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2dhbWUnKTtcclxuICAgICAgICB2YXIgY3R4ID0gY2Fudi5nZXRDb250ZXh0KCcyZCcpO1xyXG5cclxuICAgICAgICB2YXIgQWxsUGxheWVycyA9IG5ldyBBcnJheSgpO1xyXG4gICAgICAgIHZhciBBbGxCdWxsZXRzID0gbmV3IEFycmF5KCk7XHJcblxyXG4gICAgICAgIHZhciBjeWNsZTtcclxuXHJcbiAgICAgICAgc29ja2V0U2VydmljZS5vbihcImluaXRHYW1lXCIsIGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgICAgIHZhciBCdWZmZXJQbGF5ZXIgPSBwbGF5ZXJTZXJ2aWNlLmdldFBsYXllcnMoKTtcclxuICAgICAgICAgICAgZm9yKHZhciBwbGF5ZXIgaW4gQnVmZmVyUGxheWVyKXtcclxuICAgICAgICAgICAgICAgIHZhciBwID0gQnVmZmVyUGxheWVyW3BsYXllcl07XHJcbiAgICAgICAgICAgICAgICBBbGxQbGF5ZXJzLnB1c2gobmV3IFNwYWNlc2hpcChwLnVzZXJuYW1lLCBwLngsIHAueSwgcC5jb2xvciwgcC5yb3RhdGlvbikpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBjeWNsZSA9ICRpbnRlcnZhbChkcmF3LCAxMCk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHNvY2tldFNlcnZpY2Uub24oXCJ1c2VybGVmdFwiLCBmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICB2YXIgcCA9IG51bGw7XHJcbiAgICAgICAgICAgIGZvcih2YXIgaSBpbiBBbGxQbGF5ZXJzKXtcclxuICAgICAgICAgICAgICAgIGlmKGZpbHRlclBsYXllcnMoQWxsUGxheWVyc1tpXSxkYXRhKSA9PSB0cnVlKXtcclxuICAgICAgICAgICAgICAgICAgICBwID0gaTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBBbGxQbGF5ZXJzLnNwbGljZShwLDEpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBzb2NrZXRTZXJ2aWNlLm9uKFwidXBkYXRlR2FtZURhdGFcIiwgZnVuY3Rpb24oZGF0YSl7XHJcbiAgICAgICAgICAgIHZhciBwID0gbnVsbDtcclxuICAgICAgICAgICAgZm9yKHZhciBpIGluIEFsbFBsYXllcnMpe1xyXG4gICAgICAgICAgICAgICAgaWYoZmlsdGVyUGxheWVycyhBbGxQbGF5ZXJzW2ldLGRhdGEpID09IHRydWUpe1xyXG4gICAgICAgICAgICAgICAgICAgIHAgPSBpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmKHAgIT0gbnVsbCl7XHJcbiAgICAgICAgICAgICAgICBBbGxQbGF5ZXJzW3BdLnJvdGF0ZVNwYWNlc2hpcFJlbGF0aXZlKGRhdGEub3JpZW50YXRpb24pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHNvY2tldFNlcnZpY2Uub24oXCJwbGF5ZXJTaG90XCIsIGZ1bmN0aW9uKGRhdGEpe1xyXG4gICAgICAgICAgICB2YXIgcCA9IG51bGw7XHJcbiAgICAgICAgICAgIGZvcih2YXIgaSBpbiBBbGxQbGF5ZXJzKXtcclxuICAgICAgICAgICAgICAgIGlmKGZpbHRlclBsYXllcnMoQWxsUGxheWVyc1tpXSxkYXRhKSA9PSB0cnVlKXtcclxuICAgICAgICAgICAgICAgICAgICBwID0gaTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZihwICE9IG51bGwpe1xyXG4gICAgICAgICAgICAgICAgdmFyIHRlbXAgPSBBbGxQbGF5ZXJzW3BdO1xyXG4gICAgICAgICAgICAgICAgdmFyIGFuZ2xlID0gKDM2MCAtKHRlbXAucm90YXRpb24gKyAxODApKS8xODAqTWF0aC5QSTtcclxuICAgICAgICAgICAgICAgIHZhciB4ID0gdGVtcC54ICsgKGNhbnYud2lkdGgvNDAwICogTWF0aC5zaW4oYW5nbGUpKTtcclxuICAgICAgICAgICAgICAgIHZhciB5ID0gdGVtcC55ICsgKGNhbnYud2lkdGgvNDAwICogTWF0aC5jb3MoYW5nbGUpKTtcclxuICAgICAgICAgICAgICAgIEFsbEJ1bGxldHMucHVzaChuZXcgQnVsbGV0KHgsIHksIHRlbXAucm90YXRpb24sIHRlbXAuY29sb3IsIHRlbXAudXNlck5hbWUpKTtcclxuICAgICAgICAgICAgICAgIGlmKHAlMiA9PSAwKXtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgc2hvdCA9IG5ldyBBdWRpbygnLi4vLi4vYXNzZXRzL0JvbnVzL3NmeF9sYXNlcjEub2dnJyk7XHJcbiAgICAgICAgICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgc2hvdCA9IG5ldyBBdWRpbygnLi4vLi4vYXNzZXRzL0JvbnVzL3NmeF9sYXNlcjIub2dnJyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBzaG90LnBsYXkoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBmaWx0ZXJQbGF5ZXJzKG9iaixkYXRhKXtcclxuICAgICAgICAgICAgaWYoZGF0YS51c2VybmFtZSA9PSBvYmoudXNlck5hbWUpe1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgIH1lbHNle1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBkcmF3KCl7XHJcbiAgICAgICAgICAgIGlmKEFsbFBsYXllcnMubGVuZ3RoPjApe1xyXG4gICAgICAgICAgICAgICAgQWxsUGxheWVyc1swXS5zcGVlZCA9IDA7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY3R4LmNsZWFyUmVjdCgwLDAsY2Fudi53aWR0aCwgY2Fudi5oZWlnaHQpO1xyXG4gICAgICAgICAgICB2YXIgcmF0aW8gPSBjYW52LndpZHRoLzEwMDtcclxuXHJcbiAgICAgICAgICAgIGlmKEFsbEJ1bGxldHMubGVuZ3RoICE9IDApe1xyXG4gICAgICAgICAgICAgICAgdmFyIEJ1bGxldFdpZHRoID0gY2Fudi53aWR0aC8xMDA7XHJcbiAgICAgICAgICAgICAgICB2YXIgQnVsbGV0SGVpZ2h0ID0gQnVsbGV0V2lkdGggKiBBbGxCdWxsZXRzWzBdLmltYWdlLmhlaWdodC9BbGxCdWxsZXRzWzBdLmltYWdlLndpZHRoO1xyXG5cclxuICAgICAgICAgICAgICAgIGZvcih2YXIgYnVsbGV0IGluIEFsbEJ1bGxldHMpe1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBiID0gQWxsQnVsbGV0c1tidWxsZXRdO1xyXG4gICAgICAgICAgICAgICAgICAgIGIud2lkdGggPSBCdWxsZXRXaWR0aDtcclxuICAgICAgICAgICAgICAgICAgICBiLmhlaWdodCA9IEJ1bGxldEhlaWdodDtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYoYi5leHBsb2RlU3RhZ2UgPT0gMCl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vRHJhdyBidWxsZXRcclxuICAgICAgICAgICAgICAgICAgICAgICAgY3R4LnNhdmUoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY3R4LnRyYW5zbGF0ZShiLngqcmF0aW8sIGIueSpyYXRpbyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5yb3RhdGUoYi5yb3RhdGlvbi8xODAqTWF0aC5QSSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5kcmF3SW1hZ2UoYi5pbWFnZSwgLUJ1bGxldFdpZHRoLzIsIC1CdWxsZXRIZWlnaHQvMiwgQnVsbGV0V2lkdGgsIEJ1bGxldEhlaWdodCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5yZXN0b3JlKCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBBbGxCdWxsZXRzW2J1bGxldF0ueCA9IE1hdGguY29zKChiLnJvdGF0aW9uIC0gOTApLzE4MCpNYXRoLlBJKSArIGIueDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgQWxsQnVsbGV0c1tidWxsZXRdLnkgPSBNYXRoLnNpbigoYi5yb3RhdGlvbiAtIDkwKS8xODAqTWF0aC5QSSkrIGIueTtcclxuICAgICAgICAgICAgICAgICAgICB9ZWxzZSBpZihiLmV4cGxvZGVTdGFnZSA8IDQpe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvL0RyYXcgZXhwbG9zaW9uXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGIuZXhwbG9zaW9uSW1hZ2UpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjdHguc2F2ZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjdHgudHJhbnNsYXRlKGIueCpyYXRpbywgYi55KnJhdGlvKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY3R4LmRyYXdJbWFnZShiLmV4cGxvc2lvbkltYWdlLCAtQnVsbGV0V2lkdGgsIC1CdWxsZXRXaWR0aCwgQnVsbGV0V2lkdGgqMiwgQnVsbGV0V2lkdGgqMik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5yZXN0b3JlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZihBbGxQbGF5ZXJzLmxlbmd0aCAhPSAwKXtcclxuICAgICAgICAgICAgICAgIHZhciBTcGFjZXNoaXBXaWR0aCA9IGNhbnYud2lkdGgvMjA7XHJcbiAgICAgICAgICAgICAgICB2YXIgU3BhY2VzaGlwSGVpZ2h0ID0gU3BhY2VzaGlwV2lkdGggKiBBbGxQbGF5ZXJzWzBdLmltYWdlLmhlaWdodC8gQWxsUGxheWVyc1swXS5pbWFnZS53aWR0aDtcclxuXHJcbiAgICAgICAgICAgICAgICBmb3IodmFyIHBsYXllciBpbiBBbGxQbGF5ZXJzKXtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgcCA9IEFsbFBsYXllcnNbcGxheWVyXTtcclxuICAgICAgICAgICAgICAgICAgICBwLndpZHRoID0gU3BhY2VzaGlwV2lkdGg7XHJcbiAgICAgICAgICAgICAgICAgICAgcC5oZWlnaHQgPSBTcGFjZXNoaXBIZWlnaHQ7XHJcbiAgICAgICAgICAgICAgICAgICAgY3R4LnNhdmUoKTtcclxuICAgICAgICAgICAgICAgICAgICBjdHgudHJhbnNsYXRlKHAueCpyYXRpbywgcC55KnJhdGlvKTtcclxuICAgICAgICAgICAgICAgICAgICBjdHgucm90YXRlKHAucm90YXRpb24vMTgwKk1hdGguUEkpO1xyXG4gICAgICAgICAgICAgICAgICAgIGN0eC5kcmF3SW1hZ2UocC5pbWFnZSwgLVNwYWNlc2hpcFdpZHRoLzIsIC1TcGFjZXNoaXBIZWlnaHQvMiwgU3BhY2VzaGlwV2lkdGgsIFNwYWNlc2hpcEhlaWdodCk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYocC5kYW1hZ2UgPiAwKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY3R4LmRyYXdJbWFnZShwLmRhbWFnZUltYWdlLCAtU3BhY2VzaGlwV2lkdGgvMiwgLVNwYWNlc2hpcEhlaWdodC8yLCBTcGFjZXNoaXBXaWR0aCwgU3BhY2VzaGlwSGVpZ2h0KTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgY3R4LnJlc3RvcmUoKTtcclxuICAgICAgICAgICAgICAgICAgICBBbGxQbGF5ZXJzW3BsYXllcl0ueCA9IE1hdGguY29zKChwLnJvdGF0aW9uIC0gOTApLzE4MCpNYXRoLlBJKS8xMCogcC5zcGVlZCArIHAueDtcclxuICAgICAgICAgICAgICAgICAgICBBbGxQbGF5ZXJzW3BsYXllcl0ueSA9IE1hdGguc2luKChwLnJvdGF0aW9uIC0gOTApLzE4MCpNYXRoLlBJKS8xMCogcC5zcGVlZCArIHAueTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgY2hlY2tCdWxsZXRzKCk7XHJcblxyXG4gICAgICAgICAgICBjb2xsaXNpb25EZXRlY3Rpb24oKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGNoZWNrQnVsbGV0cygpe1xyXG5cclxuICAgICAgICAgICAgZm9yKHZhciBiIGluIEFsbEJ1bGxldHMpe1xyXG4gICAgICAgICAgICAgICAgaWYoQWxsQnVsbGV0c1tiXS54IDwgMCB8fCBBbGxCdWxsZXRzW2JdLnggPiBjYW52LndpZHRoIHx8IEFsbEJ1bGxldHNbYl0ueSA8IDAgfHwgQWxsQnVsbGV0c1tiXS55ID4gY2Fudi5oZWlnaHQpe1xyXG4gICAgICAgICAgICAgICAgICAgIEFsbEJ1bGxldHMuc3BsaWNlKGIsIDEpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gY29sbGlzaW9uRGV0ZWN0aW9uKCl7XHJcbiAgICAgICAgICAgIGZvcih2YXIgcCBpbiBBbGxQbGF5ZXJzKXtcclxuICAgICAgICAgICAgICAgIGZvcih2YXIgYiBpbiBBbGxCdWxsZXRzKXtcclxuICAgICAgICAgICAgICAgICAgICBpZihBbGxCdWxsZXRzW2JdLnBsYXllciAhPSBBbGxQbGF5ZXJzW3BdLnVzZXJOYW1lKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHJhZGl1cyA9IE1hdGguc3FydCgyKS8yKihBbGxCdWxsZXRzW2JdLmhlaWdodC8yIC0gQWxsQnVsbGV0c1tiXS53aWR0aC8yKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGFuZ2xlID0gKDM2MCAtKEFsbEJ1bGxldHNbYl0ucm90YXRpb24pKS8xODAqTWF0aC5QSTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGJ1bGxldEhlYWRYID0gKEFsbEJ1bGxldHNbYl0ueCpjYW52LndpZHRoLzEwMCAtIChyYWRpdXMgKiBNYXRoLnNpbihhbmdsZSkpKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGJ1bGxldEhlYWRZID0gKEFsbEJ1bGxldHNbYl0ueSpjYW52LndpZHRoLzEwMCAtIChyYWRpdXMgKiBNYXRoLmNvcyhhbmdsZSkpKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzcGFjZVNoaXBYID0gQWxsUGxheWVyc1twXS54KmNhbnYud2lkdGgvMTAwO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgc3BhY2VTaGlwWSA9IEFsbFBsYXllcnNbcF0ueSpjYW52LndpZHRoLzEwMDtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8qY3R4LnNhdmUoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY3R4LmJlZ2luUGF0aCgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjdHguYXJjKHNwYWNlU2hpcFgsIHNwYWNlU2hpcFksIEFsbFBsYXllcnNbcF0ud2lkdGgvMiwgMCwgTWF0aC5QSSoyKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY3R4LmxpbmVXaWR0aCA9IDE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5zdHJva2VTdHlsZSA9ICcjMDAwMEZGJztcclxuICAgICAgICAgICAgICAgICAgICAgICAgY3R4LnN0cm9rZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjdHgucmVzdG9yZSgpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgY3R4LnNhdmUoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY3R4LmJlZ2luUGF0aCgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjdHguYXJjKGJ1bGxldEhlYWRYLCBidWxsZXRIZWFkWSwgQWxsQnVsbGV0c1tiXS53aWR0aC8yLCAwLCBNYXRoLlBJKjIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjdHgubGluZVdpZHRoID0gMTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY3R4LnN0cm9rZVN0eWxlID0gJyNGRjAwMDAnO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjdHguc3Ryb2tlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5yZXN0b3JlKCk7Ki9cclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGRpc3RhbmNlID0gTWF0aC5zcXJ0KChidWxsZXRIZWFkWC1zcGFjZVNoaXBYKSooYnVsbGV0SGVhZFgtc3BhY2VTaGlwWCkgKyAoYnVsbGV0SGVhZFktc3BhY2VTaGlwWSkqKGJ1bGxldEhlYWRZLXNwYWNlU2hpcFkpKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYoZGlzdGFuY2UgPCAoQWxsQnVsbGV0c1tiXS53aWR0aC8yICsgQWxsUGxheWVyc1twXS53aWR0aC8yKSl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZGFtYWdlc291bmQgPSBuZXcgQXVkaW8oJy4uLy4uL2Fzc2V0cy9Cb251cy9zZnhfbG9zZS5vZ2cnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhbWFnZXNvdW5kLnBsYXkoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIEFsbFBsYXllcnNbcF0uaW5jcmVhc2VEYW1hZ2UoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKEFsbEJ1bGxldHNbYl0uZXhwbG9kZVN0YWdlIDwgNCl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQWxsQnVsbGV0c1tiXS5leHBsb2RlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBBbGxCdWxsZXRzLnNwbGljZShiLCAxKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH07XHJcblxyXG4gICAgYW5ndWxhci5tb2R1bGUoXCJhcHBcIikuY29udHJvbGxlcihcInBsYXlDb250cm9sbGVyXCIsIFtcIiRzY29wZVwiLCBcIiRpbnRlcnZhbFwiLCBcIiR3aW5kb3dcIiwgXCJzb2NrZXRTZXJ2aWNlXCIsIFwiZGlzcGxheVNlcnZpY2VcIiwgXCJwbGF5ZXJTZXJ2aWNlXCIsIHBsYXlDb250cm9sbGVyXSlcclxufSkoKTsiLCIvKipcclxuICogQ3JlYXRlZCBieSBqdXN0aWpuZGVwb3ZlciBvbiAyMi8xMi8xNS5cclxuICovXHJcblxyXG52YXIgQnVsbGV0ID0gZnVuY3Rpb24oeCwgeSxyb3RhdGlvbiwgY29sb3IsIHBsYXllcil7XHJcbiAgICB0aGlzLnggPSB4O1xyXG4gICAgdGhpcy55ID0geTtcclxuICAgIHRoaXMucm90YXRpb24gPSByb3RhdGlvbjtcclxuICAgIHRoaXMuaW1hZ2UgPSBuZXcgSW1hZ2UoKTtcclxuICAgIHRoaXMuY29sb3IgPSBjb2xvcjtcclxuICAgIHRoaXMud2lkdGggPSAwO1xyXG4gICAgdGhpcy5oZWlnaHQgPSAwO1xyXG4gICAgdGhpcy5wbGF5ZXIgPSBwbGF5ZXI7XHJcbiAgICB0aGlzLmV4cGxvc2lvbkltYWdlID0gbmV3IEltYWdlKCk7XHJcbiAgICB0aGlzLmV4cGxvZGVTdGFnZSA9IDA7XHJcbiAgICBpZih0aGlzLmNvbG9yID09IFwib3JhbmdlXCIpe1xyXG4gICAgICAgIHRoaXMuY29sb3IgPSAncmVkJztcclxuICAgIH1cclxuICAgIHRoaXMuaW1hZ2Uuc3JjID0gJy4uL2Fzc2V0cy9QTkcvTGFzZXJzL2xhc2VyJysgdGhpcy5jb2xvci5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArIHRoaXMuY29sb3Iuc2xpY2UoMSkgKycwMS5wbmcnXHJcbn07XHJcblxyXG5CdWxsZXQucHJvdG90eXBlLmV4cGxvZGUgPSBmdW5jdGlvbigpe1xyXG4gICAgaWYodGhpcy5leHBsb2RlU3RhZ2UgPCA0KXtcclxuICAgICAgICB0aGlzLmV4cGxvZGVTdGFnZSsrO1xyXG4gICAgICAgIHZhciBudW1iZXI7XHJcbiAgICAgICAgaWYodGhpcy5leHBsb2RlU3RhZ2UgPCAzKXtcclxuICAgICAgICAgICBudW1iZXIgPSAxXHJcbiAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICAgIG51bWJlciA9IDJcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5leHBsb3Npb25JbWFnZS5zcmMgPSAnLi4vYXNzZXRzL1BORy9MYXNlcnMvbGFzZXInICsgdGhpcy5jb2xvci5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArIHRoaXMuY29sb3Iuc2xpY2UoMSkgKyAnRXhwbG9kZScrIG51bWJlciArJy5wbmcnO1xyXG4gICAgfWVsc2V7XHJcbiAgICAgICAgdGhpcy5leHBsb3Npb25JbWFnZS5zcmMgPSAnJztcclxuICAgIH1cclxufTtcclxuIiwiLyoqXHJcbiAqIENyZWF0ZWQgYnkganVzdGlqbmRlcG92ZXIgb24gMDkvMTIvMTUuXHJcbiAqL1xyXG5cclxudmFyIFNwYWNlc2hpcCA9IGZ1bmN0aW9uKHVzZXJOYW1lLCB4LCB5LCBjb2xvciwgcm90YXRpb24pe1xyXG4gICAgdGhpcy51c2VyTmFtZSA9IHVzZXJOYW1lO1xyXG4gICAgdGhpcy54ID0geDtcclxuICAgIHRoaXMueSA9IHk7XHJcbiAgICB0aGlzLnNwZWVkID0gMTtcclxuICAgIHRoaXMuY29sb3IgPSBjb2xvcjtcclxuICAgIHRoaXMucm90YXRpb24gPSByb3RhdGlvbjtcclxuICAgIHRoaXMuaW1hZ2UgPSBuZXcgSW1hZ2UoKTtcclxuICAgIHRoaXMuZGFtYWdlID0gMDtcclxuICAgIHRoaXMud2lkdGggPSAwO1xyXG4gICAgdGhpcy5oZWlnaHQgPSAwO1xyXG4gICAgdGhpcy5kYW1hZ2VJbWFnZSA9IG5ldyBJbWFnZSgpO1xyXG4gICAgdGhpcy5pbWFnZS5zcmMgPSAnLi4vYXNzZXRzL1BORy9wbGF5ZXJTaGlwMV8nKyB0aGlzLmNvbG9yICsnLnBuZydcclxufTtcclxuXHJcblNwYWNlc2hpcC5wcm90b3R5cGUubW92ZVNwYWNlc2hpcCA9IGZ1bmN0aW9uKHgsIHkpe1xyXG4gICAgdGhpcy54ID0geDtcclxuICAgIHRoaXMueSA9IHk7XHJcbn07XHJcblxyXG5TcGFjZXNoaXAucHJvdG90eXBlLm1vdmVTcGFjZXNoaXBSZWxhdGl2ZSA9IGZ1bmN0aW9uKHgsIHkpe1xyXG4gICAgdGhpcy54ID0gdGhpcy54K3g7XHJcbiAgICB0aGlzLnkgPSB0aGlzLnkreTtcclxufTtcclxuXHJcblNwYWNlc2hpcC5wcm90b3R5cGUucm90YXRlU3BhY2VzaGlwID0gZnVuY3Rpb24oZGVncmVlKXtcclxuICAgIHRoaXMucm90YXRpb24gPSBkZWdyZWU7XHJcbn07XHJcblxyXG5TcGFjZXNoaXAucHJvdG90eXBlLnJvdGF0ZVNwYWNlc2hpcFJlbGF0aXZlID0gZnVuY3Rpb24oZGVncmVlKXtcclxuICAgIHRoaXMucm90YXRpb24gPSB0aGlzLnJvdGF0aW9uICsgZGVncmVlLzU7XHJcbiAgICBpZih0aGlzLnJvdGF0aW9uIDwgLTM2MCl7XHJcbiAgICAgICAgdGhpcy5yb3RhdGlvbiA9IHRoaXMucm90YXRpb24gKyA3MjA7XHJcbiAgICB9XHJcbiAgICBpZih0aGlzLnJvdGF0aW9uID4gMzYwKXtcclxuICAgICAgICB0aGlzLnJvdGF0aW9uID0gdGhpcy5yb3RhdGlvbiAtIDcyMDtcclxuICAgIH1cclxufTtcclxuXHJcblNwYWNlc2hpcC5wcm90b3R5cGUuaW5jcmVhc2VEYW1hZ2UgPSBmdW5jdGlvbigpe1xyXG4gICAgaWYodGhpcy5kYW1hZ2UgPCA0KXtcclxuICAgICAgICB0aGlzLmRhbWFnZSArPSAxO1xyXG4gICAgfVxyXG5cclxuICAgIGlmKHRoaXMuZGFtYWdlIDw9IDMgJiYgdGhpcy5kYW1hZ2UgPiAwKXtcclxuICAgICAgICB0aGlzLmRhbWFnZUltYWdlLnNyYyA9ICcuLi9hc3NldHMvUE5HL0RhbWFnZS9wbGF5ZXJTaGlwMV9kYW1hZ2UnKyB0aGlzLmRhbWFnZSArICcucG5nJztcclxuICAgIH1cclxufTtcclxuXHJcblNwYWNlc2hpcC5wcm90b3R5cGUuZGVjcmVhc2VEYW1hZ2UgPSBmdW5jdGlvbigpe1xyXG4gICAgaWYodGhpcy5kYW1hZ2UgPiAwKXtcclxuICAgICAgICB0aGlzLmRhbWFnZSAtPSAxO1xyXG4gICAgfVxyXG5cclxuICAgIGlmKHRoaXMuZGFtYWdlIDw9IDMgJiYgdGhpcy5kYW1hZ2UgPiAwKXtcclxuICAgICAgICB0aGlzLmRhbWFnZUltYWdlLnNyYyA9ICcuLi9hc3NldHMvUE5HL0RhbWFnZS9wbGF5ZXJTaGlwMV9kYW1hZ2UnKyB0aGlzLmRhbWFnZSArICcucG5nJztcclxuICAgIH1cclxufTtcclxuXHJcbiIsIi8qKlxyXG4gKiBDcmVhdGVkIGJ5IGp1c3Rpam5kZXBvdmVyIG9uIDE2LzEyLzE1LlxyXG4gKi9cclxuKGZ1bmN0aW9uKCl7XHJcbiAgICB2YXIgY2FudmFzRGlyZWN0aXZlID0gZnVuY3Rpb24oJHdpbmRvdyl7XHJcbiAgICAgICAgcmV0dXJue1xyXG4gICAgICAgICAgICByZXN0cmljdDogJ0UnLFxyXG4gICAgICAgICAgICBsaW5rOmxpbmssXHJcbiAgICAgICAgICAgIHJlcGxhY2U6dHJ1ZSxcclxuICAgICAgICAgICAgdGVtcGxhdGU6JzxjYW52YXMgaWQ9XCJnYW1lXCIgY2xhc3M9XCJwbGF5QXJlYVwiIHdpZHRoPVwie3t3aWR0aH19XCIgaGVpZ2h0PVwie3t3aWR0aH19XCIgLz4nXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gbGluayhzY29wZSwgZWxlbWVudCwgYXR0cnMpe1xyXG4gICAgICAgICAgICBpZigkd2luZG93LmlubmVyV2lkdGggPCAkd2luZG93LmlubmVySGVpZ2h0KXtcclxuICAgICAgICAgICAgICAgIHNjb3BlLndpZHRoID0gJHdpbmRvdy5pbm5lcldpZHRoIC0gMjA7XHJcbiAgICAgICAgICAgIH1lbHNle1xyXG4gICAgICAgICAgICAgICAgc2NvcGUud2lkdGggPSAkd2luZG93LmlubmVySGVpZ2h0IC0gMjA7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGFuZ3VsYXIuZWxlbWVudCgkd2luZG93KS5iaW5kKCdyZXNpemUnLCBmdW5jdGlvbigpe1xyXG4gICAgICAgICAgICAgICAgaWYoJHdpbmRvdy5pbm5lcldpZHRoIDwgJHdpbmRvdy5pbm5lckhlaWdodCl7XHJcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUud2lkdGggPSAkd2luZG93LmlubmVyV2lkdGggLSAyMDtcclxuICAgICAgICAgICAgICAgIH1lbHNle1xyXG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLndpZHRoID0gJHdpbmRvdy5pbm5lckhlaWdodCAtIDIwO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIHNjb3BlLiRkaWdlc3QoKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuXHJcbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwJykuZGlyZWN0aXZlKFwiY2FudmFzRGlyZWN0aXZlXCIsIFtcIiR3aW5kb3dcIiwgY2FudmFzRGlyZWN0aXZlXSk7XHJcbn0pKCk7IiwiLyoqXHJcbiAqIENyZWF0ZWQgYnkgTWljaGllbCBvbiAxNi8xMi8yMDE1LlxyXG4gKi9cclxuLyoqXHJcbiAqIENyZWF0ZWQgYnkganVzdGlqbmRlcG92ZXIgb24gMTYvMTIvMTUuXHJcbiAqL1xyXG5cclxuXHJcbihmdW5jdGlvbigpe1xyXG4gICAgdmFyIGRpc3BsYXlTZXJ2aWNlID0gZnVuY3Rpb24oKXtcclxuICAgICAgICAvL0xvZ2luIENvbnRyb2xsZXJcclxuICAgICAgICB2YXIgTENTaG93ID0gdHJ1ZTtcclxuICAgICAgICAvL1BsYXkgY29udHJvbGxlclxyXG4gICAgICAgIHZhciBQQ1Nob3cgPSBmYWxzZTtcclxuXHJcbiAgICAgICAgcmV0dXJue1xyXG4gICAgICAgICAgICBnZXRMQ1Nob3c6IGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gTENTaG93O1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBzZXRMQ1Nob3c6IGZ1bmN0aW9uKHZhbHVlKXtcclxuICAgICAgICAgICAgICAgIExDU2hvdyA9IHZhbHVlO1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBnZXRQQ1Nob3c6IGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gUENTaG93O1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBzZXRQQ1Nob3c6IGZ1bmN0aW9uKHZhbHVlKXtcclxuICAgICAgICAgICAgICAgIFBDU2hvdyA9IHZhbHVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuXHJcbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwJykuZmFjdG9yeSgnZGlzcGxheVNlcnZpY2UnLCBbZGlzcGxheVNlcnZpY2VdKTtcclxufSkoKTsiLCIvKipcclxuICogQ3JlYXRlZCBieSBqdXN0aWpuZGVwb3ZlciBvbiAxNy8xMi8xNS5cclxuICovXHJcblxyXG4oZnVuY3Rpb24oKXtcclxuICAgIHZhciBwbGF5ZXJTZXJ2aWNlID0gZnVuY3Rpb24oKXtcclxuICAgICAgICAvL0xvZ2luIENvbnRyb2xsZXJcclxuICAgICAgICB2YXIgcGxheWVycyA9IFtdO1xyXG5cclxuICAgICAgICByZXR1cm57XHJcbiAgICAgICAgICAgIGdldFBsYXllcnM6IGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gcGxheWVycztcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgc2V0UGxheWVyczogZnVuY3Rpb24ocGxheWVyc0FycmF5KXtcclxuICAgICAgICAgICAgICAgIHBsYXllcnMgPSBwbGF5ZXJzQXJyYXk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9O1xyXG5cclxuICAgIGFuZ3VsYXIubW9kdWxlKCdhcHAnKS5mYWN0b3J5KCdwbGF5ZXJTZXJ2aWNlJywgW3BsYXllclNlcnZpY2VdKTtcclxufSkoKTsiLCIvKipcclxuICogQ3JlYXRlZCBieSBqdXN0aWpuZGVwb3ZlciBvbiAwOS8xMi8xNS5cclxuICovXHJcblxyXG4oZnVuY3Rpb24oKXtcclxuXHJcbiAgICB2YXIgc29ja2V0U2VydmljZSA9IGZ1bmN0aW9uKCRyb290U2NvcGUpe1xyXG4gICAgICAgIFwidXNlIHN0cmljdFwiO1xyXG4gICAgICAgIC8vcHJpdmF0ZVxyXG4gICAgICAgIHZhciBzb2NrZXQgPSBpby5jb25uZWN0KHdpbmRvdy5sb2NhdGlvbi5ob3N0KTtcclxuICAgICAgICAvL2Z1bmN0aW9uc1xyXG4gICAgICAgIHZhciBvbiA9IGZ1bmN0aW9uIChldmVudE5hbWUsIGNhbGxiYWNrKSB7XHJcbiAgICAgICAgICAgIHNvY2tldC5vbihldmVudE5hbWUsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIHZhciBhcmdzID0gYXJndW1lbnRzO1xyXG4gICAgICAgICAgICAgICAgJHJvb3RTY29wZS4kYXBwbHkoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrLmFwcGx5KHNvY2tldCwgYXJncyk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGVtaXQgPSBmdW5jdGlvbiAoZXZlbnROYW1lLCBkYXRhLCBjYWxsYmFjaykge1xyXG4gICAgICAgICAgICBzb2NrZXQuZW1pdChldmVudE5hbWUsIGRhdGEsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIHZhciBhcmdzID0gYXJndW1lbnRzO1xyXG4gICAgICAgICAgICAgICAgJHJvb3RTY29wZS4kYXBwbHkoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChjYWxsYmFjaykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFjay5hcHBseShzb2NrZXQsIGFyZ3MpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIC8vcHVibGljXHJcbiAgICAgICAgcmV0dXJue1xyXG4gICAgICAgICAgICBvbjogb24sXHJcbiAgICAgICAgICAgIGVtaXQ6IGVtaXQsXHJcbiAgICAgICAgICAgIHNvY2tldDogc29ja2V0XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuXHJcbiAgICBhbmd1bGFyLm1vZHVsZShcImFwcFwiKS5mYWN0b3J5KFwic29ja2V0U2VydmljZVwiLCBbXCIkcm9vdFNjb3BlXCIsIHNvY2tldFNlcnZpY2VdKTtcclxuXHJcbn0pKCk7Il0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
