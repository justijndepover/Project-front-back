!function(){angular.module("app",[])}(),function(){var t=function(t,e,a,i){t.LCShow=a.getLCShow;var n=function(){e.emit("pcconnect",null)};t.room="",e.on("requestRoom",function(e){t.room=e}),e.on("deviceOrientation",function(t){var e=(t.username,{});e.gamma=t.gamma,e.beta=t.beta,e.alpha=t.alpha}),t.usernames={},t.checkUserCount=!1,e.on("updateusers",function(e){console.log(e),i.setPlayers(e),t.usernames=e,t.checkUserCount=Object.keys(t.usernames).length<0}),t.startGame=function(){e.emit("startGame",null),a.setLCShow(!1),a.setPCShow(!0)},function(){n()}()};angular.module("app").controller("loginController",["$scope","socketService","displayService","playerService",t])}(),function(){"use strict";var t=function(t,e,a,i,n,o){function r(t,e){return e.username==t.userName?!0:!1}function s(){p.clearRect(0,0,h.width,h.height);var t=h.width/100;if(0!=l.length){var e=h.width/100,a=e*l[0].image.height/l[0].image.width;for(var i in l){var n=l[i];p.save(),p.translate(n.x*t,n.y*t),p.rotate(n.rotation/180*Math.PI),p.drawImage(n.image,-e/2,-a/2,e,a),p.restore(),l[i].x=Math.cos((n.rotation-90)/180*Math.PI)+n.x,l[i].y=Math.sin((n.rotation-90)/180*Math.PI)+n.y}}if(0!=u.length){var o=h.width/20,r=o*u[0].image.height/u[0].image.width;for(var s in u){var c=u[s];p.save(),p.translate(c.x*t,c.y*t),p.rotate(c.rotation/180*Math.PI),p.drawImage(c.image,-o/2,-r/2,o,r),p.restore(),u[s].x=Math.cos((c.rotation-90)/180*Math.PI)/10*c.speed+c.x,u[s].y=Math.sin((c.rotation-90)/180*Math.PI)/10*c.speed+c.y}}}t.PCShow=n.getPCShow,t.startGame=!1;var c,h=document.getElementById("game"),p=h.getContext("2d"),u=new Array,l=new Array;i.on("initGame",function(){var t=o.getPlayers();for(var a in t){var i=t[a];u.push(new Spaceship(i.username,i.posX,i.posY,i.color,i.rotation))}c=e(s,10),console.log(u)}),i.on("updateGameData",function(t){var e=null;for(var a in u)1==r(u[a],t)&&(e=a);null!=e&&u[e].rotateSpaceshipRelative(t.orientation)}),i.on("playerShot",function(t){var e=null;for(var a in u)1==r(u[a],t)&&(e=a);if(null!=e){var i=u[e];l.push(new Bullet(i.x,i.y,i.rotation,i.color))}})};angular.module("app").controller("playController",["$scope","$interval","$window","socketService","displayService","playerService",t])}(),function(){var t=function(t){function e(e,a,i){t.innerWidth<t.innerHeight?e.width=t.innerWidth-20:e.width=t.innerHeight-20,angular.element(t).bind("resize",function(){t.innerWidth<t.innerHeight?e.width=t.innerWidth-20:e.width=t.innerHeight-20,e.$digest()})}return{restrict:"E",link:e,replace:!0,template:'<canvas id="game" class="playArea" width="{{width}}" height="{{width}}" />'}};angular.module("app").directive("canvasDirective",["$window",t])}();var Bullet=function(t,e,a,i){this.x=t,this.y=e,this.rotation=a,this.image=new Image,this.color=i,"orange"==this.color&&(this.color="red"),this.image.src="../assets/PNG/Lasers/laser"+this.color.charAt(0).toUpperCase()+this.color.slice(1)+"01.png"},Spaceship=function(t,e,a,i,n){this.userName=t,this.x=e,this.y=a,this.speed=1,this.color=i,this.rotation=n,this.image=new Image,this.damage=0,this.damageImage=new Image,this.image.src="../assets/PNG/playerShip1_"+this.color+".png"};Spaceship.prototype.moveSpaceship=function(t,e){this.x=t,this.y=e},Spaceship.prototype.moveSpaceshipRelative=function(t,e){this.x=this.x+t,this.y=this.y+e},Spaceship.prototype.rotateSpaceship=function(t){this.rotation=t},Spaceship.prototype.rotateSpaceshipRelative=function(t){this.rotation=this.rotation+t/5,this.rotation<-360&&(this.rotation=this.rotation+720),this.rotation>360&&(this.rotation=this.rotation-720)},Spaceship.prototype.increaseDamage=function(){this.damage<4&&(this.damage+=1),this.damage<=3&&this.damage>0&&(this.damageImage.src="../assets/PNG/Damage/playerShip1_damage"+this.damage+".png")},Spaceship.prototype.increaseDamage=function(){this.damage>0&&(this.damage-=1),this.damage<=3&&this.damage>0&&(this.damageImage.src="../assets/PNG/Damage/playerShip1_damage"+this.damage+".png")},function(){var t=function(){var t=!0,e=!1;return{getLCShow:function(){return t},setLCShow:function(e){t=e},getPCShow:function(){return e},setPCShow:function(t){e=t}}};angular.module("app").factory("displayService",[t])}(),function(){var t=function(){var t=[];return{getPlayers:function(){return t},setPlayers:function(e){t=e}}};angular.module("app").factory("playerService",[t])}(),function(){var t=function(t){"use strict";var e=io.connect(window.location.host),a=function(a,i){e.on(a,function(){var a=arguments;t.$apply(function(){i.apply(e,a)})})},i=function(a,i,n){e.emit(a,i,function(){var a=arguments;t.$apply(function(){n&&n.apply(e,a)})})};return{on:a,emit:i,socket:e}};angular.module("app").factory("socketService",["$rootScope",t])}();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyIsImNvbnRyb2xsZXIvbG9naW5Db250cm9sbGVyLmpzIiwiY29udHJvbGxlci9wbGF5Q29udHJvbGxlci5qcyIsImRpcmVjdGl2ZXMvY2FudmFzRGlyZWN0aXZlLmpzIiwibW9kZWxzL0J1bGxldC5qcyIsIm1vZGVscy9TcGFjZXNoaXAuanMiLCJzZXJ2aWNlcy9kaXNwbGF5U2VydmljZS5qcyIsInNlcnZpY2VzL3BsYXllclNlcnZpY2UuanMiLCJzZXJ2aWNlcy9zb2NrZXRTZXJ2aWNlLmpzIl0sIm5hbWVzIjpbImFuZ3VsYXIiLCJtb2R1bGUiLCJsb2dpbkNvbnRyb2xsZXIiLCIkc2NvcGUiLCJzb2NrZXRTZXJ2aWNlIiwiZGlzcGxheVNlcnZpY2UiLCJwbGF5ZXJTZXJ2aWNlIiwiTENTaG93IiwiZ2V0TENTaG93IiwibWFrZVJvb20iLCJlbWl0Iiwicm9vbSIsIm9uIiwiZGF0YSIsImRldmljZU9yaWVudGF0aW9uIiwidXNlcm5hbWUiLCJnYW1tYSIsImJldGEiLCJhbHBoYSIsInVzZXJuYW1lcyIsImNoZWNrVXNlckNvdW50IiwiY29uc29sZSIsImxvZyIsInNldFBsYXllcnMiLCJPYmplY3QiLCJrZXlzIiwibGVuZ3RoIiwic3RhcnRHYW1lIiwic2V0TENTaG93Iiwic2V0UENTaG93IiwiY29udHJvbGxlciIsInBsYXlDb250cm9sbGVyIiwiJGludGVydmFsIiwiJHdpbmRvdyIsImZpbHRlclBsYXllcnMiLCJvYmoiLCJ1c2VyTmFtZSIsImRyYXciLCJjdHgiLCJjbGVhclJlY3QiLCJjYW52Iiwid2lkdGgiLCJoZWlnaHQiLCJyYXRpbyIsIkFsbEJ1bGxldHMiLCJCdWxsZXRXaWR0aCIsIkJ1bGxldEhlaWdodCIsImltYWdlIiwiYnVsbGV0IiwiYiIsInNhdmUiLCJ0cmFuc2xhdGUiLCJ4IiwieSIsInJvdGF0ZSIsInJvdGF0aW9uIiwiTWF0aCIsIlBJIiwiZHJhd0ltYWdlIiwicmVzdG9yZSIsImNvcyIsInNpbiIsIkFsbFBsYXllcnMiLCJTcGFjZXNoaXBXaWR0aCIsIlNwYWNlc2hpcEhlaWdodCIsInBsYXllciIsInAiLCJzcGVlZCIsIlBDU2hvdyIsImdldFBDU2hvdyIsImN5Y2xlIiwiZG9jdW1lbnQiLCJnZXRFbGVtZW50QnlJZCIsImdldENvbnRleHQiLCJBcnJheSIsIkJ1ZmZlclBsYXllciIsImdldFBsYXllcnMiLCJwdXNoIiwiU3BhY2VzaGlwIiwicG9zWCIsInBvc1kiLCJjb2xvciIsImkiLCJyb3RhdGVTcGFjZXNoaXBSZWxhdGl2ZSIsIm9yaWVudGF0aW9uIiwidGVtcCIsIkJ1bGxldCIsImNhbnZhc0RpcmVjdGl2ZSIsImxpbmsiLCJzY29wZSIsImVsZW1lbnQiLCJhdHRycyIsImlubmVyV2lkdGgiLCJpbm5lckhlaWdodCIsImJpbmQiLCIkZGlnZXN0IiwicmVzdHJpY3QiLCJyZXBsYWNlIiwidGVtcGxhdGUiLCJkaXJlY3RpdmUiLCJ0aGlzIiwiSW1hZ2UiLCJzcmMiLCJjaGFyQXQiLCJ0b1VwcGVyQ2FzZSIsInNsaWNlIiwiZGFtYWdlIiwiZGFtYWdlSW1hZ2UiLCJwcm90b3R5cGUiLCJtb3ZlU3BhY2VzaGlwIiwibW92ZVNwYWNlc2hpcFJlbGF0aXZlIiwicm90YXRlU3BhY2VzaGlwIiwiZGVncmVlIiwiaW5jcmVhc2VEYW1hZ2UiLCJ2YWx1ZSIsImZhY3RvcnkiLCJwbGF5ZXJzIiwicGxheWVyc0FycmF5IiwiJHJvb3RTY29wZSIsInNvY2tldCIsImlvIiwiY29ubmVjdCIsIndpbmRvdyIsImxvY2F0aW9uIiwiaG9zdCIsImV2ZW50TmFtZSIsImNhbGxiYWNrIiwiYXJncyIsImFyZ3VtZW50cyIsIiRhcHBseSIsImFwcGx5Il0sIm1hcHBpbmdzIjoiQ0FHQSxXQUVBQSxRQUFBQyxPQUFBLGFDREEsV0FDQSxHQUFBQyxHQUFBLFNBQUFDLEVBQUFDLEVBQUFDLEVBQUFDLEdBRUFILEVBQUFJLE9BQUFGLEVBQUFHLFNBR0EsSUFBQUMsR0FBQSxXQUNBTCxFQUFBTSxLQUFBLFlBQUEsTUFFQVAsR0FBQVEsS0FBQSxH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QUtBckgsU0FBQUMsT0FBQSxPQUFBa0gsUUFBQSxpQkFBQTdHLE9DZkEsV0FFQSxHQUFBRixHQUFBLFNBQUFrSCxHQUNBLFlBRUEsSUFBQUMsR0FBQUMsR0FBQUMsUUFBQUMsT0FBQUMsU0FBQUMsTUFFQWhILEVBQUEsU0FBQWlILEVBQUFDLEdBQ0FQLEVBQUEzRyxHQUFBaUgsRUFBQSxXQUNBLEdBQUFFLEdBQUFDLFNBQ0FWLEdBQUFXLE9BQUEsV0FDQUgsRUFBQUksTUFBQVgsRUFBQVEsUUFLQXJILEVBQUEsU0FBQW1ILEVBQUFoSCxFQUFBaUgsR0FDQVAsRUFBQTdHLEtBQUFtSCxFQUFBaEgsRUFBQSxXQUNBLEdBQUFrSCxHQUFBQyxTQUNBVixHQUFBVyxPQUFBLFdBQ0FILEdBQ0FBLEVBQUFJLE1BQUFYLEVBQUFRLE9BT0EsUUFDQW5ILEdBQUFBLEVBQ0FGLEtBQUFBLEVBQ0E2RyxPQUFBQSxHQUlBdkgsU0FBQUMsT0FBQSxPQUFBa0gsUUFBQSxpQkFBQSxhQUFBL0ciLCJmaWxlIjoiYXBwLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQ3JlYXRlZCBieSBNaWNoaWVsIG9uIDI1LzExLzIwMTUuXG4gKi9cbihmdW5jdGlvbigpe1xuXG4gICAgdmFyIGFwcCA9IGFuZ3VsYXIubW9kdWxlKFwiYXBwXCIsW10pO1xufSkoKTsiLCIvKipcbiAqIENyZWF0ZWQgYnkgTWljaGllbCBvbiAxMS8xMi8yMDE1LlxuICovXG5cbihmdW5jdGlvbigpe1xuICAgIHZhciBsb2dpbkNvbnRyb2xsZXIgPSBmdW5jdGlvbigkc2NvcGUsIHNvY2tldFNlcnZpY2UsIGRpc3BsYXlTZXJ2aWNlLCBwbGF5ZXJTZXJ2aWNlKXtcblxuICAgICAgICAkc2NvcGUuTENTaG93ID0gZGlzcGxheVNlcnZpY2UuZ2V0TENTaG93O1xuXG4gICAgICAgIC8vZnVuY3Rpb25zXG4gICAgICAgIHZhciBtYWtlUm9vbSA9IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICBzb2NrZXRTZXJ2aWNlLmVtaXQoXCJwY2Nvbm5lY3RcIiwgbnVsbCk7XG4gICAgICAgIH07XG4gICAgICAgICRzY29wZS5yb29tID0gXCJcIjtcbiAgICAgICAgc29ja2V0U2VydmljZS5vbigncmVxdWVzdFJvb20nLGZ1bmN0aW9uKGRhdGEpe1xuICAgICAgICAgICAgJHNjb3BlLnJvb20gPSBkYXRhO1xuICAgICAgICB9KTtcbiAgICAgICAgc29ja2V0U2VydmljZS5vbignZGV2aWNlT3JpZW50YXRpb24nLCBmdW5jdGlvbihkYXRhKXtcbiAgICAgICAgICAgIHZhciB1c2VybmFtZSA9IGRhdGEudXNlcm5hbWU7XG4gICAgICAgICAgICB2YXIgZGV2aWNlT3JpZW50YXRpb24gPSB7fTtcbiAgICAgICAgICAgIGRldmljZU9yaWVudGF0aW9uLmdhbW1hID0gZGF0YS5nYW1tYTtcbiAgICAgICAgICAgIGRldmljZU9yaWVudGF0aW9uLmJldGEgPSBkYXRhLmJldGE7XG4gICAgICAgICAgICBkZXZpY2VPcmllbnRhdGlvbi5hbHBoYSA9IGRhdGEuYWxwaGE7XG4gICAgICAgIH0pO1xuICAgICAgICAkc2NvcGUudXNlcm5hbWVzID0ge307XG4gICAgICAgICRzY29wZS5jaGVja1VzZXJDb3VudCA9IGZhbHNlO1xuICAgICAgICBzb2NrZXRTZXJ2aWNlLm9uKCd1cGRhdGV1c2VycycsIGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhkYXRhKTtcbiAgICAgICAgICAgIHBsYXllclNlcnZpY2Uuc2V0UGxheWVycyhkYXRhKTtcbiAgICAgICAgICAgICRzY29wZS51c2VybmFtZXMgPSBkYXRhO1xuICAgICAgICAgICAgJHNjb3BlLmNoZWNrVXNlckNvdW50ID0gT2JqZWN0LmtleXMoJHNjb3BlLnVzZXJuYW1lcykubGVuZ3RoIDwgMDtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgJHNjb3BlLnN0YXJ0R2FtZT0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgc29ja2V0U2VydmljZS5lbWl0KFwic3RhcnRHYW1lXCIsIG51bGwpO1xuICAgICAgICAgICAgZGlzcGxheVNlcnZpY2Uuc2V0TENTaG93KGZhbHNlKTtcbiAgICAgICAgICAgIGRpc3BsYXlTZXJ2aWNlLnNldFBDU2hvdyh0cnVlKTtcbiAgICAgICAgfTtcblxuXG4gICAgICAgIChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIG1ha2VSb29tKCk7XG4gICAgICAgIH0pKCk7XG5cbiAgICB9O1xuXG4gICAgYW5ndWxhci5tb2R1bGUoXCJhcHBcIikuY29udHJvbGxlcihcImxvZ2luQ29udHJvbGxlclwiLCBbXCIkc2NvcGVcIiwgXCJzb2NrZXRTZXJ2aWNlXCIgLCBcImRpc3BsYXlTZXJ2aWNlXCIsIFwicGxheWVyU2VydmljZVwiLCBsb2dpbkNvbnRyb2xsZXJdKTtcbn0pKCk7IiwiLyoqXG4gKiBDcmVhdGVkIGJ5IE1pY2hpZWwgb24gMTYvMTIvMjAxNS5cbiAqL1xuXG4oZnVuY3Rpb24oKXtcbiAgICBcInVzZSBzdHJpY3RcIjtcbiAgICB2YXIgcGxheUNvbnRyb2xsZXIgPSBmdW5jdGlvbigkc2NvcGUsICRpbnRlcnZhbCwgJHdpbmRvdywgc29ja2V0U2VydmljZSwgZGlzcGxheVNlcnZpY2UsIHBsYXllclNlcnZpY2Upe1xuICAgICAgICAkc2NvcGUuUENTaG93ID0gZGlzcGxheVNlcnZpY2UuZ2V0UENTaG93O1xuICAgICAgICAkc2NvcGUuc3RhcnRHYW1lID0gZmFsc2U7XG4gICAgICAgIHZhciBjYW52ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2dhbWUnKTtcbiAgICAgICAgdmFyIGN0eCA9IGNhbnYuZ2V0Q29udGV4dCgnMmQnKTtcblxuICAgICAgICB2YXIgQWxsUGxheWVycyA9IG5ldyBBcnJheSgpO1xuICAgICAgICB2YXIgQWxsQnVsbGV0cyA9IG5ldyBBcnJheSgpO1xuXG4gICAgICAgIHZhciBjeWNsZTtcblxuICAgICAgICBzb2NrZXRTZXJ2aWNlLm9uKFwiaW5pdEdhbWVcIiwgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciBCdWZmZXJQbGF5ZXIgPSBwbGF5ZXJTZXJ2aWNlLmdldFBsYXllcnMoKTtcbiAgICAgICAgICAgIGZvcih2YXIgcGxheWVyIGluIEJ1ZmZlclBsYXllcil7XG4gICAgICAgICAgICAgICAgdmFyIHAgPSBCdWZmZXJQbGF5ZXJbcGxheWVyXTtcbiAgICAgICAgICAgICAgICBBbGxQbGF5ZXJzLnB1c2gobmV3IFNwYWNlc2hpcChwLnVzZXJuYW1lLCBwLnBvc1gsIHAucG9zWSwgcC5jb2xvciwgcC5yb3RhdGlvbikpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBjeWNsZSA9ICRpbnRlcnZhbChkcmF3LCAxMCk7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhBbGxQbGF5ZXJzKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgc29ja2V0U2VydmljZS5vbihcInVwZGF0ZUdhbWVEYXRhXCIsIGZ1bmN0aW9uKGRhdGEpe1xuICAgICAgICAgICAgdmFyIHAgPSBudWxsO1xuICAgICAgICAgICAgZm9yKHZhciBpIGluIEFsbFBsYXllcnMpe1xuICAgICAgICAgICAgICAgIGlmKGZpbHRlclBsYXllcnMoQWxsUGxheWVyc1tpXSxkYXRhKSA9PSB0cnVlKXtcbiAgICAgICAgICAgICAgICAgICAgcCA9IGk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYocCAhPSBudWxsKXtcbiAgICAgICAgICAgICAgICBBbGxQbGF5ZXJzW3BdLnJvdGF0ZVNwYWNlc2hpcFJlbGF0aXZlKGRhdGEub3JpZW50YXRpb24pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICBzb2NrZXRTZXJ2aWNlLm9uKFwicGxheWVyU2hvdFwiLCBmdW5jdGlvbihkYXRhKXtcbiAgICAgICAgICAgIHZhciBwID0gbnVsbDtcbiAgICAgICAgICAgIGZvcih2YXIgaSBpbiBBbGxQbGF5ZXJzKXtcbiAgICAgICAgICAgICAgICBpZihmaWx0ZXJQbGF5ZXJzKEFsbFBsYXllcnNbaV0sZGF0YSkgPT0gdHJ1ZSl7XG4gICAgICAgICAgICAgICAgICAgIHAgPSBpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmKHAgIT0gbnVsbCl7XG4gICAgICAgICAgICAgICAgdmFyIHRlbXAgPSBBbGxQbGF5ZXJzW3BdO1xuICAgICAgICAgICAgICAgIC8vdmFyIHggID0gTWF0aC5zaW4oKHRlbXAucm90YXRpb24gLSA5MCkvMTgwKk1hdGguUEkpK3RlbXAueDtcbiAgICAgICAgICAgICAgICAvL3ZhciB5ID0gTWF0aC5jb3MoKHRlbXAucm90YXRpb24gLSA5MCkvMTgwKk1hdGguUEkpK3RlbXAueTtcbiAgICAgICAgICAgICAgICBBbGxCdWxsZXRzLnB1c2gobmV3IEJ1bGxldCh0ZW1wLngsIHRlbXAueSwgdGVtcC5yb3RhdGlvbiwgdGVtcC5jb2xvcikpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICBmdW5jdGlvbiBmaWx0ZXJQbGF5ZXJzKG9iaixkYXRhKXtcbiAgICAgICAgICAgIGlmKGRhdGEudXNlcm5hbWUgPT0gb2JqLnVzZXJOYW1lKXtcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIH1lbHNle1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGRyYXcoKXtcbiAgICAgICAgICAgIGN0eC5jbGVhclJlY3QoMCwwLGNhbnYud2lkdGgsIGNhbnYuaGVpZ2h0KTtcbiAgICAgICAgICAgIHZhciByYXRpbyA9IGNhbnYud2lkdGgvMTAwO1xuXG4gICAgICAgICAgICBpZihBbGxCdWxsZXRzLmxlbmd0aCAhPSAwKXtcbiAgICAgICAgICAgICAgICB2YXIgQnVsbGV0V2lkdGggPSBjYW52LndpZHRoLzEwMDtcbiAgICAgICAgICAgICAgICB2YXIgQnVsbGV0SGVpZ2h0ID0gQnVsbGV0V2lkdGggKiBBbGxCdWxsZXRzWzBdLmltYWdlLmhlaWdodC9BbGxCdWxsZXRzWzBdLmltYWdlLndpZHRoO1xuXG4gICAgICAgICAgICAgICAgZm9yKHZhciBidWxsZXQgaW4gQWxsQnVsbGV0cyl7XG4gICAgICAgICAgICAgICAgICAgIHZhciBiID0gQWxsQnVsbGV0c1tidWxsZXRdO1xuICAgICAgICAgICAgICAgICAgICBjdHguc2F2ZSgpO1xuICAgICAgICAgICAgICAgICAgICBjdHgudHJhbnNsYXRlKGIueCpyYXRpbywgYi55KnJhdGlvKTtcbiAgICAgICAgICAgICAgICAgICAgY3R4LnJvdGF0ZShiLnJvdGF0aW9uLzE4MCpNYXRoLlBJKTtcbiAgICAgICAgICAgICAgICAgICAgY3R4LmRyYXdJbWFnZShiLmltYWdlLCAtQnVsbGV0V2lkdGgvMiwgLUJ1bGxldEhlaWdodC8yLCBCdWxsZXRXaWR0aCwgQnVsbGV0SGVpZ2h0KTtcbiAgICAgICAgICAgICAgICAgICAgY3R4LnJlc3RvcmUoKTtcbiAgICAgICAgICAgICAgICAgICAgQWxsQnVsbGV0c1tidWxsZXRdLnggPSBNYXRoLmNvcygoYi5yb3RhdGlvbiAtIDkwKS8xODAqTWF0aC5QSSkgKyBiLng7XG4gICAgICAgICAgICAgICAgICAgIEFsbEJ1bGxldHNbYnVsbGV0XS55ID0gTWF0aC5zaW4oKGIucm90YXRpb24tOTApLzE4MCpNYXRoLlBJKSsgYi55O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYoQWxsUGxheWVycy5sZW5ndGggIT0gMCl7XG4gICAgICAgICAgICAgICAgdmFyIFNwYWNlc2hpcFdpZHRoID0gY2Fudi53aWR0aC8yMDtcbiAgICAgICAgICAgICAgICB2YXIgU3BhY2VzaGlwSGVpZ2h0ID0gU3BhY2VzaGlwV2lkdGggKiBBbGxQbGF5ZXJzWzBdLmltYWdlLmhlaWdodC8gQWxsUGxheWVyc1swXS5pbWFnZS53aWR0aDtcblxuICAgICAgICAgICAgICAgIGZvcih2YXIgcGxheWVyIGluIEFsbFBsYXllcnMpe1xuICAgICAgICAgICAgICAgICAgICB2YXIgcCA9IEFsbFBsYXllcnNbcGxheWVyXTtcbiAgICAgICAgICAgICAgICAgICAgY3R4LnNhdmUoKTtcbiAgICAgICAgICAgICAgICAgICAgY3R4LnRyYW5zbGF0ZShwLngqcmF0aW8sIHAueSpyYXRpbyk7XG4gICAgICAgICAgICAgICAgICAgIGN0eC5yb3RhdGUocC5yb3RhdGlvbi8xODAqTWF0aC5QSSk7XG4gICAgICAgICAgICAgICAgICAgIGN0eC5kcmF3SW1hZ2UocC5pbWFnZSwgLVNwYWNlc2hpcFdpZHRoLzIsIC1TcGFjZXNoaXBIZWlnaHQvMiwgU3BhY2VzaGlwV2lkdGgsIFNwYWNlc2hpcEhlaWdodCk7XG4gICAgICAgICAgICAgICAgICAgIGN0eC5yZXN0b3JlKCk7XG4gICAgICAgICAgICAgICAgICAgIEFsbFBsYXllcnNbcGxheWVyXS54ID0gTWF0aC5jb3MoKHAucm90YXRpb24gLSA5MCkvMTgwKk1hdGguUEkpLzEwKiBwLnNwZWVkICsgcC54O1xuICAgICAgICAgICAgICAgICAgICBBbGxQbGF5ZXJzW3BsYXllcl0ueSA9IE1hdGguc2luKChwLnJvdGF0aW9uLTkwKS8xODAqTWF0aC5QSSkvMTAqIHAuc3BlZWQgKyBwLnk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfTtcblxuICAgIGFuZ3VsYXIubW9kdWxlKFwiYXBwXCIpLmNvbnRyb2xsZXIoXCJwbGF5Q29udHJvbGxlclwiLCBbXCIkc2NvcGVcIiwgXCIkaW50ZXJ2YWxcIiwgXCIkd2luZG93XCIsIFwic29ja2V0U2VydmljZVwiLCBcImRpc3BsYXlTZXJ2aWNlXCIsIFwicGxheWVyU2VydmljZVwiLCBwbGF5Q29udHJvbGxlcl0pXG59KSgpOyIsIi8qKlxuICogQ3JlYXRlZCBieSBqdXN0aWpuZGVwb3ZlciBvbiAxNi8xMi8xNS5cbiAqL1xuKGZ1bmN0aW9uKCl7XG4gICAgdmFyIGNhbnZhc0RpcmVjdGl2ZSA9IGZ1bmN0aW9uKCR3aW5kb3cpe1xuICAgICAgICByZXR1cm57XG4gICAgICAgICAgICByZXN0cmljdDogJ0UnLFxuICAgICAgICAgICAgbGluazpsaW5rLFxuICAgICAgICAgICAgcmVwbGFjZTp0cnVlLFxuICAgICAgICAgICAgdGVtcGxhdGU6JzxjYW52YXMgaWQ9XCJnYW1lXCIgY2xhc3M9XCJwbGF5QXJlYVwiIHdpZHRoPVwie3t3aWR0aH19XCIgaGVpZ2h0PVwie3t3aWR0aH19XCIgLz4nXG4gICAgICAgIH07XG5cbiAgICAgICAgZnVuY3Rpb24gbGluayhzY29wZSwgZWxlbWVudCwgYXR0cnMpe1xuICAgICAgICAgICAgaWYoJHdpbmRvdy5pbm5lcldpZHRoIDwgJHdpbmRvdy5pbm5lckhlaWdodCl7XG4gICAgICAgICAgICAgICAgc2NvcGUud2lkdGggPSAkd2luZG93LmlubmVyV2lkdGggLSAyMDtcbiAgICAgICAgICAgIH1lbHNle1xuICAgICAgICAgICAgICAgIHNjb3BlLndpZHRoID0gJHdpbmRvdy5pbm5lckhlaWdodCAtIDIwO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBhbmd1bGFyLmVsZW1lbnQoJHdpbmRvdykuYmluZCgncmVzaXplJywgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICBpZigkd2luZG93LmlubmVyV2lkdGggPCAkd2luZG93LmlubmVySGVpZ2h0KXtcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUud2lkdGggPSAkd2luZG93LmlubmVyV2lkdGggLSAyMDtcbiAgICAgICAgICAgICAgICB9ZWxzZXtcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUud2lkdGggPSAkd2luZG93LmlubmVySGVpZ2h0IC0gMjA7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgc2NvcGUuJGRpZ2VzdCgpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcCcpLmRpcmVjdGl2ZShcImNhbnZhc0RpcmVjdGl2ZVwiLCBbXCIkd2luZG93XCIsIGNhbnZhc0RpcmVjdGl2ZV0pO1xufSkoKTsiLCIvKipcbiAqIENyZWF0ZWQgYnkganVzdGlqbmRlcG92ZXIgb24gMjIvMTIvMTUuXG4gKi9cblxudmFyIEJ1bGxldCA9IGZ1bmN0aW9uKHgsIHkscm90YXRpb24sIGNvbG9yKXtcbiAgICB0aGlzLnggPSB4O1xuICAgIHRoaXMueSA9IHk7XG4gICAgdGhpcy5yb3RhdGlvbiA9IHJvdGF0aW9uO1xuICAgIHRoaXMuaW1hZ2UgPSBuZXcgSW1hZ2UoKTtcbiAgICB0aGlzLmNvbG9yID0gY29sb3I7XG4gICAgaWYodGhpcy5jb2xvciA9PSBcIm9yYW5nZVwiKXtcbiAgICAgICAgdGhpcy5jb2xvciA9ICdyZWQnO1xuICAgIH1cbiAgICB0aGlzLmltYWdlLnNyYyA9ICcuLi9hc3NldHMvUE5HL0xhc2Vycy9sYXNlcicrIHRoaXMuY29sb3IuY2hhckF0KDApLnRvVXBwZXJDYXNlKCkgKyB0aGlzLmNvbG9yLnNsaWNlKDEpICsnMDEucG5nJ1xufTsiLCIvKipcbiAqIENyZWF0ZWQgYnkganVzdGlqbmRlcG92ZXIgb24gMDkvMTIvMTUuXG4gKi9cblxudmFyIFNwYWNlc2hpcCA9IGZ1bmN0aW9uKHVzZXJOYW1lLCB4LCB5LCBjb2xvciwgcm90YXRpb24pe1xuICAgIHRoaXMudXNlck5hbWUgPSB1c2VyTmFtZTtcbiAgICB0aGlzLnggPSB4O1xuICAgIHRoaXMueSA9IHk7XG4gICAgdGhpcy5zcGVlZCA9IDE7XG4gICAgdGhpcy5jb2xvciA9IGNvbG9yO1xuICAgIHRoaXMucm90YXRpb24gPSByb3RhdGlvbjtcbiAgICB0aGlzLmltYWdlID0gbmV3IEltYWdlKCk7XG4gICAgdGhpcy5kYW1hZ2UgPSAwO1xuICAgIHRoaXMuZGFtYWdlSW1hZ2UgPSBuZXcgSW1hZ2UoKTtcbiAgICB0aGlzLmltYWdlLnNyYyA9ICcuLi9hc3NldHMvUE5HL3BsYXllclNoaXAxXycrIHRoaXMuY29sb3IgKycucG5nJ1xufTtcblxuU3BhY2VzaGlwLnByb3RvdHlwZS5tb3ZlU3BhY2VzaGlwID0gZnVuY3Rpb24oeCwgeSl7XG4gICAgdGhpcy54ID0geDtcbiAgICB0aGlzLnkgPSB5O1xufTtcblxuU3BhY2VzaGlwLnByb3RvdHlwZS5tb3ZlU3BhY2VzaGlwUmVsYXRpdmUgPSBmdW5jdGlvbih4LCB5KXtcbiAgICB0aGlzLnggPSB0aGlzLngreDtcbiAgICB0aGlzLnkgPSB0aGlzLnkreTtcbn07XG5cblNwYWNlc2hpcC5wcm90b3R5cGUucm90YXRlU3BhY2VzaGlwID0gZnVuY3Rpb24oZGVncmVlKXtcbiAgICB0aGlzLnJvdGF0aW9uID0gZGVncmVlO1xufTtcblxuU3BhY2VzaGlwLnByb3RvdHlwZS5yb3RhdGVTcGFjZXNoaXBSZWxhdGl2ZSA9IGZ1bmN0aW9uKGRlZ3JlZSl7XG4gICAgdGhpcy5yb3RhdGlvbiA9IHRoaXMucm90YXRpb24gKyBkZWdyZWUvNTtcbiAgICBpZih0aGlzLnJvdGF0aW9uIDwgLTM2MCl7XG4gICAgICAgIHRoaXMucm90YXRpb24gPSB0aGlzLnJvdGF0aW9uICsgNzIwO1xuICAgIH1cbiAgICBpZih0aGlzLnJvdGF0aW9uID4gMzYwKXtcbiAgICAgICAgdGhpcy5yb3RhdGlvbiA9IHRoaXMucm90YXRpb24gLSA3MjA7XG4gICAgfVxufTtcblxuU3BhY2VzaGlwLnByb3RvdHlwZS5pbmNyZWFzZURhbWFnZSA9IGZ1bmN0aW9uKCl7XG4gICAgaWYodGhpcy5kYW1hZ2UgPCA0KXtcbiAgICAgICAgdGhpcy5kYW1hZ2UgKz0gMTtcbiAgICB9XG5cbiAgICBpZih0aGlzLmRhbWFnZSA8PSAzICYmIHRoaXMuZGFtYWdlID4gMCl7XG4gICAgICAgIHRoaXMuZGFtYWdlSW1hZ2Uuc3JjID0gJy4uL2Fzc2V0cy9QTkcvRGFtYWdlL3BsYXllclNoaXAxX2RhbWFnZScrIHRoaXMuZGFtYWdlICsgJy5wbmcnO1xuICAgIH1cbn07XG5cblNwYWNlc2hpcC5wcm90b3R5cGUuaW5jcmVhc2VEYW1hZ2UgPSBmdW5jdGlvbigpe1xuICAgIGlmKHRoaXMuZGFtYWdlID4gMCl7XG4gICAgICAgIHRoaXMuZGFtYWdlIC09IDE7XG4gICAgfVxuXG4gICAgaWYodGhpcy5kYW1hZ2UgPD0gMyAmJiB0aGlzLmRhbWFnZSA+IDApe1xuICAgICAgICB0aGlzLmRhbWFnZUltYWdlLnNyYyA9ICcuLi9hc3NldHMvUE5HL0RhbWFnZS9wbGF5ZXJTaGlwMV9kYW1hZ2UnKyB0aGlzLmRhbWFnZSArICcucG5nJztcbiAgICB9XG59O1xuXG4iLCIvKipcbiAqIENyZWF0ZWQgYnkgTWljaGllbCBvbiAxNi8xMi8yMDE1LlxuICovXG4vKipcbiAqIENyZWF0ZWQgYnkganVzdGlqbmRlcG92ZXIgb24gMTYvMTIvMTUuXG4gKi9cblxuXG4oZnVuY3Rpb24oKXtcbiAgICB2YXIgZGlzcGxheVNlcnZpY2UgPSBmdW5jdGlvbigpe1xuICAgICAgICAvL0xvZ2luIENvbnRyb2xsZXJcbiAgICAgICAgdmFyIExDU2hvdyA9IHRydWU7XG4gICAgICAgIC8vUGxheSBjb250cm9sbGVyXG4gICAgICAgIHZhciBQQ1Nob3cgPSBmYWxzZTtcblxuICAgICAgICByZXR1cm57XG4gICAgICAgICAgICBnZXRMQ1Nob3c6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgcmV0dXJuIExDU2hvdztcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzZXRMQ1Nob3c6IGZ1bmN0aW9uKHZhbHVlKXtcbiAgICAgICAgICAgICAgICBMQ1Nob3cgPSB2YWx1ZTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXRQQ1Nob3c6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgcmV0dXJuIFBDU2hvdztcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzZXRQQ1Nob3c6IGZ1bmN0aW9uKHZhbHVlKXtcbiAgICAgICAgICAgICAgICBQQ1Nob3cgPSB2YWx1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH07XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwJykuZmFjdG9yeSgnZGlzcGxheVNlcnZpY2UnLCBbZGlzcGxheVNlcnZpY2VdKTtcbn0pKCk7IiwiLyoqXG4gKiBDcmVhdGVkIGJ5IGp1c3Rpam5kZXBvdmVyIG9uIDE3LzEyLzE1LlxuICovXG5cbihmdW5jdGlvbigpe1xuICAgIHZhciBwbGF5ZXJTZXJ2aWNlID0gZnVuY3Rpb24oKXtcbiAgICAgICAgLy9Mb2dpbiBDb250cm9sbGVyXG4gICAgICAgIHZhciBwbGF5ZXJzID0gW107XG5cbiAgICAgICAgcmV0dXJue1xuICAgICAgICAgICAgZ2V0UGxheWVyczogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICByZXR1cm4gcGxheWVycztcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzZXRQbGF5ZXJzOiBmdW5jdGlvbihwbGF5ZXJzQXJyYXkpe1xuICAgICAgICAgICAgICAgIHBsYXllcnMgPSBwbGF5ZXJzQXJyYXk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcCcpLmZhY3RvcnkoJ3BsYXllclNlcnZpY2UnLCBbcGxheWVyU2VydmljZV0pO1xufSkoKTsiLCIvKipcbiAqIENyZWF0ZWQgYnkganVzdGlqbmRlcG92ZXIgb24gMDkvMTIvMTUuXG4gKi9cblxuKGZ1bmN0aW9uKCl7XG5cbiAgICB2YXIgc29ja2V0U2VydmljZSA9IGZ1bmN0aW9uKCRyb290U2NvcGUpe1xuICAgICAgICBcInVzZSBzdHJpY3RcIjtcbiAgICAgICAgLy9wcml2YXRlXG4gICAgICAgIHZhciBzb2NrZXQgPSBpby5jb25uZWN0KHdpbmRvdy5sb2NhdGlvbi5ob3N0KTtcbiAgICAgICAgLy9mdW5jdGlvbnNcbiAgICAgICAgdmFyIG9uID0gZnVuY3Rpb24gKGV2ZW50TmFtZSwgY2FsbGJhY2spIHtcbiAgICAgICAgICAgIHNvY2tldC5vbihldmVudE5hbWUsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB2YXIgYXJncyA9IGFyZ3VtZW50cztcbiAgICAgICAgICAgICAgICAkcm9vdFNjb3BlLiRhcHBseShmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrLmFwcGx5KHNvY2tldCwgYXJncyk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgZW1pdCA9IGZ1bmN0aW9uIChldmVudE5hbWUsIGRhdGEsIGNhbGxiYWNrKSB7XG4gICAgICAgICAgICBzb2NrZXQuZW1pdChldmVudE5hbWUsIGRhdGEsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB2YXIgYXJncyA9IGFyZ3VtZW50cztcbiAgICAgICAgICAgICAgICAkcm9vdFNjb3BlLiRhcHBseShmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChjYWxsYmFjaykge1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2suYXBwbHkoc29ja2V0LCBhcmdzKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgfTtcblxuICAgICAgICAvL3B1YmxpY1xuICAgICAgICByZXR1cm57XG4gICAgICAgICAgICBvbjogb24sXG4gICAgICAgICAgICBlbWl0OiBlbWl0LFxuICAgICAgICAgICAgc29ja2V0OiBzb2NrZXRcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICBhbmd1bGFyLm1vZHVsZShcImFwcFwiKS5mYWN0b3J5KFwic29ja2V0U2VydmljZVwiLCBbXCIkcm9vdFNjb3BlXCIsIHNvY2tldFNlcnZpY2VdKTtcblxufSkoKTsiXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
