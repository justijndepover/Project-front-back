!function(){angular.module("app",[])}(),function(){var e=function(e){function t(t,a,i){e.innerWidth<e.innerHeight?t.width=e.innerWidth-20:t.width=e.innerHeight-20,angular.element(e).bind("resize",function(){e.innerWidth<e.innerHeight?t.width=e.innerWidth-20:t.width=e.innerHeight-20,t.$digest()})}return{restrict:"E",link:t,replace:!0,template:'<canvas id="game" class="playArea" width="{{width}}" height="{{width}}" />'}};angular.module("app").directive("canvasDirective",["$window",e])}(),function(){var e=function(e,t,a,i){e.LCShow=a.getLCShow;var o=function(){t.emit("pcconnect",null)};e.room="",t.on("requestRoom",function(t){e.room=t}),t.on("deviceOrientation",function(e){var t=(e.username,{});t.gamma=e.gamma,t.beta=e.beta,t.alpha=e.alpha}),e.usernames={},e.checkUserCount=!1,t.on("updateusers",function(t){i.setPlayers(t),e.usernames=t,e.checkUserCount=Object.keys(e.usernames).length<0}),e.startGame=function(){t.emit("startGame",null),a.setLCShow(!1),a.setPCShow(!0)},function(){o()}()};angular.module("app").controller("loginController",["$scope","socketService","displayService","playerService",e])}(),function(){"use strict";var e=function(e,t,a,i,o,n){function r(e,t){return t.username==e.userName?!0:!1}function s(){u.length>0&&(u[0].speed=0),g.clearRect(0,0,p.width,p.height);var e=p.width/100;if(0!=d.length){var t=p.width/100,a=t*d[0].image.height/d[0].image.width;for(var i in d){var o=d[i];o.width=t,o.height=a,0==o.explodeStage?(g.save(),g.translate(o.x*e,o.y*e),g.rotate(o.rotation/180*Math.PI),g.drawImage(o.image,-t/2,-a/2,t,a),g.restore(),d[i].x=Math.cos((o.rotation-90)/180*Math.PI)+o.x,d[i].y=Math.sin((o.rotation-90)/180*Math.PI)+o.y):o.explodeStage<4&&(console.log(o.explosionImage),g.save(),g.translate(o.x*e,o.y*e),g.drawImage(o.explosionImage,-t,-t,2*t,2*t),g.restore())}}if(0!=u.length){var n=p.width/20,r=n*u[0].image.height/u[0].image.width;for(var s in u){var l=u[s];l.width=n,l.height=r,g.save(),g.translate(l.x*e,l.y*e),g.rotate(l.rotation/180*Math.PI),g.drawImage(l.image,-n/2,-r/2,n,r),l.damage>0&&g.drawImage(l.damageImage,-n/2,-r/2,n,r),g.restore(),u[s].x=Math.cos((l.rotation-90)/180*Math.PI)/10*l.speed+l.x,u[s].y=Math.sin((l.rotation-90)/180*Math.PI)/10*l.speed+l.y}}h(),c()}function h(){for(var e in d)(d[e].x<0||d[e].x>p.width||d[e].y<0||d[e].y>p.height)&&d.splice(e,1),d[e].explodeStage>0&&(d[e].explodeStage<4?d[e].explode():d.splice(e,1))}function c(){for(var e in u)for(var t in d)if(0==d[t].explodeStage&&d[t].player!=u[e].userName){var a=Math.sqrt(2)/2*(d[t].height/2-d[t].width/2),i=(360-d[t].rotation)/180*Math.PI,o=d[t].x*p.width/100-a*Math.sin(i),n=d[t].y*p.width/100-a*Math.cos(i),r=u[e].x*p.width/100,s=u[e].y*p.width/100,h=Math.sqrt((o-r)*(o-r)+(n-s)*(n-s));if(h<d[t].width/2+u[e].width/2){var c=new Audio("../../assets/Bonus/sfx_lose.ogg");c.play(),u[e].increaseDamage(),d[t].explode()}}}e.PCShow=o.getPCShow,e.startGame=!1;var l,p=document.getElementById("game"),g=p.getContext("2d"),u=new Array,d=new Array;i.on("initGame",function(){var e=n.getPlayers();for(var a in e){var i=e[a];u.push(new Spaceship(i.username,i.x,i.y,i.color,i.rotation))}l=t(s,10)}),i.on("userleft",function(e){var t=null;for(var a in u)1==r(u[a],e)&&(t=a);u.splice(t,1)}),i.on("updateGameData",function(e){var t=null;for(var a in u)1==r(u[a],e)&&(t=a);null!=t&&u[t].rotateSpaceshipRelative(e.orientation)}),i.on("playerShot",function(e){var t=null;for(var a in u)1==r(u[a],e)&&(t=a);if(null!=t){var i=u[t],o=(360-(i.rotation+180))/180*Math.PI,n=i.x+p.width/400*Math.sin(o),s=i.y+p.width/400*Math.cos(o);if(d.push(new Bullet(n,s,i.rotation,i.color,i.userName)),t%2==0)var h=new Audio("../../assets/Bonus/sfx_laser1.ogg");else var h=new Audio("../../assets/Bonus/sfx_laser2.ogg");h.play()}})};angular.module("app").controller("playController",["$scope","$interval","$window","socketService","displayService","playerService",e])}();var Bullet=function(e,t,a,i,o){this.x=e,this.y=t,this.rotation=a,this.image=new Image,this.color=i,this.width=0,this.height=0,this.player=o,this.explosionImage=new Image,this.explodeStage=0,"orange"==this.color&&(this.color="red"),this.image.src="../assets/PNG/Lasers/laser"+this.color.charAt(0).toUpperCase()+this.color.slice(1)+"01.png"};Bullet.prototype.explode=function(){if(this.explodeStage<4){this.explodeStage++;var e;e=this.explodeStage<3?1:2,this.explosionImage.src="../assets/PNG/Lasers/laser"+this.color.charAt(0).toUpperCase()+this.color.slice(1)+"Explode"+e+".png"}else this.explosionImage.src=""};var Spaceship=function(e,t,a,i,o){this.userName=e,this.x=t,this.y=a,this.speed=1,this.color=i,this.rotation=o,this.image=new Image,this.damage=0,this.width=0,this.height=0,this.damageImage=new Image,this.image.src="../assets/PNG/playerShip1_"+this.color+".png"};Spaceship.prototype.moveSpaceship=function(e,t){this.x=e,this.y=t},Spaceship.prototype.moveSpaceshipRelative=function(e,t){this.x=this.x+e,this.y=this.y+t},Spaceship.prototype.rotateSpaceship=function(e){this.rotation=e},Spaceship.prototype.rotateSpaceshipRelative=function(e){this.rotation=this.rotation+e/5,this.rotation<-360&&(this.rotation=this.rotation+720),this.rotation>360&&(this.rotation=this.rotation-720)},Spaceship.prototype.increaseDamage=function(){this.damage<4&&(this.damage+=1),this.damage<=3&&this.damage>0&&(this.damageImage.src="../assets/PNG/Damage/playerShip1_damage"+this.damage+".png")},Spaceship.prototype.decreaseDamage=function(){this.damage>0&&(this.damage-=1),this.damage<=3&&this.damage>0&&(this.damageImage.src="../assets/PNG/Damage/playerShip1_damage"+this.damage+".png")},function(){var e=function(){var e=!0,t=!1;return{getLCShow:function(){return e},setLCShow:function(t){e=t},getPCShow:function(){return t},setPCShow:function(e){t=e}}};angular.module("app").factory("displayService",[e])}(),function(){var e=function(){var e=[];return{getPlayers:function(){return e},setPlayers:function(t){e=t}}};angular.module("app").factory("playerService",[e])}(),function(){var e=function(e){"use strict";var t=io.connect(window.location.host),a=function(a,i){t.on(a,function(){var a=arguments;e.$apply(function(){i.apply(t,a)})})},i=function(a,i,o){t.emit(a,i,function(){var a=arguments;e.$apply(function(){o&&o.apply(t,a)})})};return{on:a,emit:i,socket:t}};angular.module("app").factory("socketService",["$rootScope",e])}();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyIsImRpcmVjdGl2ZXMvY2FudmFzRGlyZWN0aXZlLmpzIiwiY29udHJvbGxlci9sb2dpbkNvbnRyb2xsZXIuanMiLCJjb250cm9sbGVyL3BsYXlDb250cm9sbGVyLmpzIiwibW9kZWxzL0J1bGxldC5qcyIsIm1vZGVscy9TcGFjZXNoaXAuanMiLCJzZXJ2aWNlcy9kaXNwbGF5U2VydmljZS5qcyIsInNlcnZpY2VzL3BsYXllclNlcnZpY2UuanMiLCJzZXJ2aWNlcy9zb2NrZXRTZXJ2aWNlLmpzIl0sIm5hbWVzIjpbImFuZ3VsYXIiLCJtb2R1bGUiLCJjYW52YXNEaXJlY3RpdmUiLCIkd2luZG93IiwibGluayIsInNjb3BlIiwiZWxlbWVudCIsImF0dHJzIiwiaW5uZXJXaWR0aCIsImlubmVySGVpZ2h0Iiwid2lkdGgiLCJiaW5kIiwiJGRpZ2VzdCIsInJlc3RyaWN0IiwicmVwbGFjZSIsInRlbXBsYXRlIiwiZGlyZWN0aXZlIiwibG9naW5Db250cm9sbGVyIiwiJHNjb3BlIiwic29ja2V0U2VydmljZSIsImRpc3BsYXlTZXJ2aWNlIiwicGxheWVyU2VydmljZSIsIkxDU2hvdyIsImdldExDU2hvdyIsIm1ha2VSb29tIiwiZW1pdCIsInJvb20iLCJvbiIsImRhdGEiLCJkZXZpY2VPcmllbnRhdGlvbiIsInVzZXJuYW1lIiwiZ2FtbWEiLCJiZXRhIiwiYWxwaGEiLCJ1c2VybmFtZXMiLCJjaGVja1VzZXJDb3VudCIsInNldFBsYXllcnMiLCJPYmplY3QiLCJrZXlzIiwibGVuZ3RoIiwic3RhcnRHYW1lIiwic2V0TENTaG93Iiwic2V0UENTaG93IiwiY29udHJvbGxlciIsInBsYXlDb250cm9sbGVyIiwiJGludGVydmFsIiwiZmlsdGVyUGxheWVycyIsIm9iaiIsInVzZXJOYW1lIiwiZHJhdyIsIkFsbFBsYXllcnMiLCJzcGVlZCIsImN0eCIsImNsZWFyUmVjdCIsImNhbnYiLCJoZWlnaHQiLCJyYXRpbyIsIkFsbEJ1bGxldHMiLCJCdWxsZXRXaWR0aCIsIkJ1bGxldEhlaWdodCIsImltYWdlIiwiYnVsbGV0IiwiYiIsImV4cGxvZGVTdGFnZSIsInNhdmUiLCJ0cmFuc2xhdGUiLCJ4IiwieSIsInJvdGF0ZSIsInJvdGF0aW9uIiwiTWF0aCIsIlBJIiwiZHJhd0ltYWdlIiwicmVzdG9yZSIsImNvcyIsInNpbiIsImNvbnNvbGUiLCJsb2ciLCJleHBsb3Npb25JbWFnZSIsIlNwYWNlc2hpcFdpZHRoIiwiU3BhY2VzaGlwSGVpZ2h0IiwicGxheWVyIiwicCIsImRhbWFnZSIsImRhbWFnZUltYWdlIiwiY2hlY2tCdWxsZXRzIiwiY29sbGlzaW9uRGV0ZWN0aW9uIiwic3BsaWNlIiwiZXhwbG9kZSIsInJhZGl1cyIsInNxcnQiLCJhbmdsZSIsImJ1bGxldEhlYWRYIiwiYnVsbGV0SGVhZFkiLCJzcGFjZVNoaXBYIiwic3BhY2VTaGlwWSIsImRpc3RhbmNlIiwiZGFtYWdlc291bmQiLCJBdWRpbyIsInBsYXkiLCJpbmNyZWFzZURhbWFnZSIsIlBDU2hvdyIsImdldFBDU2hvdyIsImN5Y2xlIiwiZG9jdW1lbnQiLCJnZXRFbGVtZW50QnlJZCIsImdldENvbnRleHQiLCJBcnJheSIsIkJ1ZmZlclBsYXllciIsImdldFBsYXllcnMiLCJwdXNoIiwiU3BhY2VzaGlwIiwiY29sb3IiLCJpIiwicm90YXRlU3BhY2VzaGlwUmVsYXRpdmUiLCJvcmllbnRhdGlvbiIsInRlbXAiLCJCdWxsZXQiLCJzaG90IiwidGhpcyIsIkltYWdlIiwic3JjIiwiY2hhckF0IiwidG9VcHBlckNhc2UiLCJzbGljZSIsInByb3RvdHlwZSIsIm51bWJlciIsIm1vdmVTcGFjZXNoaXAiLCJtb3ZlU3BhY2VzaGlwUmVsYXRpdmUiLCJyb3RhdGVTcGFjZXNoaXAiLCJkZWdyZWUiLCJkZWNyZWFzZURhbWFnZSIsInZhbHVlIiwiZmFjdG9yeSIsInBsYXllcnMiLCJwbGF5ZXJzQXJyYXkiLCIkcm9vdFNjb3BlIiwic29ja2V0IiwiaW8iLCJjb25uZWN0Iiwid2luZG93IiwibG9jYXRpb24iLCJob3N0IiwiZXZlbnROYW1lIiwiY2FsbGJhY2siLCJhcmdzIiwiYXJndW1lbnRzIiwiJGFwcGx5IiwiYXBwbHkiXSwibWFwcGluZ3MiOiJDQUdBLFdBRUFBLFFBQUFDLE9BQUEsYUNGQSxXQUNBLEdBQUFDLEdBQUEsU0FBQUMsR0FRQSxRQUFBQyxHQUFBQyxFQUFBQyxFQUFBQyxHQUNBSixFQUFBSyxXQUFBTCxFQUFBTSxZQUNBSixFQUFBSyxNQUFBUCxFQUFBSyxXQUFBLEdBRUFILEVBQUFLLE1BQUFQLEVBQUFNLFlBQUEsR0FHQVQsUUFBQU0sUUFBQUgsR0FBQVEsS0FBQSxTQUFBLFdBQ0FSLEVBQUFLLFdBQUFMLEVBQUFNLFlBQ0FKLEVBQUFLLE1BQUFQLEVBQUFLLFdBQUEsR0FFQUgsRUFBQUssTUFBQVAsRUFBQU0sWUFBQSxHQUdBSixFQUFBTyxZQXJCQSxPQUNBQyxTQUFBLElBQ0FULEtBQUFBLEVBQ0FVLFNBQUEsRUFDQUMsU0FBQSw4RUFzQkFmLFNBQUFDLE9BQUEsT0FBQWUsVUFBQSxtQkFBQSxVQUFBZCxPQzNCQSxXQUNBLEdBQUFlLEdBQUEsU0FBQUMsRUFBQUMsRUFBQUMsRUFBQUMsR0FFQUgsRUFBQUksT0FBQUYsRUFBQUcsU0FHQSxJQUFBQyxHQUFBLFdBQ0FMLEVBQUFNLEtBQUEsWUFBQSxNQUVBUCxHQUFBUSxLQUFBLEdBQ0FQLEVBQUFRLEdBQUEsY0FBQSxTQUFBQyxHQUNBVixFQUFBUSxLQUFBRSxJQUVBVCxFQUFBUSxHQUFBLG9CQUFBLFNBQUFDLEdBQ0EsR0FDQUMsSUFEQUQsRUFBQUUsWUFFQUQsR0FBQUUsTUFBQUgsRUFBQUcsTUFDQUYsRUFBQUcsS0FBQUosRUFBQUksS0FDQUgsRUFBQUksTUFBQUwsRUFBQUssUUFFQWYsRUFBQWdCLGFBQ0FoQixFQUFBaUIsZ0JBQUEsRUFDQWhCLEVBQUFRLEdBQUEsY0FBQSxTQUFBQyxHQUNBUCxFQUFBZSxXQUFBUixHQUNBVixFQUFBZ0IsVUFBQU4sRUFDQVYsRUFBQWlCLGVBQUFFLE9BQUFDLEtBQUFwQixFQUFBZ0IsV0FBQUssT0FBQSxJQUdBckIsRUFBQXNCLFVBQUEsV0FDQXJCLEVBQUFNLEtBQUEsWUFBQSxNQUNBTCxFQUFBcUIsV0FBQSxHQUNBckIsRUFBQXNCLFdBQUEsSUFJQSxXQUNBbEIsT0FLQXhCLFNBQUFDLE9BQUEsT0FBQTBDLFdBQUEsbUJBQUEsU0FBQSxnQkFBQSxpQkFBQSxnQkFBQTFCLE9DekNBLFdBQ0EsWUFDQSxJQUFBMkIsR0FBQSxTQUFBMUIsRUFBQTJCLEVBQUExQyxFQUFBZ0IsRUFBQUMsRUFBQUMsR0FpRUEsUUFBQXlCLEdBQUFDLEVBQUFuQixHQUNBLE1BQUFBLEdBQUFFLFVBQUFpQixFQUFBQyxVQUNBLEdBRUEsRUFJQSxRQUFBQyxLQUNBQyxFQUFBWCxPQUFBLElBQ0FXLEVBQUEsR0FBQUMsTUFBQSxHQUVBQyxFQUFBQyxVQUFBLEVBQUEsRUFBQUMsRUFBQTVDLE1BQUE0QyxFQUFBQyxPQUNBLElBQUFDLEdBQUFGLEVBQUE1QyxNQUFBLEdBRUEsSUFBQSxHQUFBK0MsRUFBQWxCLE9BQUEsQ0FDQSxHQUFBbUIsR0FBQUosRUFBQTVDLE1BQUEsSUFDQWlELEVBQUFELEVBQUFELEVBQUEsR0FBQUcsTUFBQUwsT0FBQUUsRUFBQSxHQUFBRyxNQUFBbEQsS0FFQSxLQUFBLEdBQUFtRCxLQUFBSixHQUFBLENBQ0EsR0FBQUssR0FBQUwsRUFBQUksRUFDQUMsR0FBQXBELE1BQUFnRCxFQUNBSSxFQUFBUCxPQUFBSSxFQUVBLEdBQUFHLEVBQUFDLGNBRUFYLEVBQUFZLE9BQ0FaLEVBQUFhLFVBQUFILEVBQUFJLEVBQUFWLEVBQUFNLEVBQUFLLEVBQUFYLEdBQ0FKLEVBQUFnQixPQUFBTixFQUFBTyxTQUFBLElBQUFDLEtBQUFDLElBQ0FuQixFQUFBb0IsVUFBQVYsRUFBQUYsT0FBQUYsRUFBQSxHQUFBQyxFQUFBLEVBQUFELEVBQUFDLEdBQ0FQLEVBQUFxQixVQUVBaEIsRUFBQUksR0FBQUssRUFBQUksS0FBQUksS0FBQVosRUFBQU8sU0FBQSxJQUFBLElBQUFDLEtBQUFDLElBQUFULEVBQUFJLEVBQ0FULEVBQUFJLEdBQUFNLEVBQUFHLEtBQUFLLEtBQUFiLEVBQUFPLFNBQUEsSUFBQSxJQUFBQyxLQUFBQyxJQUFBVCxFQUFBSyxHQUNBTCxFQUFBQyxhQUFBLElBRUFhLFFBQUFDLElBQUFmLEVBQUFnQixnQkFDQTFCLEVBQUFZLE9BQ0FaLEVBQUFhLFVBQUFILEVBQUFJLEVBQUFWLEVBQUFNLEVBQUFLLEVBQUFYLEdBQ0FKLEVBQUFvQixVQUFBVixFQUFBZ0IsZ0JBQUFwQixHQUFBQSxFQUFBLEVBQUFBLEVBQUEsRUFBQUEsR0FDQU4sRUFBQXFCLFlBS0EsR0FBQSxHQUFBdkIsRUFBQVgsT0FBQSxDQUNBLEdBQUF3QyxHQUFBekIsRUFBQTVDLE1BQUEsR0FDQXNFLEVBQUFELEVBQUE3QixFQUFBLEdBQUFVLE1BQUFMLE9BQUFMLEVBQUEsR0FBQVUsTUFBQWxELEtBRUEsS0FBQSxHQUFBdUUsS0FBQS9CLEdBQUEsQ0FDQSxHQUFBZ0MsR0FBQWhDLEVBQUErQixFQUNBQyxHQUFBeEUsTUFBQXFFLEVBQ0FHLEVBQUEzQixPQUFBeUIsRUFDQTVCLEVBQUFZLE9BQ0FaLEVBQUFhLFVBQUFpQixFQUFBaEIsRUFBQVYsRUFBQTBCLEVBQUFmLEVBQUFYLEdBQ0FKLEVBQUFnQixPQUFBYyxFQUFBYixTQUFBLElBQUFDLEtBQUFDLElBQ0FuQixFQUFBb0IsVUFBQVUsRUFBQXRCLE9BQUFtQixFQUFBLEdBQUFDLEVBQUEsRUFBQUQsRUFBQUMsR0FDQUUsRUFBQUMsT0FBQSxHQUNBL0IsRUFBQW9CLFVBQUFVLEVBQUFFLGFBQUFMLEVBQUEsR0FBQUMsRUFBQSxFQUFBRCxFQUFBQyxHQUVBNUIsRUFBQXFCLFVBQ0F2QixFQUFBK0IsR0FBQWYsRUFBQUksS0FBQUksS0FBQVEsRUFBQWIsU0FBQSxJQUFBLElBQUFDLEtBQUFDLElBQUEsR0FBQVcsRUFBQS9CLE1BQUErQixFQUFBaEIsRUFDQWhCLEVBQUErQixHQUFBZCxFQUFBRyxLQUFBSyxLQUFBTyxFQUFBYixTQUFBLElBQUEsSUFBQUMsS0FBQUMsSUFBQSxHQUFBVyxFQUFBL0IsTUFBQStCLEVBQUFmLEdBSUFrQixJQUVBQyxJQUdBLFFBQUFELEtBRUEsSUFBQSxHQUFBdkIsS0FBQUwsSUFDQUEsRUFBQUssR0FBQUksRUFBQSxHQUFBVCxFQUFBSyxHQUFBSSxFQUFBWixFQUFBNUMsT0FBQStDLEVBQUFLLEdBQUFLLEVBQUEsR0FBQVYsRUFBQUssR0FBQUssRUFBQWIsRUFBQUMsU0FDQUUsRUFBQThCLE9BQUF6QixFQUFBLEdBRUFMLEVBQUFLLEdBQUFDLGFBQUEsSUFDQU4sRUFBQUssR0FBQUMsYUFBQSxFQUNBTixFQUFBSyxHQUFBMEIsVUFFQS9CLEVBQUE4QixPQUFBekIsRUFBQSxJQU1BLFFBQUF3QixLQUNBLElBQUEsR0FBQUosS0FBQWhDLEdBQ0EsSUFBQSxHQUFBWSxLQUFBTCxHQUNBLEdBQUEsR0FBQUEsRUFBQUssR0FBQUMsY0FDQU4sRUFBQUssR0FBQW1CLFFBQUEvQixFQUFBZ0MsR0FBQWxDLFNBQUEsQ0FDQSxHQUFBeUMsR0FBQW5CLEtBQUFvQixLQUFBLEdBQUEsR0FBQWpDLEVBQUFLLEdBQUFQLE9BQUEsRUFBQUUsRUFBQUssR0FBQXBELE1BQUEsR0FDQWlGLEdBQUEsSUFBQWxDLEVBQUFLLEdBQUEsVUFBQSxJQUFBUSxLQUFBQyxHQUNBcUIsRUFBQW5DLEVBQUFLLEdBQUFJLEVBQUFaLEVBQUE1QyxNQUFBLElBQUErRSxFQUFBbkIsS0FBQUssSUFBQWdCLEdBQ0FFLEVBQUFwQyxFQUFBSyxHQUFBSyxFQUFBYixFQUFBNUMsTUFBQSxJQUFBK0UsRUFBQW5CLEtBQUFJLElBQUFpQixHQUVBRyxFQUFBNUMsRUFBQWdDLEdBQUFoQixFQUFBWixFQUFBNUMsTUFBQSxJQUNBcUYsRUFBQTdDLEVBQUFnQyxHQUFBZixFQUFBYixFQUFBNUMsTUFBQSxJQWlCQXNGLEVBQUExQixLQUFBb0IsTUFBQUUsRUFBQUUsSUFBQUYsRUFBQUUsSUFBQUQsRUFBQUUsSUFBQUYsRUFBQUUsR0FDQSxJQUFBQyxFQUFBdkMsRUFBQUssR0FBQXBELE1BQUEsRUFBQXdDLEVBQUFnQyxHQUFBeEUsTUFBQSxFQUFBLENBQ0EsR0FBQXVGLEdBQUEsR0FBQUMsT0FBQSxrQ0FDQUQsR0FBQUUsT0FDQWpELEVBQUFnQyxHQUFBa0IsaUJBQ0EzQyxFQUFBSyxHQUFBMEIsWUF4TEF0RSxFQUFBbUYsT0FBQWpGLEVBQUFrRixVQUNBcEYsRUFBQXNCLFdBQUEsQ0FDQSxJQU1BK0QsR0FOQWpELEVBQUFrRCxTQUFBQyxlQUFBLFFBQ0FyRCxFQUFBRSxFQUFBb0QsV0FBQSxNQUVBeEQsRUFBQSxHQUFBeUQsT0FDQWxELEVBQUEsR0FBQWtELE1BSUF4RixHQUFBUSxHQUFBLFdBQUEsV0FDQSxHQUFBaUYsR0FBQXZGLEVBQUF3RixZQUNBLEtBQUEsR0FBQTVCLEtBQUEyQixHQUFBLENBQ0EsR0FBQTFCLEdBQUEwQixFQUFBM0IsRUFDQS9CLEdBQUE0RCxLQUFBLEdBQUFDLFdBQUE3QixFQUFBcEQsU0FBQW9ELEVBQUFoQixFQUFBZ0IsRUFBQWYsRUFBQWUsRUFBQThCLE1BQUE5QixFQUFBYixXQUdBa0MsRUFBQTFELEVBQUFJLEVBQUEsTUFHQTlCLEVBQUFRLEdBQUEsV0FBQSxTQUFBQyxHQUNBLEdBQUFzRCxHQUFBLElBQ0EsS0FBQSxHQUFBK0IsS0FBQS9ELEdBQ0EsR0FBQUosRUFBQUksRUFBQStELEdBQUFyRixLQUNBc0QsRUFBQStCLEVBR0EvRCxHQUFBcUMsT0FBQUwsRUFBQSxLQUdBL0QsRUFBQVEsR0FBQSxpQkFBQSxTQUFBQyxHQUNBLEdBQUFzRCxHQUFBLElBQ0EsS0FBQSxHQUFBK0IsS0FBQS9ELEdBQ0EsR0FBQUosRUFBQUksRUFBQStELEdBQUFyRixLQUNBc0QsRUFBQStCLEVBR0EsT0FBQS9CLEdBQ0FoQyxFQUFBZ0MsR0FBQWdDLHdCQUFBdEYsRUFBQXVGLGVBSUFoRyxFQUFBUSxHQUFBLGFBQUEsU0FBQUMsR0FDQSxHQUFBc0QsR0FBQSxJQUNBLEtBQUEsR0FBQStCLEtBQUEvRCxHQUNBLEdBQUFKLEVBQUFJLEVBQUErRCxHQUFBckYsS0FDQXNELEVBQUErQixFQUdBLElBQUEsTUFBQS9CLEVBQUEsQ0FDQSxHQUFBa0MsR0FBQWxFLEVBQUFnQyxHQUNBUyxHQUFBLEtBQUF5QixFQUFBL0MsU0FBQSxNQUFBLElBQUFDLEtBQUFDLEdBQ0FMLEVBQUFrRCxFQUFBbEQsRUFBQVosRUFBQTVDLE1BQUEsSUFBQTRELEtBQUFLLElBQUFnQixHQUNBeEIsRUFBQWlELEVBQUFqRCxFQUFBYixFQUFBNUMsTUFBQSxJQUFBNEQsS0FBQUksSUFBQWlCLEVBRUEsSUFEQWxDLEVBQUFxRCxLQUFBLEdBQUFPLFFBQUFuRCxFQUFBQyxFQUFBaUQsRUFBQS9DLFNBQUErQyxFQUFBSixNQUFBSSxFQUFBcEUsV0FDQWtDLEVBQUEsR0FBQSxFQUNBLEdBQUFvQyxHQUFBLEdBQUFwQixPQUFBLHlDQUVBLElBQUFvQixHQUFBLEdBQUFwQixPQUFBLG9DQUVBb0IsR0FBQW5CLFVBcUlBbkcsU0FBQUMsT0FBQSxPQUFBMEMsV0FBQSxrQkFBQSxTQUFBLFlBQUEsVUFBQSxnQkFBQSxpQkFBQSxnQkFBQUMsTUNwTUEsSUFBQXlFLFFBQUEsU0FBQW5ELEVBQUFDLEVBQUFFLEVBQUEyQyxFQUFBL0IsR0FDQXNDLEtBQUFyRCxFQUFBQSxFQUNBcUQsS0FBQXBELEVBQUFBLEVBQ0FvRCxLQUFBbEQsU0FBQUEsRUFDQWtELEtBQUEzRCxNQUFBLEdBQUE0RCxPQUNBRCxLQUFBUCxNQUFBQSxFQUNBTyxLQUFBN0csTUFBQSxFQUNBNkcsS0FBQWhFLE9BQUEsRUFDQWdFLEtBQUF0QyxPQUFBQSxFQUNBc0MsS0FBQXpDLGVBQUEsR0FBQTBDLE9BQ0FELEtBQUF4RCxhQUFBLEVBQ0EsVUFBQXdELEtBQUFQLFFBQ0FPLEtBQUFQLE1BQUEsT0FFQU8sS0FBQTNELE1BQUE2RCxJQUFBLDZCQUFBRixLQUFBUCxNQUFBVSxPQUFBLEdBQUFDLGNBQUFKLEtBQUFQLE1BQUFZLE1BQUEsR0FBQSxTQUdBUCxRQUFBUSxVQUFBckMsUUFBQSxXQUNBLEdBQUErQixLQUFBeEQsYUFBQSxFQUFBLENBQ0F3RCxLQUFBeEQsY0FDQSxJQUFBK0QsRUFFQUEsR0FEQVAsS0FBQXhELGFBQUEsRUFDQSxFQUVBLEVBRUF3RCxLQUFBekMsZUFBQTJDLElBQUEsNkJBQUFGLEtBQUFQLE1BQUFVLE9BQUEsR0FBQUMsY0FBQUosS0FBQVAsTUFBQVksTUFBQSxHQUFBLFVBQUFFLEVBQUEsV0FFQVAsTUFBQXpDLGVBQUEyQyxJQUFBLEdDNUJBLElBQUFWLFdBQUEsU0FBQS9ELEVBQUFrQixFQUFBQyxFQUFBNkMsRUFBQTNDLEdBQ0FrRCxLQUFBdkUsU0FBQUEsRUFDQXVFLEtBQUFyRCxFQUFBQSxFQUNBcUQsS0FBQXBELEVBQUFBLEVBQ0FvRCxLQUFBcEUsTUFBQSxFQUNBb0UsS0FBQVAsTUFBQUEsRUFDQU8sS0FBQWxELFNBQUFBLEVBQ0FrRCxLQUFBM0QsTUFBQSxHQUFBNEQsT0FDQUQsS0FBQXBDLE9BQUEsRUFDQW9DLEtBQUE3RyxNQUFBLEVBQ0E2RyxLQUFBaEUsT0FBQSxFQUNBZ0UsS0FBQW5DLFlBQUEsR0FBQW9DLE9BQ0FELEtBQUEzRCxNQUFBNkQsSUFBQSw2QkFBQUYsS0FBQVAsTUFBQSxPQUdBRCxXQUFBYyxVQUFBRSxjQUFBLFNBQUE3RCxFQUFBQyxHQUNBb0QsS0FBQXJELEVBQUFBLEVBQ0FxRCxLQUFBcEQsRUFBQUEsR0FHQTRDLFVBQUFjLFVBQUFHLHNCQUFBLFNBQUE5RCxFQUFBQyxHQUNBb0QsS0FBQXJELEVBQUFxRCxLQUFBckQsRUFBQUEsRUFDQXFELEtBQUFwRCxFQUFBb0QsS0FBQXBELEVBQUFBLEdBR0E0QyxVQUFBYyxVQUFBSSxnQkFBQSxTQUFBQyxHQUNBWCxLQUFBbEQsU0FBQTZELEdBR0FuQixVQUFBYyxVQUFBWCx3QkFBQSxTQUFBZ0IsR0FDQVgsS0FBQWxELFNBQUFrRCxLQUFBbEQsU0FBQTZELEVBQUEsRUFDQVgsS0FBQWxELFNBQUEsT0FDQWtELEtBQUFsRCxTQUFBa0QsS0FBQWxELFNBQUEsS0FFQWtELEtBQUFsRCxTQUFBLE1BQ0FrRCxLQUFBbEQsU0FBQWtELEtBQUFsRCxTQUFBLE1BSUEwQyxVQUFBYyxVQUFBekIsZUFBQSxXQUNBbUIsS0FBQXBDLE9BQUEsSUFDQW9DLEtBQUFwQyxRQUFBLEdBR0FvQyxLQUFBcEMsUUFBQSxHQUFBb0MsS0FBQXBDLE9BQUEsSUFDQW9DLEtBQUFuQyxZQUFBcUMsSUFBQSwwQ0FBQUYsS0FBQXBDLE9BQUEsU0FJQTRCLFVBQUFjLFVBQUFNLGVBQUEsV0FDQVosS0FBQXBDLE9BQUEsSUFDQW9DLEtBQUFwQyxRQUFBLEdBR0FvQyxLQUFBcEMsUUFBQSxHQUFBb0MsS0FBQXBDLE9BQUEsSUFDQW9DLEtBQUFuQyxZQUFBcUMsSUFBQSwwQ0FBQUYsS0FBQXBDLE9BQUEsU0NuREEsV0FDQSxHQUFBL0QsR0FBQSxXQUVBLEdBQUFFLElBQUEsRUFFQStFLEdBQUEsQ0FFQSxRQUNBOUUsVUFBQSxXQUNBLE1BQUFELElBRUFtQixVQUFBLFNBQUEyRixHQUNBOUcsRUFBQThHLEdBRUE5QixVQUFBLFdBQ0EsTUFBQUQsSUFFQTNELFVBQUEsU0FBQTBGLEdBQ0EvQixFQUFBK0IsSUFLQXBJLFNBQUFDLE9BQUEsT0FBQW9JLFFBQUEsa0JBQUFqSCxPQzNCQSxXQUNBLEdBQUFDLEdBQUEsV0FFQSxHQUFBaUgsS0FFQSxRQUNBekIsV0FBQSxXQUNBLE1BQUF5QixJQUVBbEcsV0FBQSxTQUFBbUcsR0FDQUQsRUFBQUMsSUFLQXZJLFNBQUFDLE9BQUEsT0FBQW9JLFFBQUEsaUJBQUFoSCxPQ2ZBLFdBRUEsR0FBQUYsR0FBQSxTQUFBcUgsR0FDQSxZQUVBLElBQUFDLEdBQUFDLEdBQUFDLFFBQUFDLE9BQUFDLFNBQUFDLE1BRUFuSCxFQUFBLFNBQUFvSCxFQUFBQyxHQUNBUCxFQUFBOUcsR0FBQW9ILEVBQUEsV0FDQSxHQUFBRSxHQUFBQyxTQUNBVixHQUFBVyxPQUFBLFdBQ0FILEVBQUFJLE1BQUFYLEVBQUFRLFFBS0F4SCxFQUFBLFNBQUFzSCxFQUFBbkgsRUFBQW9ILEdBQ0FQLEVBQUFoSCxLQUFBc0gsRUFBQW5ILEVBQUEsV0FDQSxHQUFBcUgsR0FBQUMsU0FDQVYsR0FBQVcsT0FBQSxXQUNBSCxHQUNBQSxFQUFBSSxNQUFBWCxFQUFBUSxPQU9BLFFBQ0F0SCxHQUFBQSxFQUNBRixLQUFBQSxFQUNBZ0gsT0FBQUEsR0FJQXpJLFNBQUFDLE9BQUEsT0FBQW9JLFFBQUEsaUJBQUEsYUFBQWxIIiwiZmlsZSI6ImFwcC5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIENyZWF0ZWQgYnkgTWljaGllbCBvbiAyNS8xMS8yMDE1LlxuICovXG4oZnVuY3Rpb24oKXtcblxuICAgIHZhciBhcHAgPSBhbmd1bGFyLm1vZHVsZShcImFwcFwiLFtdKTtcbn0pKCk7IiwiLyoqXHJcbiAqIENyZWF0ZWQgYnkganVzdGlqbmRlcG92ZXIgb24gMTYvMTIvMTUuXHJcbiAqL1xyXG4oZnVuY3Rpb24oKXtcclxuICAgIHZhciBjYW52YXNEaXJlY3RpdmUgPSBmdW5jdGlvbigkd2luZG93KXtcclxuICAgICAgICByZXR1cm57XHJcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnRScsXHJcbiAgICAgICAgICAgIGxpbms6bGluayxcclxuICAgICAgICAgICAgcmVwbGFjZTp0cnVlLFxyXG4gICAgICAgICAgICB0ZW1wbGF0ZTonPGNhbnZhcyBpZD1cImdhbWVcIiBjbGFzcz1cInBsYXlBcmVhXCIgd2lkdGg9XCJ7e3dpZHRofX1cIiBoZWlnaHQ9XCJ7e3dpZHRofX1cIiAvPidcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBsaW5rKHNjb3BlLCBlbGVtZW50LCBhdHRycyl7XHJcbiAgICAgICAgICAgIGlmKCR3aW5kb3cuaW5uZXJXaWR0aCA8ICR3aW5kb3cuaW5uZXJIZWlnaHQpe1xyXG4gICAgICAgICAgICAgICAgc2NvcGUud2lkdGggPSAkd2luZG93LmlubmVyV2lkdGggLSAyMDtcclxuICAgICAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICAgICAgICBzY29wZS53aWR0aCA9ICR3aW5kb3cuaW5uZXJIZWlnaHQgLSAyMDtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgYW5ndWxhci5lbGVtZW50KCR3aW5kb3cpLmJpbmQoJ3Jlc2l6ZScsIGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgICAgICAgICBpZigkd2luZG93LmlubmVyV2lkdGggPCAkd2luZG93LmlubmVySGVpZ2h0KXtcclxuICAgICAgICAgICAgICAgICAgICBzY29wZS53aWR0aCA9ICR3aW5kb3cuaW5uZXJXaWR0aCAtIDIwO1xyXG4gICAgICAgICAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUud2lkdGggPSAkd2luZG93LmlubmVySGVpZ2h0IC0gMjA7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgc2NvcGUuJGRpZ2VzdCgpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG5cclxuICAgIGFuZ3VsYXIubW9kdWxlKCdhcHAnKS5kaXJlY3RpdmUoXCJjYW52YXNEaXJlY3RpdmVcIiwgW1wiJHdpbmRvd1wiLCBjYW52YXNEaXJlY3RpdmVdKTtcclxufSkoKTsiLCIvKipcclxuICogQ3JlYXRlZCBieSBNaWNoaWVsIG9uIDExLzEyLzIwMTUuXHJcbiAqL1xyXG5cclxuKGZ1bmN0aW9uKCl7XHJcbiAgICB2YXIgbG9naW5Db250cm9sbGVyID0gZnVuY3Rpb24oJHNjb3BlLCBzb2NrZXRTZXJ2aWNlLCBkaXNwbGF5U2VydmljZSwgcGxheWVyU2VydmljZSl7XHJcblxyXG4gICAgICAgICRzY29wZS5MQ1Nob3cgPSBkaXNwbGF5U2VydmljZS5nZXRMQ1Nob3c7XHJcblxyXG4gICAgICAgIC8vZnVuY3Rpb25zXHJcbiAgICAgICAgdmFyIG1ha2VSb29tID0gZnVuY3Rpb24oKXtcclxuICAgICAgICAgICAgc29ja2V0U2VydmljZS5lbWl0KFwicGNjb25uZWN0XCIsIG51bGwpO1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgJHNjb3BlLnJvb20gPSBcIlwiO1xyXG4gICAgICAgIHNvY2tldFNlcnZpY2Uub24oJ3JlcXVlc3RSb29tJyxmdW5jdGlvbihkYXRhKXtcclxuICAgICAgICAgICAgJHNjb3BlLnJvb20gPSBkYXRhO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHNvY2tldFNlcnZpY2Uub24oJ2RldmljZU9yaWVudGF0aW9uJywgZnVuY3Rpb24oZGF0YSl7XHJcbiAgICAgICAgICAgIHZhciB1c2VybmFtZSA9IGRhdGEudXNlcm5hbWU7XHJcbiAgICAgICAgICAgIHZhciBkZXZpY2VPcmllbnRhdGlvbiA9IHt9O1xyXG4gICAgICAgICAgICBkZXZpY2VPcmllbnRhdGlvbi5nYW1tYSA9IGRhdGEuZ2FtbWE7XHJcbiAgICAgICAgICAgIGRldmljZU9yaWVudGF0aW9uLmJldGEgPSBkYXRhLmJldGE7XHJcbiAgICAgICAgICAgIGRldmljZU9yaWVudGF0aW9uLmFscGhhID0gZGF0YS5hbHBoYTtcclxuICAgICAgICB9KTtcclxuICAgICAgICAkc2NvcGUudXNlcm5hbWVzID0ge307XHJcbiAgICAgICAgJHNjb3BlLmNoZWNrVXNlckNvdW50ID0gZmFsc2U7XHJcbiAgICAgICAgc29ja2V0U2VydmljZS5vbigndXBkYXRldXNlcnMnLCBmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICBwbGF5ZXJTZXJ2aWNlLnNldFBsYXllcnMoZGF0YSk7XHJcbiAgICAgICAgICAgICRzY29wZS51c2VybmFtZXMgPSBkYXRhO1xyXG4gICAgICAgICAgICAkc2NvcGUuY2hlY2tVc2VyQ291bnQgPSBPYmplY3Qua2V5cygkc2NvcGUudXNlcm5hbWVzKS5sZW5ndGggPCAwO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICAkc2NvcGUuc3RhcnRHYW1lPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHNvY2tldFNlcnZpY2UuZW1pdChcInN0YXJ0R2FtZVwiLCBudWxsKTtcclxuICAgICAgICAgICAgZGlzcGxheVNlcnZpY2Uuc2V0TENTaG93KGZhbHNlKTtcclxuICAgICAgICAgICAgZGlzcGxheVNlcnZpY2Uuc2V0UENTaG93KHRydWUpO1xyXG4gICAgICAgIH07XHJcblxyXG5cclxuICAgICAgICAoZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIG1ha2VSb29tKCk7XHJcbiAgICAgICAgfSkoKTtcclxuXHJcbiAgICB9O1xyXG5cclxuICAgIGFuZ3VsYXIubW9kdWxlKFwiYXBwXCIpLmNvbnRyb2xsZXIoXCJsb2dpbkNvbnRyb2xsZXJcIiwgW1wiJHNjb3BlXCIsIFwic29ja2V0U2VydmljZVwiICwgXCJkaXNwbGF5U2VydmljZVwiLCBcInBsYXllclNlcnZpY2VcIiwgbG9naW5Db250cm9sbGVyXSk7XHJcbn0pKCk7IiwiLyoqXHJcbiAqIENyZWF0ZWQgYnkgTWljaGllbCBvbiAxNi8xMi8yMDE1LlxyXG4gKi9cclxuXHJcbihmdW5jdGlvbigpe1xyXG4gICAgXCJ1c2Ugc3RyaWN0XCI7XHJcbiAgICB2YXIgcGxheUNvbnRyb2xsZXIgPSBmdW5jdGlvbigkc2NvcGUsICRpbnRlcnZhbCwgJHdpbmRvdywgc29ja2V0U2VydmljZSwgZGlzcGxheVNlcnZpY2UsIHBsYXllclNlcnZpY2Upe1xyXG4gICAgICAgICRzY29wZS5QQ1Nob3cgPSBkaXNwbGF5U2VydmljZS5nZXRQQ1Nob3c7XHJcbiAgICAgICAgJHNjb3BlLnN0YXJ0R2FtZSA9IGZhbHNlO1xyXG4gICAgICAgIHZhciBjYW52ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2dhbWUnKTtcclxuICAgICAgICB2YXIgY3R4ID0gY2Fudi5nZXRDb250ZXh0KCcyZCcpO1xyXG5cclxuICAgICAgICB2YXIgQWxsUGxheWVycyA9IG5ldyBBcnJheSgpO1xyXG4gICAgICAgIHZhciBBbGxCdWxsZXRzID0gbmV3IEFycmF5KCk7XHJcblxyXG4gICAgICAgIHZhciBjeWNsZTtcclxuXHJcbiAgICAgICAgc29ja2V0U2VydmljZS5vbihcImluaXRHYW1lXCIsIGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgICAgIHZhciBCdWZmZXJQbGF5ZXIgPSBwbGF5ZXJTZXJ2aWNlLmdldFBsYXllcnMoKTtcclxuICAgICAgICAgICAgZm9yKHZhciBwbGF5ZXIgaW4gQnVmZmVyUGxheWVyKXtcclxuICAgICAgICAgICAgICAgIHZhciBwID0gQnVmZmVyUGxheWVyW3BsYXllcl07XHJcbiAgICAgICAgICAgICAgICBBbGxQbGF5ZXJzLnB1c2gobmV3IFNwYWNlc2hpcChwLnVzZXJuYW1lLCBwLngsIHAueSwgcC5jb2xvciwgcC5yb3RhdGlvbikpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBjeWNsZSA9ICRpbnRlcnZhbChkcmF3LCAxMCk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHNvY2tldFNlcnZpY2Uub24oXCJ1c2VybGVmdFwiLCBmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICB2YXIgcCA9IG51bGw7XHJcbiAgICAgICAgICAgIGZvcih2YXIgaSBpbiBBbGxQbGF5ZXJzKXtcclxuICAgICAgICAgICAgICAgIGlmKGZpbHRlclBsYXllcnMoQWxsUGxheWVyc1tpXSxkYXRhKSA9PSB0cnVlKXtcclxuICAgICAgICAgICAgICAgICAgICBwID0gaTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBBbGxQbGF5ZXJzLnNwbGljZShwLDEpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBzb2NrZXRTZXJ2aWNlLm9uKFwidXBkYXRlR2FtZURhdGFcIiwgZnVuY3Rpb24oZGF0YSl7XHJcbiAgICAgICAgICAgIHZhciBwID0gbnVsbDtcclxuICAgICAgICAgICAgZm9yKHZhciBpIGluIEFsbFBsYXllcnMpe1xyXG4gICAgICAgICAgICAgICAgaWYoZmlsdGVyUGxheWVycyhBbGxQbGF5ZXJzW2ldLGRhdGEpID09IHRydWUpe1xyXG4gICAgICAgICAgICAgICAgICAgIHAgPSBpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmKHAgIT0gbnVsbCl7XHJcbiAgICAgICAgICAgICAgICBBbGxQbGF5ZXJzW3BdLnJvdGF0ZVNwYWNlc2hpcFJlbGF0aXZlKGRhdGEub3JpZW50YXRpb24pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHNvY2tldFNlcnZpY2Uub24oXCJwbGF5ZXJTaG90XCIsIGZ1bmN0aW9uKGRhdGEpe1xyXG4gICAgICAgICAgICB2YXIgcCA9IG51bGw7XHJcbiAgICAgICAgICAgIGZvcih2YXIgaSBpbiBBbGxQbGF5ZXJzKXtcclxuICAgICAgICAgICAgICAgIGlmKGZpbHRlclBsYXllcnMoQWxsUGxheWVyc1tpXSxkYXRhKSA9PSB0cnVlKXtcclxuICAgICAgICAgICAgICAgICAgICBwID0gaTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZihwICE9IG51bGwpe1xyXG4gICAgICAgICAgICAgICAgdmFyIHRlbXAgPSBBbGxQbGF5ZXJzW3BdO1xyXG4gICAgICAgICAgICAgICAgdmFyIGFuZ2xlID0gKDM2MCAtKHRlbXAucm90YXRpb24gKyAxODApKS8xODAqTWF0aC5QSTtcclxuICAgICAgICAgICAgICAgIHZhciB4ID0gdGVtcC54ICsgKGNhbnYud2lkdGgvNDAwICogTWF0aC5zaW4oYW5nbGUpKTtcclxuICAgICAgICAgICAgICAgIHZhciB5ID0gdGVtcC55ICsgKGNhbnYud2lkdGgvNDAwICogTWF0aC5jb3MoYW5nbGUpKTtcclxuICAgICAgICAgICAgICAgIEFsbEJ1bGxldHMucHVzaChuZXcgQnVsbGV0KHgsIHksIHRlbXAucm90YXRpb24sIHRlbXAuY29sb3IsIHRlbXAudXNlck5hbWUpKTtcclxuICAgICAgICAgICAgICAgIGlmKHAlMiA9PSAwKXtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgc2hvdCA9IG5ldyBBdWRpbygnLi4vLi4vYXNzZXRzL0JvbnVzL3NmeF9sYXNlcjEub2dnJyk7XHJcbiAgICAgICAgICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgc2hvdCA9IG5ldyBBdWRpbygnLi4vLi4vYXNzZXRzL0JvbnVzL3NmeF9sYXNlcjIub2dnJyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBzaG90LnBsYXkoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBmaWx0ZXJQbGF5ZXJzKG9iaixkYXRhKXtcclxuICAgICAgICAgICAgaWYoZGF0YS51c2VybmFtZSA9PSBvYmoudXNlck5hbWUpe1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgIH1lbHNle1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBkcmF3KCl7XHJcbiAgICAgICAgICAgIGlmKEFsbFBsYXllcnMubGVuZ3RoPjApe1xyXG4gICAgICAgICAgICAgICAgQWxsUGxheWVyc1swXS5zcGVlZCA9IDA7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY3R4LmNsZWFyUmVjdCgwLDAsY2Fudi53aWR0aCwgY2Fudi5oZWlnaHQpO1xyXG4gICAgICAgICAgICB2YXIgcmF0aW8gPSBjYW52LndpZHRoLzEwMDtcclxuXHJcbiAgICAgICAgICAgIGlmKEFsbEJ1bGxldHMubGVuZ3RoICE9IDApe1xyXG4gICAgICAgICAgICAgICAgdmFyIEJ1bGxldFdpZHRoID0gY2Fudi53aWR0aC8xMDA7XHJcbiAgICAgICAgICAgICAgICB2YXIgQnVsbGV0SGVpZ2h0ID0gQnVsbGV0V2lkdGggKiBBbGxCdWxsZXRzWzBdLmltYWdlLmhlaWdodC9BbGxCdWxsZXRzWzBdLmltYWdlLndpZHRoO1xyXG5cclxuICAgICAgICAgICAgICAgIGZvcih2YXIgYnVsbGV0IGluIEFsbEJ1bGxldHMpe1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBiID0gQWxsQnVsbGV0c1tidWxsZXRdO1xyXG4gICAgICAgICAgICAgICAgICAgIGIud2lkdGggPSBCdWxsZXRXaWR0aDtcclxuICAgICAgICAgICAgICAgICAgICBiLmhlaWdodCA9IEJ1bGxldEhlaWdodDtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYoYi5leHBsb2RlU3RhZ2UgPT0gMCl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vRHJhdyBidWxsZXRcclxuICAgICAgICAgICAgICAgICAgICAgICAgY3R4LnNhdmUoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY3R4LnRyYW5zbGF0ZShiLngqcmF0aW8sIGIueSpyYXRpbyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5yb3RhdGUoYi5yb3RhdGlvbi8xODAqTWF0aC5QSSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5kcmF3SW1hZ2UoYi5pbWFnZSwgLUJ1bGxldFdpZHRoLzIsIC1CdWxsZXRIZWlnaHQvMiwgQnVsbGV0V2lkdGgsIEJ1bGxldEhlaWdodCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5yZXN0b3JlKCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBBbGxCdWxsZXRzW2J1bGxldF0ueCA9IE1hdGguY29zKChiLnJvdGF0aW9uIC0gOTApLzE4MCpNYXRoLlBJKSArIGIueDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgQWxsQnVsbGV0c1tidWxsZXRdLnkgPSBNYXRoLnNpbigoYi5yb3RhdGlvbiAtIDkwKS8xODAqTWF0aC5QSSkrIGIueTtcclxuICAgICAgICAgICAgICAgICAgICB9ZWxzZSBpZihiLmV4cGxvZGVTdGFnZSA8IDQpe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvL0RyYXcgZXhwbG9zaW9uXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGIuZXhwbG9zaW9uSW1hZ2UpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjdHguc2F2ZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjdHgudHJhbnNsYXRlKGIueCpyYXRpbywgYi55KnJhdGlvKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY3R4LmRyYXdJbWFnZShiLmV4cGxvc2lvbkltYWdlLCAtQnVsbGV0V2lkdGgsIC1CdWxsZXRXaWR0aCwgQnVsbGV0V2lkdGgqMiwgQnVsbGV0V2lkdGgqMik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5yZXN0b3JlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZihBbGxQbGF5ZXJzLmxlbmd0aCAhPSAwKXtcclxuICAgICAgICAgICAgICAgIHZhciBTcGFjZXNoaXBXaWR0aCA9IGNhbnYud2lkdGgvMjA7XHJcbiAgICAgICAgICAgICAgICB2YXIgU3BhY2VzaGlwSGVpZ2h0ID0gU3BhY2VzaGlwV2lkdGggKiBBbGxQbGF5ZXJzWzBdLmltYWdlLmhlaWdodC8gQWxsUGxheWVyc1swXS5pbWFnZS53aWR0aDtcclxuXHJcbiAgICAgICAgICAgICAgICBmb3IodmFyIHBsYXllciBpbiBBbGxQbGF5ZXJzKXtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgcCA9IEFsbFBsYXllcnNbcGxheWVyXTtcclxuICAgICAgICAgICAgICAgICAgICBwLndpZHRoID0gU3BhY2VzaGlwV2lkdGg7XHJcbiAgICAgICAgICAgICAgICAgICAgcC5oZWlnaHQgPSBTcGFjZXNoaXBIZWlnaHQ7XHJcbiAgICAgICAgICAgICAgICAgICAgY3R4LnNhdmUoKTtcclxuICAgICAgICAgICAgICAgICAgICBjdHgudHJhbnNsYXRlKHAueCpyYXRpbywgcC55KnJhdGlvKTtcclxuICAgICAgICAgICAgICAgICAgICBjdHgucm90YXRlKHAucm90YXRpb24vMTgwKk1hdGguUEkpO1xyXG4gICAgICAgICAgICAgICAgICAgIGN0eC5kcmF3SW1hZ2UocC5pbWFnZSwgLVNwYWNlc2hpcFdpZHRoLzIsIC1TcGFjZXNoaXBIZWlnaHQvMiwgU3BhY2VzaGlwV2lkdGgsIFNwYWNlc2hpcEhlaWdodCk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYocC5kYW1hZ2UgPiAwKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY3R4LmRyYXdJbWFnZShwLmRhbWFnZUltYWdlLCAtU3BhY2VzaGlwV2lkdGgvMiwgLVNwYWNlc2hpcEhlaWdodC8yLCBTcGFjZXNoaXBXaWR0aCwgU3BhY2VzaGlwSGVpZ2h0KTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgY3R4LnJlc3RvcmUoKTtcclxuICAgICAgICAgICAgICAgICAgICBBbGxQbGF5ZXJzW3BsYXllcl0ueCA9IE1hdGguY29zKChwLnJvdGF0aW9uIC0gOTApLzE4MCpNYXRoLlBJKS8xMCogcC5zcGVlZCArIHAueDtcclxuICAgICAgICAgICAgICAgICAgICBBbGxQbGF5ZXJzW3BsYXllcl0ueSA9IE1hdGguc2luKChwLnJvdGF0aW9uIC0gOTApLzE4MCpNYXRoLlBJKS8xMCogcC5zcGVlZCArIHAueTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgY2hlY2tCdWxsZXRzKCk7XHJcblxyXG4gICAgICAgICAgICBjb2xsaXNpb25EZXRlY3Rpb24oKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGNoZWNrQnVsbGV0cygpe1xyXG5cclxuICAgICAgICAgICAgZm9yKHZhciBiIGluIEFsbEJ1bGxldHMpe1xyXG4gICAgICAgICAgICAgICAgaWYoQWxsQnVsbGV0c1tiXS54IDwgMCB8fCBBbGxCdWxsZXRzW2JdLnggPiBjYW52LndpZHRoIHx8IEFsbEJ1bGxldHNbYl0ueSA8IDAgfHwgQWxsQnVsbGV0c1tiXS55ID4gY2Fudi5oZWlnaHQpe1xyXG4gICAgICAgICAgICAgICAgICAgIEFsbEJ1bGxldHMuc3BsaWNlKGIsIDEpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYoQWxsQnVsbGV0c1tiXS5leHBsb2RlU3RhZ2UgPjApIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoQWxsQnVsbGV0c1tiXS5leHBsb2RlU3RhZ2UgPCA0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIEFsbEJ1bGxldHNbYl0uZXhwbG9kZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIEFsbEJ1bGxldHMuc3BsaWNlKGIsIDEpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gY29sbGlzaW9uRGV0ZWN0aW9uKCl7XHJcbiAgICAgICAgICAgIGZvcih2YXIgcCBpbiBBbGxQbGF5ZXJzKXtcclxuICAgICAgICAgICAgICAgIGZvcih2YXIgYiBpbiBBbGxCdWxsZXRzKXtcclxuICAgICAgICAgICAgICAgICAgICBpZihBbGxCdWxsZXRzW2JdLmV4cGxvZGVTdGFnZSA9PSAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChBbGxCdWxsZXRzW2JdLnBsYXllciAhPSBBbGxQbGF5ZXJzW3BdLnVzZXJOYW1lKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgcmFkaXVzID0gTWF0aC5zcXJ0KDIpIC8gMiAqIChBbGxCdWxsZXRzW2JdLmhlaWdodCAvIDIgLSBBbGxCdWxsZXRzW2JdLndpZHRoIC8gMik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgYW5nbGUgPSAoMzYwIC0gKEFsbEJ1bGxldHNbYl0ucm90YXRpb24pKSAvIDE4MCAqIE1hdGguUEk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgYnVsbGV0SGVhZFggPSAoQWxsQnVsbGV0c1tiXS54ICogY2Fudi53aWR0aCAvIDEwMCAtIChyYWRpdXMgKiBNYXRoLnNpbihhbmdsZSkpKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBidWxsZXRIZWFkWSA9IChBbGxCdWxsZXRzW2JdLnkgKiBjYW52LndpZHRoIC8gMTAwIC0gKHJhZGl1cyAqIE1hdGguY29zKGFuZ2xlKSkpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzcGFjZVNoaXBYID0gQWxsUGxheWVyc1twXS54ICogY2Fudi53aWR0aCAvIDEwMDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzcGFjZVNoaXBZID0gQWxsUGxheWVyc1twXS55ICogY2Fudi53aWR0aCAvIDEwMDtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvKmN0eC5zYXZlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3R4LmJlZ2luUGF0aCgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5hcmMoc3BhY2VTaGlwWCwgc3BhY2VTaGlwWSwgQWxsUGxheWVyc1twXS53aWR0aC8yLCAwLCBNYXRoLlBJKjIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5saW5lV2lkdGggPSAxO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5zdHJva2VTdHlsZSA9ICcjMDAwMEZGJztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdHguc3Ryb2tlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3R4LnJlc3RvcmUoKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3R4LnNhdmUoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdHguYmVnaW5QYXRoKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3R4LmFyYyhidWxsZXRIZWFkWCwgYnVsbGV0SGVhZFksIEFsbEJ1bGxldHNbYl0ud2lkdGgvMiwgMCwgTWF0aC5QSSoyKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdHgubGluZVdpZHRoID0gMTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdHguc3Ryb2tlU3R5bGUgPSAnI0ZGMDAwMCc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3R4LnN0cm9rZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5yZXN0b3JlKCk7Ki9cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBkaXN0YW5jZSA9IE1hdGguc3FydCgoYnVsbGV0SGVhZFggLSBzcGFjZVNoaXBYKSAqIChidWxsZXRIZWFkWCAtIHNwYWNlU2hpcFgpICsgKGJ1bGxldEhlYWRZIC0gc3BhY2VTaGlwWSkgKiAoYnVsbGV0SGVhZFkgLSBzcGFjZVNoaXBZKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGlzdGFuY2UgPCAoQWxsQnVsbGV0c1tiXS53aWR0aCAvIDIgKyBBbGxQbGF5ZXJzW3BdLndpZHRoIC8gMikpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZGFtYWdlc291bmQgPSBuZXcgQXVkaW8oJy4uLy4uL2Fzc2V0cy9Cb251cy9zZnhfbG9zZS5vZ2cnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYW1hZ2Vzb3VuZC5wbGF5KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQWxsUGxheWVyc1twXS5pbmNyZWFzZURhbWFnZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEFsbEJ1bGxldHNbYl0uZXhwbG9kZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuXHJcbiAgICBhbmd1bGFyLm1vZHVsZShcImFwcFwiKS5jb250cm9sbGVyKFwicGxheUNvbnRyb2xsZXJcIiwgW1wiJHNjb3BlXCIsIFwiJGludGVydmFsXCIsIFwiJHdpbmRvd1wiLCBcInNvY2tldFNlcnZpY2VcIiwgXCJkaXNwbGF5U2VydmljZVwiLCBcInBsYXllclNlcnZpY2VcIiwgcGxheUNvbnRyb2xsZXJdKVxyXG59KSgpOyIsIi8qKlxyXG4gKiBDcmVhdGVkIGJ5IGp1c3Rpam5kZXBvdmVyIG9uIDIyLzEyLzE1LlxyXG4gKi9cclxuXHJcbnZhciBCdWxsZXQgPSBmdW5jdGlvbih4LCB5LHJvdGF0aW9uLCBjb2xvciwgcGxheWVyKXtcclxuICAgIHRoaXMueCA9IHg7XHJcbiAgICB0aGlzLnkgPSB5O1xyXG4gICAgdGhpcy5yb3RhdGlvbiA9IHJvdGF0aW9uO1xyXG4gICAgdGhpcy5pbWFnZSA9IG5ldyBJbWFnZSgpO1xyXG4gICAgdGhpcy5jb2xvciA9IGNvbG9yO1xyXG4gICAgdGhpcy53aWR0aCA9IDA7XHJcbiAgICB0aGlzLmhlaWdodCA9IDA7XHJcbiAgICB0aGlzLnBsYXllciA9IHBsYXllcjtcclxuICAgIHRoaXMuZXhwbG9zaW9uSW1hZ2UgPSBuZXcgSW1hZ2UoKTtcclxuICAgIHRoaXMuZXhwbG9kZVN0YWdlID0gMDtcclxuICAgIGlmKHRoaXMuY29sb3IgPT0gXCJvcmFuZ2VcIil7XHJcbiAgICAgICAgdGhpcy5jb2xvciA9ICdyZWQnO1xyXG4gICAgfVxyXG4gICAgdGhpcy5pbWFnZS5zcmMgPSAnLi4vYXNzZXRzL1BORy9MYXNlcnMvbGFzZXInKyB0aGlzLmNvbG9yLmNoYXJBdCgwKS50b1VwcGVyQ2FzZSgpICsgdGhpcy5jb2xvci5zbGljZSgxKSArJzAxLnBuZydcclxufTtcclxuXHJcbkJ1bGxldC5wcm90b3R5cGUuZXhwbG9kZSA9IGZ1bmN0aW9uKCl7XHJcbiAgICBpZih0aGlzLmV4cGxvZGVTdGFnZSA8IDQpe1xyXG4gICAgICAgIHRoaXMuZXhwbG9kZVN0YWdlKys7XHJcbiAgICAgICAgdmFyIG51bWJlcjtcclxuICAgICAgICBpZih0aGlzLmV4cGxvZGVTdGFnZSA8IDMpe1xyXG4gICAgICAgICAgIG51bWJlciA9IDFcclxuICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgbnVtYmVyID0gMlxyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmV4cGxvc2lvbkltYWdlLnNyYyA9ICcuLi9hc3NldHMvUE5HL0xhc2Vycy9sYXNlcicgKyB0aGlzLmNvbG9yLmNoYXJBdCgwKS50b1VwcGVyQ2FzZSgpICsgdGhpcy5jb2xvci5zbGljZSgxKSArICdFeHBsb2RlJysgbnVtYmVyICsnLnBuZyc7XHJcbiAgICB9ZWxzZXtcclxuICAgICAgICB0aGlzLmV4cGxvc2lvbkltYWdlLnNyYyA9ICcnO1xyXG4gICAgfVxyXG59O1xyXG4iLCIvKipcclxuICogQ3JlYXRlZCBieSBqdXN0aWpuZGVwb3ZlciBvbiAwOS8xMi8xNS5cclxuICovXHJcblxyXG52YXIgU3BhY2VzaGlwID0gZnVuY3Rpb24odXNlck5hbWUsIHgsIHksIGNvbG9yLCByb3RhdGlvbil7XHJcbiAgICB0aGlzLnVzZXJOYW1lID0gdXNlck5hbWU7XHJcbiAgICB0aGlzLnggPSB4O1xyXG4gICAgdGhpcy55ID0geTtcclxuICAgIHRoaXMuc3BlZWQgPSAxO1xyXG4gICAgdGhpcy5jb2xvciA9IGNvbG9yO1xyXG4gICAgdGhpcy5yb3RhdGlvbiA9IHJvdGF0aW9uO1xyXG4gICAgdGhpcy5pbWFnZSA9IG5ldyBJbWFnZSgpO1xyXG4gICAgdGhpcy5kYW1hZ2UgPSAwO1xyXG4gICAgdGhpcy53aWR0aCA9IDA7XHJcbiAgICB0aGlzLmhlaWdodCA9IDA7XHJcbiAgICB0aGlzLmRhbWFnZUltYWdlID0gbmV3IEltYWdlKCk7XHJcbiAgICB0aGlzLmltYWdlLnNyYyA9ICcuLi9hc3NldHMvUE5HL3BsYXllclNoaXAxXycrIHRoaXMuY29sb3IgKycucG5nJ1xyXG59O1xyXG5cclxuU3BhY2VzaGlwLnByb3RvdHlwZS5tb3ZlU3BhY2VzaGlwID0gZnVuY3Rpb24oeCwgeSl7XHJcbiAgICB0aGlzLnggPSB4O1xyXG4gICAgdGhpcy55ID0geTtcclxufTtcclxuXHJcblNwYWNlc2hpcC5wcm90b3R5cGUubW92ZVNwYWNlc2hpcFJlbGF0aXZlID0gZnVuY3Rpb24oeCwgeSl7XHJcbiAgICB0aGlzLnggPSB0aGlzLngreDtcclxuICAgIHRoaXMueSA9IHRoaXMueSt5O1xyXG59O1xyXG5cclxuU3BhY2VzaGlwLnByb3RvdHlwZS5yb3RhdGVTcGFjZXNoaXAgPSBmdW5jdGlvbihkZWdyZWUpe1xyXG4gICAgdGhpcy5yb3RhdGlvbiA9IGRlZ3JlZTtcclxufTtcclxuXHJcblNwYWNlc2hpcC5wcm90b3R5cGUucm90YXRlU3BhY2VzaGlwUmVsYXRpdmUgPSBmdW5jdGlvbihkZWdyZWUpe1xyXG4gICAgdGhpcy5yb3RhdGlvbiA9IHRoaXMucm90YXRpb24gKyBkZWdyZWUvNTtcclxuICAgIGlmKHRoaXMucm90YXRpb24gPCAtMzYwKXtcclxuICAgICAgICB0aGlzLnJvdGF0aW9uID0gdGhpcy5yb3RhdGlvbiArIDcyMDtcclxuICAgIH1cclxuICAgIGlmKHRoaXMucm90YXRpb24gPiAzNjApe1xyXG4gICAgICAgIHRoaXMucm90YXRpb24gPSB0aGlzLnJvdGF0aW9uIC0gNzIwO1xyXG4gICAgfVxyXG59O1xyXG5cclxuU3BhY2VzaGlwLnByb3RvdHlwZS5pbmNyZWFzZURhbWFnZSA9IGZ1bmN0aW9uKCl7XHJcbiAgICBpZih0aGlzLmRhbWFnZSA8IDQpe1xyXG4gICAgICAgIHRoaXMuZGFtYWdlICs9IDE7XHJcbiAgICB9XHJcblxyXG4gICAgaWYodGhpcy5kYW1hZ2UgPD0gMyAmJiB0aGlzLmRhbWFnZSA+IDApe1xyXG4gICAgICAgIHRoaXMuZGFtYWdlSW1hZ2Uuc3JjID0gJy4uL2Fzc2V0cy9QTkcvRGFtYWdlL3BsYXllclNoaXAxX2RhbWFnZScrIHRoaXMuZGFtYWdlICsgJy5wbmcnO1xyXG4gICAgfVxyXG59O1xyXG5cclxuU3BhY2VzaGlwLnByb3RvdHlwZS5kZWNyZWFzZURhbWFnZSA9IGZ1bmN0aW9uKCl7XHJcbiAgICBpZih0aGlzLmRhbWFnZSA+IDApe1xyXG4gICAgICAgIHRoaXMuZGFtYWdlIC09IDE7XHJcbiAgICB9XHJcblxyXG4gICAgaWYodGhpcy5kYW1hZ2UgPD0gMyAmJiB0aGlzLmRhbWFnZSA+IDApe1xyXG4gICAgICAgIHRoaXMuZGFtYWdlSW1hZ2Uuc3JjID0gJy4uL2Fzc2V0cy9QTkcvRGFtYWdlL3BsYXllclNoaXAxX2RhbWFnZScrIHRoaXMuZGFtYWdlICsgJy5wbmcnO1xyXG4gICAgfVxyXG59O1xyXG5cclxuIiwiLyoqXHJcbiAqIENyZWF0ZWQgYnkgTWljaGllbCBvbiAxNi8xMi8yMDE1LlxyXG4gKi9cclxuLyoqXHJcbiAqIENyZWF0ZWQgYnkganVzdGlqbmRlcG92ZXIgb24gMTYvMTIvMTUuXHJcbiAqL1xyXG5cclxuXHJcbihmdW5jdGlvbigpe1xyXG4gICAgdmFyIGRpc3BsYXlTZXJ2aWNlID0gZnVuY3Rpb24oKXtcclxuICAgICAgICAvL0xvZ2luIENvbnRyb2xsZXJcclxuICAgICAgICB2YXIgTENTaG93ID0gdHJ1ZTtcclxuICAgICAgICAvL1BsYXkgY29udHJvbGxlclxyXG4gICAgICAgIHZhciBQQ1Nob3cgPSBmYWxzZTtcclxuXHJcbiAgICAgICAgcmV0dXJue1xyXG4gICAgICAgICAgICBnZXRMQ1Nob3c6IGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gTENTaG93O1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBzZXRMQ1Nob3c6IGZ1bmN0aW9uKHZhbHVlKXtcclxuICAgICAgICAgICAgICAgIExDU2hvdyA9IHZhbHVlO1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBnZXRQQ1Nob3c6IGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gUENTaG93O1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBzZXRQQ1Nob3c6IGZ1bmN0aW9uKHZhbHVlKXtcclxuICAgICAgICAgICAgICAgIFBDU2hvdyA9IHZhbHVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuXHJcbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwJykuZmFjdG9yeSgnZGlzcGxheVNlcnZpY2UnLCBbZGlzcGxheVNlcnZpY2VdKTtcclxufSkoKTsiLCIvKipcclxuICogQ3JlYXRlZCBieSBqdXN0aWpuZGVwb3ZlciBvbiAxNy8xMi8xNS5cclxuICovXHJcblxyXG4oZnVuY3Rpb24oKXtcclxuICAgIHZhciBwbGF5ZXJTZXJ2aWNlID0gZnVuY3Rpb24oKXtcclxuICAgICAgICAvL0xvZ2luIENvbnRyb2xsZXJcclxuICAgICAgICB2YXIgcGxheWVycyA9IFtdO1xyXG5cclxuICAgICAgICByZXR1cm57XHJcbiAgICAgICAgICAgIGdldFBsYXllcnM6IGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gcGxheWVycztcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgc2V0UGxheWVyczogZnVuY3Rpb24ocGxheWVyc0FycmF5KXtcclxuICAgICAgICAgICAgICAgIHBsYXllcnMgPSBwbGF5ZXJzQXJyYXk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9O1xyXG5cclxuICAgIGFuZ3VsYXIubW9kdWxlKCdhcHAnKS5mYWN0b3J5KCdwbGF5ZXJTZXJ2aWNlJywgW3BsYXllclNlcnZpY2VdKTtcclxufSkoKTsiLCIvKipcclxuICogQ3JlYXRlZCBieSBqdXN0aWpuZGVwb3ZlciBvbiAwOS8xMi8xNS5cclxuICovXHJcblxyXG4oZnVuY3Rpb24oKXtcclxuXHJcbiAgICB2YXIgc29ja2V0U2VydmljZSA9IGZ1bmN0aW9uKCRyb290U2NvcGUpe1xyXG4gICAgICAgIFwidXNlIHN0cmljdFwiO1xyXG4gICAgICAgIC8vcHJpdmF0ZVxyXG4gICAgICAgIHZhciBzb2NrZXQgPSBpby5jb25uZWN0KHdpbmRvdy5sb2NhdGlvbi5ob3N0KTtcclxuICAgICAgICAvL2Z1bmN0aW9uc1xyXG4gICAgICAgIHZhciBvbiA9IGZ1bmN0aW9uIChldmVudE5hbWUsIGNhbGxiYWNrKSB7XHJcbiAgICAgICAgICAgIHNvY2tldC5vbihldmVudE5hbWUsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIHZhciBhcmdzID0gYXJndW1lbnRzO1xyXG4gICAgICAgICAgICAgICAgJHJvb3RTY29wZS4kYXBwbHkoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrLmFwcGx5KHNvY2tldCwgYXJncyk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGVtaXQgPSBmdW5jdGlvbiAoZXZlbnROYW1lLCBkYXRhLCBjYWxsYmFjaykge1xyXG4gICAgICAgICAgICBzb2NrZXQuZW1pdChldmVudE5hbWUsIGRhdGEsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIHZhciBhcmdzID0gYXJndW1lbnRzO1xyXG4gICAgICAgICAgICAgICAgJHJvb3RTY29wZS4kYXBwbHkoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChjYWxsYmFjaykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFjay5hcHBseShzb2NrZXQsIGFyZ3MpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIC8vcHVibGljXHJcbiAgICAgICAgcmV0dXJue1xyXG4gICAgICAgICAgICBvbjogb24sXHJcbiAgICAgICAgICAgIGVtaXQ6IGVtaXQsXHJcbiAgICAgICAgICAgIHNvY2tldDogc29ja2V0XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuXHJcbiAgICBhbmd1bGFyLm1vZHVsZShcImFwcFwiKS5mYWN0b3J5KFwic29ja2V0U2VydmljZVwiLCBbXCIkcm9vdFNjb3BlXCIsIHNvY2tldFNlcnZpY2VdKTtcclxuXHJcbn0pKCk7Il0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
