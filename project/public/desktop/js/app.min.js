!function(){angular.module("app",[])}(),function(){var e=function(e,t,a,i){e.LCShow=a.getLCShow;var o=function(){t.emit("pcconnect",null)};e.room="",t.on("requestRoom",function(t){e.room=t}),t.on("deviceOrientation",function(e){var t=(e.username,{});t.gamma=e.gamma,t.beta=e.beta,t.alpha=e.alpha}),e.usernames={},e.checkUserCount=!1,t.on("updateusers",function(t){i.setPlayers(t),e.usernames=t,e.checkUserCount=Object.keys(e.usernames).length<0}),e.startGame=function(){t.emit("startGame",null),a.setLCShow(!1),a.setPCShow(!0)},function(){o()}()};angular.module("app").controller("loginController",["$scope","socketService","displayService","playerService",e])}(),function(){"use strict";var e=function(e,t,a,i,o,n){function r(e,t){return t.username==e.userName?!0:!1}function s(){u[0].speed=0,g.clearRect(0,0,p.width,p.height);var e=p.width/100;if(0!=d.length){var t=p.width/100,a=t*d[0].image.height/d[0].image.width;for(var i in d){var o=d[i];o.width=t,o.height=a,0==o.explodeStage?(g.save(),g.translate(o.x*e,o.y*e),g.rotate(o.rotation/180*Math.PI),g.drawImage(o.image,-t/2,-a/2,t,a),g.restore(),d[i].x=Math.cos((o.rotation-90)/180*Math.PI)+o.x,d[i].y=Math.sin((o.rotation-90)/180*Math.PI)+o.y):o.explodeStage<4&&(console.log(o.explosionImage),g.save(),g.translate(o.x*e,o.y*e),g.drawImage(o.explosionImage,-t,-t,2*t,2*t),g.restore())}}if(0!=u.length){var n=p.width/20,r=n*u[0].image.height/u[0].image.width;for(var s in u){var l=u[s];l.width=n,l.height=r,g.save(),g.translate(l.x*e,l.y*e),g.rotate(l.rotation/180*Math.PI),g.drawImage(l.image,-n/2,-r/2,n,r),l.damage>0&&g.drawImage(l.damageImage,-n/2,-r/2,n,r),g.restore(),u[s].x=Math.cos((l.rotation-90)/180*Math.PI)/10*l.speed+l.x,u[s].y=Math.sin((l.rotation-90)/180*Math.PI)/10*l.speed+l.y}}h(),c()}function h(){for(var e in d)(d[e].x<0||d[e].x>p.width||d[e].y<0||d[e].y>p.height)&&d.splice(e,1)}function c(){for(var e in u)for(var t in d)if(d[t].player!=u[e].userName){var a=Math.sqrt(2)/2*(d[t].height/2-d[t].width/2),i=(360-d[t].rotation)/180*Math.PI,o=d[t].x*p.width/100-a*Math.sin(i),n=d[t].y*p.width/100-a*Math.cos(i),r=u[e].x*p.width/100,s=u[e].y*p.width/100,h=Math.sqrt((o-r)*(o-r)+(n-s)*(n-s));if(h<d[t].width/2+u[e].width/2){var c=new Audio("../../assets/Bonus/sfx_lose.ogg");c.play(),u[e].increaseDamage(),d[t].explodeStage<4?d[t].explode():d.splice(t,1)}}}e.PCShow=o.getPCShow,e.startGame=!1;var l,p=document.getElementById("game"),g=p.getContext("2d"),u=new Array,d=new Array;i.on("initGame",function(){var e=n.getPlayers();for(var a in e){var i=e[a];u.push(new Spaceship(i.username,i.x,i.y,i.color,i.rotation))}l=t(s,10)}),i.on("updateGameData",function(e){var t=null;for(var a in u)1==r(u[a],e)&&(t=a);null!=t&&u[t].rotateSpaceshipRelative(e.orientation)}),i.on("playerShot",function(e){var t=null;for(var a in u)1==r(u[a],e)&&(t=a);if(null!=t){var i=u[t],o=(360-(i.rotation+180))/180*Math.PI,n=i.x+p.width/400*Math.sin(o),s=i.y+p.width/400*Math.cos(o);if(d.push(new Bullet(n,s,i.rotation,i.color,i.userName)),t%2==0)var h=new Audio("../../assets/Bonus/sfx_laser1.ogg");else var h=new Audio("../../assets/Bonus/sfx_laser2.ogg");h.play()}})};angular.module("app").controller("playController",["$scope","$interval","$window","socketService","displayService","playerService",e])}();var Bullet=function(e,t,a,i,o){this.x=e,this.y=t,this.rotation=a,this.image=new Image,this.color=i,this.width=0,this.height=0,this.player=o,this.explosionImage=new Image,this.shieldImage=new Image,shieldImage.src=this.explodeStage=0,"orange"==this.color&&(this.color="red"),this.image.src="../assets/PNG/Lasers/laser"+this.color.charAt(0).toUpperCase()+this.color.slice(1)+"01.png"};Bullet.prototype.explode=function(){if(this.explodeStage<4){this.explodeStage++;var e;e=this.explodeStage<3?1:2,this.explosionImage.src="../assets/PNG/Lasers/laser"+this.color.charAt(0).toUpperCase()+this.color.slice(1)+"Explode"+e+".png"}else this.explosionImage.src=""};var Spaceship=function(e,t,a,i,o){this.userName=e,this.x=t,this.y=a,this.speed=1,this.color=i,this.rotation=o,this.image=new Image,this.damage=0,this.width=0,this.height=0,this.damageImage=new Image,this.image.src="../assets/PNG/playerShip1_"+this.color+".png"};Spaceship.prototype.moveSpaceship=function(e,t){this.x=e,this.y=t},Spaceship.prototype.moveSpaceshipRelative=function(e,t){this.x=this.x+e,this.y=this.y+t},Spaceship.prototype.rotateSpaceship=function(e){this.rotation=e},Spaceship.prototype.rotateSpaceshipRelative=function(e){this.rotation=this.rotation+e/5,this.rotation<-360&&(this.rotation=this.rotation+720),this.rotation>360&&(this.rotation=this.rotation-720)},Spaceship.prototype.increaseDamage=function(){this.damage<4&&(this.damage+=1),this.damage<=3&&this.damage>0&&(this.damageImage.src="../assets/PNG/Damage/playerShip1_damage"+this.damage+".png")},Spaceship.prototype.decreaseDamage=function(){this.damage>0&&(this.damage-=1),this.damage<=3&&this.damage>0&&(this.damageImage.src="../assets/PNG/Damage/playerShip1_damage"+this.damage+".png")},function(){var e=function(e){function t(t,a,i){e.innerWidth<e.innerHeight?t.width=e.innerWidth-20:t.width=e.innerHeight-20,angular.element(e).bind("resize",function(){e.innerWidth<e.innerHeight?t.width=e.innerWidth-20:t.width=e.innerHeight-20,t.$digest()})}return{restrict:"E",link:t,replace:!0,template:'<canvas id="game" class="playArea" width="{{width}}" height="{{width}}" />'}};angular.module("app").directive("canvasDirective",["$window",e])}(),function(){var e=function(){var e=!0,t=!1;return{getLCShow:function(){return e},setLCShow:function(t){e=t},getPCShow:function(){return t},setPCShow:function(e){t=e}}};angular.module("app").factory("displayService",[e])}(),function(){var e=function(){var e=[];return{getPlayers:function(){return e},setPlayers:function(t){e=t}}};angular.module("app").factory("playerService",[e])}(),function(){var e=function(e){"use strict";var t=io.connect(window.location.host),a=function(a,i){t.on(a,function(){var a=arguments;e.$apply(function(){i.apply(t,a)})})},i=function(a,i,o){t.emit(a,i,function(){var a=arguments;e.$apply(function(){o&&o.apply(t,a)})})};return{on:a,emit:i,socket:t}};angular.module("app").factory("socketService",["$rootScope",e])}();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyIsImNvbnRyb2xsZXIvbG9naW5Db250cm9sbGVyLmpzIiwiY29udHJvbGxlci9wbGF5Q29udHJvbGxlci5qcyIsIm1vZGVscy9CdWxsZXQuanMiLCJtb2RlbHMvU3BhY2VzaGlwLmpzIiwiZGlyZWN0aXZlcy9jYW52YXNEaXJlY3RpdmUuanMiLCJzZXJ2aWNlcy9kaXNwbGF5U2VydmljZS5qcyIsInNlcnZpY2VzL3BsYXllclNlcnZpY2UuanMiLCJzZXJ2aWNlcy9zb2NrZXRTZXJ2aWNlLmpzIl0sIm5hbWVzIjpbImFuZ3VsYXIiLCJtb2R1bGUiLCJsb2dpbkNvbnRyb2xsZXIiLCIkc2NvcGUiLCJzb2NrZXRTZXJ2aWNlIiwiZGlzcGxheVNlcnZpY2UiLCJwbGF5ZXJTZXJ2aWNlIiwiTENTaG93IiwiZ2V0TENTaG93IiwibWFrZVJvb20iLCJlbWl0Iiwicm9vbSIsIm9uIiwiZGF0YSIsImRldmljZU9yaWVudGF0aW9uIiwidXNlcm5hbWUiLCJnYW1tYSIsImJldGEiLCJhbHBoYSIsInVzZXJuYW1lcyIsImNoZWNrVXNlckNvdW50Iiwic2V0UGxheWVycyIsIk9iamVjdCIsImtleXMiLCJsZW5ndGgiLCJzdGFydEdhbWUiLCJzZXRMQ1Nob3ciLCJzZXRQQ1Nob3ciLCJjb250cm9sbGVyIiwicGxheUNvbnRyb2xsZXIiLCIkaW50ZXJ2YWwiLCIkd2luZG93IiwiZmlsdGVyUGxheWVycyIsIm9iaiIsInVzZXJOYW1lIiwiZHJhdyIsIkFsbFBsYXllcnMiLCJzcGVlZCIsImN0eCIsImNsZWFyUmVjdCIsImNhbnYiLCJ3aWR0aCIsImhlaWdodCIsInJhdGlvIiwiQWxsQnVsbGV0cyIsIkJ1bGxldFdpZHRoIiwiQnVsbGV0SGVpZ2h0IiwiaW1hZ2UiLCJidWxsZXQiLCJiIiwiZXhwbG9kZVN0YWdlIiwic2F2ZSIsInRyYW5zbGF0ZSIsIngiLCJ5Iiwicm90YXRlIiwicm90YXRpb24iLCJNYXRoIiwiUEkiLCJkcmF3SW1hZ2UiLCJyZXN0b3JlIiwiY29zIiwic2luIiwiY29uc29sZSIsImxvZyIsImV4cGxvc2lvbkltYWdlIiwiU3BhY2VzaGlwV2lkdGgiLCJTcGFjZXNoaXBIZWlnaHQiLCJwbGF5ZXIiLCJwIiwiZGFtYWdlIiwiZGFtYWdlSW1hZ2UiLCJjaGVja0J1bGxldHMiLCJjb2xsaXNpb25EZXRlY3Rpb24iLCJzcGxpY2UiLCJyYWRpdXMiLCJzcXJ0IiwiYW5nbGUiLCJidWxsZXRIZWFkWCIsImJ1bGxldEhlYWRZIiwic3BhY2VTaGlwWCIsInNwYWNlU2hpcFkiLCJkaXN0YW5jZSIsImRhbWFnZXNvdW5kIiwiQXVkaW8iLCJwbGF5IiwiaW5jcmVhc2VEYW1hZ2UiLCJleHBsb2RlIiwiUENTaG93IiwiZ2V0UENTaG93IiwiY3ljbGUiLCJkb2N1bWVudCIsImdldEVsZW1lbnRCeUlkIiwiZ2V0Q29udGV4dCIsIkFycmF5IiwiQnVmZmVyUGxheWVyIiwiZ2V0UGxheWVycyIsInB1c2giLCJTcGFjZXNoaXAiLCJjb2xvciIsImkiLCJyb3RhdGVTcGFjZXNoaXBSZWxhdGl2ZSIsIm9yaWVudGF0aW9uIiwidGVtcCIsIkJ1bGxldCIsInNob3QiLCJ0aGlzIiwiSW1hZ2UiLCJzaGllbGRJbWFnZSIsInNyYyIsImNoYXJBdCIsInRvVXBwZXJDYXNlIiwic2xpY2UiLCJwcm90b3R5cGUiLCJudW1iZXIiLCJtb3ZlU3BhY2VzaGlwIiwibW92ZVNwYWNlc2hpcFJlbGF0aXZlIiwicm90YXRlU3BhY2VzaGlwIiwiZGVncmVlIiwiZGVjcmVhc2VEYW1hZ2UiLCJjYW52YXNEaXJlY3RpdmUiLCJsaW5rIiwic2NvcGUiLCJlbGVtZW50IiwiYXR0cnMiLCJpbm5lcldpZHRoIiwiaW5uZXJIZWlnaHQiLCJiaW5kIiwiJGRpZ2VzdCIsInJlc3RyaWN0IiwicmVwbGFjZSIsInRlbXBsYXRlIiwiZGlyZWN0aXZlIiwidmFsdWUiLCJmYWN0b3J5IiwicGxheWVycyIsInBsYXllcnNBcnJheSIsIiRyb290U2NvcGUiLCJzb2NrZXQiLCJpbyIsImNvbm5lY3QiLCJ3aW5kb3ciLCJsb2NhdGlvbiIsImhvc3QiLCJldmVudE5hbWUiLCJjYWxsYmFjayIsImFyZ3MiLCJhcmd1bWVudHMiLCIkYXBwbHkiLCJhcHBseSJdLCJtYXBwaW5ncyI6IkNBR0EsV0FFQUEsUUFBQUMsT0FBQSxhQ0RBLFdBQ0EsR0FBQUMsR0FBQSxTQUFBQyxFQUFBQyxFQUFBQyxFQUFBQyxHQUVBSCxFQUFBSSxPQUFBRixFQUFBRyxTQUdBLElBQUFDLEdBQUEsV0FDQUwsRUFBQU0sS0FBQSxZQUFBLE1BRUFQLEdBQUFRLEtBQUEsR0FDQVAsRUFBQVEsR0FBQSxjQUFBLFNBQUFDLEdBQ0FWLEVBQUFRLEtBQUFFLElBRUFULEVBQUFRLEdBQUEsb0JBQUEsU0FBQUMsR0FDQSxHQUNBQyxJQURBRCxFQUFBRSxZQUVBRCxHQUFBRSxNQUFBSCxFQUFBRyxNQUNBRixFQUFBRyxLQUFBSixFQUFBSSxLQUNBSCxFQUFBSSxNQUFBTCxFQUFBSyxRQUVBZixFQUFBZ0IsYUFDQWhCLEVBQUFpQixnQkFBQSxFQUNBaEIsRUFBQVEsR0FBQSxjQUFBLFNBQUFDLEdBQ0FQLEVBQUFlLFdBQUFSLEdBQ0FWLEVBQUFnQixVQUFBTixFQUNBVixFQUFBaUIsZUFBQUUsT0FBQUMsS0FBQXBCLEVBQUFnQixXQUFBSyxPQUFBLElBR0FyQixFQUFBc0IsVUFBQSxXQUNBckIsRUFBQU0sS0FBQSxZQUFBLE1BQ0FMLEVBQUFxQixXQUFBLEdBQ0FyQixFQUFBc0IsV0FBQSxJQUlBLFdBQ0FsQixPQUtBVCxTQUFBQyxPQUFBLE9BQUEyQixXQUFBLG1CQUFBLFNBQUEsZ0JBQUEsaUJBQUEsZ0JBQUExQixPQ3pDQSxXQUNBLFlBQ0EsSUFBQTJCLEdBQUEsU0FBQTFCLEVBQUEyQixFQUFBQyxFQUFBM0IsRUFBQUMsRUFBQUMsR0F1REEsUUFBQTBCLEdBQUFDLEVBQUFwQixHQUNBLE1BQUFBLEdBQUFFLFVBQUFrQixFQUFBQyxVQUNBLEdBRUEsRUFJQSxRQUFBQyxLQUNBQyxFQUFBLEdBQUFDLE1BQUEsRUFDQUMsRUFBQUMsVUFBQSxFQUFBLEVBQUFD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QkEsT0FDQUMsU0FBQSxJQUNBUixLQUFBQSxFQUNBUyxTQUFBLEVBQ0FDLFNBQUEsOEVBc0JBbkksU0FBQUMsT0FBQSxPQUFBbUksVUFBQSxtQkFBQSxVQUFBWixPQ3ZCQSxXQUNBLEdBQUFuSCxHQUFBLFdBRUEsR0FBQUUsSUFBQSxFQUVBaUYsR0FBQSxDQUVBLFFBQ0FoRixVQUFBLFdBQ0EsTUFBQUQsSUFFQW1CLFVBQUEsU0FBQTJHLEdBQ0E5SCxFQUFBOEgsR0FFQTVDLFVBQUEsV0FDQSxNQUFBRCxJQUVBN0QsVUFBQSxTQUFBMEcsR0FDQTdDLEVBQUE2QyxJQUtBckksU0FBQUMsT0FBQSxPQUFBcUksUUFBQSxrQkFBQWpJLE9DM0JBLFdBQ0EsR0FBQUMsR0FBQSxXQUVBLEdBQUFpSSxLQUVBLFFBQ0F2QyxXQUFBLFdBQ0EsTUFBQXVDLElBRUFsSCxXQUFBLFNBQUFtSCxHQUNBRCxFQUFBQyxJQUtBeEksU0FBQUMsT0FBQSxPQUFBcUksUUFBQSxpQkFBQWhJLE9DZkEsV0FFQSxHQUFBRixHQUFBLFNBQUFxSSxHQUNBLFlBRUEsSUFBQUMsR0FBQUMsR0FBQUMsUUFBQUMsT0FBQUMsU0FBQUMsTUFFQW5JLEVBQUEsU0FBQW9JLEVBQUFDLEdBQ0FQLEVBQUE5SCxHQUFBb0ksRUFBQSxXQUNBLEdBQUFFLEdBQUFDLFNBQ0FWLEdBQUFXLE9BQUEsV0FDQUgsRUFBQUksTUFBQVgsRUFBQVEsUUFLQXhJLEVBQUEsU0FBQXNJLEVBQUFuSSxFQUFBb0ksR0FDQVAsRUFBQWhJLEtBQUFzSSxFQUFBbkksRUFBQSxXQUNBLEdBQUFxSSxHQUFBQyxTQUNBVixHQUFBVyxPQUFBLFdBQ0FILEdBQ0FBLEVBQUFJLE1BQUFYLEVBQUFRLE9BT0EsUUFDQXRJLEdBQUFBLEVBQ0FGLEtBQUFBLEVBQ0FnSSxPQUFBQSxHQUlBMUksU0FBQUMsT0FBQSxPQUFBcUksUUFBQSxpQkFBQSxhQUFBbEkiLCJmaWxlIjoiYXBwLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQ3JlYXRlZCBieSBNaWNoaWVsIG9uIDI1LzExLzIwMTUuXG4gKi9cbihmdW5jdGlvbigpe1xuXG4gICAgdmFyIGFwcCA9IGFuZ3VsYXIubW9kdWxlKFwiYXBwXCIsW10pO1xufSkoKTsiLCIvKipcbiAqIENyZWF0ZWQgYnkgTWljaGllbCBvbiAxMS8xMi8yMDE1LlxuICovXG5cbihmdW5jdGlvbigpe1xuICAgIHZhciBsb2dpbkNvbnRyb2xsZXIgPSBmdW5jdGlvbigkc2NvcGUsIHNvY2tldFNlcnZpY2UsIGRpc3BsYXlTZXJ2aWNlLCBwbGF5ZXJTZXJ2aWNlKXtcblxuICAgICAgICAkc2NvcGUuTENTaG93ID0gZGlzcGxheVNlcnZpY2UuZ2V0TENTaG93O1xuXG4gICAgICAgIC8vZnVuY3Rpb25zXG4gICAgICAgIHZhciBtYWtlUm9vbSA9IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICBzb2NrZXRTZXJ2aWNlLmVtaXQoXCJwY2Nvbm5lY3RcIiwgbnVsbCk7XG4gICAgICAgIH07XG4gICAgICAgICRzY29wZS5yb29tID0gXCJcIjtcbiAgICAgICAgc29ja2V0U2VydmljZS5vbigncmVxdWVzdFJvb20nLGZ1bmN0aW9uKGRhdGEpe1xuICAgICAgICAgICAgJHNjb3BlLnJvb20gPSBkYXRhO1xuICAgICAgICB9KTtcbiAgICAgICAgc29ja2V0U2VydmljZS5vbignZGV2aWNlT3JpZW50YXRpb24nLCBmdW5jdGlvbihkYXRhKXtcbiAgICAgICAgICAgIHZhciB1c2VybmFtZSA9IGRhdGEudXNlcm5hbWU7XG4gICAgICAgICAgICB2YXIgZGV2aWNlT3JpZW50YXRpb24gPSB7fTtcbiAgICAgICAgICAgIGRldmljZU9yaWVudGF0aW9uLmdhbW1hID0gZGF0YS5nYW1tYTtcbiAgICAgICAgICAgIGRldmljZU9yaWVudGF0aW9uLmJldGEgPSBkYXRhLmJldGE7XG4gICAgICAgICAgICBkZXZpY2VPcmllbnRhdGlvbi5hbHBoYSA9IGRhdGEuYWxwaGE7XG4gICAgICAgIH0pO1xuICAgICAgICAkc2NvcGUudXNlcm5hbWVzID0ge307XG4gICAgICAgICRzY29wZS5jaGVja1VzZXJDb3VudCA9IGZhbHNlO1xuICAgICAgICBzb2NrZXRTZXJ2aWNlLm9uKCd1cGRhdGV1c2VycycsIGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBwbGF5ZXJTZXJ2aWNlLnNldFBsYXllcnMoZGF0YSk7XG4gICAgICAgICAgICAkc2NvcGUudXNlcm5hbWVzID0gZGF0YTtcbiAgICAgICAgICAgICRzY29wZS5jaGVja1VzZXJDb3VudCA9IE9iamVjdC5rZXlzKCRzY29wZS51c2VybmFtZXMpLmxlbmd0aCA8IDA7XG4gICAgICAgIH0pO1xuXG4gICAgICAgICRzY29wZS5zdGFydEdhbWU9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHNvY2tldFNlcnZpY2UuZW1pdChcInN0YXJ0R2FtZVwiLCBudWxsKTtcbiAgICAgICAgICAgIGRpc3BsYXlTZXJ2aWNlLnNldExDU2hvdyhmYWxzZSk7XG4gICAgICAgICAgICBkaXNwbGF5U2VydmljZS5zZXRQQ1Nob3codHJ1ZSk7XG4gICAgICAgIH07XG5cblxuICAgICAgICAoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBtYWtlUm9vbSgpO1xuICAgICAgICB9KSgpO1xuXG4gICAgfTtcblxuICAgIGFuZ3VsYXIubW9kdWxlKFwiYXBwXCIpLmNvbnRyb2xsZXIoXCJsb2dpbkNvbnRyb2xsZXJcIiwgW1wiJHNjb3BlXCIsIFwic29ja2V0U2VydmljZVwiICwgXCJkaXNwbGF5U2VydmljZVwiLCBcInBsYXllclNlcnZpY2VcIiwgbG9naW5Db250cm9sbGVyXSk7XG59KSgpOyIsIi8qKlxuICogQ3JlYXRlZCBieSBNaWNoaWVsIG9uIDE2LzEyLzIwMTUuXG4gKi9cblxuKGZ1bmN0aW9uKCl7XG4gICAgXCJ1c2Ugc3RyaWN0XCI7XG4gICAgdmFyIHBsYXlDb250cm9sbGVyID0gZnVuY3Rpb24oJHNjb3BlLCAkaW50ZXJ2YWwsICR3aW5kb3csIHNvY2tldFNlcnZpY2UsIGRpc3BsYXlTZXJ2aWNlLCBwbGF5ZXJTZXJ2aWNlKXtcbiAgICAgICAgJHNjb3BlLlBDU2hvdyA9IGRpc3BsYXlTZXJ2aWNlLmdldFBDU2hvdztcbiAgICAgICAgJHNjb3BlLnN0YXJ0R2FtZSA9IGZhbHNlO1xuICAgICAgICB2YXIgY2FudiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdnYW1lJyk7XG4gICAgICAgIHZhciBjdHggPSBjYW52LmdldENvbnRleHQoJzJkJyk7XG5cbiAgICAgICAgdmFyIEFsbFBsYXllcnMgPSBuZXcgQXJyYXkoKTtcbiAgICAgICAgdmFyIEFsbEJ1bGxldHMgPSBuZXcgQXJyYXkoKTtcblxuICAgICAgICB2YXIgY3ljbGU7XG5cbiAgICAgICAgc29ja2V0U2VydmljZS5vbihcImluaXRHYW1lXCIsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgQnVmZmVyUGxheWVyID0gcGxheWVyU2VydmljZS5nZXRQbGF5ZXJzKCk7XG4gICAgICAgICAgICBmb3IodmFyIHBsYXllciBpbiBCdWZmZXJQbGF5ZXIpe1xuICAgICAgICAgICAgICAgIHZhciBwID0gQnVmZmVyUGxheWVyW3BsYXllcl07XG4gICAgICAgICAgICAgICAgQWxsUGxheWVycy5wdXNoKG5ldyBTcGFjZXNoaXAocC51c2VybmFtZSwgcC54LCBwLnksIHAuY29sb3IsIHAucm90YXRpb24pKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgY3ljbGUgPSAkaW50ZXJ2YWwoZHJhdywgMTApO1xuICAgICAgICB9KTtcblxuICAgICAgICBzb2NrZXRTZXJ2aWNlLm9uKFwidXBkYXRlR2FtZURhdGFcIiwgZnVuY3Rpb24oZGF0YSl7XG4gICAgICAgICAgICB2YXIgcCA9IG51bGw7XG4gICAgICAgICAgICBmb3IodmFyIGkgaW4gQWxsUGxheWVycyl7XG4gICAgICAgICAgICAgICAgaWYoZmlsdGVyUGxheWVycyhBbGxQbGF5ZXJzW2ldLGRhdGEpID09IHRydWUpe1xuICAgICAgICAgICAgICAgICAgICBwID0gaTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZihwICE9IG51bGwpe1xuICAgICAgICAgICAgICAgIEFsbFBsYXllcnNbcF0ucm90YXRlU3BhY2VzaGlwUmVsYXRpdmUoZGF0YS5vcmllbnRhdGlvbik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHNvY2tldFNlcnZpY2Uub24oXCJwbGF5ZXJTaG90XCIsIGZ1bmN0aW9uKGRhdGEpe1xuICAgICAgICAgICAgdmFyIHAgPSBudWxsO1xuICAgICAgICAgICAgZm9yKHZhciBpIGluIEFsbFBsYXllcnMpe1xuICAgICAgICAgICAgICAgIGlmKGZpbHRlclBsYXllcnMoQWxsUGxheWVyc1tpXSxkYXRhKSA9PSB0cnVlKXtcbiAgICAgICAgICAgICAgICAgICAgcCA9IGk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYocCAhPSBudWxsKXtcbiAgICAgICAgICAgICAgICB2YXIgdGVtcCA9IEFsbFBsYXllcnNbcF07XG4gICAgICAgICAgICAgICAgdmFyIGFuZ2xlID0gKDM2MCAtKHRlbXAucm90YXRpb24gKyAxODApKS8xODAqTWF0aC5QSTtcbiAgICAgICAgICAgICAgICB2YXIgeCA9IHRlbXAueCArIChjYW52LndpZHRoLzQwMCAqIE1hdGguc2luKGFuZ2xlKSk7XG4gICAgICAgICAgICAgICAgdmFyIHkgPSB0ZW1wLnkgKyAoY2Fudi53aWR0aC80MDAgKiBNYXRoLmNvcyhhbmdsZSkpO1xuICAgICAgICAgICAgICAgIEFsbEJ1bGxldHMucHVzaChuZXcgQnVsbGV0KHgsIHksIHRlbXAucm90YXRpb24sIHRlbXAuY29sb3IsIHRlbXAudXNlck5hbWUpKTtcbiAgICAgICAgICAgICAgICBpZihwJTIgPT0gMCl7XG4gICAgICAgICAgICAgICAgICAgIHZhciBzaG90ID0gbmV3IEF1ZGlvKCcuLi8uLi9hc3NldHMvQm9udXMvc2Z4X2xhc2VyMS5vZ2cnKTtcbiAgICAgICAgICAgICAgICB9ZWxzZXtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHNob3QgPSBuZXcgQXVkaW8oJy4uLy4uL2Fzc2V0cy9Cb251cy9zZnhfbGFzZXIyLm9nZycpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBzaG90LnBsYXkoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgZnVuY3Rpb24gZmlsdGVyUGxheWVycyhvYmosZGF0YSl7XG4gICAgICAgICAgICBpZihkYXRhLnVzZXJuYW1lID09IG9iai51c2VyTmFtZSl7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9ZWxzZXtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBkcmF3KCl7XG4gICAgICAgICAgICBBbGxQbGF5ZXJzWzBdLnNwZWVkID0gMDtcbiAgICAgICAgICAgIGN0eC5jbGVhclJlY3QoMCwwLGNhbnYud2lkdGgsIGNhbnYuaGVpZ2h0KTtcbiAgICAgICAgICAgIHZhciByYXRpbyA9IGNhbnYud2lkdGgvMTAwO1xuXG4gICAgICAgICAgICBpZihBbGxCdWxsZXRzLmxlbmd0aCAhPSAwKXtcbiAgICAgICAgICAgICAgICB2YXIgQnVsbGV0V2lkdGggPSBjYW52LndpZHRoLzEwMDtcbiAgICAgICAgICAgICAgICB2YXIgQnVsbGV0SGVpZ2h0ID0gQnVsbGV0V2lkdGggKiBBbGxCdWxsZXRzWzBdLmltYWdlLmhlaWdodC9BbGxCdWxsZXRzWzBdLmltYWdlLndpZHRoO1xuXG4gICAgICAgICAgICAgICAgZm9yKHZhciBidWxsZXQgaW4gQWxsQnVsbGV0cyl7XG4gICAgICAgICAgICAgICAgICAgIHZhciBiID0gQWxsQnVsbGV0c1tidWxsZXRdO1xuICAgICAgICAgICAgICAgICAgICBiLndpZHRoID0gQnVsbGV0V2lkdGg7XG4gICAgICAgICAgICAgICAgICAgIGIuaGVpZ2h0ID0gQnVsbGV0SGVpZ2h0O1xuXG4gICAgICAgICAgICAgICAgICAgIGlmKGIuZXhwbG9kZVN0YWdlID09IDApe1xuICAgICAgICAgICAgICAgICAgICAgICAgLy9EcmF3IGJ1bGxldFxuICAgICAgICAgICAgICAgICAgICAgICAgY3R4LnNhdmUoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGN0eC50cmFuc2xhdGUoYi54KnJhdGlvLCBiLnkqcmF0aW8pO1xuICAgICAgICAgICAgICAgICAgICAgICAgY3R4LnJvdGF0ZShiLnJvdGF0aW9uLzE4MCpNYXRoLlBJKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5kcmF3SW1hZ2UoYi5pbWFnZSwgLUJ1bGxldFdpZHRoLzIsIC1CdWxsZXRIZWlnaHQvMiwgQnVsbGV0V2lkdGgsIEJ1bGxldEhlaWdodCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBjdHgucmVzdG9yZSgpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBBbGxCdWxsZXRzW2J1bGxldF0ueCA9IE1hdGguY29zKChiLnJvdGF0aW9uIC0gOTApLzE4MCpNYXRoLlBJKSArIGIueDtcbiAgICAgICAgICAgICAgICAgICAgICAgIEFsbEJ1bGxldHNbYnVsbGV0XS55ID0gTWF0aC5zaW4oKGIucm90YXRpb24gLSA5MCkvMTgwKk1hdGguUEkpKyBiLnk7XG4gICAgICAgICAgICAgICAgICAgIH1lbHNlIGlmKGIuZXhwbG9kZVN0YWdlIDwgNCl7XG4gICAgICAgICAgICAgICAgICAgICAgICAvL0RyYXcgZXhwbG9zaW9uXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhiLmV4cGxvc2lvbkltYWdlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5zYXZlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBjdHgudHJhbnNsYXRlKGIueCpyYXRpbywgYi55KnJhdGlvKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5kcmF3SW1hZ2UoYi5leHBsb3Npb25JbWFnZSwgLUJ1bGxldFdpZHRoLCAtQnVsbGV0V2lkdGgsIEJ1bGxldFdpZHRoKjIsIEJ1bGxldFdpZHRoKjIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgY3R4LnJlc3RvcmUoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYoQWxsUGxheWVycy5sZW5ndGggIT0gMCl7XG4gICAgICAgICAgICAgICAgdmFyIFNwYWNlc2hpcFdpZHRoID0gY2Fudi53aWR0aC8yMDtcbiAgICAgICAgICAgICAgICB2YXIgU3BhY2VzaGlwSGVpZ2h0ID0gU3BhY2VzaGlwV2lkdGggKiBBbGxQbGF5ZXJzWzBdLmltYWdlLmhlaWdodC8gQWxsUGxheWVyc1swXS5pbWFnZS53aWR0aDtcblxuICAgICAgICAgICAgICAgIGZvcih2YXIgcGxheWVyIGluIEFsbFBsYXllcnMpe1xuICAgICAgICAgICAgICAgICAgICB2YXIgcCA9IEFsbFBsYXllcnNbcGxheWVyXTtcbiAgICAgICAgICAgICAgICAgICAgcC53aWR0aCA9IFNwYWNlc2hpcFdpZHRoO1xuICAgICAgICAgICAgICAgICAgICBwLmhlaWdodCA9IFNwYWNlc2hpcEhlaWdodDtcbiAgICAgICAgICAgICAgICAgICAgY3R4LnNhdmUoKTtcbiAgICAgICAgICAgICAgICAgICAgY3R4LnRyYW5zbGF0ZShwLngqcmF0aW8sIHAueSpyYXRpbyk7XG4gICAgICAgICAgICAgICAgICAgIGN0eC5yb3RhdGUocC5yb3RhdGlvbi8xODAqTWF0aC5QSSk7XG4gICAgICAgICAgICAgICAgICAgIGN0eC5kcmF3SW1hZ2UocC5pbWFnZSwgLVNwYWNlc2hpcFdpZHRoLzIsIC1TcGFjZXNoaXBIZWlnaHQvMiwgU3BhY2VzaGlwV2lkdGgsIFNwYWNlc2hpcEhlaWdodCk7XG4gICAgICAgICAgICAgICAgICAgIGlmKHAuZGFtYWdlID4gMCl7XG4gICAgICAgICAgICAgICAgICAgICAgICBjdHguZHJhd0ltYWdlKHAuZGFtYWdlSW1hZ2UsIC1TcGFjZXNoaXBXaWR0aC8yLCAtU3BhY2VzaGlwSGVpZ2h0LzIsIFNwYWNlc2hpcFdpZHRoLCBTcGFjZXNoaXBIZWlnaHQpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGN0eC5yZXN0b3JlKCk7XG4gICAgICAgICAgICAgICAgICAgIEFsbFBsYXllcnNbcGxheWVyXS54ID0gTWF0aC5jb3MoKHAucm90YXRpb24gLSA5MCkvMTgwKk1hdGguUEkpLzEwKiBwLnNwZWVkICsgcC54O1xuICAgICAgICAgICAgICAgICAgICBBbGxQbGF5ZXJzW3BsYXllcl0ueSA9IE1hdGguc2luKChwLnJvdGF0aW9uIC0gOTApLzE4MCpNYXRoLlBJKS8xMCogcC5zcGVlZCArIHAueTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGNoZWNrQnVsbGV0cygpO1xuXG4gICAgICAgICAgICBjb2xsaXNpb25EZXRlY3Rpb24oKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGNoZWNrQnVsbGV0cygpe1xuXG4gICAgICAgICAgICBmb3IodmFyIGIgaW4gQWxsQnVsbGV0cyl7XG4gICAgICAgICAgICAgICAgaWYoQWxsQnVsbGV0c1tiXS54IDwgMCB8fCBBbGxCdWxsZXRzW2JdLnggPiBjYW52LndpZHRoIHx8IEFsbEJ1bGxldHNbYl0ueSA8IDAgfHwgQWxsQnVsbGV0c1tiXS55ID4gY2Fudi5oZWlnaHQpe1xuICAgICAgICAgICAgICAgICAgICBBbGxCdWxsZXRzLnNwbGljZShiLCAxKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGNvbGxpc2lvbkRldGVjdGlvbigpe1xuICAgICAgICAgICAgZm9yKHZhciBwIGluIEFsbFBsYXllcnMpe1xuICAgICAgICAgICAgICAgIGZvcih2YXIgYiBpbiBBbGxCdWxsZXRzKXtcbiAgICAgICAgICAgICAgICAgICAgaWYoQWxsQnVsbGV0c1tiXS5wbGF5ZXIgIT0gQWxsUGxheWVyc1twXS51c2VyTmFtZSl7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgcmFkaXVzID0gTWF0aC5zcXJ0KDIpLzIqKEFsbEJ1bGxldHNbYl0uaGVpZ2h0LzIgLSBBbGxCdWxsZXRzW2JdLndpZHRoLzIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGFuZ2xlID0gKDM2MCAtKEFsbEJ1bGxldHNbYl0ucm90YXRpb24pKS8xODAqTWF0aC5QSTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBidWxsZXRIZWFkWCA9IChBbGxCdWxsZXRzW2JdLngqY2Fudi53aWR0aC8xMDAgLSAocmFkaXVzICogTWF0aC5zaW4oYW5nbGUpKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgYnVsbGV0SGVhZFkgPSAoQWxsQnVsbGV0c1tiXS55KmNhbnYud2lkdGgvMTAwIC0gKHJhZGl1cyAqIE1hdGguY29zKGFuZ2xlKSkpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgc3BhY2VTaGlwWCA9IEFsbFBsYXllcnNbcF0ueCpjYW52LndpZHRoLzEwMDtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzcGFjZVNoaXBZID0gQWxsUGxheWVyc1twXS55KmNhbnYud2lkdGgvMTAwO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAvKmN0eC5zYXZlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBjdHguYmVnaW5QYXRoKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBjdHguYXJjKHNwYWNlU2hpcFgsIHNwYWNlU2hpcFksIEFsbFBsYXllcnNbcF0ud2lkdGgvMiwgMCwgTWF0aC5QSSoyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5saW5lV2lkdGggPSAxO1xuICAgICAgICAgICAgICAgICAgICAgICAgY3R4LnN0cm9rZVN0eWxlID0gJyMwMDAwRkYnO1xuICAgICAgICAgICAgICAgICAgICAgICAgY3R4LnN0cm9rZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgY3R4LnJlc3RvcmUoKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgY3R4LnNhdmUoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5iZWdpblBhdGgoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5hcmMoYnVsbGV0SGVhZFgsIGJ1bGxldEhlYWRZLCBBbGxCdWxsZXRzW2JdLndpZHRoLzIsIDAsIE1hdGguUEkqMik7XG4gICAgICAgICAgICAgICAgICAgICAgICBjdHgubGluZVdpZHRoID0gMTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5zdHJva2VTdHlsZSA9ICcjRkYwMDAwJztcbiAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5zdHJva2UoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5yZXN0b3JlKCk7Ki9cbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBkaXN0YW5jZSA9IE1hdGguc3FydCgoYnVsbGV0SGVhZFgtc3BhY2VTaGlwWCkqKGJ1bGxldEhlYWRYLXNwYWNlU2hpcFgpICsgKGJ1bGxldEhlYWRZLXNwYWNlU2hpcFkpKihidWxsZXRIZWFkWS1zcGFjZVNoaXBZKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZihkaXN0YW5jZSA8IChBbGxCdWxsZXRzW2JdLndpZHRoLzIgKyBBbGxQbGF5ZXJzW3BdLndpZHRoLzIpKXtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZGFtYWdlc291bmQgPSBuZXcgQXVkaW8oJy4uLy4uL2Fzc2V0cy9Cb251cy9zZnhfbG9zZS5vZ2cnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYW1hZ2Vzb3VuZC5wbGF5KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgQWxsUGxheWVyc1twXS5pbmNyZWFzZURhbWFnZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKEFsbEJ1bGxldHNbYl0uZXhwbG9kZVN0YWdlIDwgNCl7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEFsbEJ1bGxldHNbYl0uZXhwbG9kZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1lbHNle1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBBbGxCdWxsZXRzLnNwbGljZShiLCAxKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgYW5ndWxhci5tb2R1bGUoXCJhcHBcIikuY29udHJvbGxlcihcInBsYXlDb250cm9sbGVyXCIsIFtcIiRzY29wZVwiLCBcIiRpbnRlcnZhbFwiLCBcIiR3aW5kb3dcIiwgXCJzb2NrZXRTZXJ2aWNlXCIsIFwiZGlzcGxheVNlcnZpY2VcIiwgXCJwbGF5ZXJTZXJ2aWNlXCIsIHBsYXlDb250cm9sbGVyXSlcbn0pKCk7IiwiLyoqXG4gKiBDcmVhdGVkIGJ5IGp1c3Rpam5kZXBvdmVyIG9uIDIyLzEyLzE1LlxuICovXG5cbnZhciBCdWxsZXQgPSBmdW5jdGlvbih4LCB5LHJvdGF0aW9uLCBjb2xvciwgcGxheWVyKXtcbiAgICB0aGlzLnggPSB4O1xuICAgIHRoaXMueSA9IHk7XG4gICAgdGhpcy5yb3RhdGlvbiA9IHJvdGF0aW9uO1xuICAgIHRoaXMuaW1hZ2UgPSBuZXcgSW1hZ2UoKTtcbiAgICB0aGlzLmNvbG9yID0gY29sb3I7XG4gICAgdGhpcy53aWR0aCA9IDA7XG4gICAgdGhpcy5oZWlnaHQgPSAwO1xuICAgIHRoaXMucGxheWVyID0gcGxheWVyO1xuICAgIHRoaXMuZXhwbG9zaW9uSW1hZ2UgPSBuZXcgSW1hZ2UoKTtcbiAgICB0aGlzLnNoaWVsZEltYWdlID0gbmV3IEltYWdlKCk7XG4gICAgc2hpZWxkSW1hZ2Uuc3JjID0gXG4gICAgdGhpcy5leHBsb2RlU3RhZ2UgPSAwO1xuICAgIGlmKHRoaXMuY29sb3IgPT0gXCJvcmFuZ2VcIil7XG4gICAgICAgIHRoaXMuY29sb3IgPSAncmVkJztcbiAgICB9XG4gICAgdGhpcy5pbWFnZS5zcmMgPSAnLi4vYXNzZXRzL1BORy9MYXNlcnMvbGFzZXInKyB0aGlzLmNvbG9yLmNoYXJBdCgwKS50b1VwcGVyQ2FzZSgpICsgdGhpcy5jb2xvci5zbGljZSgxKSArJzAxLnBuZydcbn07XG5cbkJ1bGxldC5wcm90b3R5cGUuZXhwbG9kZSA9IGZ1bmN0aW9uKCl7XG4gICAgaWYodGhpcy5leHBsb2RlU3RhZ2UgPCA0KXtcbiAgICAgICAgdGhpcy5leHBsb2RlU3RhZ2UrKztcbiAgICAgICAgdmFyIG51bWJlcjtcbiAgICAgICAgaWYodGhpcy5leHBsb2RlU3RhZ2UgPCAzKXtcbiAgICAgICAgICAgbnVtYmVyID0gMVxuICAgICAgICB9ZWxzZXtcbiAgICAgICAgICAgIG51bWJlciA9IDJcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmV4cGxvc2lvbkltYWdlLnNyYyA9ICcuLi9hc3NldHMvUE5HL0xhc2Vycy9sYXNlcicgKyB0aGlzLmNvbG9yLmNoYXJBdCgwKS50b1VwcGVyQ2FzZSgpICsgdGhpcy5jb2xvci5zbGljZSgxKSArICdFeHBsb2RlJysgbnVtYmVyICsnLnBuZyc7XG4gICAgfWVsc2V7XG4gICAgICAgIHRoaXMuZXhwbG9zaW9uSW1hZ2Uuc3JjID0gJyc7XG4gICAgfVxufTtcbiIsIi8qKlxuICogQ3JlYXRlZCBieSBqdXN0aWpuZGVwb3ZlciBvbiAwOS8xMi8xNS5cbiAqL1xuXG52YXIgU3BhY2VzaGlwID0gZnVuY3Rpb24odXNlck5hbWUsIHgsIHksIGNvbG9yLCByb3RhdGlvbil7XG4gICAgdGhpcy51c2VyTmFtZSA9IHVzZXJOYW1lO1xuICAgIHRoaXMueCA9IHg7XG4gICAgdGhpcy55ID0geTtcbiAgICB0aGlzLnNwZWVkID0gMTtcbiAgICB0aGlzLmNvbG9yID0gY29sb3I7XG4gICAgdGhpcy5yb3RhdGlvbiA9IHJvdGF0aW9uO1xuICAgIHRoaXMuaW1hZ2UgPSBuZXcgSW1hZ2UoKTtcbiAgICB0aGlzLmRhbWFnZSA9IDA7XG4gICAgdGhpcy53aWR0aCA9IDA7XG4gICAgdGhpcy5oZWlnaHQgPSAwO1xuICAgIHRoaXMuZGFtYWdlSW1hZ2UgPSBuZXcgSW1hZ2UoKTtcbiAgICB0aGlzLmltYWdlLnNyYyA9ICcuLi9hc3NldHMvUE5HL3BsYXllclNoaXAxXycrIHRoaXMuY29sb3IgKycucG5nJ1xufTtcblxuU3BhY2VzaGlwLnByb3RvdHlwZS5tb3ZlU3BhY2VzaGlwID0gZnVuY3Rpb24oeCwgeSl7XG4gICAgdGhpcy54ID0geDtcbiAgICB0aGlzLnkgPSB5O1xufTtcblxuU3BhY2VzaGlwLnByb3RvdHlwZS5tb3ZlU3BhY2VzaGlwUmVsYXRpdmUgPSBmdW5jdGlvbih4LCB5KXtcbiAgICB0aGlzLnggPSB0aGlzLngreDtcbiAgICB0aGlzLnkgPSB0aGlzLnkreTtcbn07XG5cblNwYWNlc2hpcC5wcm90b3R5cGUucm90YXRlU3BhY2VzaGlwID0gZnVuY3Rpb24oZGVncmVlKXtcbiAgICB0aGlzLnJvdGF0aW9uID0gZGVncmVlO1xufTtcblxuU3BhY2VzaGlwLnByb3RvdHlwZS5yb3RhdGVTcGFjZXNoaXBSZWxhdGl2ZSA9IGZ1bmN0aW9uKGRlZ3JlZSl7XG4gICAgdGhpcy5yb3RhdGlvbiA9IHRoaXMucm90YXRpb24gKyBkZWdyZWUvNTtcbiAgICBpZih0aGlzLnJvdGF0aW9uIDwgLTM2MCl7XG4gICAgICAgIHRoaXMucm90YXRpb24gPSB0aGlzLnJvdGF0aW9uICsgNzIwO1xuICAgIH1cbiAgICBpZih0aGlzLnJvdGF0aW9uID4gMzYwKXtcbiAgICAgICAgdGhpcy5yb3RhdGlvbiA9IHRoaXMucm90YXRpb24gLSA3MjA7XG4gICAgfVxufTtcblxuU3BhY2VzaGlwLnByb3RvdHlwZS5pbmNyZWFzZURhbWFnZSA9IGZ1bmN0aW9uKCl7XG4gICAgaWYodGhpcy5kYW1hZ2UgPCA0KXtcbiAgICAgICAgdGhpcy5kYW1hZ2UgKz0gMTtcbiAgICB9XG5cbiAgICBpZih0aGlzLmRhbWFnZSA8PSAzICYmIHRoaXMuZGFtYWdlID4gMCl7XG4gICAgICAgIHRoaXMuZGFtYWdlSW1hZ2Uuc3JjID0gJy4uL2Fzc2V0cy9QTkcvRGFtYWdlL3BsYXllclNoaXAxX2RhbWFnZScrIHRoaXMuZGFtYWdlICsgJy5wbmcnO1xuICAgIH1cbn07XG5cblNwYWNlc2hpcC5wcm90b3R5cGUuZGVjcmVhc2VEYW1hZ2UgPSBmdW5jdGlvbigpe1xuICAgIGlmKHRoaXMuZGFtYWdlID4gMCl7XG4gICAgICAgIHRoaXMuZGFtYWdlIC09IDE7XG4gICAgfVxuXG4gICAgaWYodGhpcy5kYW1hZ2UgPD0gMyAmJiB0aGlzLmRhbWFnZSA+IDApe1xuICAgICAgICB0aGlzLmRhbWFnZUltYWdlLnNyYyA9ICcuLi9hc3NldHMvUE5HL0RhbWFnZS9wbGF5ZXJTaGlwMV9kYW1hZ2UnKyB0aGlzLmRhbWFnZSArICcucG5nJztcbiAgICB9XG59O1xuXG4iLCIvKipcbiAqIENyZWF0ZWQgYnkganVzdGlqbmRlcG92ZXIgb24gMTYvMTIvMTUuXG4gKi9cbihmdW5jdGlvbigpe1xuICAgIHZhciBjYW52YXNEaXJlY3RpdmUgPSBmdW5jdGlvbigkd2luZG93KXtcbiAgICAgICAgcmV0dXJue1xuICAgICAgICAgICAgcmVzdHJpY3Q6ICdFJyxcbiAgICAgICAgICAgIGxpbms6bGluayxcbiAgICAgICAgICAgIHJlcGxhY2U6dHJ1ZSxcbiAgICAgICAgICAgIHRlbXBsYXRlOic8Y2FudmFzIGlkPVwiZ2FtZVwiIGNsYXNzPVwicGxheUFyZWFcIiB3aWR0aD1cInt7d2lkdGh9fVwiIGhlaWdodD1cInt7d2lkdGh9fVwiIC8+J1xuICAgICAgICB9O1xuXG4gICAgICAgIGZ1bmN0aW9uIGxpbmsoc2NvcGUsIGVsZW1lbnQsIGF0dHJzKXtcbiAgICAgICAgICAgIGlmKCR3aW5kb3cuaW5uZXJXaWR0aCA8ICR3aW5kb3cuaW5uZXJIZWlnaHQpe1xuICAgICAgICAgICAgICAgIHNjb3BlLndpZHRoID0gJHdpbmRvdy5pbm5lcldpZHRoIC0gMjA7XG4gICAgICAgICAgICB9ZWxzZXtcbiAgICAgICAgICAgICAgICBzY29wZS53aWR0aCA9ICR3aW5kb3cuaW5uZXJIZWlnaHQgLSAyMDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgYW5ndWxhci5lbGVtZW50KCR3aW5kb3cpLmJpbmQoJ3Jlc2l6ZScsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgaWYoJHdpbmRvdy5pbm5lcldpZHRoIDwgJHdpbmRvdy5pbm5lckhlaWdodCl7XG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLndpZHRoID0gJHdpbmRvdy5pbm5lcldpZHRoIC0gMjA7XG4gICAgICAgICAgICAgICAgfWVsc2V7XG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLndpZHRoID0gJHdpbmRvdy5pbm5lckhlaWdodCAtIDIwO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHNjb3BlLiRkaWdlc3QoKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfTtcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdhcHAnKS5kaXJlY3RpdmUoXCJjYW52YXNEaXJlY3RpdmVcIiwgW1wiJHdpbmRvd1wiLCBjYW52YXNEaXJlY3RpdmVdKTtcbn0pKCk7IiwiLyoqXG4gKiBDcmVhdGVkIGJ5IE1pY2hpZWwgb24gMTYvMTIvMjAxNS5cbiAqL1xuLyoqXG4gKiBDcmVhdGVkIGJ5IGp1c3Rpam5kZXBvdmVyIG9uIDE2LzEyLzE1LlxuICovXG5cblxuKGZ1bmN0aW9uKCl7XG4gICAgdmFyIGRpc3BsYXlTZXJ2aWNlID0gZnVuY3Rpb24oKXtcbiAgICAgICAgLy9Mb2dpbiBDb250cm9sbGVyXG4gICAgICAgIHZhciBMQ1Nob3cgPSB0cnVlO1xuICAgICAgICAvL1BsYXkgY29udHJvbGxlclxuICAgICAgICB2YXIgUENTaG93ID0gZmFsc2U7XG5cbiAgICAgICAgcmV0dXJue1xuICAgICAgICAgICAgZ2V0TENTaG93OiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIHJldHVybiBMQ1Nob3c7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc2V0TENTaG93OiBmdW5jdGlvbih2YWx1ZSl7XG4gICAgICAgICAgICAgICAgTENTaG93ID0gdmFsdWU7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0UENTaG93OiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIHJldHVybiBQQ1Nob3c7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc2V0UENTaG93OiBmdW5jdGlvbih2YWx1ZSl7XG4gICAgICAgICAgICAgICAgUENTaG93ID0gdmFsdWU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcCcpLmZhY3RvcnkoJ2Rpc3BsYXlTZXJ2aWNlJywgW2Rpc3BsYXlTZXJ2aWNlXSk7XG59KSgpOyIsIi8qKlxuICogQ3JlYXRlZCBieSBqdXN0aWpuZGVwb3ZlciBvbiAxNy8xMi8xNS5cbiAqL1xuXG4oZnVuY3Rpb24oKXtcbiAgICB2YXIgcGxheWVyU2VydmljZSA9IGZ1bmN0aW9uKCl7XG4gICAgICAgIC8vTG9naW4gQ29udHJvbGxlclxuICAgICAgICB2YXIgcGxheWVycyA9IFtdO1xuXG4gICAgICAgIHJldHVybntcbiAgICAgICAgICAgIGdldFBsYXllcnM6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHBsYXllcnM7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc2V0UGxheWVyczogZnVuY3Rpb24ocGxheWVyc0FycmF5KXtcbiAgICAgICAgICAgICAgICBwbGF5ZXJzID0gcGxheWVyc0FycmF5O1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfTtcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdhcHAnKS5mYWN0b3J5KCdwbGF5ZXJTZXJ2aWNlJywgW3BsYXllclNlcnZpY2VdKTtcbn0pKCk7IiwiLyoqXG4gKiBDcmVhdGVkIGJ5IGp1c3Rpam5kZXBvdmVyIG9uIDA5LzEyLzE1LlxuICovXG5cbihmdW5jdGlvbigpe1xuXG4gICAgdmFyIHNvY2tldFNlcnZpY2UgPSBmdW5jdGlvbigkcm9vdFNjb3BlKXtcbiAgICAgICAgXCJ1c2Ugc3RyaWN0XCI7XG4gICAgICAgIC8vcHJpdmF0ZVxuICAgICAgICB2YXIgc29ja2V0ID0gaW8uY29ubmVjdCh3aW5kb3cubG9jYXRpb24uaG9zdCk7XG4gICAgICAgIC8vZnVuY3Rpb25zXG4gICAgICAgIHZhciBvbiA9IGZ1bmN0aW9uIChldmVudE5hbWUsIGNhbGxiYWNrKSB7XG4gICAgICAgICAgICBzb2NrZXQub24oZXZlbnROYW1lLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgdmFyIGFyZ3MgPSBhcmd1bWVudHM7XG4gICAgICAgICAgICAgICAgJHJvb3RTY29wZS4kYXBwbHkoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjay5hcHBseShzb2NrZXQsIGFyZ3MpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIGVtaXQgPSBmdW5jdGlvbiAoZXZlbnROYW1lLCBkYXRhLCBjYWxsYmFjaykge1xuICAgICAgICAgICAgc29ja2V0LmVtaXQoZXZlbnROYW1lLCBkYXRhLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgdmFyIGFyZ3MgPSBhcmd1bWVudHM7XG4gICAgICAgICAgICAgICAgJHJvb3RTY29wZS4kYXBwbHkoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoY2FsbGJhY2spIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrLmFwcGx5KHNvY2tldCwgYXJncyk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgIH07XG5cbiAgICAgICAgLy9wdWJsaWNcbiAgICAgICAgcmV0dXJue1xuICAgICAgICAgICAgb246IG9uLFxuICAgICAgICAgICAgZW1pdDogZW1pdCxcbiAgICAgICAgICAgIHNvY2tldDogc29ja2V0XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgYW5ndWxhci5tb2R1bGUoXCJhcHBcIikuZmFjdG9yeShcInNvY2tldFNlcnZpY2VcIiwgW1wiJHJvb3RTY29wZVwiLCBzb2NrZXRTZXJ2aWNlXSk7XG5cbn0pKCk7Il0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
