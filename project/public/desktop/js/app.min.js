!function(){angular.module("app",[])}(),function(){var e=function(e,t,a,i){e.LCShow=a.getLCShow;var o=function(){t.emit("pcconnect",null)};e.room="",t.on("requestRoom",function(t){e.room=t}),t.on("deviceOrientation",function(e){var t=(e.username,{});t.gamma=e.gamma,t.beta=e.beta,t.alpha=e.alpha}),e.usernames={},e.checkUserCount=!1,t.on("updateusers",function(t){i.setPlayers(t),e.usernames=t,e.checkUserCount=Object.keys(e.usernames).length<0}),e.startGame=function(){t.emit("startGame",null),a.setLCShow(!1),a.setPCShow(!0)},function(){o()}()};angular.module("app").controller("loginController",["$scope","socketService","displayService","playerService",e])}(),function(){"use strict";var e=function(e,t,a,i,o,n){function r(e,t){return t.username==e.userName?!0:!1}function s(){u.length>0&&(u[0].speed=0),g.clearRect(0,0,p.width,p.height);var e=p.width/100;if(0!=d.length){var t=p.width/100,a=t*d[0].image.height/d[0].image.width;for(var i in d){var o=d[i];o.width=t,o.height=a,0==o.explodeStage?(g.save(),g.translate(o.x*e,o.y*e),g.rotate(o.rotation/180*Math.PI),g.drawImage(o.image,-t/2,-a/2,t,a),g.restore(),d[i].x=Math.cos((o.rotation-90)/180*Math.PI)+o.x,d[i].y=Math.sin((o.rotation-90)/180*Math.PI)+o.y):o.explodeStage<4&&(console.log(o.explosionImage),g.save(),g.translate(o.x*e,o.y*e),g.drawImage(o.explosionImage,-t,-t,2*t,2*t),g.restore())}}if(0!=u.length){var n=p.width/20,r=n*u[0].image.height/u[0].image.width;for(var s in u){var l=u[s];l.width=n,l.height=r,g.save(),g.translate(l.x*e,l.y*e),g.rotate(l.rotation/180*Math.PI),g.drawImage(l.image,-n/2,-r/2,n,r),l.damage>0&&g.drawImage(l.damageImage,-n/2,-r/2,n,r),g.restore(),u[s].x=Math.cos((l.rotation-90)/180*Math.PI)/10*l.speed+l.x,u[s].y=Math.sin((l.rotation-90)/180*Math.PI)/10*l.speed+l.y}}h(),c()}function h(){for(var e in d)(d[e].x<0||d[e].x>p.width||d[e].y<0||d[e].y>p.height)&&d.splice(e,1),d[e].explodeStage>0&&(d[e].explodeStage<4?d[e].explode():d.splice(e,1))}function c(){for(var e in u)for(var t in d)if(0==d[t].explodeStage&&d[t].player!=u[e].userName){var a=Math.sqrt(2)/2*(d[t].height/2-d[t].width/2),o=(360-d[t].rotation)/180*Math.PI,n=d[t].x*p.width/100-a*Math.sin(o),r=d[t].y*p.width/100-a*Math.cos(o),s=u[e].x*p.width/100,h=u[e].y*p.width/100,c=Math.sqrt((n-s)*(n-s)+(r-h)*(r-h));if(c<d[t].width/2+u[e].width/2){var l=new Audio("../../assets/Bonus/sfx_lose.ogg");l.play(),u[e].increaseDamage();var g={};g.username=u[e].userName,g.life=3-u[e].damage,i.emit("playerLife",g),d[t].explode()}}}e.PCShow=o.getPCShow,e.startGame=!1;var l,p=document.getElementById("game"),g=p.getContext("2d"),u=new Array,d=new Array;i.on("initGame",function(){var e=n.getPlayers();for(var a in e){var i=e[a];u.push(new Spaceship(i.username,i.x,i.y,i.color,i.rotation))}l=t(s,10)}),i.on("userleft",function(e){var t=null;for(var a in u)1==r(u[a],e)&&(t=a);u.splice(t,1)}),i.on("updateGameData",function(e){var t=null;for(var a in u)1==r(u[a],e)&&(t=a);null!=t&&u[t].rotateSpaceshipRelative(e.orientation)}),i.on("playerShot",function(e){var t=null;for(var a in u)1==r(u[a],e)&&(t=a);if(null!=t){var i=u[t],o=(360-(i.rotation+180))/180*Math.PI,n=i.x+p.width/400*Math.sin(o),s=i.y+p.width/400*Math.cos(o);if(d.push(new Bullet(n,s,i.rotation,i.color,i.userName)),t%2==0)var h=new Audio("../../assets/Bonus/sfx_laser1.ogg");else var h=new Audio("../../assets/Bonus/sfx_laser2.ogg");h.play()}})};angular.module("app").controller("playController",["$scope","$interval","$window","socketService","displayService","playerService",e])}(),function(){var e=function(e){function t(t,a,i){e.innerWidth<e.innerHeight?t.width=e.innerWidth-20:t.width=e.innerHeight-20,angular.element(e).bind("resize",function(){e.innerWidth<e.innerHeight?t.width=e.innerWidth-20:t.width=e.innerHeight-20,t.$digest()})}return{restrict:"E",link:t,replace:!0,template:'<canvas id="game" class="playArea" width="{{width}}" height="{{width}}" />'}};angular.module("app").directive("canvasDirective",["$window",e])}();var Bullet=function(e,t,a,i,o){this.x=e,this.y=t,this.rotation=a,this.image=new Image,this.color=i,this.width=0,this.height=0,this.player=o,this.explosionImage=new Image,this.explodeStage=0,"orange"==this.color&&(this.color="red"),this.image.src="../assets/PNG/Lasers/laser"+this.color.charAt(0).toUpperCase()+this.color.slice(1)+"01.png"};Bullet.prototype.explode=function(){if(this.explodeStage<4){this.explodeStage++;var e;e=this.explodeStage<3?1:2,this.explosionImage.src="../assets/PNG/Lasers/laser"+this.color.charAt(0).toUpperCase()+this.color.slice(1)+"Explode"+e+".png"}else this.explosionImage.src=""};var Spaceship=function(e,t,a,i,o){this.userName=e,this.x=t,this.y=a,this.speed=1,this.color=i,this.rotation=o,this.image=new Image,this.damage=0,this.width=0,this.height=0,this.damageImage=new Image,this.image.src="../assets/PNG/playerShip1_"+this.color+".png"};Spaceship.prototype.reset=function(){},Spaceship.prototype.moveSpaceship=function(e,t){this.x=e,this.y=t},Spaceship.prototype.moveSpaceshipRelative=function(e,t){this.x=this.x+e,this.y=this.y+t},Spaceship.prototype.rotateSpaceship=function(e){this.rotation=e},Spaceship.prototype.rotateSpaceshipRelative=function(e){this.rotation=this.rotation+e/5,this.rotation<-360&&(this.rotation=this.rotation+720),this.rotation>360&&(this.rotation=this.rotation-720)},Spaceship.prototype.increaseDamage=function(){this.damage<4&&(this.damage+=1),this.damage<=3&&this.damage>0?this.damageImage.src="../assets/PNG/Damage/playerShip1_damage"+this.damage+".png":4==this.damage&&(this.damageImage.src="../assets/PNG/Damage/explode.gif")},Spaceship.prototype.decreaseDamage=function(){this.damage>0&&(this.damage-=1),this.damage<=3&&this.damage>0&&(this.damageImage.src="../assets/PNG/Damage/playerShip1_damage"+this.damage+".png")},function(){var e=function(){var e=!0,t=!1;return{getLCShow:function(){return e},setLCShow:function(t){e=t},getPCShow:function(){return t},setPCShow:function(e){t=e}}};angular.module("app").factory("displayService",[e])}(),function(){var e=function(){var e=[];return{getPlayers:function(){return e},setPlayers:function(t){e=t}}};angular.module("app").factory("playerService",[e])}(),function(){var e=function(e){"use strict";var t=io.connect(window.location.host),a=function(a,i){t.on(a,function(){var a=arguments;e.$apply(function(){i.apply(t,a)})})},i=function(a,i,o){t.emit(a,i,function(){var a=arguments;e.$apply(function(){o&&o.apply(t,a)})})};return{on:a,emit:i,socket:t}};angular.module("app").factory("socketService",["$rootScope",e])}();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyIsImNvbnRyb2xsZXIvbG9naW5Db250cm9sbGVyLmpzIiwiY29udHJvbGxlci9wbGF5Q29udHJvbGxlci5qcyIsImRpcmVjdGl2ZXMvY2FudmFzRGlyZWN0aXZlLmpzIiwibW9kZWxzL0J1bGxldC5qcyIsIm1vZGVscy9TcGFjZXNoaXAuanMiLCJzZXJ2aWNlcy9kaXNwbGF5U2VydmljZS5qcyIsInNlcnZpY2VzL3BsYXllclNlcnZpY2UuanMiLCJzZXJ2aWNlcy9zb2NrZXRTZXJ2aWNlLmpzIl0sIm5hbWVzIjpbImFuZ3VsYXIiLCJtb2R1bGUiLCJsb2dpbkNvbnRyb2xsZXIiLCIkc2NvcGUiLCJzb2NrZXRTZXJ2aWNlIiwiZGlzcGxheVNlcnZpY2UiLCJwbGF5ZXJTZXJ2aWNlIiwiTENTaG93IiwiZ2V0TENTaG93IiwibWFrZVJvb20iLCJlbWl0Iiwicm9vbSIsIm9uIiwiZGF0YSIsImRldmljZU9yaWVudGF0aW9uIiwidXNlcm5hbWUiLCJnYW1tYSIsImJldGEiLCJhbHBoYSIsInVzZXJuYW1lcyIsImNoZWNrVXNlckNvdW50Iiwic2V0UGxheWVycyIsIk9iamVjdCIsImtleXMiLCJsZW5ndGgiLCJzdGFydEdhbWUiLCJzZXRMQ1Nob3ciLCJzZXRQQ1Nob3ciLCJjb250cm9sbGVyIiwicGxheUNvbnRyb2xsZXIiLCIkaW50ZXJ2YWwiLCIkd2luZG93IiwiZmlsdGVyUGxheWVycyIsIm9iaiIsInVzZXJOYW1lIiwiZHJhdyIsIkFsbFBsYXllcnMiLCJzcGVlZCIsImN0eCIsImNsZWFyUmVjdCIsImNhbnYiLCJ3aWR0aCIsImhlaWdodCIsInJhdGlvIiwiQWxsQnVsbGV0cyIsIkJ1bGxldFdpZHRoIiwiQnVsbGV0SGVpZ2h0IiwiaW1hZ2UiLCJidWxsZXQiLCJiIiwiZXhwbG9kZVN0YWdlIiwic2F2ZSIsInRyYW5zbGF0ZSIsIngiLCJ5Iiwicm90YXRlIiwicm90YXRpb24iLCJNYXRoIiwiUEkiLCJkcmF3SW1hZ2UiLCJyZXN0b3JlIiwiY29zIiwic2luIiwiY29uc29sZSIsImxvZyIsImV4cGxvc2lvbkltYWdlIiwiU3BhY2VzaGlwV2lkdGgiLCJTcGFjZXNoaXBIZWlnaHQiLCJwbGF5ZXIiLCJwIiwiZGFtYWdlIiwiZGFtYWdlSW1hZ2UiLCJjaGVja0J1bGxldHMiLCJjb2xsaXNpb25EZXRlY3Rpb24iLCJzcGxpY2UiLCJleHBsb2RlIiwicmFkaXVzIiwic3FydCIsImFuZ2xlIiwiYnVsbGV0SGVhZFgiLCJidWxsZXRIZWFkWSIsInNwYWNlU2hpcFgiLCJzcGFjZVNoaXBZIiwiZGlzdGFuY2UiLCJkYW1hZ2Vzb3VuZCIsIkF1ZGlvIiwicGxheSIsImluY3JlYXNlRGFtYWdlIiwibGlmZSIsIlBDU2hvdyIsImdldFBDU2hvdyIsImN5Y2xlIiwiZG9jdW1lbnQiLCJnZXRFbGVtZW50QnlJZCIsImdldENvbnRleHQiLCJBcnJheSIsIkJ1ZmZlclBsYXllciIsImdldFBsYXllcnMiLCJwdXNoIiwiU3BhY2VzaGlwIiwiY29sb3IiLCJpIiwicm90YXRlU3BhY2VzaGlwUmVsYXRpdmUiLCJvcmllbnRhdGlvbiIsInRlbXAiLCJCdWxsZXQiLCJzaG90IiwiY2FudmFzRGlyZWN0aXZlIiwibGluayIsInNjb3BlIiwiZWxlbWVudCIsImF0dHJzIiwiaW5uZXJXaWR0aCIsImlubmVySGVpZ2h0IiwiYmluZCIsIiRkaWdlc3QiLCJyZXN0cmljdCIsInJlcGxhY2UiLCJ0ZW1wbGF0ZSIsImRpcmVjdGl2ZSIsInRoaXMiLCJJbWFnZSIsInNyYyIsImNoYXJBdCIsInRvVXBwZXJDYXNlIiwic2xpY2UiLCJwcm90b3R5cGUiLCJudW1iZXIiLCJyZXNldCIsIm1vdmVTcGFjZXNoaXAiLCJtb3ZlU3BhY2VzaGlwUmVsYXRpdmUiLCJyb3RhdGVTcGFjZXNoaXAiLCJkZWdyZWUiLCJkZWNyZWFzZURhbWFnZSIsInZhbHVlIiwiZmFjdG9yeSIsInBsYXllcnMiLCJwbGF5ZXJzQXJyYXkiLCIkcm9vdFNjb3BlIiwic29ja2V0IiwiaW8iLCJjb25uZWN0Iiwid2luZG93IiwibG9jYXRpb24iLCJob3N0IiwiZXZlbnROYW1lIiwiY2FsbGJhY2siLCJhcmdzIiwiYXJndW1lbnRzIiwiJGFwcGx5IiwiYXBwbHkiXSwibWFwcGluZ3MiOiJDQUdBLFdBRUFBLFFBQUFDLE9BQUEsYUNEQSxXQUNBLEdBQUFDLEdBQUEsU0FBQUMsRUFBQUMsRUFBQUMsRUFBQUMsR0FFQUgsRUFBQUksT0FBQUYsRUFBQUcsU0FHQSxJQUFBQyxHQUFBLFdBQ0FMLEVBQUFNLEtBQUEsWUFBQSxNQUVBUCxHQUFBUSxLQUFBLEdBQ0FQLEVBQUFRLEdBQUEsY0FBQSxTQUFBQyxHQUNBVixFQUFBUSxLQUFBRSxJQUVBVCxFQUFBUSxHQUFBLG9CQUFBLFNBQUFDLEdBQ0EsR0FDQUMsSUFEQUQsRUFBQUUsWUFFQUQsR0FBQUUsTUFBQUgsRUFBQUcsTUFDQUYsRUFBQUcsS0FBQUosRUFBQUksS0FDQUgsRUFBQUksTUFBQUwsRUFBQUssUUFFQWYsRUFBQWdCLGFBQ0FoQixFQUFBaUIsZ0JBQUEsRUFDQWhCLEVBQUFRLEdBQUEsY0FBQSxTQUFBQyxHQUNBUCxFQUFBZSxXQUFBUixHQUNBVixFQUFBZ0IsVUFBQU4sRUFDQVYsRUFBQWlCLGVBQUFFLE9BQUFDLEtBQUFwQixFQUFBZ0IsV0FBQUssT0FBQSxJQUdBckIsRUFBQXNCLFVBQUEsV0FDQXJCLEVBQUFNLEtBQUEsWUFBQSxNQUNBTCxFQUFBcUIsV0FBQSxHQUNBckIsRUFBQXNCLFdBQUEsSUFJQSxXQUNBbEIsT0FLQVQsU0FBQUMsT0FBQSxPQUFBMkIsV0FBQSxtQkFBQSxTQUFBLGdCQUFBLGlCQUFBLGdCQUFBMUIsT0N6Q0EsV0FDQSxZQUNBLElBQUEyQixHQUFBLFNBQUExQixFQUFBMkIsRUFBQUMsRUFBQTNCLEVBQUFDLEVBQUFDLEdBaUVBLFFBQUEwQixHQUFBQyxFQUFBcEIsR0FDQSxNQUFBQSxHQUFBRSxVQUFBa0IsRUFBQUMsVUFDQSxHQUVBLEVBSUEsUUFBQUMsS0FDQUMsRUFBQVosT0FBQSxJQUNBWSxFQUFBLEdBQUFDLE1BQUEsR0FFQUMsRUFB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QUVBcEksRUFBQSxTQUFBcUksRUFBQUMsR0FDQVAsRUFBQS9ILEdBQUFxSSxFQUFBLFdBQ0EsR0FBQUUsR0FBQUMsU0FDQVYsR0FBQVcsT0FBQSxXQUNBSCxFQUFBSSxNQUFBWCxFQUFBUSxRQUtBekksRUFBQSxTQUFBdUksRUFBQXBJLEVBQUFxSSxHQUNBUCxFQUFBakksS0FBQXVJLEVBQUFwSSxFQUFBLFdBQ0EsR0FBQXNJLEdBQUFDLFNBQ0FWLEdBQUFXLE9BQUEsV0FDQUgsR0FDQUEsRUFBQUksTUFBQVgsRUFBQVEsT0FPQSxRQUNBdkksR0FBQUEsRUFDQUYsS0FBQUEsRUFDQWlJLE9BQUFBLEdBSUEzSSxTQUFBQyxPQUFBLE9BQUFzSSxRQUFBLGlCQUFBLGFBQUFuSSIsImZpbGUiOiJhcHAubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBDcmVhdGVkIGJ5IE1pY2hpZWwgb24gMjUvMTEvMjAxNS5cbiAqL1xuKGZ1bmN0aW9uKCl7XG5cbiAgICB2YXIgYXBwID0gYW5ndWxhci5tb2R1bGUoXCJhcHBcIixbXSk7XG59KSgpOyIsIi8qKlxyXG4gKiBDcmVhdGVkIGJ5IE1pY2hpZWwgb24gMTEvMTIvMjAxNS5cclxuICovXHJcblxyXG4oZnVuY3Rpb24oKXtcclxuICAgIHZhciBsb2dpbkNvbnRyb2xsZXIgPSBmdW5jdGlvbigkc2NvcGUsIHNvY2tldFNlcnZpY2UsIGRpc3BsYXlTZXJ2aWNlLCBwbGF5ZXJTZXJ2aWNlKXtcclxuXHJcbiAgICAgICAgJHNjb3BlLkxDU2hvdyA9IGRpc3BsYXlTZXJ2aWNlLmdldExDU2hvdztcclxuXHJcbiAgICAgICAgLy9mdW5jdGlvbnNcclxuICAgICAgICB2YXIgbWFrZVJvb20gPSBmdW5jdGlvbigpe1xyXG4gICAgICAgICAgICBzb2NrZXRTZXJ2aWNlLmVtaXQoXCJwY2Nvbm5lY3RcIiwgbnVsbCk7XHJcbiAgICAgICAgfTtcclxuICAgICAgICAkc2NvcGUucm9vbSA9IFwiXCI7XHJcbiAgICAgICAgc29ja2V0U2VydmljZS5vbigncmVxdWVzdFJvb20nLGZ1bmN0aW9uKGRhdGEpe1xyXG4gICAgICAgICAgICAkc2NvcGUucm9vbSA9IGRhdGE7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgc29ja2V0U2VydmljZS5vbignZGV2aWNlT3JpZW50YXRpb24nLCBmdW5jdGlvbihkYXRhKXtcclxuICAgICAgICAgICAgdmFyIHVzZXJuYW1lID0gZGF0YS51c2VybmFtZTtcclxuICAgICAgICAgICAgdmFyIGRldmljZU9yaWVudGF0aW9uID0ge307XHJcbiAgICAgICAgICAgIGRldmljZU9yaWVudGF0aW9uLmdhbW1hID0gZGF0YS5nYW1tYTtcclxuICAgICAgICAgICAgZGV2aWNlT3JpZW50YXRpb24uYmV0YSA9IGRhdGEuYmV0YTtcclxuICAgICAgICAgICAgZGV2aWNlT3JpZW50YXRpb24uYWxwaGEgPSBkYXRhLmFscGhhO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgICRzY29wZS51c2VybmFtZXMgPSB7fTtcclxuICAgICAgICAkc2NvcGUuY2hlY2tVc2VyQ291bnQgPSBmYWxzZTtcclxuICAgICAgICBzb2NrZXRTZXJ2aWNlLm9uKCd1cGRhdGV1c2VycycsIGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgIHBsYXllclNlcnZpY2Uuc2V0UGxheWVycyhkYXRhKTtcclxuICAgICAgICAgICAgJHNjb3BlLnVzZXJuYW1lcyA9IGRhdGE7XHJcbiAgICAgICAgICAgICRzY29wZS5jaGVja1VzZXJDb3VudCA9IE9iamVjdC5rZXlzKCRzY29wZS51c2VybmFtZXMpLmxlbmd0aCA8IDA7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICRzY29wZS5zdGFydEdhbWU9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgc29ja2V0U2VydmljZS5lbWl0KFwic3RhcnRHYW1lXCIsIG51bGwpO1xyXG4gICAgICAgICAgICBkaXNwbGF5U2VydmljZS5zZXRMQ1Nob3coZmFsc2UpO1xyXG4gICAgICAgICAgICBkaXNwbGF5U2VydmljZS5zZXRQQ1Nob3codHJ1ZSk7XHJcbiAgICAgICAgfTtcclxuXHJcblxyXG4gICAgICAgIChmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgbWFrZVJvb20oKTtcclxuICAgICAgICB9KSgpO1xyXG5cclxuICAgIH07XHJcblxyXG4gICAgYW5ndWxhci5tb2R1bGUoXCJhcHBcIikuY29udHJvbGxlcihcImxvZ2luQ29udHJvbGxlclwiLCBbXCIkc2NvcGVcIiwgXCJzb2NrZXRTZXJ2aWNlXCIgLCBcImRpc3BsYXlTZXJ2aWNlXCIsIFwicGxheWVyU2VydmljZVwiLCBsb2dpbkNvbnRyb2xsZXJdKTtcclxufSkoKTsiLCIvKipcclxuICogQ3JlYXRlZCBieSBNaWNoaWVsIG9uIDE2LzEyLzIwMTUuXHJcbiAqL1xyXG5cclxuKGZ1bmN0aW9uKCl7XHJcbiAgICBcInVzZSBzdHJpY3RcIjtcclxuICAgIHZhciBwbGF5Q29udHJvbGxlciA9IGZ1bmN0aW9uKCRzY29wZSwgJGludGVydmFsLCAkd2luZG93LCBzb2NrZXRTZXJ2aWNlLCBkaXNwbGF5U2VydmljZSwgcGxheWVyU2VydmljZSl7XHJcbiAgICAgICAgJHNjb3BlLlBDU2hvdyA9IGRpc3BsYXlTZXJ2aWNlLmdldFBDU2hvdztcclxuICAgICAgICAkc2NvcGUuc3RhcnRHYW1lID0gZmFsc2U7XHJcbiAgICAgICAgdmFyIGNhbnYgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZ2FtZScpO1xyXG4gICAgICAgIHZhciBjdHggPSBjYW52LmdldENvbnRleHQoJzJkJyk7XHJcblxyXG4gICAgICAgIHZhciBBbGxQbGF5ZXJzID0gbmV3IEFycmF5KCk7XHJcbiAgICAgICAgdmFyIEFsbEJ1bGxldHMgPSBuZXcgQXJyYXkoKTtcclxuXHJcbiAgICAgICAgdmFyIGN5Y2xlO1xyXG5cclxuICAgICAgICBzb2NrZXRTZXJ2aWNlLm9uKFwiaW5pdEdhbWVcIiwgZnVuY3Rpb24oKXtcclxuICAgICAgICAgICAgdmFyIEJ1ZmZlclBsYXllciA9IHBsYXllclNlcnZpY2UuZ2V0UGxheWVycygpO1xyXG4gICAgICAgICAgICBmb3IodmFyIHBsYXllciBpbiBCdWZmZXJQbGF5ZXIpe1xyXG4gICAgICAgICAgICAgICAgdmFyIHAgPSBCdWZmZXJQbGF5ZXJbcGxheWVyXTtcclxuICAgICAgICAgICAgICAgIEFsbFBsYXllcnMucHVzaChuZXcgU3BhY2VzaGlwKHAudXNlcm5hbWUsIHAueCwgcC55LCBwLmNvbG9yLCBwLnJvdGF0aW9uKSk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGN5Y2xlID0gJGludGVydmFsKGRyYXcsIDEwKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgc29ja2V0U2VydmljZS5vbihcInVzZXJsZWZ0XCIsIGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgIHZhciBwID0gbnVsbDtcclxuICAgICAgICAgICAgZm9yKHZhciBpIGluIEFsbFBsYXllcnMpe1xyXG4gICAgICAgICAgICAgICAgaWYoZmlsdGVyUGxheWVycyhBbGxQbGF5ZXJzW2ldLGRhdGEpID09IHRydWUpe1xyXG4gICAgICAgICAgICAgICAgICAgIHAgPSBpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIEFsbFBsYXllcnMuc3BsaWNlKHAsMSk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHNvY2tldFNlcnZpY2Uub24oXCJ1cGRhdGVHYW1lRGF0YVwiLCBmdW5jdGlvbihkYXRhKXtcclxuICAgICAgICAgICAgdmFyIHAgPSBudWxsO1xyXG4gICAgICAgICAgICBmb3IodmFyIGkgaW4gQWxsUGxheWVycyl7XHJcbiAgICAgICAgICAgICAgICBpZihmaWx0ZXJQbGF5ZXJzKEFsbFBsYXllcnNbaV0sZGF0YSkgPT0gdHJ1ZSl7XHJcbiAgICAgICAgICAgICAgICAgICAgcCA9IGk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYocCAhPSBudWxsKXtcclxuICAgICAgICAgICAgICAgIEFsbFBsYXllcnNbcF0ucm90YXRlU3BhY2VzaGlwUmVsYXRpdmUoZGF0YS5vcmllbnRhdGlvbik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgc29ja2V0U2VydmljZS5vbihcInBsYXllclNob3RcIiwgZnVuY3Rpb24oZGF0YSl7XHJcbiAgICAgICAgICAgIHZhciBwID0gbnVsbDtcclxuICAgICAgICAgICAgZm9yKHZhciBpIGluIEFsbFBsYXllcnMpe1xyXG4gICAgICAgICAgICAgICAgaWYoZmlsdGVyUGxheWVycyhBbGxQbGF5ZXJzW2ldLGRhdGEpID09IHRydWUpe1xyXG4gICAgICAgICAgICAgICAgICAgIHAgPSBpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmKHAgIT0gbnVsbCl7XHJcbiAgICAgICAgICAgICAgICB2YXIgdGVtcCA9IEFsbFBsYXllcnNbcF07XHJcbiAgICAgICAgICAgICAgICB2YXIgYW5nbGUgPSAoMzYwIC0odGVtcC5yb3RhdGlvbiArIDE4MCkpLzE4MCpNYXRoLlBJO1xyXG4gICAgICAgICAgICAgICAgdmFyIHggPSB0ZW1wLnggKyAoY2Fudi53aWR0aC80MDAgKiBNYXRoLnNpbihhbmdsZSkpO1xyXG4gICAgICAgICAgICAgICAgdmFyIHkgPSB0ZW1wLnkgKyAoY2Fudi53aWR0aC80MDAgKiBNYXRoLmNvcyhhbmdsZSkpO1xyXG4gICAgICAgICAgICAgICAgQWxsQnVsbGV0cy5wdXNoKG5ldyBCdWxsZXQoeCwgeSwgdGVtcC5yb3RhdGlvbiwgdGVtcC5jb2xvciwgdGVtcC51c2VyTmFtZSkpO1xyXG4gICAgICAgICAgICAgICAgaWYocCUyID09IDApe1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBzaG90ID0gbmV3IEF1ZGlvKCcuLi8uLi9hc3NldHMvQm9udXMvc2Z4X2xhc2VyMS5vZ2cnKTtcclxuICAgICAgICAgICAgICAgIH1lbHNle1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBzaG90ID0gbmV3IEF1ZGlvKCcuLi8uLi9hc3NldHMvQm9udXMvc2Z4X2xhc2VyMi5vZ2cnKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHNob3QucGxheSgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGZpbHRlclBsYXllcnMob2JqLGRhdGEpe1xyXG4gICAgICAgICAgICBpZihkYXRhLnVzZXJuYW1lID09IG9iai51c2VyTmFtZSl7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGRyYXcoKXtcclxuICAgICAgICAgICAgaWYoQWxsUGxheWVycy5sZW5ndGg+MCl7XHJcbiAgICAgICAgICAgICAgICBBbGxQbGF5ZXJzWzBdLnNwZWVkID0gMDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjdHguY2xlYXJSZWN0KDAsMCxjYW52LndpZHRoLCBjYW52LmhlaWdodCk7XHJcbiAgICAgICAgICAgIHZhciByYXRpbyA9IGNhbnYud2lkdGgvMTAwO1xyXG5cclxuICAgICAgICAgICAgaWYoQWxsQnVsbGV0cy5sZW5ndGggIT0gMCl7XHJcbiAgICAgICAgICAgICAgICB2YXIgQnVsbGV0V2lkdGggPSBjYW52LndpZHRoLzEwMDtcclxuICAgICAgICAgICAgICAgIHZhciBCdWxsZXRIZWlnaHQgPSBCdWxsZXRXaWR0aCAqIEFsbEJ1bGxldHNbMF0uaW1hZ2UuaGVpZ2h0L0FsbEJ1bGxldHNbMF0uaW1hZ2Uud2lkdGg7XHJcblxyXG4gICAgICAgICAgICAgICAgZm9yKHZhciBidWxsZXQgaW4gQWxsQnVsbGV0cyl7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGIgPSBBbGxCdWxsZXRzW2J1bGxldF07XHJcbiAgICAgICAgICAgICAgICAgICAgYi53aWR0aCA9IEJ1bGxldFdpZHRoO1xyXG4gICAgICAgICAgICAgICAgICAgIGIuaGVpZ2h0ID0gQnVsbGV0SGVpZ2h0O1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBpZihiLmV4cGxvZGVTdGFnZSA9PSAwKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy9EcmF3IGJ1bGxldFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjdHguc2F2ZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjdHgudHJhbnNsYXRlKGIueCpyYXRpbywgYi55KnJhdGlvKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY3R4LnJvdGF0ZShiLnJvdGF0aW9uLzE4MCpNYXRoLlBJKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY3R4LmRyYXdJbWFnZShiLmltYWdlLCAtQnVsbGV0V2lkdGgvMiwgLUJ1bGxldEhlaWdodC8yLCBCdWxsZXRXaWR0aCwgQnVsbGV0SGVpZ2h0KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY3R4LnJlc3RvcmUoKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIEFsbEJ1bGxldHNbYnVsbGV0XS54ID0gTWF0aC5jb3MoKGIucm90YXRpb24gLSA5MCkvMTgwKk1hdGguUEkpICsgYi54O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBBbGxCdWxsZXRzW2J1bGxldF0ueSA9IE1hdGguc2luKChiLnJvdGF0aW9uIC0gOTApLzE4MCpNYXRoLlBJKSsgYi55O1xyXG4gICAgICAgICAgICAgICAgICAgIH1lbHNlIGlmKGIuZXhwbG9kZVN0YWdlIDwgNCl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vRHJhdyBleHBsb3Npb25cclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coYi5leHBsb3Npb25JbWFnZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5zYXZlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGN0eC50cmFuc2xhdGUoYi54KnJhdGlvLCBiLnkqcmF0aW8pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjdHguZHJhd0ltYWdlKGIuZXhwbG9zaW9uSW1hZ2UsIC1CdWxsZXRXaWR0aCwgLUJ1bGxldFdpZHRoLCBCdWxsZXRXaWR0aCoyLCBCdWxsZXRXaWR0aCoyKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY3R4LnJlc3RvcmUoKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmKEFsbFBsYXllcnMubGVuZ3RoICE9IDApe1xyXG4gICAgICAgICAgICAgICAgdmFyIFNwYWNlc2hpcFdpZHRoID0gY2Fudi53aWR0aC8yMDtcclxuICAgICAgICAgICAgICAgIHZhciBTcGFjZXNoaXBIZWlnaHQgPSBTcGFjZXNoaXBXaWR0aCAqIEFsbFBsYXllcnNbMF0uaW1hZ2UuaGVpZ2h0LyBBbGxQbGF5ZXJzWzBdLmltYWdlLndpZHRoO1xyXG5cclxuICAgICAgICAgICAgICAgIGZvcih2YXIgcGxheWVyIGluIEFsbFBsYXllcnMpe1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBwID0gQWxsUGxheWVyc1twbGF5ZXJdO1xyXG4gICAgICAgICAgICAgICAgICAgIHAud2lkdGggPSBTcGFjZXNoaXBXaWR0aDtcclxuICAgICAgICAgICAgICAgICAgICBwLmhlaWdodCA9IFNwYWNlc2hpcEhlaWdodDtcclxuICAgICAgICAgICAgICAgICAgICBjdHguc2F2ZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIGN0eC50cmFuc2xhdGUocC54KnJhdGlvLCBwLnkqcmF0aW8pO1xyXG4gICAgICAgICAgICAgICAgICAgIGN0eC5yb3RhdGUocC5yb3RhdGlvbi8xODAqTWF0aC5QSSk7XHJcbiAgICAgICAgICAgICAgICAgICAgY3R4LmRyYXdJbWFnZShwLmltYWdlLCAtU3BhY2VzaGlwV2lkdGgvMiwgLVNwYWNlc2hpcEhlaWdodC8yLCBTcGFjZXNoaXBXaWR0aCwgU3BhY2VzaGlwSGVpZ2h0KTtcclxuICAgICAgICAgICAgICAgICAgICBpZihwLmRhbWFnZSA+IDApe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjdHguZHJhd0ltYWdlKHAuZGFtYWdlSW1hZ2UsIC1TcGFjZXNoaXBXaWR0aC8yLCAtU3BhY2VzaGlwSGVpZ2h0LzIsIFNwYWNlc2hpcFdpZHRoLCBTcGFjZXNoaXBIZWlnaHQpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBjdHgucmVzdG9yZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIEFsbFBsYXllcnNbcGxheWVyXS54ID0gTWF0aC5jb3MoKHAucm90YXRpb24gLSA5MCkvMTgwKk1hdGguUEkpLzEwKiBwLnNwZWVkICsgcC54O1xyXG4gICAgICAgICAgICAgICAgICAgIEFsbFBsYXllcnNbcGxheWVyXS55ID0gTWF0aC5zaW4oKHAucm90YXRpb24gLSA5MCkvMTgwKk1hdGguUEkpLzEwKiBwLnNwZWVkICsgcC55O1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBjaGVja0J1bGxldHMoKTtcclxuXHJcbiAgICAgICAgICAgIGNvbGxpc2lvbkRldGVjdGlvbigpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gY2hlY2tCdWxsZXRzKCl7XHJcblxyXG4gICAgICAgICAgICBmb3IodmFyIGIgaW4gQWxsQnVsbGV0cyl7XHJcbiAgICAgICAgICAgICAgICBpZihBbGxCdWxsZXRzW2JdLnggPCAwIHx8IEFsbEJ1bGxldHNbYl0ueCA+IGNhbnYud2lkdGggfHwgQWxsQnVsbGV0c1tiXS55IDwgMCB8fCBBbGxCdWxsZXRzW2JdLnkgPiBjYW52LmhlaWdodCl7XHJcbiAgICAgICAgICAgICAgICAgICAgQWxsQnVsbGV0cy5zcGxpY2UoYiwgMSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZihBbGxCdWxsZXRzW2JdLmV4cGxvZGVTdGFnZSA+MCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChBbGxCdWxsZXRzW2JdLmV4cGxvZGVTdGFnZSA8IDQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgQWxsQnVsbGV0c1tiXS5leHBsb2RlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgQWxsQnVsbGV0cy5zcGxpY2UoYiwgMSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBjb2xsaXNpb25EZXRlY3Rpb24oKXtcclxuICAgICAgICAgICAgZm9yKHZhciBwIGluIEFsbFBsYXllcnMpe1xyXG4gICAgICAgICAgICAgICAgZm9yKHZhciBiIGluIEFsbEJ1bGxldHMpe1xyXG4gICAgICAgICAgICAgICAgICAgIGlmKEFsbEJ1bGxldHNbYl0uZXhwbG9kZVN0YWdlID09IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKEFsbEJ1bGxldHNbYl0ucGxheWVyICE9IEFsbFBsYXllcnNbcF0udXNlck5hbWUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciByYWRpdXMgPSBNYXRoLnNxcnQoMikgLyAyICogKEFsbEJ1bGxldHNbYl0uaGVpZ2h0IC8gMiAtIEFsbEJ1bGxldHNbYl0ud2lkdGggLyAyKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBhbmdsZSA9ICgzNjAgLSAoQWxsQnVsbGV0c1tiXS5yb3RhdGlvbikpIC8gMTgwICogTWF0aC5QSTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBidWxsZXRIZWFkWCA9IChBbGxCdWxsZXRzW2JdLnggKiBjYW52LndpZHRoIC8gMTAwIC0gKHJhZGl1cyAqIE1hdGguc2luKGFuZ2xlKSkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGJ1bGxldEhlYWRZID0gKEFsbEJ1bGxldHNbYl0ueSAqIGNhbnYud2lkdGggLyAxMDAgLSAocmFkaXVzICogTWF0aC5jb3MoYW5nbGUpKSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHNwYWNlU2hpcFggPSBBbGxQbGF5ZXJzW3BdLnggKiBjYW52LndpZHRoIC8gMTAwO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHNwYWNlU2hpcFkgPSBBbGxQbGF5ZXJzW3BdLnkgKiBjYW52LndpZHRoIC8gMTAwO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8qY3R4LnNhdmUoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdHguYmVnaW5QYXRoKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3R4LmFyYyhzcGFjZVNoaXBYLCBzcGFjZVNoaXBZLCBBbGxQbGF5ZXJzW3BdLndpZHRoLzIsIDAsIE1hdGguUEkqMik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3R4LmxpbmVXaWR0aCA9IDE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3R4LnN0cm9rZVN0eWxlID0gJyMwMDAwRkYnO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5zdHJva2UoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdHgucmVzdG9yZSgpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdHguc2F2ZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5iZWdpblBhdGgoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdHguYXJjKGJ1bGxldEhlYWRYLCBidWxsZXRIZWFkWSwgQWxsQnVsbGV0c1tiXS53aWR0aC8yLCAwLCBNYXRoLlBJKjIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5saW5lV2lkdGggPSAxO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5zdHJva2VTdHlsZSA9ICcjRkYwMDAwJztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdHguc3Ryb2tlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3R4LnJlc3RvcmUoKTsqL1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGRpc3RhbmNlID0gTWF0aC5zcXJ0KChidWxsZXRIZWFkWCAtIHNwYWNlU2hpcFgpICogKGJ1bGxldEhlYWRYIC0gc3BhY2VTaGlwWCkgKyAoYnVsbGV0SGVhZFkgLSBzcGFjZVNoaXBZKSAqIChidWxsZXRIZWFkWSAtIHNwYWNlU2hpcFkpKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkaXN0YW5jZSA8IChBbGxCdWxsZXRzW2JdLndpZHRoIC8gMiArIEFsbFBsYXllcnNbcF0ud2lkdGggLyAyKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBkYW1hZ2Vzb3VuZCA9IG5ldyBBdWRpbygnLi4vLi4vYXNzZXRzL0JvbnVzL3NmeF9sb3NlLm9nZycpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhbWFnZXNvdW5kLnBsYXkoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBBbGxQbGF5ZXJzW3BdLmluY3JlYXNlRGFtYWdlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGRhdGEgPSB7fTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhLnVzZXJuYW1lID0gQWxsUGxheWVyc1twXS51c2VyTmFtZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhLmxpZmUgPSAzLUFsbFBsYXllcnNbcF0uZGFtYWdlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNvY2tldFNlcnZpY2UuZW1pdChcInBsYXllckxpZmVcIixkYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBBbGxCdWxsZXRzW2JdLmV4cGxvZGUoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH07XHJcblxyXG4gICAgYW5ndWxhci5tb2R1bGUoXCJhcHBcIikuY29udHJvbGxlcihcInBsYXlDb250cm9sbGVyXCIsIFtcIiRzY29wZVwiLCBcIiRpbnRlcnZhbFwiLCBcIiR3aW5kb3dcIiwgXCJzb2NrZXRTZXJ2aWNlXCIsIFwiZGlzcGxheVNlcnZpY2VcIiwgXCJwbGF5ZXJTZXJ2aWNlXCIsIHBsYXlDb250cm9sbGVyXSlcclxufSkoKTsiLCIvKipcclxuICogQ3JlYXRlZCBieSBqdXN0aWpuZGVwb3ZlciBvbiAxNi8xMi8xNS5cclxuICovXHJcbihmdW5jdGlvbigpe1xyXG4gICAgdmFyIGNhbnZhc0RpcmVjdGl2ZSA9IGZ1bmN0aW9uKCR3aW5kb3cpe1xyXG4gICAgICAgIHJldHVybntcclxuICAgICAgICAgICAgcmVzdHJpY3Q6ICdFJyxcclxuICAgICAgICAgICAgbGluazpsaW5rLFxyXG4gICAgICAgICAgICByZXBsYWNlOnRydWUsXHJcbiAgICAgICAgICAgIHRlbXBsYXRlOic8Y2FudmFzIGlkPVwiZ2FtZVwiIGNsYXNzPVwicGxheUFyZWFcIiB3aWR0aD1cInt7d2lkdGh9fVwiIGhlaWdodD1cInt7d2lkdGh9fVwiIC8+J1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGxpbmsoc2NvcGUsIGVsZW1lbnQsIGF0dHJzKXtcclxuICAgICAgICAgICAgaWYoJHdpbmRvdy5pbm5lcldpZHRoIDwgJHdpbmRvdy5pbm5lckhlaWdodCl7XHJcbiAgICAgICAgICAgICAgICBzY29wZS53aWR0aCA9ICR3aW5kb3cuaW5uZXJXaWR0aCAtIDIwO1xyXG4gICAgICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgICAgIHNjb3BlLndpZHRoID0gJHdpbmRvdy5pbm5lckhlaWdodCAtIDIwO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBhbmd1bGFyLmVsZW1lbnQoJHdpbmRvdykuYmluZCgncmVzaXplJywgZnVuY3Rpb24oKXtcclxuICAgICAgICAgICAgICAgIGlmKCR3aW5kb3cuaW5uZXJXaWR0aCA8ICR3aW5kb3cuaW5uZXJIZWlnaHQpe1xyXG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLndpZHRoID0gJHdpbmRvdy5pbm5lcldpZHRoIC0gMjA7XHJcbiAgICAgICAgICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgICAgICAgICBzY29wZS53aWR0aCA9ICR3aW5kb3cuaW5uZXJIZWlnaHQgLSAyMDtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBzY29wZS4kZGlnZXN0KCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcblxyXG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcCcpLmRpcmVjdGl2ZShcImNhbnZhc0RpcmVjdGl2ZVwiLCBbXCIkd2luZG93XCIsIGNhbnZhc0RpcmVjdGl2ZV0pO1xyXG59KSgpOyIsIi8qKlxyXG4gKiBDcmVhdGVkIGJ5IGp1c3Rpam5kZXBvdmVyIG9uIDIyLzEyLzE1LlxyXG4gKi9cclxuXHJcbnZhciBCdWxsZXQgPSBmdW5jdGlvbih4LCB5LHJvdGF0aW9uLCBjb2xvciwgcGxheWVyKXtcclxuICAgIHRoaXMueCA9IHg7XHJcbiAgICB0aGlzLnkgPSB5O1xyXG4gICAgdGhpcy5yb3RhdGlvbiA9IHJvdGF0aW9uO1xyXG4gICAgdGhpcy5pbWFnZSA9IG5ldyBJbWFnZSgpO1xyXG4gICAgdGhpcy5jb2xvciA9IGNvbG9yO1xyXG4gICAgdGhpcy53aWR0aCA9IDA7XHJcbiAgICB0aGlzLmhlaWdodCA9IDA7XHJcbiAgICB0aGlzLnBsYXllciA9IHBsYXllcjtcclxuICAgIHRoaXMuZXhwbG9zaW9uSW1hZ2UgPSBuZXcgSW1hZ2UoKTtcclxuICAgIHRoaXMuZXhwbG9kZVN0YWdlID0gMDtcclxuICAgIGlmKHRoaXMuY29sb3IgPT0gXCJvcmFuZ2VcIil7XHJcbiAgICAgICAgdGhpcy5jb2xvciA9ICdyZWQnO1xyXG4gICAgfVxyXG4gICAgdGhpcy5pbWFnZS5zcmMgPSAnLi4vYXNzZXRzL1BORy9MYXNlcnMvbGFzZXInKyB0aGlzLmNvbG9yLmNoYXJBdCgwKS50b1VwcGVyQ2FzZSgpICsgdGhpcy5jb2xvci5zbGljZSgxKSArJzAxLnBuZydcclxufTtcclxuXHJcbkJ1bGxldC5wcm90b3R5cGUuZXhwbG9kZSA9IGZ1bmN0aW9uKCl7XHJcbiAgICBpZih0aGlzLmV4cGxvZGVTdGFnZSA8IDQpe1xyXG4gICAgICAgIHRoaXMuZXhwbG9kZVN0YWdlKys7XHJcbiAgICAgICAgdmFyIG51bWJlcjtcclxuICAgICAgICBpZih0aGlzLmV4cGxvZGVTdGFnZSA8IDMpe1xyXG4gICAgICAgICAgIG51bWJlciA9IDFcclxuICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgbnVtYmVyID0gMlxyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmV4cGxvc2lvbkltYWdlLnNyYyA9ICcuLi9hc3NldHMvUE5HL0xhc2Vycy9sYXNlcicgKyB0aGlzLmNvbG9yLmNoYXJBdCgwKS50b1VwcGVyQ2FzZSgpICsgdGhpcy5jb2xvci5zbGljZSgxKSArICdFeHBsb2RlJysgbnVtYmVyICsnLnBuZyc7XHJcbiAgICB9ZWxzZXtcclxuICAgICAgICB0aGlzLmV4cGxvc2lvbkltYWdlLnNyYyA9ICcnO1xyXG4gICAgfVxyXG59O1xyXG4iLCIvKipcclxuICogQ3JlYXRlZCBieSBqdXN0aWpuZGVwb3ZlciBvbiAwOS8xMi8xNS5cclxuICovXHJcblxyXG52YXIgU3BhY2VzaGlwID0gZnVuY3Rpb24odXNlck5hbWUsIHgsIHksIGNvbG9yLCByb3RhdGlvbil7XHJcbiAgICB0aGlzLnVzZXJOYW1lID0gdXNlck5hbWU7XHJcbiAgICB0aGlzLnggPSB4O1xyXG4gICAgdGhpcy55ID0geTtcclxuICAgIHRoaXMuc3BlZWQgPSAxO1xyXG4gICAgdGhpcy5jb2xvciA9IGNvbG9yO1xyXG4gICAgdGhpcy5yb3RhdGlvbiA9IHJvdGF0aW9uO1xyXG4gICAgdGhpcy5pbWFnZSA9IG5ldyBJbWFnZSgpO1xyXG4gICAgdGhpcy5kYW1hZ2UgPSAwO1xyXG4gICAgdGhpcy53aWR0aCA9IDA7XHJcbiAgICB0aGlzLmhlaWdodCA9IDA7XHJcbiAgICB0aGlzLmRhbWFnZUltYWdlID0gbmV3IEltYWdlKCk7XHJcbiAgICB0aGlzLmltYWdlLnNyYyA9ICcuLi9hc3NldHMvUE5HL3BsYXllclNoaXAxXycrIHRoaXMuY29sb3IgKycucG5nJ1xyXG59O1xyXG5cclxuU3BhY2VzaGlwLnByb3RvdHlwZS5yZXNldCA9IGZ1bmN0aW9uICgpIHtcclxuXHJcbn07XHJcblxyXG5TcGFjZXNoaXAucHJvdG90eXBlLm1vdmVTcGFjZXNoaXAgPSBmdW5jdGlvbih4LCB5KXtcclxuICAgIHRoaXMueCA9IHg7XHJcbiAgICB0aGlzLnkgPSB5O1xyXG59O1xyXG5cclxuU3BhY2VzaGlwLnByb3RvdHlwZS5tb3ZlU3BhY2VzaGlwUmVsYXRpdmUgPSBmdW5jdGlvbih4LCB5KXtcclxuICAgIHRoaXMueCA9IHRoaXMueCt4O1xyXG4gICAgdGhpcy55ID0gdGhpcy55K3k7XHJcbn07XHJcblxyXG5TcGFjZXNoaXAucHJvdG90eXBlLnJvdGF0ZVNwYWNlc2hpcCA9IGZ1bmN0aW9uKGRlZ3JlZSl7XHJcbiAgICB0aGlzLnJvdGF0aW9uID0gZGVncmVlO1xyXG59O1xyXG5cclxuU3BhY2VzaGlwLnByb3RvdHlwZS5yb3RhdGVTcGFjZXNoaXBSZWxhdGl2ZSA9IGZ1bmN0aW9uKGRlZ3JlZSl7XHJcbiAgICB0aGlzLnJvdGF0aW9uID0gdGhpcy5yb3RhdGlvbiArIGRlZ3JlZS81O1xyXG4gICAgaWYodGhpcy5yb3RhdGlvbiA8IC0zNjApe1xyXG4gICAgICAgIHRoaXMucm90YXRpb24gPSB0aGlzLnJvdGF0aW9uICsgNzIwO1xyXG4gICAgfVxyXG4gICAgaWYodGhpcy5yb3RhdGlvbiA+IDM2MCl7XHJcbiAgICAgICAgdGhpcy5yb3RhdGlvbiA9IHRoaXMucm90YXRpb24gLSA3MjA7XHJcbiAgICB9XHJcbn07XHJcblxyXG5TcGFjZXNoaXAucHJvdG90eXBlLmluY3JlYXNlRGFtYWdlID0gZnVuY3Rpb24oKXtcclxuICAgIGlmKHRoaXMuZGFtYWdlIDwgNCl7XHJcbiAgICAgICAgdGhpcy5kYW1hZ2UgKz0gMTtcclxuICAgIH1cclxuXHJcbiAgICBpZih0aGlzLmRhbWFnZSA8PSAzICYmIHRoaXMuZGFtYWdlID4gMCl7XHJcbiAgICAgICAgdGhpcy5kYW1hZ2VJbWFnZS5zcmMgPSAnLi4vYXNzZXRzL1BORy9EYW1hZ2UvcGxheWVyU2hpcDFfZGFtYWdlJysgdGhpcy5kYW1hZ2UgKyAnLnBuZyc7XHJcbiAgICB9ZWxzZSBpZih0aGlzLmRhbWFnZT09NCl7XHJcbiAgICAgICAgdGhpcy5kYW1hZ2VJbWFnZS5zcmMgPSAnLi4vYXNzZXRzL1BORy9EYW1hZ2UvZXhwbG9kZS5naWYnO1xyXG4gICAgfVxyXG59O1xyXG5cclxuU3BhY2VzaGlwLnByb3RvdHlwZS5kZWNyZWFzZURhbWFnZSA9IGZ1bmN0aW9uKCl7XHJcbiAgICBpZih0aGlzLmRhbWFnZSA+IDApe1xyXG4gICAgICAgIHRoaXMuZGFtYWdlIC09IDE7XHJcbiAgICB9XHJcblxyXG4gICAgaWYodGhpcy5kYW1hZ2UgPD0gMyAmJiB0aGlzLmRhbWFnZSA+IDApe1xyXG4gICAgICAgIHRoaXMuZGFtYWdlSW1hZ2Uuc3JjID0gJy4uL2Fzc2V0cy9QTkcvRGFtYWdlL3BsYXllclNoaXAxX2RhbWFnZScrIHRoaXMuZGFtYWdlICsgJy5wbmcnO1xyXG4gICAgfVxyXG59O1xyXG5cclxuIiwiLyoqXHJcbiAqIENyZWF0ZWQgYnkgTWljaGllbCBvbiAxNi8xMi8yMDE1LlxyXG4gKi9cclxuLyoqXHJcbiAqIENyZWF0ZWQgYnkganVzdGlqbmRlcG92ZXIgb24gMTYvMTIvMTUuXHJcbiAqL1xyXG5cclxuXHJcbihmdW5jdGlvbigpe1xyXG4gICAgdmFyIGRpc3BsYXlTZXJ2aWNlID0gZnVuY3Rpb24oKXtcclxuICAgICAgICAvL0xvZ2luIENvbnRyb2xsZXJcclxuICAgICAgICB2YXIgTENTaG93ID0gdHJ1ZTtcclxuICAgICAgICAvL1BsYXkgY29udHJvbGxlclxyXG4gICAgICAgIHZhciBQQ1Nob3cgPSBmYWxzZTtcclxuXHJcbiAgICAgICAgcmV0dXJue1xyXG4gICAgICAgICAgICBnZXRMQ1Nob3c6IGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gTENTaG93O1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBzZXRMQ1Nob3c6IGZ1bmN0aW9uKHZhbHVlKXtcclxuICAgICAgICAgICAgICAgIExDU2hvdyA9IHZhbHVlO1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBnZXRQQ1Nob3c6IGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gUENTaG93O1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBzZXRQQ1Nob3c6IGZ1bmN0aW9uKHZhbHVlKXtcclxuICAgICAgICAgICAgICAgIFBDU2hvdyA9IHZhbHVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuXHJcbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwJykuZmFjdG9yeSgnZGlzcGxheVNlcnZpY2UnLCBbZGlzcGxheVNlcnZpY2VdKTtcclxufSkoKTsiLCIvKipcclxuICogQ3JlYXRlZCBieSBqdXN0aWpuZGVwb3ZlciBvbiAxNy8xMi8xNS5cclxuICovXHJcblxyXG4oZnVuY3Rpb24oKXtcclxuICAgIHZhciBwbGF5ZXJTZXJ2aWNlID0gZnVuY3Rpb24oKXtcclxuICAgICAgICAvL0xvZ2luIENvbnRyb2xsZXJcclxuICAgICAgICB2YXIgcGxheWVycyA9IFtdO1xyXG5cclxuICAgICAgICByZXR1cm57XHJcbiAgICAgICAgICAgIGdldFBsYXllcnM6IGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gcGxheWVycztcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgc2V0UGxheWVyczogZnVuY3Rpb24ocGxheWVyc0FycmF5KXtcclxuICAgICAgICAgICAgICAgIHBsYXllcnMgPSBwbGF5ZXJzQXJyYXk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9O1xyXG5cclxuICAgIGFuZ3VsYXIubW9kdWxlKCdhcHAnKS5mYWN0b3J5KCdwbGF5ZXJTZXJ2aWNlJywgW3BsYXllclNlcnZpY2VdKTtcclxufSkoKTsiLCIvKipcclxuICogQ3JlYXRlZCBieSBqdXN0aWpuZGVwb3ZlciBvbiAwOS8xMi8xNS5cclxuICovXHJcblxyXG4oZnVuY3Rpb24oKXtcclxuXHJcbiAgICB2YXIgc29ja2V0U2VydmljZSA9IGZ1bmN0aW9uKCRyb290U2NvcGUpe1xyXG4gICAgICAgIFwidXNlIHN0cmljdFwiO1xyXG4gICAgICAgIC8vcHJpdmF0ZVxyXG4gICAgICAgIHZhciBzb2NrZXQgPSBpby5jb25uZWN0KHdpbmRvdy5sb2NhdGlvbi5ob3N0KTtcclxuICAgICAgICAvL2Z1bmN0aW9uc1xyXG4gICAgICAgIHZhciBvbiA9IGZ1bmN0aW9uIChldmVudE5hbWUsIGNhbGxiYWNrKSB7XHJcbiAgICAgICAgICAgIHNvY2tldC5vbihldmVudE5hbWUsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIHZhciBhcmdzID0gYXJndW1lbnRzO1xyXG4gICAgICAgICAgICAgICAgJHJvb3RTY29wZS4kYXBwbHkoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrLmFwcGx5KHNvY2tldCwgYXJncyk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGVtaXQgPSBmdW5jdGlvbiAoZXZlbnROYW1lLCBkYXRhLCBjYWxsYmFjaykge1xyXG4gICAgICAgICAgICBzb2NrZXQuZW1pdChldmVudE5hbWUsIGRhdGEsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIHZhciBhcmdzID0gYXJndW1lbnRzO1xyXG4gICAgICAgICAgICAgICAgJHJvb3RTY29wZS4kYXBwbHkoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChjYWxsYmFjaykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFjay5hcHBseShzb2NrZXQsIGFyZ3MpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIC8vcHVibGljXHJcbiAgICAgICAgcmV0dXJue1xyXG4gICAgICAgICAgICBvbjogb24sXHJcbiAgICAgICAgICAgIGVtaXQ6IGVtaXQsXHJcbiAgICAgICAgICAgIHNvY2tldDogc29ja2V0XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuXHJcbiAgICBhbmd1bGFyLm1vZHVsZShcImFwcFwiKS5mYWN0b3J5KFwic29ja2V0U2VydmljZVwiLCBbXCIkcm9vdFNjb3BlXCIsIHNvY2tldFNlcnZpY2VdKTtcclxuXHJcbn0pKCk7Il0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
