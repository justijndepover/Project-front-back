!function(){angular.module("app",[])}(),function(){var e=function(e,t,a,i){e.LCShow=a.getLCShow;var o=function(){t.emit("pcconnect",null)};e.room="",t.on("requestRoom",function(t){e.room=t}),t.on("deviceOrientation",function(e){var t=(e.username,{});t.gamma=e.gamma,t.beta=e.beta,t.alpha=e.alpha}),e.usernames={},e.checkUserCount=!1,t.on("updateusers",function(t){i.setPlayers(t),e.usernames=t,e.checkUserCount=Object.keys(e.usernames).length<0}),e.startGame=function(){t.emit("startGame",null),a.setLCShow(!1),a.setPCShow(!0)},function(){o()}()};angular.module("app").controller("loginController",["$scope","socketService","displayService","playerService",e])}(),function(){"use strict";var e=function(e,t,a,i,o,n){function r(e,t){return t.username==e.userName?!0:!1}function s(){u.length>0&&(u[0].speed=0),g.clearRect(0,0,p.width,p.height);var e=p.width/100;if(0!=d.length){var t=p.width/100,a=t*d[0].image.height/d[0].image.width;for(var i in d){var o=d[i];o.width=t,o.height=a,0==o.explodeStage?(g.save(),g.translate(o.x*e,o.y*e),g.rotate(o.rotation/180*Math.PI),g.drawImage(o.image,-t/2,-a/2,t,a),g.restore(),d[i].x=Math.cos((o.rotation-90)/180*Math.PI)+o.x,d[i].y=Math.sin((o.rotation-90)/180*Math.PI)+o.y):o.explodeStage<4&&(console.log(o.explosionImage),g.save(),g.translate(o.x*e,o.y*e),g.drawImage(o.explosionImage,-t,-t,2*t,2*t),g.restore())}}if(0!=u.length){var n=p.width/20,r=n*u[0].image.height/u[0].image.width;for(var s in u){var l=u[s];l.width=n,l.height=r,g.save(),g.translate(l.x*e,l.y*e),g.rotate(l.rotation/180*Math.PI),g.drawImage(l.image,-n/2,-r/2,n,r),l.damage>0&&g.drawImage(l.damageImage,-n/2,-r/2,n,r),g.restore(),u[s].x=Math.cos((l.rotation-90)/180*Math.PI)/10*l.speed+l.x,u[s].y=Math.sin((l.rotation-90)/180*Math.PI)/10*l.speed+l.y}}h(),c()}function h(){for(var e in d)(d[e].x<0||d[e].x>p.width||d[e].y<0||d[e].y>p.height)&&d.splice(e,1),d[e].explodeStage>0&&(d[e].explodeStage<4?d[e].explode():d.splice(e,1))}function c(){for(var e in u)for(var t in d)if(0==d[t].explodeStage&&d[t].player!=u[e].userName){var a=Math.sqrt(2)/2*(d[t].height/2-d[t].width/2),o=(360-d[t].rotation)/180*Math.PI,n=d[t].x*p.width/100-a*Math.sin(o),r=d[t].y*p.width/100-a*Math.cos(o),s=u[e].x*p.width/100,h=u[e].y*p.width/100,c=Math.sqrt((n-s)*(n-s)+(r-h)*(r-h));if(c<d[t].width/2+u[e].width/2){var l=new Audio("../../assets/Bonus/sfx_lose.ogg");l.play(),u[e].increaseDamage();var g={};g.username=u[e].userName,g.life=3-u[e].damage,i.emit("playerLife",g),d[t].explode()}}}e.PCShow=o.getPCShow,e.startGame=!1;var l,p=document.getElementById("game"),g=p.getContext("2d"),u=new Array,d=new Array;i.on("initGame",function(){var e=n.getPlayers();for(var a in e){var i=e[a];u.push(new Spaceship(i.username,i.x,i.y,i.color,i.rotation))}l=t(s,10)}),i.on("userleft",function(e){var t=null;for(var a in u)1==r(u[a],e)&&(t=a);u.splice(t,1)}),i.on("updateGameData",function(e){var t=null;for(var a in u)1==r(u[a],e)&&(t=a);null!=t&&u[t].rotateSpaceshipRelative(e.orientation)}),i.on("playerShot",function(e){var t=null;for(var a in u)1==r(u[a],e)&&(t=a);if(null!=t){var i=u[t],o=(360-(i.rotation+180))/180*Math.PI,n=i.x+p.width/400*Math.sin(o),s=i.y+p.width/400*Math.cos(o);if(d.push(new Bullet(n,s,i.rotation,i.color,i.userName)),t%2==0)var h=new Audio("../../assets/Bonus/sfx_laser1.ogg");else var h=new Audio("../../assets/Bonus/sfx_laser2.ogg");h.play()}})};angular.module("app").controller("playController",["$scope","$interval","$window","socketService","displayService","playerService",e])}();var Bullet=function(e,t,a,i,o){this.x=e,this.y=t,this.rotation=a,this.image=new Image,this.color=i,this.width=0,this.height=0,this.player=o,this.explosionImage=new Image,this.explodeStage=0,"orange"==this.color&&(this.color="red"),this.image.src="../assets/PNG/Lasers/laser"+this.color.charAt(0).toUpperCase()+this.color.slice(1)+"01.png"};Bullet.prototype.explode=function(){if(this.explodeStage<4){this.explodeStage++;var e;e=this.explodeStage<3?1:2,this.explosionImage.src="../assets/PNG/Lasers/laser"+this.color.charAt(0).toUpperCase()+this.color.slice(1)+"Explode"+e+".png"}else this.explosionImage.src=""};var Spaceship=function(e,t,a,i,o){this.userName=e,this.x=t,this.y=a,this.speed=1,this.color=i,this.rotation=o,this.image=new Image,this.damage=0,this.width=0,this.height=0,this.damageImage=new Image,this.image.src="../assets/PNG/playerShip1_"+this.color+".png"};Spaceship.prototype.moveSpaceship=function(e,t){this.x=e,this.y=t},Spaceship.prototype.moveSpaceshipRelative=function(e,t){this.x=this.x+e,this.y=this.y+t},Spaceship.prototype.rotateSpaceship=function(e){this.rotation=e},Spaceship.prototype.rotateSpaceshipRelative=function(e){this.rotation=this.rotation+e/5,this.rotation<-360&&(this.rotation=this.rotation+720),this.rotation>360&&(this.rotation=this.rotation-720)},Spaceship.prototype.increaseDamage=function(){this.damage<4&&(this.damage+=1),this.damage<=3&&this.damage>0?this.damageImage.src="../assets/PNG/Damage/playerShip1_damage"+this.damage+".png":4==this.damage&&(this.damageImage.src="../assets/PNG/Damage/explode.gif")},Spaceship.prototype.decreaseDamage=function(){this.damage>0&&(this.damage-=1),this.damage<=3&&this.damage>0&&(this.damageImage.src="../assets/PNG/Damage/playerShip1_damage"+this.damage+".png")},function(){var e=function(e){function t(t,a,i){e.innerWidth<e.innerHeight?t.width=e.innerWidth-20:t.width=e.innerHeight-20,angular.element(e).bind("resize",function(){e.innerWidth<e.innerHeight?t.width=e.innerWidth-20:t.width=e.innerHeight-20,t.$digest()})}return{restrict:"E",link:t,replace:!0,template:'<canvas id="game" class="playArea" width="{{width}}" height="{{width}}" />'}};angular.module("app").directive("canvasDirective",["$window",e])}(),function(){var e=function(){var e=!0,t=!1;return{getLCShow:function(){return e},setLCShow:function(t){e=t},getPCShow:function(){return t},setPCShow:function(e){t=e}}};angular.module("app").factory("displayService",[e])}(),function(){var e=function(){var e=[];return{getPlayers:function(){return e},setPlayers:function(t){e=t}}};angular.module("app").factory("playerService",[e])}(),function(){var e=function(e){"use strict";var t=io.connect(window.location.host),a=function(a,i){t.on(a,function(){var a=arguments;e.$apply(function(){i.apply(t,a)})})},i=function(a,i,o){t.emit(a,i,function(){var a=arguments;e.$apply(function(){o&&o.apply(t,a)})})};return{on:a,emit:i,socket:t}};angular.module("app").factory("socketService",["$rootScope",e])}();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyIsImNvbnRyb2xsZXIvbG9naW5Db250cm9sbGVyLmpzIiwiY29udHJvbGxlci9wbGF5Q29udHJvbGxlci5qcyIsIm1vZGVscy9CdWxsZXQuanMiLCJtb2RlbHMvU3BhY2VzaGlwLmpzIiwiZGlyZWN0aXZlcy9jYW52YXNEaXJlY3RpdmUuanMiLCJzZXJ2aWNlcy9kaXNwbGF5U2VydmljZS5qcyIsInNlcnZpY2VzL3BsYXllclNlcnZpY2UuanMiLCJzZXJ2aWNlcy9zb2NrZXRTZXJ2aWNlLmpzIl0sIm5hbWVzIjpbImFuZ3VsYXIiLCJtb2R1bGUiLCJsb2dpbkNvbnRyb2xsZXIiLCIkc2NvcGUiLCJzb2NrZXRTZXJ2aWNlIiwiZGlzcGxheVNlcnZpY2UiLCJwbGF5ZXJTZXJ2aWNlIiwiTENTaG93IiwiZ2V0TENTaG93IiwibWFrZVJvb20iLCJlbWl0Iiwicm9vbSIsIm9uIiwiZGF0YSIsImRldmljZU9yaWVudGF0aW9uIiwidXNlcm5hbWUiLCJnYW1tYSIsImJldGEiLCJhbHBoYSIsInVzZXJuYW1lcyIsImNoZWNrVXNlckNvdW50Iiwic2V0UGxheWVycyIsIk9iamVjdCIsImtleXMiLCJsZW5ndGgiLCJzdGFydEdhbWUiLCJzZXRMQ1Nob3ciLCJzZXRQQ1Nob3ciLCJjb250cm9sbGVyIiwicGxheUNvbnRyb2xsZXIiLCIkaW50ZXJ2YWwiLCIkd2luZG93IiwiZmlsdGVyUGxheWVycyIsIm9iaiIsInVzZXJOYW1lIiwiZHJhdyIsIkFsbFBsYXllcnMiLCJzcGVlZCIsImN0eCIsImNsZWFyUmVjdCIsImNhbnYiLCJ3aWR0aCIsImhlaWdodCIsInJhdGlvIiwiQWxsQnVsbGV0cyIsIkJ1bGxldFdpZHRoIiwiQnVsbGV0SGVpZ2h0IiwiaW1hZ2UiLCJidWxsZXQiLCJiIiwiZXhwbG9kZVN0YWdlIiwic2F2ZSIsInRyYW5zbGF0ZSIsIngiLCJ5Iiwicm90YXRlIiwicm90YXRpb24iLCJNYXRoIiwiUEkiLCJkcmF3SW1hZ2UiLCJyZXN0b3JlIiwiY29zIiwic2luIiwiY29uc29sZSIsImxvZyIsImV4cGxvc2lvbkltYWdlIiwiU3BhY2VzaGlwV2lkdGgiLCJTcGFjZXNoaXBIZWlnaHQiLCJwbGF5ZXIiLCJwIiwiZGFtYWdlIiwiZGFtYWdlSW1hZ2UiLCJjaGVja0J1bGxldHMiLCJjb2xsaXNpb25EZXRlY3Rpb24iLCJzcGxpY2UiLCJleHBsb2RlIiwicmFkaXVzIiwic3FydCIsImFuZ2xlIiwiYnVsbGV0SGVhZFgiLCJidWxsZXRIZWFkWSIsInNwYWNlU2hpcFgiLCJzcGFjZVNoaXBZIiwiZGlzdGFuY2UiLCJkYW1hZ2Vzb3VuZCIsIkF1ZGlvIiwicGxheSIsImluY3JlYXNlRGFtYWdlIiwibGlmZSIsIlBDU2hvdyIsImdldFBDU2hvdyIsImN5Y2xlIiwiZG9jdW1lbnQiLCJnZXRFbGVtZW50QnlJZCIsImdldENvbnRleHQiLCJBcnJheSIsIkJ1ZmZlclBsYXllciIsImdldFBsYXllcnMiLCJwdXNoIiwiU3BhY2VzaGlwIiwiY29sb3IiLCJpIiwicm90YXRlU3BhY2VzaGlwUmVsYXRpdmUiLCJvcmllbnRhdGlvbiIsInRlbXAiLCJCdWxsZXQiLCJzaG90IiwidGhpcyIsIkltYWdlIiwic3JjIiwiY2hhckF0IiwidG9VcHBlckNhc2UiLCJzbGljZSIsInByb3RvdHlwZSIsIm51bWJlciIsIm1vdmVTcGFjZXNoaXAiLCJtb3ZlU3BhY2VzaGlwUmVsYXRpdmUiLCJyb3RhdGVTcGFjZXNoaXAiLCJkZWdyZWUiLCJkZWNyZWFzZURhbWFnZSIsImNhbnZhc0RpcmVjdGl2ZSIsImxpbmsiLCJzY29wZSIsImVsZW1lbnQiLCJhdHRycyIsImlubmVyV2lkdGgiLCJpbm5lckhlaWdodCIsImJpbmQiLCIkZGlnZXN0IiwicmVzdHJpY3QiLCJyZXBsYWNlIiwidGVtcGxhdGUiLCJkaXJlY3RpdmUiLCJ2YWx1ZSIsImZhY3RvcnkiLCJwbGF5ZXJzIiwicGxheWVyc0FycmF5IiwiJHJvb3RTY29wZSIsInNvY2tldCIsImlvIiwiY29ubmVjdCIsIndpbmRvdyIsImxvY2F0aW9uIiwiaG9zdCIsImV2ZW50TmFtZSIsImNhbGxiYWNrIiwiYXJncyIsImFyZ3VtZW50cyIsIiRhcHBseSIsImFwcGx5Il0sIm1hcHBpbmdzIjoiQ0FHQSxXQUVBQSxRQUFBQyxPQUFBLGFDREEsV0FDQSxHQUFBQyxHQUFBLFNBQUFDLEVBQUFDLEVBQUFDLEVBQUFDLEdBRUFILEVBQUFJLE9BQUFGLEVBQUFHLFNBR0EsSUFBQUMsR0FBQSxXQUNBTCxFQUFBTSxLQUFBLFlBQUEsTUFFQVAsR0FBQVEsS0FBQSxHQUNBUCxFQUFBUSxHQUFBLGNBQUEsU0FBQUMsR0FDQVYsRUFBQVEsS0FBQUUsSUFFQVQsRUFBQVEsR0FBQSxvQkFBQSxTQUFBQyxHQUNBLEdBQ0FDLElBREFELEVBQUFFLFlBRUFELEdBQUFFLE1BQUFILEVBQUFHLE1BQ0FGLEVBQUFHLEtBQUFKLEVBQUFJLEtBQ0FILEVBQUFJLE1BQUFMLEVBQUFLLFFBRUFmLEVBQUFnQixhQUNBaEIsRUFBQWlCLGdCQUFBLEVBQ0FoQixFQUFBUSxHQUFBLGNBQUEsU0FBQUMsR0FDQVAsRUFBQWUsV0FBQVIsR0FDQVYsRUFBQWdCLFVBQUFOLEVBQ0FWLEVBQUFpQixlQUFBRSxPQUFBQyxLQUFBcEIsRUFBQWdCLFdBQUFLLE9BQUEsSUFHQXJCLEVBQUFzQixVQUFBLFdBQ0FyQixFQUFBTSxLQUFBLFlBQUEsTUFDQUwsRUFBQXFCLFdBQUEsR0FDQXJCLEVBQUFzQixXQUFBLElBSUEsV0FDQWxCLE9BS0FULFNBQUFDLE9BQUEsT0FBQTJCLFdBQUEsbUJBQUEsU0FBQSxnQkFBQSxpQkFBQSxnQkFBQTFCLE9DekNBLFdBQ0EsWUFDQSxJQUFBMkIsR0FBQSxTQUFBMUIsRUFBQTJCLEVBQUFDLEVBQUEzQixFQUFBQyxFQUFBQyxHQWlFQSxRQUFBMEIsR0FBQUMsRUFBQXBCLEdBQ0EsTUFBQUEsR0FBQUUsVUFBQWtCLEVBQUFDLFVBQ0EsR0FFQSxFQUlBLFFBQUFDLEtBQ0FDLEVBQUFaLE9BQUEsSUFDQVksRUFBQSxHQUFBQyxNQUFBLEdBRUFDLEVBQUFDLFVBQUEs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R0FBQUMsU0FDQVYsR0FBQVcsT0FBQSxXQUNBSCxFQUFBSSxNQUFBWCxFQUFBUSxRQUtBeEksRUFBQSxTQUFBc0ksRUFBQW5JLEVBQUFvSSxHQUNBUCxFQUFBaEksS0FBQXNJLEVBQUFuSSxFQUFBLFdBQ0EsR0FBQXFJLEdBQUFDLFNBQ0FWLEdBQUFXLE9BQUEsV0FDQUgsR0FDQUEsRUFBQUksTUFBQVgsRUFBQVEsT0FPQSxRQUNBdEksR0FBQUEsRUFDQUYsS0FBQUEsRUFDQWdJLE9BQUFBLEdBSUExSSxTQUFBQyxPQUFBLE9BQUFxSSxRQUFBLGlCQUFBLGFBQUFsSSIsImZpbGUiOiJhcHAubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBDcmVhdGVkIGJ5IE1pY2hpZWwgb24gMjUvMTEvMjAxNS5cbiAqL1xuKGZ1bmN0aW9uKCl7XG5cbiAgICB2YXIgYXBwID0gYW5ndWxhci5tb2R1bGUoXCJhcHBcIixbXSk7XG59KSgpOyIsIi8qKlxyXG4gKiBDcmVhdGVkIGJ5IE1pY2hpZWwgb24gMTEvMTIvMjAxNS5cclxuICovXHJcblxyXG4oZnVuY3Rpb24oKXtcclxuICAgIHZhciBsb2dpbkNvbnRyb2xsZXIgPSBmdW5jdGlvbigkc2NvcGUsIHNvY2tldFNlcnZpY2UsIGRpc3BsYXlTZXJ2aWNlLCBwbGF5ZXJTZXJ2aWNlKXtcclxuXHJcbiAgICAgICAgJHNjb3BlLkxDU2hvdyA9IGRpc3BsYXlTZXJ2aWNlLmdldExDU2hvdztcclxuXHJcbiAgICAgICAgLy9mdW5jdGlvbnNcclxuICAgICAgICB2YXIgbWFrZVJvb20gPSBmdW5jdGlvbigpe1xyXG4gICAgICAgICAgICBzb2NrZXRTZXJ2aWNlLmVtaXQoXCJwY2Nvbm5lY3RcIiwgbnVsbCk7XHJcbiAgICAgICAgfTtcclxuICAgICAgICAkc2NvcGUucm9vbSA9IFwiXCI7XHJcbiAgICAgICAgc29ja2V0U2VydmljZS5vbigncmVxdWVzdFJvb20nLGZ1bmN0aW9uKGRhdGEpe1xyXG4gICAgICAgICAgICAkc2NvcGUucm9vbSA9IGRhdGE7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgc29ja2V0U2VydmljZS5vbignZGV2aWNlT3JpZW50YXRpb24nLCBmdW5jdGlvbihkYXRhKXtcclxuICAgICAgICAgICAgdmFyIHVzZXJuYW1lID0gZGF0YS51c2VybmFtZTtcclxuICAgICAgICAgICAgdmFyIGRldmljZU9yaWVudGF0aW9uID0ge307XHJcbiAgICAgICAgICAgIGRldmljZU9yaWVudGF0aW9uLmdhbW1hID0gZGF0YS5nYW1tYTtcclxuICAgICAgICAgICAgZGV2aWNlT3JpZW50YXRpb24uYmV0YSA9IGRhdGEuYmV0YTtcclxuICAgICAgICAgICAgZGV2aWNlT3JpZW50YXRpb24uYWxwaGEgPSBkYXRhLmFscGhhO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgICRzY29wZS51c2VybmFtZXMgPSB7fTtcclxuICAgICAgICAkc2NvcGUuY2hlY2tVc2VyQ291bnQgPSBmYWxzZTtcclxuICAgICAgICBzb2NrZXRTZXJ2aWNlLm9uKCd1cGRhdGV1c2VycycsIGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgIHBsYXllclNlcnZpY2Uuc2V0UGxheWVycyhkYXRhKTtcclxuICAgICAgICAgICAgJHNjb3BlLnVzZXJuYW1lcyA9IGRhdGE7XHJcbiAgICAgICAgICAgICRzY29wZS5jaGVja1VzZXJDb3VudCA9IE9iamVjdC5rZXlzKCRzY29wZS51c2VybmFtZXMpLmxlbmd0aCA8IDA7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICRzY29wZS5zdGFydEdhbWU9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgc29ja2V0U2VydmljZS5lbWl0KFwic3RhcnRHYW1lXCIsIG51bGwpO1xyXG4gICAgICAgICAgICBkaXNwbGF5U2VydmljZS5zZXRMQ1Nob3coZmFsc2UpO1xyXG4gICAgICAgICAgICBkaXNwbGF5U2VydmljZS5zZXRQQ1Nob3codHJ1ZSk7XHJcbiAgICAgICAgfTtcclxuXHJcblxyXG4gICAgICAgIChmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgbWFrZVJvb20oKTtcclxuICAgICAgICB9KSgpO1xyXG5cclxuICAgIH07XHJcblxyXG4gICAgYW5ndWxhci5tb2R1bGUoXCJhcHBcIikuY29udHJvbGxlcihcImxvZ2luQ29udHJvbGxlclwiLCBbXCIkc2NvcGVcIiwgXCJzb2NrZXRTZXJ2aWNlXCIgLCBcImRpc3BsYXlTZXJ2aWNlXCIsIFwicGxheWVyU2VydmljZVwiLCBsb2dpbkNvbnRyb2xsZXJdKTtcclxufSkoKTsiLCIvKipcclxuICogQ3JlYXRlZCBieSBNaWNoaWVsIG9uIDE2LzEyLzIwMTUuXHJcbiAqL1xyXG5cclxuKGZ1bmN0aW9uKCl7XHJcbiAgICBcInVzZSBzdHJpY3RcIjtcclxuICAgIHZhciBwbGF5Q29udHJvbGxlciA9IGZ1bmN0aW9uKCRzY29wZSwgJGludGVydmFsLCAkd2luZG93LCBzb2NrZXRTZXJ2aWNlLCBkaXNwbGF5U2VydmljZSwgcGxheWVyU2VydmljZSl7XHJcbiAgICAgICAgJHNjb3BlLlBDU2hvdyA9IGRpc3BsYXlTZXJ2aWNlLmdldFBDU2hvdztcclxuICAgICAgICAkc2NvcGUuc3RhcnRHYW1lID0gZmFsc2U7XHJcbiAgICAgICAgdmFyIGNhbnYgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZ2FtZScpO1xyXG4gICAgICAgIHZhciBjdHggPSBjYW52LmdldENvbnRleHQoJzJkJyk7XHJcblxyXG4gICAgICAgIHZhciBBbGxQbGF5ZXJzID0gbmV3IEFycmF5KCk7XHJcbiAgICAgICAgdmFyIEFsbEJ1bGxldHMgPSBuZXcgQXJyYXkoKTtcclxuXHJcbiAgICAgICAgdmFyIGN5Y2xlO1xyXG5cclxuICAgICAgICBzb2NrZXRTZXJ2aWNlLm9uKFwiaW5pdEdhbWVcIiwgZnVuY3Rpb24oKXtcclxuICAgICAgICAgICAgdmFyIEJ1ZmZlclBsYXllciA9IHBsYXllclNlcnZpY2UuZ2V0UGxheWVycygpO1xyXG4gICAgICAgICAgICBmb3IodmFyIHBsYXllciBpbiBCdWZmZXJQbGF5ZXIpe1xyXG4gICAgICAgICAgICAgICAgdmFyIHAgPSBCdWZmZXJQbGF5ZXJbcGxheWVyXTtcclxuICAgICAgICAgICAgICAgIEFsbFBsYXllcnMucHVzaChuZXcgU3BhY2VzaGlwKHAudXNlcm5hbWUsIHAueCwgcC55LCBwLmNvbG9yLCBwLnJvdGF0aW9uKSk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGN5Y2xlID0gJGludGVydmFsKGRyYXcsIDEwKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgc29ja2V0U2VydmljZS5vbihcInVzZXJsZWZ0XCIsIGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgIHZhciBwID0gbnVsbDtcclxuICAgICAgICAgICAgZm9yKHZhciBpIGluIEFsbFBsYXllcnMpe1xyXG4gICAgICAgICAgICAgICAgaWYoZmlsdGVyUGxheWVycyhBbGxQbGF5ZXJzW2ldLGRhdGEpID09IHRydWUpe1xyXG4gICAgICAgICAgICAgICAgICAgIHAgPSBpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIEFsbFBsYXllcnMuc3BsaWNlKHAsMSk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHNvY2tldFNlcnZpY2Uub24oXCJ1cGRhdGVHYW1lRGF0YVwiLCBmdW5jdGlvbihkYXRhKXtcclxuICAgICAgICAgICAgdmFyIHAgPSBudWxsO1xyXG4gICAgICAgICAgICBmb3IodmFyIGkgaW4gQWxsUGxheWVycyl7XHJcbiAgICAgICAgICAgICAgICBpZihmaWx0ZXJQbGF5ZXJzKEFsbFBsYXllcnNbaV0sZGF0YSkgPT0gdHJ1ZSl7XHJcbiAgICAgICAgICAgICAgICAgICAgcCA9IGk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYocCAhPSBudWxsKXtcclxuICAgICAgICAgICAgICAgIEFsbFBsYXllcnNbcF0ucm90YXRlU3BhY2VzaGlwUmVsYXRpdmUoZGF0YS5vcmllbnRhdGlvbik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgc29ja2V0U2VydmljZS5vbihcInBsYXllclNob3RcIiwgZnVuY3Rpb24oZGF0YSl7XHJcbiAgICAgICAgICAgIHZhciBwID0gbnVsbDtcclxuICAgICAgICAgICAgZm9yKHZhciBpIGluIEFsbFBsYXllcnMpe1xyXG4gICAgICAgICAgICAgICAgaWYoZmlsdGVyUGxheWVycyhBbGxQbGF5ZXJzW2ldLGRhdGEpID09IHRydWUpe1xyXG4gICAgICAgICAgICAgICAgICAgIHAgPSBpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmKHAgIT0gbnVsbCl7XHJcbiAgICAgICAgICAgICAgICB2YXIgdGVtcCA9IEFsbFBsYXllcnNbcF07XHJcbiAgICAgICAgICAgICAgICB2YXIgYW5nbGUgPSAoMzYwIC0odGVtcC5yb3RhdGlvbiArIDE4MCkpLzE4MCpNYXRoLlBJO1xyXG4gICAgICAgICAgICAgICAgdmFyIHggPSB0ZW1wLnggKyAoY2Fudi53aWR0aC80MDAgKiBNYXRoLnNpbihhbmdsZSkpO1xyXG4gICAgICAgICAgICAgICAgdmFyIHkgPSB0ZW1wLnkgKyAoY2Fudi53aWR0aC80MDAgKiBNYXRoLmNvcyhhbmdsZSkpO1xyXG4gICAgICAgICAgICAgICAgQWxsQnVsbGV0cy5wdXNoKG5ldyBCdWxsZXQoeCwgeSwgdGVtcC5yb3RhdGlvbiwgdGVtcC5jb2xvciwgdGVtcC51c2VyTmFtZSkpO1xyXG4gICAgICAgICAgICAgICAgaWYocCUyID09IDApe1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBzaG90ID0gbmV3IEF1ZGlvKCcuLi8uLi9hc3NldHMvQm9udXMvc2Z4X2xhc2VyMS5vZ2cnKTtcclxuICAgICAgICAgICAgICAgIH1lbHNle1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBzaG90ID0gbmV3IEF1ZGlvKCcuLi8uLi9hc3NldHMvQm9udXMvc2Z4X2xhc2VyMi5vZ2cnKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHNob3QucGxheSgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGZpbHRlclBsYXllcnMob2JqLGRhdGEpe1xyXG4gICAgICAgICAgICBpZihkYXRhLnVzZXJuYW1lID09IG9iai51c2VyTmFtZSl7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGRyYXcoKXtcclxuICAgICAgICAgICAgaWYoQWxsUGxheWVycy5sZW5ndGg+MCl7XHJcbiAgICAgICAgICAgICAgICBBbGxQbGF5ZXJzWzBdLnNwZWVkID0gMDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjdHguY2xlYXJSZWN0KDAsMCxjYW52LndpZHRoLCBjYW52LmhlaWdodCk7XHJcbiAgICAgICAgICAgIHZhciByYXRpbyA9IGNhbnYud2lkdGgvMTAwO1xyXG5cclxuICAgICAgICAgICAgaWYoQWxsQnVsbGV0cy5sZW5ndGggIT0gMCl7XHJcbiAgICAgICAgICAgICAgICB2YXIgQnVsbGV0V2lkdGggPSBjYW52LndpZHRoLzEwMDtcclxuICAgICAgICAgICAgICAgIHZhciBCdWxsZXRIZWlnaHQgPSBCdWxsZXRXaWR0aCAqIEFsbEJ1bGxldHNbMF0uaW1hZ2UuaGVpZ2h0L0FsbEJ1bGxldHNbMF0uaW1hZ2Uud2lkdGg7XHJcblxyXG4gICAgICAgICAgICAgICAgZm9yKHZhciBidWxsZXQgaW4gQWxsQnVsbGV0cyl7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGIgPSBBbGxCdWxsZXRzW2J1bGxldF07XHJcbiAgICAgICAgICAgICAgICAgICAgYi53aWR0aCA9IEJ1bGxldFdpZHRoO1xyXG4gICAgICAgICAgICAgICAgICAgIGIuaGVpZ2h0ID0gQnVsbGV0SGVpZ2h0O1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBpZihiLmV4cGxvZGVTdGFnZSA9PSAwKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy9EcmF3IGJ1bGxldFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjdHguc2F2ZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjdHgudHJhbnNsYXRlKGIueCpyYXRpbywgYi55KnJhdGlvKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY3R4LnJvdGF0ZShiLnJvdGF0aW9uLzE4MCpNYXRoLlBJKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY3R4LmRyYXdJbWFnZShiLmltYWdlLCAtQnVsbGV0V2lkdGgvMiwgLUJ1bGxldEhlaWdodC8yLCBCdWxsZXRXaWR0aCwgQnVsbGV0SGVpZ2h0KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY3R4LnJlc3RvcmUoKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIEFsbEJ1bGxldHNbYnVsbGV0XS54ID0gTWF0aC5jb3MoKGIucm90YXRpb24gLSA5MCkvMTgwKk1hdGguUEkpICsgYi54O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBBbGxCdWxsZXRzW2J1bGxldF0ueSA9IE1hdGguc2luKChiLnJvdGF0aW9uIC0gOTApLzE4MCpNYXRoLlBJKSsgYi55O1xyXG4gICAgICAgICAgICAgICAgICAgIH1lbHNlIGlmKGIuZXhwbG9kZVN0YWdlIDwgNCl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vRHJhdyBleHBsb3Npb25cclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coYi5leHBsb3Npb25JbWFnZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5zYXZlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGN0eC50cmFuc2xhdGUoYi54KnJhdGlvLCBiLnkqcmF0aW8pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjdHguZHJhd0ltYWdlKGIuZXhwbG9zaW9uSW1hZ2UsIC1CdWxsZXRXaWR0aCwgLUJ1bGxldFdpZHRoLCBCdWxsZXRXaWR0aCoyLCBCdWxsZXRXaWR0aCoyKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY3R4LnJlc3RvcmUoKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmKEFsbFBsYXllcnMubGVuZ3RoICE9IDApe1xyXG4gICAgICAgICAgICAgICAgdmFyIFNwYWNlc2hpcFdpZHRoID0gY2Fudi53aWR0aC8yMDtcclxuICAgICAgICAgICAgICAgIHZhciBTcGFjZXNoaXBIZWlnaHQgPSBTcGFjZXNoaXBXaWR0aCAqIEFsbFBsYXllcnNbMF0uaW1hZ2UuaGVpZ2h0LyBBbGxQbGF5ZXJzWzBdLmltYWdlLndpZHRoO1xyXG5cclxuICAgICAgICAgICAgICAgIGZvcih2YXIgcGxheWVyIGluIEFsbFBsYXllcnMpe1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBwID0gQWxsUGxheWVyc1twbGF5ZXJdO1xyXG4gICAgICAgICAgICAgICAgICAgIHAud2lkdGggPSBTcGFjZXNoaXBXaWR0aDtcclxuICAgICAgICAgICAgICAgICAgICBwLmhlaWdodCA9IFNwYWNlc2hpcEhlaWdodDtcclxuICAgICAgICAgICAgICAgICAgICBjdHguc2F2ZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIGN0eC50cmFuc2xhdGUocC54KnJhdGlvLCBwLnkqcmF0aW8pO1xyXG4gICAgICAgICAgICAgICAgICAgIGN0eC5yb3RhdGUocC5yb3RhdGlvbi8xODAqTWF0aC5QSSk7XHJcbiAgICAgICAgICAgICAgICAgICAgY3R4LmRyYXdJbWFnZShwLmltYWdlLCAtU3BhY2VzaGlwV2lkdGgvMiwgLVNwYWNlc2hpcEhlaWdodC8yLCBTcGFjZXNoaXBXaWR0aCwgU3BhY2VzaGlwSGVpZ2h0KTtcclxuICAgICAgICAgICAgICAgICAgICBpZihwLmRhbWFnZSA+IDApe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjdHguZHJhd0ltYWdlKHAuZGFtYWdlSW1hZ2UsIC1TcGFjZXNoaXBXaWR0aC8yLCAtU3BhY2VzaGlwSGVpZ2h0LzIsIFNwYWNlc2hpcFdpZHRoLCBTcGFjZXNoaXBIZWlnaHQpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBjdHgucmVzdG9yZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIEFsbFBsYXllcnNbcGxheWVyXS54ID0gTWF0aC5jb3MoKHAucm90YXRpb24gLSA5MCkvMTgwKk1hdGguUEkpLzEwKiBwLnNwZWVkICsgcC54O1xyXG4gICAgICAgICAgICAgICAgICAgIEFsbFBsYXllcnNbcGxheWVyXS55ID0gTWF0aC5zaW4oKHAucm90YXRpb24gLSA5MCkvMTgwKk1hdGguUEkpLzEwKiBwLnNwZWVkICsgcC55O1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBjaGVja0J1bGxldHMoKTtcclxuXHJcbiAgICAgICAgICAgIGNvbGxpc2lvbkRldGVjdGlvbigpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gY2hlY2tCdWxsZXRzKCl7XHJcblxyXG4gICAgICAgICAgICBmb3IodmFyIGIgaW4gQWxsQnVsbGV0cyl7XHJcbiAgICAgICAgICAgICAgICBpZihBbGxCdWxsZXRzW2JdLnggPCAwIHx8IEFsbEJ1bGxldHNbYl0ueCA+IGNhbnYud2lkdGggfHwgQWxsQnVsbGV0c1tiXS55IDwgMCB8fCBBbGxCdWxsZXRzW2JdLnkgPiBjYW52LmhlaWdodCl7XHJcbiAgICAgICAgICAgICAgICAgICAgQWxsQnVsbGV0cy5zcGxpY2UoYiwgMSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZihBbGxCdWxsZXRzW2JdLmV4cGxvZGVTdGFnZSA+MCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChBbGxCdWxsZXRzW2JdLmV4cGxvZGVTdGFnZSA8IDQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgQWxsQnVsbGV0c1tiXS5leHBsb2RlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgQWxsQnVsbGV0cy5zcGxpY2UoYiwgMSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBjb2xsaXNpb25EZXRlY3Rpb24oKXtcclxuICAgICAgICAgICAgZm9yKHZhciBwIGluIEFsbFBsYXllcnMpe1xyXG4gICAgICAgICAgICAgICAgZm9yKHZhciBiIGluIEFsbEJ1bGxldHMpe1xyXG4gICAgICAgICAgICAgICAgICAgIGlmKEFsbEJ1bGxldHNbYl0uZXhwbG9kZVN0YWdlID09IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKEFsbEJ1bGxldHNbYl0ucGxheWVyICE9IEFsbFBsYXllcnNbcF0udXNlck5hbWUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciByYWRpdXMgPSBNYXRoLnNxcnQoMikgLyAyICogKEFsbEJ1bGxldHNbYl0uaGVpZ2h0IC8gMiAtIEFsbEJ1bGxldHNbYl0ud2lkdGggLyAyKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBhbmdsZSA9ICgzNjAgLSAoQWxsQnVsbGV0c1tiXS5yb3RhdGlvbikpIC8gMTgwICogTWF0aC5QSTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBidWxsZXRIZWFkWCA9IChBbGxCdWxsZXRzW2JdLnggKiBjYW52LndpZHRoIC8gMTAwIC0gKHJhZGl1cyAqIE1hdGguc2luKGFuZ2xlKSkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGJ1bGxldEhlYWRZID0gKEFsbEJ1bGxldHNbYl0ueSAqIGNhbnYud2lkdGggLyAxMDAgLSAocmFkaXVzICogTWF0aC5jb3MoYW5nbGUpKSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHNwYWNlU2hpcFggPSBBbGxQbGF5ZXJzW3BdLnggKiBjYW52LndpZHRoIC8gMTAwO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHNwYWNlU2hpcFkgPSBBbGxQbGF5ZXJzW3BdLnkgKiBjYW52LndpZHRoIC8gMTAwO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8qY3R4LnNhdmUoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdHguYmVnaW5QYXRoKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3R4LmFyYyhzcGFjZVNoaXBYLCBzcGFjZVNoaXBZLCBBbGxQbGF5ZXJzW3BdLndpZHRoLzIsIDAsIE1hdGguUEkqMik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3R4LmxpbmVXaWR0aCA9IDE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3R4LnN0cm9rZVN0eWxlID0gJyMwMDAwRkYnO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5zdHJva2UoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdHgucmVzdG9yZSgpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdHguc2F2ZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5iZWdpblBhdGgoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdHguYXJjKGJ1bGxldEhlYWRYLCBidWxsZXRIZWFkWSwgQWxsQnVsbGV0c1tiXS53aWR0aC8yLCAwLCBNYXRoLlBJKjIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5saW5lV2lkdGggPSAxO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5zdHJva2VTdHlsZSA9ICcjRkYwMDAwJztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdHguc3Ryb2tlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3R4LnJlc3RvcmUoKTsqL1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGRpc3RhbmNlID0gTWF0aC5zcXJ0KChidWxsZXRIZWFkWCAtIHNwYWNlU2hpcFgpICogKGJ1bGxldEhlYWRYIC0gc3BhY2VTaGlwWCkgKyAoYnVsbGV0SGVhZFkgLSBzcGFjZVNoaXBZKSAqIChidWxsZXRIZWFkWSAtIHNwYWNlU2hpcFkpKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkaXN0YW5jZSA8IChBbGxCdWxsZXRzW2JdLndpZHRoIC8gMiArIEFsbFBsYXllcnNbcF0ud2lkdGggLyAyKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBkYW1hZ2Vzb3VuZCA9IG5ldyBBdWRpbygnLi4vLi4vYXNzZXRzL0JvbnVzL3NmeF9sb3NlLm9nZycpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhbWFnZXNvdW5kLnBsYXkoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBBbGxQbGF5ZXJzW3BdLmluY3JlYXNlRGFtYWdlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGRhdGEgPSB7fTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhLnVzZXJuYW1lID0gQWxsUGxheWVyc1twXS51c2VyTmFtZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhLmxpZmUgPSAzLUFsbFBsYXllcnNbcF0uZGFtYWdlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNvY2tldFNlcnZpY2UuZW1pdChcInBsYXllckxpZmVcIixkYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBBbGxCdWxsZXRzW2JdLmV4cGxvZGUoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH07XHJcblxyXG4gICAgYW5ndWxhci5tb2R1bGUoXCJhcHBcIikuY29udHJvbGxlcihcInBsYXlDb250cm9sbGVyXCIsIFtcIiRzY29wZVwiLCBcIiRpbnRlcnZhbFwiLCBcIiR3aW5kb3dcIiwgXCJzb2NrZXRTZXJ2aWNlXCIsIFwiZGlzcGxheVNlcnZpY2VcIiwgXCJwbGF5ZXJTZXJ2aWNlXCIsIHBsYXlDb250cm9sbGVyXSlcclxufSkoKTsiLCIvKipcclxuICogQ3JlYXRlZCBieSBqdXN0aWpuZGVwb3ZlciBvbiAyMi8xMi8xNS5cclxuICovXHJcblxyXG52YXIgQnVsbGV0ID0gZnVuY3Rpb24oeCwgeSxyb3RhdGlvbiwgY29sb3IsIHBsYXllcil7XHJcbiAgICB0aGlzLnggPSB4O1xyXG4gICAgdGhpcy55ID0geTtcclxuICAgIHRoaXMucm90YXRpb24gPSByb3RhdGlvbjtcclxuICAgIHRoaXMuaW1hZ2UgPSBuZXcgSW1hZ2UoKTtcclxuICAgIHRoaXMuY29sb3IgPSBjb2xvcjtcclxuICAgIHRoaXMud2lkdGggPSAwO1xyXG4gICAgdGhpcy5oZWlnaHQgPSAwO1xyXG4gICAgdGhpcy5wbGF5ZXIgPSBwbGF5ZXI7XHJcbiAgICB0aGlzLmV4cGxvc2lvbkltYWdlID0gbmV3IEltYWdlKCk7XHJcbiAgICB0aGlzLmV4cGxvZGVTdGFnZSA9IDA7XHJcbiAgICBpZih0aGlzLmNvbG9yID09IFwib3JhbmdlXCIpe1xyXG4gICAgICAgIHRoaXMuY29sb3IgPSAncmVkJztcclxuICAgIH1cclxuICAgIHRoaXMuaW1hZ2Uuc3JjID0gJy4uL2Fzc2V0cy9QTkcvTGFzZXJzL2xhc2VyJysgdGhpcy5jb2xvci5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArIHRoaXMuY29sb3Iuc2xpY2UoMSkgKycwMS5wbmcnXHJcbn07XHJcblxyXG5CdWxsZXQucHJvdG90eXBlLmV4cGxvZGUgPSBmdW5jdGlvbigpe1xyXG4gICAgaWYodGhpcy5leHBsb2RlU3RhZ2UgPCA0KXtcclxuICAgICAgICB0aGlzLmV4cGxvZGVTdGFnZSsrO1xyXG4gICAgICAgIHZhciBudW1iZXI7XHJcbiAgICAgICAgaWYodGhpcy5leHBsb2RlU3RhZ2UgPCAzKXtcclxuICAgICAgICAgICBudW1iZXIgPSAxXHJcbiAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICAgIG51bWJlciA9IDJcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5leHBsb3Npb25JbWFnZS5zcmMgPSAnLi4vYXNzZXRzL1BORy9MYXNlcnMvbGFzZXInICsgdGhpcy5jb2xvci5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArIHRoaXMuY29sb3Iuc2xpY2UoMSkgKyAnRXhwbG9kZScrIG51bWJlciArJy5wbmcnO1xyXG4gICAgfWVsc2V7XHJcbiAgICAgICAgdGhpcy5leHBsb3Npb25JbWFnZS5zcmMgPSAnJztcclxuICAgIH1cclxufTtcclxuIiwiLyoqXHJcbiAqIENyZWF0ZWQgYnkganVzdGlqbmRlcG92ZXIgb24gMDkvMTIvMTUuXHJcbiAqL1xyXG5cclxudmFyIFNwYWNlc2hpcCA9IGZ1bmN0aW9uKHVzZXJOYW1lLCB4LCB5LCBjb2xvciwgcm90YXRpb24pe1xyXG4gICAgdGhpcy51c2VyTmFtZSA9IHVzZXJOYW1lO1xyXG4gICAgdGhpcy54ID0geDtcclxuICAgIHRoaXMueSA9IHk7XHJcbiAgICB0aGlzLnNwZWVkID0gMTtcclxuICAgIHRoaXMuY29sb3IgPSBjb2xvcjtcclxuICAgIHRoaXMucm90YXRpb24gPSByb3RhdGlvbjtcclxuICAgIHRoaXMuaW1hZ2UgPSBuZXcgSW1hZ2UoKTtcclxuICAgIHRoaXMuZGFtYWdlID0gMDtcclxuICAgIHRoaXMud2lkdGggPSAwO1xyXG4gICAgdGhpcy5oZWlnaHQgPSAwO1xyXG4gICAgdGhpcy5kYW1hZ2VJbWFnZSA9IG5ldyBJbWFnZSgpO1xyXG4gICAgdGhpcy5pbWFnZS5zcmMgPSAnLi4vYXNzZXRzL1BORy9wbGF5ZXJTaGlwMV8nKyB0aGlzLmNvbG9yICsnLnBuZydcclxufTtcclxuXHJcblNwYWNlc2hpcC5wcm90b3R5cGUubW92ZVNwYWNlc2hpcCA9IGZ1bmN0aW9uKHgsIHkpe1xyXG4gICAgdGhpcy54ID0geDtcclxuICAgIHRoaXMueSA9IHk7XHJcbn07XHJcblxyXG5TcGFjZXNoaXAucHJvdG90eXBlLm1vdmVTcGFjZXNoaXBSZWxhdGl2ZSA9IGZ1bmN0aW9uKHgsIHkpe1xyXG4gICAgdGhpcy54ID0gdGhpcy54K3g7XHJcbiAgICB0aGlzLnkgPSB0aGlzLnkreTtcclxufTtcclxuXHJcblNwYWNlc2hpcC5wcm90b3R5cGUucm90YXRlU3BhY2VzaGlwID0gZnVuY3Rpb24oZGVncmVlKXtcclxuICAgIHRoaXMucm90YXRpb24gPSBkZWdyZWU7XHJcbn07XHJcblxyXG5TcGFjZXNoaXAucHJvdG90eXBlLnJvdGF0ZVNwYWNlc2hpcFJlbGF0aXZlID0gZnVuY3Rpb24oZGVncmVlKXtcclxuICAgIHRoaXMucm90YXRpb24gPSB0aGlzLnJvdGF0aW9uICsgZGVncmVlLzU7XHJcbiAgICBpZih0aGlzLnJvdGF0aW9uIDwgLTM2MCl7XHJcbiAgICAgICAgdGhpcy5yb3RhdGlvbiA9IHRoaXMucm90YXRpb24gKyA3MjA7XHJcbiAgICB9XHJcbiAgICBpZih0aGlzLnJvdGF0aW9uID4gMzYwKXtcclxuICAgICAgICB0aGlzLnJvdGF0aW9uID0gdGhpcy5yb3RhdGlvbiAtIDcyMDtcclxuICAgIH1cclxufTtcclxuXHJcblNwYWNlc2hpcC5wcm90b3R5cGUuaW5jcmVhc2VEYW1hZ2UgPSBmdW5jdGlvbigpe1xyXG4gICAgaWYodGhpcy5kYW1hZ2UgPCA0KXtcclxuICAgICAgICB0aGlzLmRhbWFnZSArPSAxO1xyXG4gICAgfVxyXG5cclxuICAgIGlmKHRoaXMuZGFtYWdlIDw9IDMgJiYgdGhpcy5kYW1hZ2UgPiAwKXtcclxuICAgICAgICB0aGlzLmRhbWFnZUltYWdlLnNyYyA9ICcuLi9hc3NldHMvUE5HL0RhbWFnZS9wbGF5ZXJTaGlwMV9kYW1hZ2UnKyB0aGlzLmRhbWFnZSArICcucG5nJztcclxuICAgIH1lbHNlIGlmKHRoaXMuZGFtYWdlPT00KXtcclxuICAgICAgICB0aGlzLmRhbWFnZUltYWdlLnNyYyA9ICcuLi9hc3NldHMvUE5HL0RhbWFnZS9leHBsb2RlLmdpZic7XHJcbiAgICB9XHJcbn07XHJcblxyXG5TcGFjZXNoaXAucHJvdG90eXBlLmRlY3JlYXNlRGFtYWdlID0gZnVuY3Rpb24oKXtcclxuICAgIGlmKHRoaXMuZGFtYWdlID4gMCl7XHJcbiAgICAgICAgdGhpcy5kYW1hZ2UgLT0gMTtcclxuICAgIH1cclxuXHJcbiAgICBpZih0aGlzLmRhbWFnZSA8PSAzICYmIHRoaXMuZGFtYWdlID4gMCl7XHJcbiAgICAgICAgdGhpcy5kYW1hZ2VJbWFnZS5zcmMgPSAnLi4vYXNzZXRzL1BORy9EYW1hZ2UvcGxheWVyU2hpcDFfZGFtYWdlJysgdGhpcy5kYW1hZ2UgKyAnLnBuZyc7XHJcbiAgICB9XHJcbn07XHJcblxyXG4iLCIvKipcclxuICogQ3JlYXRlZCBieSBqdXN0aWpuZGVwb3ZlciBvbiAxNi8xMi8xNS5cclxuICovXHJcbihmdW5jdGlvbigpe1xyXG4gICAgdmFyIGNhbnZhc0RpcmVjdGl2ZSA9IGZ1bmN0aW9uKCR3aW5kb3cpe1xyXG4gICAgICAgIHJldHVybntcclxuICAgICAgICAgICAgcmVzdHJpY3Q6ICdFJyxcclxuICAgICAgICAgICAgbGluazpsaW5rLFxyXG4gICAgICAgICAgICByZXBsYWNlOnRydWUsXHJcbiAgICAgICAgICAgIHRlbXBsYXRlOic8Y2FudmFzIGlkPVwiZ2FtZVwiIGNsYXNzPVwicGxheUFyZWFcIiB3aWR0aD1cInt7d2lkdGh9fVwiIGhlaWdodD1cInt7d2lkdGh9fVwiIC8+J1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGxpbmsoc2NvcGUsIGVsZW1lbnQsIGF0dHJzKXtcclxuICAgICAgICAgICAgaWYoJHdpbmRvdy5pbm5lcldpZHRoIDwgJHdpbmRvdy5pbm5lckhlaWdodCl7XHJcbiAgICAgICAgICAgICAgICBzY29wZS53aWR0aCA9ICR3aW5kb3cuaW5uZXJXaWR0aCAtIDIwO1xyXG4gICAgICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgICAgIHNjb3BlLndpZHRoID0gJHdpbmRvdy5pbm5lckhlaWdodCAtIDIwO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBhbmd1bGFyLmVsZW1lbnQoJHdpbmRvdykuYmluZCgncmVzaXplJywgZnVuY3Rpb24oKXtcclxuICAgICAgICAgICAgICAgIGlmKCR3aW5kb3cuaW5uZXJXaWR0aCA8ICR3aW5kb3cuaW5uZXJIZWlnaHQpe1xyXG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLndpZHRoID0gJHdpbmRvdy5pbm5lcldpZHRoIC0gMjA7XHJcbiAgICAgICAgICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgICAgICAgICBzY29wZS53aWR0aCA9ICR3aW5kb3cuaW5uZXJIZWlnaHQgLSAyMDtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBzY29wZS4kZGlnZXN0KCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcblxyXG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcCcpLmRpcmVjdGl2ZShcImNhbnZhc0RpcmVjdGl2ZVwiLCBbXCIkd2luZG93XCIsIGNhbnZhc0RpcmVjdGl2ZV0pO1xyXG59KSgpOyIsIi8qKlxyXG4gKiBDcmVhdGVkIGJ5IE1pY2hpZWwgb24gMTYvMTIvMjAxNS5cclxuICovXHJcbi8qKlxyXG4gKiBDcmVhdGVkIGJ5IGp1c3Rpam5kZXBvdmVyIG9uIDE2LzEyLzE1LlxyXG4gKi9cclxuXHJcblxyXG4oZnVuY3Rpb24oKXtcclxuICAgIHZhciBkaXNwbGF5U2VydmljZSA9IGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgLy9Mb2dpbiBDb250cm9sbGVyXHJcbiAgICAgICAgdmFyIExDU2hvdyA9IHRydWU7XHJcbiAgICAgICAgLy9QbGF5IGNvbnRyb2xsZXJcclxuICAgICAgICB2YXIgUENTaG93ID0gZmFsc2U7XHJcblxyXG4gICAgICAgIHJldHVybntcclxuICAgICAgICAgICAgZ2V0TENTaG93OiBmdW5jdGlvbigpe1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIExDU2hvdztcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgc2V0TENTaG93OiBmdW5jdGlvbih2YWx1ZSl7XHJcbiAgICAgICAgICAgICAgICBMQ1Nob3cgPSB2YWx1ZTtcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgZ2V0UENTaG93OiBmdW5jdGlvbigpe1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIFBDU2hvdztcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgc2V0UENTaG93OiBmdW5jdGlvbih2YWx1ZSl7XHJcbiAgICAgICAgICAgICAgICBQQ1Nob3cgPSB2YWx1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH07XHJcblxyXG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcCcpLmZhY3RvcnkoJ2Rpc3BsYXlTZXJ2aWNlJywgW2Rpc3BsYXlTZXJ2aWNlXSk7XHJcbn0pKCk7IiwiLyoqXHJcbiAqIENyZWF0ZWQgYnkganVzdGlqbmRlcG92ZXIgb24gMTcvMTIvMTUuXHJcbiAqL1xyXG5cclxuKGZ1bmN0aW9uKCl7XHJcbiAgICB2YXIgcGxheWVyU2VydmljZSA9IGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgLy9Mb2dpbiBDb250cm9sbGVyXHJcbiAgICAgICAgdmFyIHBsYXllcnMgPSBbXTtcclxuXHJcbiAgICAgICAgcmV0dXJue1xyXG4gICAgICAgICAgICBnZXRQbGF5ZXJzOiBmdW5jdGlvbigpe1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHBsYXllcnM7XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIHNldFBsYXllcnM6IGZ1bmN0aW9uKHBsYXllcnNBcnJheSl7XHJcbiAgICAgICAgICAgICAgICBwbGF5ZXJzID0gcGxheWVyc0FycmF5O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuXHJcbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwJykuZmFjdG9yeSgncGxheWVyU2VydmljZScsIFtwbGF5ZXJTZXJ2aWNlXSk7XHJcbn0pKCk7IiwiLyoqXHJcbiAqIENyZWF0ZWQgYnkganVzdGlqbmRlcG92ZXIgb24gMDkvMTIvMTUuXHJcbiAqL1xyXG5cclxuKGZ1bmN0aW9uKCl7XHJcblxyXG4gICAgdmFyIHNvY2tldFNlcnZpY2UgPSBmdW5jdGlvbigkcm9vdFNjb3BlKXtcclxuICAgICAgICBcInVzZSBzdHJpY3RcIjtcclxuICAgICAgICAvL3ByaXZhdGVcclxuICAgICAgICB2YXIgc29ja2V0ID0gaW8uY29ubmVjdCh3aW5kb3cubG9jYXRpb24uaG9zdCk7XHJcbiAgICAgICAgLy9mdW5jdGlvbnNcclxuICAgICAgICB2YXIgb24gPSBmdW5jdGlvbiAoZXZlbnROYW1lLCBjYWxsYmFjaykge1xyXG4gICAgICAgICAgICBzb2NrZXQub24oZXZlbnROYW1lLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgYXJncyA9IGFyZ3VtZW50cztcclxuICAgICAgICAgICAgICAgICRyb290U2NvcGUuJGFwcGx5KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjay5hcHBseShzb2NrZXQsIGFyZ3MpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBlbWl0ID0gZnVuY3Rpb24gKGV2ZW50TmFtZSwgZGF0YSwgY2FsbGJhY2spIHtcclxuICAgICAgICAgICAgc29ja2V0LmVtaXQoZXZlbnROYW1lLCBkYXRhLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgYXJncyA9IGFyZ3VtZW50cztcclxuICAgICAgICAgICAgICAgICRyb290U2NvcGUuJGFwcGx5KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoY2FsbGJhY2spIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2suYXBwbHkoc29ja2V0LCBhcmdzKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAvL3B1YmxpY1xyXG4gICAgICAgIHJldHVybntcclxuICAgICAgICAgICAgb246IG9uLFxyXG4gICAgICAgICAgICBlbWl0OiBlbWl0LFxyXG4gICAgICAgICAgICBzb2NrZXQ6IHNvY2tldFxyXG4gICAgICAgIH1cclxuICAgIH07XHJcblxyXG4gICAgYW5ndWxhci5tb2R1bGUoXCJhcHBcIikuZmFjdG9yeShcInNvY2tldFNlcnZpY2VcIiwgW1wiJHJvb3RTY29wZVwiLCBzb2NrZXRTZXJ2aWNlXSk7XHJcblxyXG59KSgpOyJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
