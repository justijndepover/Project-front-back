!function(){angular.module("app",[])}(),function(){var e=function(e){function t(t,a,i){e.innerWidth<e.innerHeight?t.width=e.innerWidth-20:t.width=e.innerHeight-20,angular.element(e).bind("resize",function(){e.innerWidth<e.innerHeight?t.width=e.innerWidth-20:t.width=e.innerHeight-20,t.$digest()})}return{restrict:"E",link:t,replace:!0,template:'<canvas id="game" class="playArea" width="{{width}}" height="{{width}}" />'}};angular.module("app").directive("canvasDirective",["$window",e])}(),function(){var e=function(e,t,a,i){e.LCShow=a.getLCShow;var o=function(){t.emit("pcconnect",null)};e.room="",t.on("requestRoom",function(t){e.room=t}),t.on("deviceOrientation",function(e){var t=(e.username,{});t.gamma=e.gamma,t.beta=e.beta,t.alpha=e.alpha}),e.usernames={},e.checkUserCount=!1,t.on("updateusers",function(t){i.setPlayers(t),e.usernames=t,e.checkUserCount=Object.keys(e.usernames).length<0}),e.startGame=function(){t.emit("startGame",null),a.setLCShow(!1),a.setPCShow(!0)},function(){o()}()};angular.module("app").controller("loginController",["$scope","socketService","displayService","playerService",e])}(),function(){"use strict";var e=function(e,t,a,i,o,n){function r(e,t){return t.username==e.userName?!0:!1}function s(){u.length>0&&(u[0].speed=0),g.clearRect(0,0,p.width,p.height);var e=p.width/100;if(0!=d.length){var t=p.width/100,a=t*d[0].image.height/d[0].image.width;for(var i in d){var o=d[i];o.width=t,o.height=a,0==o.explodeStage?(g.save(),g.translate(o.x*e,o.y*e),g.rotate(o.rotation/180*Math.PI),g.drawImage(o.image,-t/2,-a/2,t,a),g.restore(),d[i].x=Math.cos((o.rotation-90)/180*Math.PI)+o.x,d[i].y=Math.sin((o.rotation-90)/180*Math.PI)+o.y):o.explodeStage<4&&(console.log(o.explosionImage),g.save(),g.translate(o.x*e,o.y*e),g.drawImage(o.explosionImage,-t,-t,2*t,2*t),g.restore())}}if(0!=u.length){var n=p.width/20,r=n*u[0].image.height/u[0].image.width;for(var s in u){var l=u[s];l.width=n,l.height=r,g.save(),g.translate(l.x*e,l.y*e),g.rotate(l.rotation/180*Math.PI),g.drawImage(l.image,-n/2,-r/2,n,r),l.damage>0&&g.drawImage(l.damageImage,-n/2,-r/2,n,r),g.restore(),u[s].x=Math.cos((l.rotation-90)/180*Math.PI)/10*l.speed+l.x,u[s].y=Math.sin((l.rotation-90)/180*Math.PI)/10*l.speed+l.y}}h(),c()}function h(){for(var e in d)(d[e].x<0||d[e].x>p.width||d[e].y<0||d[e].y>p.height)&&d.splice(e,1),d[e].explodeStage>0&&(d[e].explodeStage<4?d[e].explode():d.splice(e,1))}function c(){for(var e in u)for(var t in d)if(0==d[t].explodeStage&&d[t].player!=u[e].userName){var a=Math.sqrt(2)/2*(d[t].height/2-d[t].width/2),o=(360-d[t].rotation)/180*Math.PI,n=d[t].x*p.width/100-a*Math.sin(o),r=d[t].y*p.width/100-a*Math.cos(o),s=u[e].x*p.width/100,h=u[e].y*p.width/100,c=Math.sqrt((n-s)*(n-s)+(r-h)*(r-h));if(c<d[t].width/2+u[e].width/2){var l=new Audio("../../assets/Bonus/sfx_lose.ogg");l.play(),u[e].increaseDamage();var g={};g.username=u[e].userName,g.life=3-u[e].damage,i.emit("playerLife",g),d[t].explode()}}}e.PCShow=o.getPCShow,e.startGame=!1;var l,p=document.getElementById("game"),g=p.getContext("2d"),u=new Array,d=new Array;i.on("initGame",function(){var e=n.getPlayers();for(var a in e){var i=e[a];u.push(new Spaceship(i.username,i.x,i.y,i.color,i.rotation))}l=t(s,10)}),i.on("userleft",function(e){var t=null;for(var a in u)1==r(u[a],e)&&(t=a);u.splice(t,1)}),i.on("updateGameData",function(e){var t=null;for(var a in u)1==r(u[a],e)&&(t=a);null!=t&&u[t].rotateSpaceshipRelative(e.orientation)}),i.on("playerShot",function(e){var t=null;for(var a in u)1==r(u[a],e)&&(t=a);if(null!=t){var i=u[t],o=(360-(i.rotation+180))/180*Math.PI,n=i.x+p.width/400*Math.sin(o),s=i.y+p.width/400*Math.cos(o);if(d.push(new Bullet(n,s,i.rotation,i.color,i.userName)),t%2==0)var h=new Audio("../../assets/Bonus/sfx_laser1.ogg");else var h=new Audio("../../assets/Bonus/sfx_laser2.ogg");h.play()}})};angular.module("app").controller("playController",["$scope","$interval","$window","socketService","displayService","playerService",e])}();var Bullet=function(e,t,a,i,o){this.x=e,this.y=t,this.rotation=a,this.image=new Image,this.color=i,this.width=0,this.height=0,this.player=o,this.explosionImage=new Image,this.explodeStage=0,"orange"==this.color&&(this.color="red"),this.image.src="../assets/PNG/Lasers/laser"+this.color.charAt(0).toUpperCase()+this.color.slice(1)+"01.png"};Bullet.prototype.explode=function(){if(this.explodeStage<4){this.explodeStage++;var e;e=this.explodeStage<3?1:2,this.explosionImage.src="../assets/PNG/Lasers/laser"+this.color.charAt(0).toUpperCase()+this.color.slice(1)+"Explode"+e+".png"}else this.explosionImage.src=""};var Spaceship=function(e,t,a,i,o){this.userName=e,this.x=t,this.y=a,this.speed=1,this.color=i,this.rotation=o,this.image=new Image,this.damage=0,this.width=0,this.height=0,this.damageImage=new Image,this.image.src="../assets/PNG/playerShip1_"+this.color+".png"};Spaceship.prototype.moveSpaceship=function(e,t){this.x=e,this.y=t},Spaceship.prototype.moveSpaceshipRelative=function(e,t){this.x=this.x+e,this.y=this.y+t},Spaceship.prototype.rotateSpaceship=function(e){this.rotation=e},Spaceship.prototype.rotateSpaceshipRelative=function(e){this.rotation=this.rotation+e/5,this.rotation<-360&&(this.rotation=this.rotation+720),this.rotation>360&&(this.rotation=this.rotation-720)},Spaceship.prototype.increaseDamage=function(){this.damage<4&&(this.damage+=1),this.damage<=3&&this.damage>0&&(this.damageImage.src="../assets/PNG/Damage/playerShip1_damage"+this.damage+".png")},Spaceship.prototype.decreaseDamage=function(){this.damage>0&&(this.damage-=1),this.damage<=3&&this.damage>0&&(this.damageImage.src="../assets/PNG/Damage/playerShip1_damage"+this.damage+".png")},function(){var e=function(){var e=!0,t=!1;return{getLCShow:function(){return e},setLCShow:function(t){e=t},getPCShow:function(){return t},setPCShow:function(e){t=e}}};angular.module("app").factory("displayService",[e])}(),function(){var e=function(){var e=[];return{getPlayers:function(){return e},setPlayers:function(t){e=t}}};angular.module("app").factory("playerService",[e])}(),function(){var e=function(e){"use strict";var t=io.connect(window.location.host),a=function(a,i){t.on(a,function(){var a=arguments;e.$apply(function(){i.apply(t,a)})})},i=function(a,i,o){t.emit(a,i,function(){var a=arguments;e.$apply(function(){o&&o.apply(t,a)})})};return{on:a,emit:i,socket:t}};angular.module("app").factory("socketService",["$rootScope",e])}();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyIsImRpcmVjdGl2ZXMvY2FudmFzRGlyZWN0aXZlLmpzIiwiY29udHJvbGxlci9sb2dpbkNvbnRyb2xsZXIuanMiLCJjb250cm9sbGVyL3BsYXlDb250cm9sbGVyLmpzIiwibW9kZWxzL0J1bGxldC5qcyIsIm1vZGVscy9TcGFjZXNoaXAuanMiLCJzZXJ2aWNlcy9kaXNwbGF5U2VydmljZS5qcyIsInNlcnZpY2VzL3BsYXllclNlcnZpY2UuanMiLCJzZXJ2aWNlcy9zb2NrZXRTZXJ2aWNlLmpzIl0sIm5hbWVzIjpbImFuZ3VsYXIiLCJtb2R1bGUiLCJjYW52YXNEaXJlY3RpdmUiLCIkd2luZG93IiwibGluayIsInNjb3BlIiwiZWxlbWVudCIsImF0dHJzIiwiaW5uZXJXaWR0aCIsImlubmVySGVpZ2h0Iiwid2lkdGgiLCJiaW5kIiwiJGRpZ2VzdCIsInJlc3RyaWN0IiwicmVwbGFjZSIsInRlbXBsYXRlIiwiZGlyZWN0aXZlIiwibG9naW5Db250cm9sbGVyIiwiJHNjb3BlIiwic29ja2V0U2VydmljZSIsImRpc3BsYXlTZXJ2aWNlIiwicGxheWVyU2VydmljZSIsIkxDU2hvdyIsImdldExDU2hvdyIsIm1ha2VSb29tIiwiZW1pdCIsInJvb20iLCJvbiIsImRhdGEiLCJkZXZpY2VPcmllbnRhdGlvbiIsInVzZXJuYW1lIiwiZ2FtbWEiLCJiZXRhIiwiYWxwaGEiLCJ1c2VybmFtZXMiLCJjaGVja1VzZXJDb3VudCIsInNldFBsYXllcnMiLCJPYmplY3QiLCJrZXlzIiwibGVuZ3RoIiwic3RhcnRHYW1lIiwic2V0TENTaG93Iiwic2V0UENTaG93IiwiY29udHJvbGxlciIsInBsYXlDb250cm9sbGVyIiwiJGludGVydmFsIiwiZmlsdGVyUGxheWVycyIsIm9iaiIsInVzZXJOYW1lIiwiZHJhdyIsIkFsbFBsYXllcnMiLCJzcGVlZCIsImN0eCIsImNsZWFyUmVjdCIsImNhbnYiLCJoZWlnaHQiLCJyYXRpbyIsIkFsbEJ1bGxldHMiLCJCdWxsZXRXaWR0aCIsIkJ1bGxldEhlaWdodCIsImltYWdlIiwiYnVsbGV0IiwiYiIsImV4cGxvZGVTdGFnZSIsInNhdmUiLCJ0cmFuc2xhdGUiLCJ4IiwieSIsInJvdGF0ZSIsInJvdGF0aW9uIiwiTWF0aCIsIlBJIiwiZHJhd0ltYWdlIiwicmVzdG9yZSIsImNvcyIsInNpbiIsImNvbnNvbGUiLCJsb2ciLCJleHBsb3Npb25JbWFnZSIsIlNwYWNlc2hpcFdpZHRoIiwiU3BhY2VzaGlwSGVpZ2h0IiwicGxheWVyIiwicCIsImRhbWFnZSIsImRhbWFnZUltYWdlIiwiY2hlY2tCdWxsZXRzIiwiY29sbGlzaW9uRGV0ZWN0aW9uIiwic3BsaWNlIiwiZXhwbG9kZSIsInJhZGl1cyIsInNxcnQiLCJhbmdsZSIsImJ1bGxldEhlYWRYIiwiYnVsbGV0SGVhZFkiLCJzcGFjZVNoaXBYIiwic3BhY2VTaGlwWSIsImRpc3RhbmNlIiwiZGFtYWdlc291bmQiLCJBdWRpbyIsInBsYXkiLCJpbmNyZWFzZURhbWFnZSIsImxpZmUiLCJQQ1Nob3ciLCJnZXRQQ1Nob3ciLCJjeWNsZSIsImRvY3VtZW50IiwiZ2V0RWxlbWVudEJ5SWQiLCJnZXRDb250ZXh0IiwiQXJyYXkiLCJCdWZmZXJQbGF5ZXIiLCJnZXRQbGF5ZXJzIiwicHVzaCIsIlNwYWNlc2hpcCIsImNvbG9yIiwiaSIsInJvdGF0ZVNwYWNlc2hpcFJlbGF0aXZlIiwib3JpZW50YXRpb24iLCJ0ZW1wIiwiQnVsbGV0Iiwic2hvdCIsInRoaXMiLCJJbWFnZSIsInNyYyIsImNoYXJBdCIsInRvVXBwZXJDYXNlIiwic2xpY2UiLCJwcm90b3R5cGUiLCJudW1iZXIiLCJtb3ZlU3BhY2VzaGlwIiwibW92ZVNwYWNlc2hpcFJlbGF0aXZlIiwicm90YXRlU3BhY2VzaGlwIiwiZGVncmVlIiwiZGVjcmVhc2VEYW1hZ2UiLCJ2YWx1ZSIsImZhY3RvcnkiLCJwbGF5ZXJzIiwicGxheWVyc0FycmF5IiwiJHJvb3RTY29wZSIsInNvY2tldCIsImlvIiwiY29ubmVjdCIsIndpbmRvdyIsImxvY2F0aW9uIiwiaG9zdCIsImV2ZW50TmFtZSIsImNhbGxiYWNrIiwiYXJncyIsImFyZ3VtZW50cyIsIiRhcHBseSIsImFwcGx5Il0sIm1hcHBpbmdzIjoiQ0FHQSxXQUVBQSxRQUFBQyxPQUFBLGFDRkEsV0FDQSxHQUFBQyxHQUFBLFNBQUFDLEdBUUEsUUFBQUMsR0FBQUMsRUFBQUMsRUFBQUMsR0FDQUosRUFBQUssV0FBQUwsRUFBQU0sWUFDQUosRUFBQUssTUFBQVAsRUFBQUssV0FBQSxHQUVBSCxFQUFBSyxNQUFBUCxFQUFBTSxZQUFBLEdBR0FULFFBQUFNLFFBQUFILEdBQUFRLEtBQUEsU0FBQSxXQUNBUixFQUFBSyxXQUFBTCxFQUFBTSxZQUNBSixFQUFBSyxNQUFBUCxFQUFBSyxXQUFBLEdBRUFILEVBQUFLLE1BQUFQLEVBQUFNLFlBQUEsR0FHQUosRUFBQU8sWUFyQkEsT0FDQUMsU0FBQSxJQUNBVCxLQUFBQSxFQUNBVSxTQUFBLEVBQ0FDLFNBQUEsOEVBc0JBZixTQUFBQyxPQUFBLE9BQUFlLFVBQUEsbUJBQUEsVUFBQWQsT0MzQkEsV0FDQSxHQUFBZSxHQUFBLFNBQUFDLEVBQUFDLEVBQUFDLEVBQUFDLEdBRUFILEVBQUFJLE9BQUFGLEVBQUFHLFNBR0EsSUFBQUMsR0FBQSxXQUNBTCxFQUFBTSxLQUFBLFlBQUEsTUFFQVAsR0FBQVEsS0FBQSxHQUNBUCxFQUFBUSxHQUFBLGNBQUEsU0FBQUMsR0FDQVYsRUFBQVEsS0FBQUUsSUFFQVQsRUFBQVEsR0FBQSxvQkFBQSxTQUFBQyxHQUNBLEdBQ0FDLElBREFELEVBQUFFLFlBRUFELEdBQUFFLE1BQUFILEVBQUFHLE1BQ0FGLEVBQUFHLEtBQUFKLEVBQUFJLEtBQ0FILEVBQUFJLE1BQUFMLEVBQUFLLFFBRUFmLEVBQUFnQixhQUNBaEIsRUFBQWlCLGdCQUFBLEVBQ0FoQixFQUFBUSxHQUFBLGNBQUEsU0FBQUMsR0FDQVAsRUFBQWUsV0FBQVIsR0FDQVYsRUFBQWdCLFVBQUFOLEVBQ0FWLEVBQUFpQixlQUFBRSxPQUFBQyxLQUFBcEIsRUFBQWdCLFdB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USxRQUtBekgsRUFBQSxTQUFBdUgsRUFBQXBILEVBQUFxSCxHQUNBUCxFQUFBakgsS0FBQXVILEVBQUFwSCxFQUFBLFdBQ0EsR0FBQXNILEdBQUFDLFNBQ0FWLEdBQUFXLE9BQUEsV0FDQUgsR0FDQUEsRUFBQUksTUFBQVgsRUFBQVEsT0FPQSxRQUNBdkgsR0FBQUEsRUFDQUYsS0FBQUEsRUFDQWlILE9BQUFBLEdBSUExSSxTQUFBQyxPQUFBLE9BQUFxSSxRQUFBLGlCQUFBLGFBQUFuSCIsImZpbGUiOiJhcHAubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBDcmVhdGVkIGJ5IE1pY2hpZWwgb24gMjUvMTEvMjAxNS5cbiAqL1xuKGZ1bmN0aW9uKCl7XG5cbiAgICB2YXIgYXBwID0gYW5ndWxhci5tb2R1bGUoXCJhcHBcIixbXSk7XG59KSgpOyIsIi8qKlxyXG4gKiBDcmVhdGVkIGJ5IGp1c3Rpam5kZXBvdmVyIG9uIDE2LzEyLzE1LlxyXG4gKi9cclxuKGZ1bmN0aW9uKCl7XHJcbiAgICB2YXIgY2FudmFzRGlyZWN0aXZlID0gZnVuY3Rpb24oJHdpbmRvdyl7XHJcbiAgICAgICAgcmV0dXJue1xyXG4gICAgICAgICAgICByZXN0cmljdDogJ0UnLFxyXG4gICAgICAgICAgICBsaW5rOmxpbmssXHJcbiAgICAgICAgICAgIHJlcGxhY2U6dHJ1ZSxcclxuICAgICAgICAgICAgdGVtcGxhdGU6JzxjYW52YXMgaWQ9XCJnYW1lXCIgY2xhc3M9XCJwbGF5QXJlYVwiIHdpZHRoPVwie3t3aWR0aH19XCIgaGVpZ2h0PVwie3t3aWR0aH19XCIgLz4nXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gbGluayhzY29wZSwgZWxlbWVudCwgYXR0cnMpe1xyXG4gICAgICAgICAgICBpZigkd2luZG93LmlubmVyV2lkdGggPCAkd2luZG93LmlubmVySGVpZ2h0KXtcclxuICAgICAgICAgICAgICAgIHNjb3BlLndpZHRoID0gJHdpbmRvdy5pbm5lcldpZHRoIC0gMjA7XHJcbiAgICAgICAgICAgIH1lbHNle1xyXG4gICAgICAgICAgICAgICAgc2NvcGUud2lkdGggPSAkd2luZG93LmlubmVySGVpZ2h0IC0gMjA7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGFuZ3VsYXIuZWxlbWVudCgkd2luZG93KS5iaW5kKCdyZXNpemUnLCBmdW5jdGlvbigpe1xyXG4gICAgICAgICAgICAgICAgaWYoJHdpbmRvdy5pbm5lcldpZHRoIDwgJHdpbmRvdy5pbm5lckhlaWdodCl7XHJcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUud2lkdGggPSAkd2luZG93LmlubmVyV2lkdGggLSAyMDtcclxuICAgICAgICAgICAgICAgIH1lbHNle1xyXG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLndpZHRoID0gJHdpbmRvdy5pbm5lckhlaWdodCAtIDIwO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIHNjb3BlLiRkaWdlc3QoKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuXHJcbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwJykuZGlyZWN0aXZlKFwiY2FudmFzRGlyZWN0aXZlXCIsIFtcIiR3aW5kb3dcIiwgY2FudmFzRGlyZWN0aXZlXSk7XHJcbn0pKCk7IiwiLyoqXHJcbiAqIENyZWF0ZWQgYnkgTWljaGllbCBvbiAxMS8xMi8yMDE1LlxyXG4gKi9cclxuXHJcbihmdW5jdGlvbigpe1xyXG4gICAgdmFyIGxvZ2luQ29udHJvbGxlciA9IGZ1bmN0aW9uKCRzY29wZSwgc29ja2V0U2VydmljZSwgZGlzcGxheVNlcnZpY2UsIHBsYXllclNlcnZpY2Upe1xyXG5cclxuICAgICAgICAkc2NvcGUuTENTaG93ID0gZGlzcGxheVNlcnZpY2UuZ2V0TENTaG93O1xyXG5cclxuICAgICAgICAvL2Z1bmN0aW9uc1xyXG4gICAgICAgIHZhciBtYWtlUm9vbSA9IGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgICAgIHNvY2tldFNlcnZpY2UuZW1pdChcInBjY29ubmVjdFwiLCBudWxsKTtcclxuICAgICAgICB9O1xyXG4gICAgICAgICRzY29wZS5yb29tID0gXCJcIjtcclxuICAgICAgICBzb2NrZXRTZXJ2aWNlLm9uKCdyZXF1ZXN0Um9vbScsZnVuY3Rpb24oZGF0YSl7XHJcbiAgICAgICAgICAgICRzY29wZS5yb29tID0gZGF0YTtcclxuICAgICAgICB9KTtcclxuICAgICAgICBzb2NrZXRTZXJ2aWNlLm9uKCdkZXZpY2VPcmllbnRhdGlvbicsIGZ1bmN0aW9uKGRhdGEpe1xyXG4gICAgICAgICAgICB2YXIgdXNlcm5hbWUgPSBkYXRhLnVzZXJuYW1lO1xyXG4gICAgICAgICAgICB2YXIgZGV2aWNlT3JpZW50YXRpb24gPSB7fTtcclxuICAgICAgICAgICAgZGV2aWNlT3JpZW50YXRpb24uZ2FtbWEgPSBkYXRhLmdhbW1hO1xyXG4gICAgICAgICAgICBkZXZpY2VPcmllbnRhdGlvbi5iZXRhID0gZGF0YS5iZXRhO1xyXG4gICAgICAgICAgICBkZXZpY2VPcmllbnRhdGlvbi5hbHBoYSA9IGRhdGEuYWxwaGE7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgJHNjb3BlLnVzZXJuYW1lcyA9IHt9O1xyXG4gICAgICAgICRzY29wZS5jaGVja1VzZXJDb3VudCA9IGZhbHNlO1xyXG4gICAgICAgIHNvY2tldFNlcnZpY2Uub24oJ3VwZGF0ZXVzZXJzJywgZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgcGxheWVyU2VydmljZS5zZXRQbGF5ZXJzKGRhdGEpO1xyXG4gICAgICAgICAgICAkc2NvcGUudXNlcm5hbWVzID0gZGF0YTtcclxuICAgICAgICAgICAgJHNjb3BlLmNoZWNrVXNlckNvdW50ID0gT2JqZWN0LmtleXMoJHNjb3BlLnVzZXJuYW1lcykubGVuZ3RoIDwgMDtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgJHNjb3BlLnN0YXJ0R2FtZT0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBzb2NrZXRTZXJ2aWNlLmVtaXQoXCJzdGFydEdhbWVcIiwgbnVsbCk7XHJcbiAgICAgICAgICAgIGRpc3BsYXlTZXJ2aWNlLnNldExDU2hvdyhmYWxzZSk7XHJcbiAgICAgICAgICAgIGRpc3BsYXlTZXJ2aWNlLnNldFBDU2hvdyh0cnVlKTtcclxuICAgICAgICB9O1xyXG5cclxuXHJcbiAgICAgICAgKGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICBtYWtlUm9vbSgpO1xyXG4gICAgICAgIH0pKCk7XHJcblxyXG4gICAgfTtcclxuXHJcbiAgICBhbmd1bGFyLm1vZHVsZShcImFwcFwiKS5jb250cm9sbGVyKFwibG9naW5Db250cm9sbGVyXCIsIFtcIiRzY29wZVwiLCBcInNvY2tldFNlcnZpY2VcIiAsIFwiZGlzcGxheVNlcnZpY2VcIiwgXCJwbGF5ZXJTZXJ2aWNlXCIsIGxvZ2luQ29udHJvbGxlcl0pO1xyXG59KSgpOyIsIi8qKlxyXG4gKiBDcmVhdGVkIGJ5IE1pY2hpZWwgb24gMTYvMTIvMjAxNS5cclxuICovXHJcblxyXG4oZnVuY3Rpb24oKXtcclxuICAgIFwidXNlIHN0cmljdFwiO1xyXG4gICAgdmFyIHBsYXlDb250cm9sbGVyID0gZnVuY3Rpb24oJHNjb3BlLCAkaW50ZXJ2YWwsICR3aW5kb3csIHNvY2tldFNlcnZpY2UsIGRpc3BsYXlTZXJ2aWNlLCBwbGF5ZXJTZXJ2aWNlKXtcclxuICAgICAgICAkc2NvcGUuUENTaG93ID0gZGlzcGxheVNlcnZpY2UuZ2V0UENTaG93O1xyXG4gICAgICAgICRzY29wZS5zdGFydEdhbWUgPSBmYWxzZTtcclxuICAgICAgICB2YXIgY2FudiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdnYW1lJyk7XHJcbiAgICAgICAgdmFyIGN0eCA9IGNhbnYuZ2V0Q29udGV4dCgnMmQnKTtcclxuXHJcbiAgICAgICAgdmFyIEFsbFBsYXllcnMgPSBuZXcgQXJyYXkoKTtcclxuICAgICAgICB2YXIgQWxsQnVsbGV0cyA9IG5ldyBBcnJheSgpO1xyXG5cclxuICAgICAgICB2YXIgY3ljbGU7XHJcblxyXG4gICAgICAgIHNvY2tldFNlcnZpY2Uub24oXCJpbml0R2FtZVwiLCBmdW5jdGlvbigpe1xyXG4gICAgICAgICAgICB2YXIgQnVmZmVyUGxheWVyID0gcGxheWVyU2VydmljZS5nZXRQbGF5ZXJzKCk7XHJcbiAgICAgICAgICAgIGZvcih2YXIgcGxheWVyIGluIEJ1ZmZlclBsYXllcil7XHJcbiAgICAgICAgICAgICAgICB2YXIgcCA9IEJ1ZmZlclBsYXllcltwbGF5ZXJdO1xyXG4gICAgICAgICAgICAgICAgQWxsUGxheWVycy5wdXNoKG5ldyBTcGFjZXNoaXAocC51c2VybmFtZSwgcC54LCBwLnksIHAuY29sb3IsIHAucm90YXRpb24pKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgY3ljbGUgPSAkaW50ZXJ2YWwoZHJhdywgMTApO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBzb2NrZXRTZXJ2aWNlLm9uKFwidXNlcmxlZnRcIiwgZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgdmFyIHAgPSBudWxsO1xyXG4gICAgICAgICAgICBmb3IodmFyIGkgaW4gQWxsUGxheWVycyl7XHJcbiAgICAgICAgICAgICAgICBpZihmaWx0ZXJQbGF5ZXJzKEFsbFBsYXllcnNbaV0sZGF0YSkgPT0gdHJ1ZSl7XHJcbiAgICAgICAgICAgICAgICAgICAgcCA9IGk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgQWxsUGxheWVycy5zcGxpY2UocCwxKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgc29ja2V0U2VydmljZS5vbihcInVwZGF0ZUdhbWVEYXRhXCIsIGZ1bmN0aW9uKGRhdGEpe1xyXG4gICAgICAgICAgICB2YXIgcCA9IG51bGw7XHJcbiAgICAgICAgICAgIGZvcih2YXIgaSBpbiBBbGxQbGF5ZXJzKXtcclxuICAgICAgICAgICAgICAgIGlmKGZpbHRlclBsYXllcnMoQWxsUGxheWVyc1tpXSxkYXRhKSA9PSB0cnVlKXtcclxuICAgICAgICAgICAgICAgICAgICBwID0gaTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZihwICE9IG51bGwpe1xyXG4gICAgICAgICAgICAgICAgQWxsUGxheWVyc1twXS5yb3RhdGVTcGFjZXNoaXBSZWxhdGl2ZShkYXRhLm9yaWVudGF0aW9uKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBzb2NrZXRTZXJ2aWNlLm9uKFwicGxheWVyU2hvdFwiLCBmdW5jdGlvbihkYXRhKXtcclxuICAgICAgICAgICAgdmFyIHAgPSBudWxsO1xyXG4gICAgICAgICAgICBmb3IodmFyIGkgaW4gQWxsUGxheWVycyl7XHJcbiAgICAgICAgICAgICAgICBpZihmaWx0ZXJQbGF5ZXJzKEFsbFBsYXllcnNbaV0sZGF0YSkgPT0gdHJ1ZSl7XHJcbiAgICAgICAgICAgICAgICAgICAgcCA9IGk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYocCAhPSBudWxsKXtcclxuICAgICAgICAgICAgICAgIHZhciB0ZW1wID0gQWxsUGxheWVyc1twXTtcclxuICAgICAgICAgICAgICAgIHZhciBhbmdsZSA9ICgzNjAgLSh0ZW1wLnJvdGF0aW9uICsgMTgwKSkvMTgwKk1hdGguUEk7XHJcbiAgICAgICAgICAgICAgICB2YXIgeCA9IHRlbXAueCArIChjYW52LndpZHRoLzQwMCAqIE1hdGguc2luKGFuZ2xlKSk7XHJcbiAgICAgICAgICAgICAgICB2YXIgeSA9IHRlbXAueSArIChjYW52LndpZHRoLzQwMCAqIE1hdGguY29zKGFuZ2xlKSk7XHJcbiAgICAgICAgICAgICAgICBBbGxCdWxsZXRzLnB1c2gobmV3IEJ1bGxldCh4LCB5LCB0ZW1wLnJvdGF0aW9uLCB0ZW1wLmNvbG9yLCB0ZW1wLnVzZXJOYW1lKSk7XHJcbiAgICAgICAgICAgICAgICBpZihwJTIgPT0gMCl7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHNob3QgPSBuZXcgQXVkaW8oJy4uLy4uL2Fzc2V0cy9Cb251cy9zZnhfbGFzZXIxLm9nZycpO1xyXG4gICAgICAgICAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHNob3QgPSBuZXcgQXVkaW8oJy4uLy4uL2Fzc2V0cy9Cb251cy9zZnhfbGFzZXIyLm9nZycpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgc2hvdC5wbGF5KCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZmlsdGVyUGxheWVycyhvYmosZGF0YSl7XHJcbiAgICAgICAgICAgIGlmKGRhdGEudXNlcm5hbWUgPT0gb2JqLnVzZXJOYW1lKXtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZHJhdygpe1xyXG4gICAgICAgICAgICBpZihBbGxQbGF5ZXJzLmxlbmd0aD4wKXtcclxuICAgICAgICAgICAgICAgIEFsbFBsYXllcnNbMF0uc3BlZWQgPSAwO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGN0eC5jbGVhclJlY3QoMCwwLGNhbnYud2lkdGgsIGNhbnYuaGVpZ2h0KTtcclxuICAgICAgICAgICAgdmFyIHJhdGlvID0gY2Fudi53aWR0aC8xMDA7XHJcblxyXG4gICAgICAgICAgICBpZihBbGxCdWxsZXRzLmxlbmd0aCAhPSAwKXtcclxuICAgICAgICAgICAgICAgIHZhciBCdWxsZXRXaWR0aCA9IGNhbnYud2lkdGgvMTAwO1xyXG4gICAgICAgICAgICAgICAgdmFyIEJ1bGxldEhlaWdodCA9IEJ1bGxldFdpZHRoICogQWxsQnVsbGV0c1swXS5pbWFnZS5oZWlnaHQvQWxsQnVsbGV0c1swXS5pbWFnZS53aWR0aDtcclxuXHJcbiAgICAgICAgICAgICAgICBmb3IodmFyIGJ1bGxldCBpbiBBbGxCdWxsZXRzKXtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgYiA9IEFsbEJ1bGxldHNbYnVsbGV0XTtcclxuICAgICAgICAgICAgICAgICAgICBiLndpZHRoID0gQnVsbGV0V2lkdGg7XHJcbiAgICAgICAgICAgICAgICAgICAgYi5oZWlnaHQgPSBCdWxsZXRIZWlnaHQ7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmKGIuZXhwbG9kZVN0YWdlID09IDApe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvL0RyYXcgYnVsbGV0XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5zYXZlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGN0eC50cmFuc2xhdGUoYi54KnJhdGlvLCBiLnkqcmF0aW8pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjdHgucm90YXRlKGIucm90YXRpb24vMTgwKk1hdGguUEkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjdHguZHJhd0ltYWdlKGIuaW1hZ2UsIC1CdWxsZXRXaWR0aC8yLCAtQnVsbGV0SGVpZ2h0LzIsIEJ1bGxldFdpZHRoLCBCdWxsZXRIZWlnaHQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjdHgucmVzdG9yZSgpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgQWxsQnVsbGV0c1tidWxsZXRdLnggPSBNYXRoLmNvcygoYi5yb3RhdGlvbiAtIDkwKS8xODAqTWF0aC5QSSkgKyBiLng7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIEFsbEJ1bGxldHNbYnVsbGV0XS55ID0gTWF0aC5zaW4oKGIucm90YXRpb24gLSA5MCkvMTgwKk1hdGguUEkpKyBiLnk7XHJcbiAgICAgICAgICAgICAgICAgICAgfWVsc2UgaWYoYi5leHBsb2RlU3RhZ2UgPCA0KXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy9EcmF3IGV4cGxvc2lvblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhiLmV4cGxvc2lvbkltYWdlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY3R4LnNhdmUoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY3R4LnRyYW5zbGF0ZShiLngqcmF0aW8sIGIueSpyYXRpbyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5kcmF3SW1hZ2UoYi5leHBsb3Npb25JbWFnZSwgLUJ1bGxldFdpZHRoLCAtQnVsbGV0V2lkdGgsIEJ1bGxldFdpZHRoKjIsIEJ1bGxldFdpZHRoKjIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjdHgucmVzdG9yZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYoQWxsUGxheWVycy5sZW5ndGggIT0gMCl7XHJcbiAgICAgICAgICAgICAgICB2YXIgU3BhY2VzaGlwV2lkdGggPSBjYW52LndpZHRoLzIwO1xyXG4gICAgICAgICAgICAgICAgdmFyIFNwYWNlc2hpcEhlaWdodCA9IFNwYWNlc2hpcFdpZHRoICogQWxsUGxheWVyc1swXS5pbWFnZS5oZWlnaHQvIEFsbFBsYXllcnNbMF0uaW1hZ2Uud2lkdGg7XHJcblxyXG4gICAgICAgICAgICAgICAgZm9yKHZhciBwbGF5ZXIgaW4gQWxsUGxheWVycyl7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHAgPSBBbGxQbGF5ZXJzW3BsYXllcl07XHJcbiAgICAgICAgICAgICAgICAgICAgcC53aWR0aCA9IFNwYWNlc2hpcFdpZHRoO1xyXG4gICAgICAgICAgICAgICAgICAgIHAuaGVpZ2h0ID0gU3BhY2VzaGlwSGVpZ2h0O1xyXG4gICAgICAgICAgICAgICAgICAgIGN0eC5zYXZlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgY3R4LnRyYW5zbGF0ZShwLngqcmF0aW8sIHAueSpyYXRpbyk7XHJcbiAgICAgICAgICAgICAgICAgICAgY3R4LnJvdGF0ZShwLnJvdGF0aW9uLzE4MCpNYXRoLlBJKTtcclxuICAgICAgICAgICAgICAgICAgICBjdHguZHJhd0ltYWdlKHAuaW1hZ2UsIC1TcGFjZXNoaXBXaWR0aC8yLCAtU3BhY2VzaGlwSGVpZ2h0LzIsIFNwYWNlc2hpcFdpZHRoLCBTcGFjZXNoaXBIZWlnaHQpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmKHAuZGFtYWdlID4gMCl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5kcmF3SW1hZ2UocC5kYW1hZ2VJbWFnZSwgLVNwYWNlc2hpcFdpZHRoLzIsIC1TcGFjZXNoaXBIZWlnaHQvMiwgU3BhY2VzaGlwV2lkdGgsIFNwYWNlc2hpcEhlaWdodCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGN0eC5yZXN0b3JlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgQWxsUGxheWVyc1twbGF5ZXJdLnggPSBNYXRoLmNvcygocC5yb3RhdGlvbiAtIDkwKS8xODAqTWF0aC5QSSkvMTAqIHAuc3BlZWQgKyBwLng7XHJcbiAgICAgICAgICAgICAgICAgICAgQWxsUGxheWVyc1twbGF5ZXJdLnkgPSBNYXRoLnNpbigocC5yb3RhdGlvbiAtIDkwKS8xODAqTWF0aC5QSSkvMTAqIHAuc3BlZWQgKyBwLnk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGNoZWNrQnVsbGV0cygpO1xyXG5cclxuICAgICAgICAgICAgY29sbGlzaW9uRGV0ZWN0aW9uKCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBjaGVja0J1bGxldHMoKXtcclxuXHJcbiAgICAgICAgICAgIGZvcih2YXIgYiBpbiBBbGxCdWxsZXRzKXtcclxuICAgICAgICAgICAgICAgIGlmKEFsbEJ1bGxldHNbYl0ueCA8IDAgfHwgQWxsQnVsbGV0c1tiXS54ID4gY2Fudi53aWR0aCB8fCBBbGxCdWxsZXRzW2JdLnkgPCAwIHx8IEFsbEJ1bGxldHNbYl0ueSA+IGNhbnYuaGVpZ2h0KXtcclxuICAgICAgICAgICAgICAgICAgICBBbGxCdWxsZXRzLnNwbGljZShiLCAxKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmKEFsbEJ1bGxldHNbYl0uZXhwbG9kZVN0YWdlID4wKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKEFsbEJ1bGxldHNbYl0uZXhwbG9kZVN0YWdlIDwgNCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBBbGxCdWxsZXRzW2JdLmV4cGxvZGUoKTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBBbGxCdWxsZXRzLnNwbGljZShiLCAxKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGNvbGxpc2lvbkRldGVjdGlvbigpe1xyXG4gICAgICAgICAgICBmb3IodmFyIHAgaW4gQWxsUGxheWVycyl7XHJcbiAgICAgICAgICAgICAgICBmb3IodmFyIGIgaW4gQWxsQnVsbGV0cyl7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYoQWxsQnVsbGV0c1tiXS5leHBsb2RlU3RhZ2UgPT0gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoQWxsQnVsbGV0c1tiXS5wbGF5ZXIgIT0gQWxsUGxheWVyc1twXS51c2VyTmFtZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHJhZGl1cyA9IE1hdGguc3FydCgyKSAvIDIgKiAoQWxsQnVsbGV0c1tiXS5oZWlnaHQgLyAyIC0gQWxsQnVsbGV0c1tiXS53aWR0aCAvIDIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGFuZ2xlID0gKDM2MCAtIChBbGxCdWxsZXRzW2JdLnJvdGF0aW9uKSkgLyAxODAgKiBNYXRoLlBJO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGJ1bGxldEhlYWRYID0gKEFsbEJ1bGxldHNbYl0ueCAqIGNhbnYud2lkdGggLyAxMDAgLSAocmFkaXVzICogTWF0aC5zaW4oYW5nbGUpKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgYnVsbGV0SGVhZFkgPSAoQWxsQnVsbGV0c1tiXS55ICogY2Fudi53aWR0aCAvIDEwMCAtIChyYWRpdXMgKiBNYXRoLmNvcyhhbmdsZSkpKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgc3BhY2VTaGlwWCA9IEFsbFBsYXllcnNbcF0ueCAqIGNhbnYud2lkdGggLyAxMDA7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgc3BhY2VTaGlwWSA9IEFsbFBsYXllcnNbcF0ueSAqIGNhbnYud2lkdGggLyAxMDA7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLypjdHguc2F2ZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5iZWdpblBhdGgoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdHguYXJjKHNwYWNlU2hpcFgsIHNwYWNlU2hpcFksIEFsbFBsYXllcnNbcF0ud2lkdGgvMiwgMCwgTWF0aC5QSSoyKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdHgubGluZVdpZHRoID0gMTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdHguc3Ryb2tlU3R5bGUgPSAnIzAwMDBGRic7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3R4LnN0cm9rZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5yZXN0b3JlKCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5zYXZlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3R4LmJlZ2luUGF0aCgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5hcmMoYnVsbGV0SGVhZFgsIGJ1bGxldEhlYWRZLCBBbGxCdWxsZXRzW2JdLndpZHRoLzIsIDAsIE1hdGguUEkqMik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3R4LmxpbmVXaWR0aCA9IDE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3R4LnN0cm9rZVN0eWxlID0gJyNGRjAwMDAnO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5zdHJva2UoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdHgucmVzdG9yZSgpOyovXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZGlzdGFuY2UgPSBNYXRoLnNxcnQoKGJ1bGxldEhlYWRYIC0gc3BhY2VTaGlwWCkgKiAoYnVsbGV0SGVhZFggLSBzcGFjZVNoaXBYKSArIChidWxsZXRIZWFkWSAtIHNwYWNlU2hpcFkpICogKGJ1bGxldEhlYWRZIC0gc3BhY2VTaGlwWSkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRpc3RhbmNlIDwgKEFsbEJ1bGxldHNbYl0ud2lkdGggLyAyICsgQWxsUGxheWVyc1twXS53aWR0aCAvIDIpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGRhbWFnZXNvdW5kID0gbmV3IEF1ZGlvKCcuLi8uLi9hc3NldHMvQm9udXMvc2Z4X2xvc2Uub2dnJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGFtYWdlc291bmQucGxheSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEFsbFBsYXllcnNbcF0uaW5jcmVhc2VEYW1hZ2UoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZGF0YSA9IHt9O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEudXNlcm5hbWUgPSBBbGxQbGF5ZXJzW3BdLnVzZXJOYW1lO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEubGlmZSA9IDMtQWxsUGxheWVyc1twXS5kYW1hZ2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc29ja2V0U2VydmljZS5lbWl0KFwicGxheWVyTGlmZVwiLGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEFsbEJ1bGxldHNbYl0uZXhwbG9kZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuXHJcbiAgICBhbmd1bGFyLm1vZHVsZShcImFwcFwiKS5jb250cm9sbGVyKFwicGxheUNvbnRyb2xsZXJcIiwgW1wiJHNjb3BlXCIsIFwiJGludGVydmFsXCIsIFwiJHdpbmRvd1wiLCBcInNvY2tldFNlcnZpY2VcIiwgXCJkaXNwbGF5U2VydmljZVwiLCBcInBsYXllclNlcnZpY2VcIiwgcGxheUNvbnRyb2xsZXJdKVxyXG59KSgpOyIsIi8qKlxyXG4gKiBDcmVhdGVkIGJ5IGp1c3Rpam5kZXBvdmVyIG9uIDIyLzEyLzE1LlxyXG4gKi9cclxuXHJcbnZhciBCdWxsZXQgPSBmdW5jdGlvbih4LCB5LHJvdGF0aW9uLCBjb2xvciwgcGxheWVyKXtcclxuICAgIHRoaXMueCA9IHg7XHJcbiAgICB0aGlzLnkgPSB5O1xyXG4gICAgdGhpcy5yb3RhdGlvbiA9IHJvdGF0aW9uO1xyXG4gICAgdGhpcy5pbWFnZSA9IG5ldyBJbWFnZSgpO1xyXG4gICAgdGhpcy5jb2xvciA9IGNvbG9yO1xyXG4gICAgdGhpcy53aWR0aCA9IDA7XHJcbiAgICB0aGlzLmhlaWdodCA9IDA7XHJcbiAgICB0aGlzLnBsYXllciA9IHBsYXllcjtcclxuICAgIHRoaXMuZXhwbG9zaW9uSW1hZ2UgPSBuZXcgSW1hZ2UoKTtcclxuICAgIHRoaXMuZXhwbG9kZVN0YWdlID0gMDtcclxuICAgIGlmKHRoaXMuY29sb3IgPT0gXCJvcmFuZ2VcIil7XHJcbiAgICAgICAgdGhpcy5jb2xvciA9ICdyZWQnO1xyXG4gICAgfVxyXG4gICAgdGhpcy5pbWFnZS5zcmMgPSAnLi4vYXNzZXRzL1BORy9MYXNlcnMvbGFzZXInKyB0aGlzLmNvbG9yLmNoYXJBdCgwKS50b1VwcGVyQ2FzZSgpICsgdGhpcy5jb2xvci5zbGljZSgxKSArJzAxLnBuZydcclxufTtcclxuXHJcbkJ1bGxldC5wcm90b3R5cGUuZXhwbG9kZSA9IGZ1bmN0aW9uKCl7XHJcbiAgICBpZih0aGlzLmV4cGxvZGVTdGFnZSA8IDQpe1xyXG4gICAgICAgIHRoaXMuZXhwbG9kZVN0YWdlKys7XHJcbiAgICAgICAgdmFyIG51bWJlcjtcclxuICAgICAgICBpZih0aGlzLmV4cGxvZGVTdGFnZSA8IDMpe1xyXG4gICAgICAgICAgIG51bWJlciA9IDFcclxuICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgbnVtYmVyID0gMlxyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmV4cGxvc2lvbkltYWdlLnNyYyA9ICcuLi9hc3NldHMvUE5HL0xhc2Vycy9sYXNlcicgKyB0aGlzLmNvbG9yLmNoYXJBdCgwKS50b1VwcGVyQ2FzZSgpICsgdGhpcy5jb2xvci5zbGljZSgxKSArICdFeHBsb2RlJysgbnVtYmVyICsnLnBuZyc7XHJcbiAgICB9ZWxzZXtcclxuICAgICAgICB0aGlzLmV4cGxvc2lvbkltYWdlLnNyYyA9ICcnO1xyXG4gICAgfVxyXG59O1xyXG4iLCIvKipcclxuICogQ3JlYXRlZCBieSBqdXN0aWpuZGVwb3ZlciBvbiAwOS8xMi8xNS5cclxuICovXHJcblxyXG52YXIgU3BhY2VzaGlwID0gZnVuY3Rpb24odXNlck5hbWUsIHgsIHksIGNvbG9yLCByb3RhdGlvbil7XHJcbiAgICB0aGlzLnVzZXJOYW1lID0gdXNlck5hbWU7XHJcbiAgICB0aGlzLnggPSB4O1xyXG4gICAgdGhpcy55ID0geTtcclxuICAgIHRoaXMuc3BlZWQgPSAxO1xyXG4gICAgdGhpcy5jb2xvciA9IGNvbG9yO1xyXG4gICAgdGhpcy5yb3RhdGlvbiA9IHJvdGF0aW9uO1xyXG4gICAgdGhpcy5pbWFnZSA9IG5ldyBJbWFnZSgpO1xyXG4gICAgdGhpcy5kYW1hZ2UgPSAwO1xyXG4gICAgdGhpcy53aWR0aCA9IDA7XHJcbiAgICB0aGlzLmhlaWdodCA9IDA7XHJcbiAgICB0aGlzLmRhbWFnZUltYWdlID0gbmV3IEltYWdlKCk7XHJcbiAgICB0aGlzLmltYWdlLnNyYyA9ICcuLi9hc3NldHMvUE5HL3BsYXllclNoaXAxXycrIHRoaXMuY29sb3IgKycucG5nJ1xyXG59O1xyXG5cclxuU3BhY2VzaGlwLnByb3RvdHlwZS5tb3ZlU3BhY2VzaGlwID0gZnVuY3Rpb24oeCwgeSl7XHJcbiAgICB0aGlzLnggPSB4O1xyXG4gICAgdGhpcy55ID0geTtcclxufTtcclxuXHJcblNwYWNlc2hpcC5wcm90b3R5cGUubW92ZVNwYWNlc2hpcFJlbGF0aXZlID0gZnVuY3Rpb24oeCwgeSl7XHJcbiAgICB0aGlzLnggPSB0aGlzLngreDtcclxuICAgIHRoaXMueSA9IHRoaXMueSt5O1xyXG59O1xyXG5cclxuU3BhY2VzaGlwLnByb3RvdHlwZS5yb3RhdGVTcGFjZXNoaXAgPSBmdW5jdGlvbihkZWdyZWUpe1xyXG4gICAgdGhpcy5yb3RhdGlvbiA9IGRlZ3JlZTtcclxufTtcclxuXHJcblNwYWNlc2hpcC5wcm90b3R5cGUucm90YXRlU3BhY2VzaGlwUmVsYXRpdmUgPSBmdW5jdGlvbihkZWdyZWUpe1xyXG4gICAgdGhpcy5yb3RhdGlvbiA9IHRoaXMucm90YXRpb24gKyBkZWdyZWUvNTtcclxuICAgIGlmKHRoaXMucm90YXRpb24gPCAtMzYwKXtcclxuICAgICAgICB0aGlzLnJvdGF0aW9uID0gdGhpcy5yb3RhdGlvbiArIDcyMDtcclxuICAgIH1cclxuICAgIGlmKHRoaXMucm90YXRpb24gPiAzNjApe1xyXG4gICAgICAgIHRoaXMucm90YXRpb24gPSB0aGlzLnJvdGF0aW9uIC0gNzIwO1xyXG4gICAgfVxyXG59O1xyXG5cclxuU3BhY2VzaGlwLnByb3RvdHlwZS5pbmNyZWFzZURhbWFnZSA9IGZ1bmN0aW9uKCl7XHJcbiAgICBpZih0aGlzLmRhbWFnZSA8IDQpe1xyXG4gICAgICAgIHRoaXMuZGFtYWdlICs9IDE7XHJcbiAgICB9XHJcblxyXG4gICAgaWYodGhpcy5kYW1hZ2UgPD0gMyAmJiB0aGlzLmRhbWFnZSA+IDApe1xyXG4gICAgICAgIHRoaXMuZGFtYWdlSW1hZ2Uuc3JjID0gJy4uL2Fzc2V0cy9QTkcvRGFtYWdlL3BsYXllclNoaXAxX2RhbWFnZScrIHRoaXMuZGFtYWdlICsgJy5wbmcnO1xyXG4gICAgfVxyXG59O1xyXG5cclxuU3BhY2VzaGlwLnByb3RvdHlwZS5kZWNyZWFzZURhbWFnZSA9IGZ1bmN0aW9uKCl7XHJcbiAgICBpZih0aGlzLmRhbWFnZSA+IDApe1xyXG4gICAgICAgIHRoaXMuZGFtYWdlIC09IDE7XHJcbiAgICB9XHJcblxyXG4gICAgaWYodGhpcy5kYW1hZ2UgPD0gMyAmJiB0aGlzLmRhbWFnZSA+IDApe1xyXG4gICAgICAgIHRoaXMuZGFtYWdlSW1hZ2Uuc3JjID0gJy4uL2Fzc2V0cy9QTkcvRGFtYWdlL3BsYXllclNoaXAxX2RhbWFnZScrIHRoaXMuZGFtYWdlICsgJy5wbmcnO1xyXG4gICAgfVxyXG59O1xyXG5cclxuIiwiLyoqXHJcbiAqIENyZWF0ZWQgYnkgTWljaGllbCBvbiAxNi8xMi8yMDE1LlxyXG4gKi9cclxuLyoqXHJcbiAqIENyZWF0ZWQgYnkganVzdGlqbmRlcG92ZXIgb24gMTYvMTIvMTUuXHJcbiAqL1xyXG5cclxuXHJcbihmdW5jdGlvbigpe1xyXG4gICAgdmFyIGRpc3BsYXlTZXJ2aWNlID0gZnVuY3Rpb24oKXtcclxuICAgICAgICAvL0xvZ2luIENvbnRyb2xsZXJcclxuICAgICAgICB2YXIgTENTaG93ID0gdHJ1ZTtcclxuICAgICAgICAvL1BsYXkgY29udHJvbGxlclxyXG4gICAgICAgIHZhciBQQ1Nob3cgPSBmYWxzZTtcclxuXHJcbiAgICAgICAgcmV0dXJue1xyXG4gICAgICAgICAgICBnZXRMQ1Nob3c6IGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gTENTaG93O1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBzZXRMQ1Nob3c6IGZ1bmN0aW9uKHZhbHVlKXtcclxuICAgICAgICAgICAgICAgIExDU2hvdyA9IHZhbHVlO1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBnZXRQQ1Nob3c6IGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gUENTaG93O1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBzZXRQQ1Nob3c6IGZ1bmN0aW9uKHZhbHVlKXtcclxuICAgICAgICAgICAgICAgIFBDU2hvdyA9IHZhbHVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuXHJcbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwJykuZmFjdG9yeSgnZGlzcGxheVNlcnZpY2UnLCBbZGlzcGxheVNlcnZpY2VdKTtcclxufSkoKTsiLCIvKipcclxuICogQ3JlYXRlZCBieSBqdXN0aWpuZGVwb3ZlciBvbiAxNy8xMi8xNS5cclxuICovXHJcblxyXG4oZnVuY3Rpb24oKXtcclxuICAgIHZhciBwbGF5ZXJTZXJ2aWNlID0gZnVuY3Rpb24oKXtcclxuICAgICAgICAvL0xvZ2luIENvbnRyb2xsZXJcclxuICAgICAgICB2YXIgcGxheWVycyA9IFtdO1xyXG5cclxuICAgICAgICByZXR1cm57XHJcbiAgICAgICAgICAgIGdldFBsYXllcnM6IGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gcGxheWVycztcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgc2V0UGxheWVyczogZnVuY3Rpb24ocGxheWVyc0FycmF5KXtcclxuICAgICAgICAgICAgICAgIHBsYXllcnMgPSBwbGF5ZXJzQXJyYXk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9O1xyXG5cclxuICAgIGFuZ3VsYXIubW9kdWxlKCdhcHAnKS5mYWN0b3J5KCdwbGF5ZXJTZXJ2aWNlJywgW3BsYXllclNlcnZpY2VdKTtcclxufSkoKTsiLCIvKipcclxuICogQ3JlYXRlZCBieSBqdXN0aWpuZGVwb3ZlciBvbiAwOS8xMi8xNS5cclxuICovXHJcblxyXG4oZnVuY3Rpb24oKXtcclxuXHJcbiAgICB2YXIgc29ja2V0U2VydmljZSA9IGZ1bmN0aW9uKCRyb290U2NvcGUpe1xyXG4gICAgICAgIFwidXNlIHN0cmljdFwiO1xyXG4gICAgICAgIC8vcHJpdmF0ZVxyXG4gICAgICAgIHZhciBzb2NrZXQgPSBpby5jb25uZWN0KHdpbmRvdy5sb2NhdGlvbi5ob3N0KTtcclxuICAgICAgICAvL2Z1bmN0aW9uc1xyXG4gICAgICAgIHZhciBvbiA9IGZ1bmN0aW9uIChldmVudE5hbWUsIGNhbGxiYWNrKSB7XHJcbiAgICAgICAgICAgIHNvY2tldC5vbihldmVudE5hbWUsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIHZhciBhcmdzID0gYXJndW1lbnRzO1xyXG4gICAgICAgICAgICAgICAgJHJvb3RTY29wZS4kYXBwbHkoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrLmFwcGx5KHNvY2tldCwgYXJncyk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGVtaXQgPSBmdW5jdGlvbiAoZXZlbnROYW1lLCBkYXRhLCBjYWxsYmFjaykge1xyXG4gICAgICAgICAgICBzb2NrZXQuZW1pdChldmVudE5hbWUsIGRhdGEsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIHZhciBhcmdzID0gYXJndW1lbnRzO1xyXG4gICAgICAgICAgICAgICAgJHJvb3RTY29wZS4kYXBwbHkoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChjYWxsYmFjaykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFjay5hcHBseShzb2NrZXQsIGFyZ3MpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIC8vcHVibGljXHJcbiAgICAgICAgcmV0dXJue1xyXG4gICAgICAgICAgICBvbjogb24sXHJcbiAgICAgICAgICAgIGVtaXQ6IGVtaXQsXHJcbiAgICAgICAgICAgIHNvY2tldDogc29ja2V0XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuXHJcbiAgICBhbmd1bGFyLm1vZHVsZShcImFwcFwiKS5mYWN0b3J5KFwic29ja2V0U2VydmljZVwiLCBbXCIkcm9vdFNjb3BlXCIsIHNvY2tldFNlcnZpY2VdKTtcclxuXHJcbn0pKCk7Il0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
