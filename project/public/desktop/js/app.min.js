!function(){angular.module("app",[])}(),function(){var t=function(t,e,a,i){t.LCShow=a.getLCShow;var n=function(){e.emit("pcconnect",null)};t.room="",e.on("requestRoom",function(e){t.room=e}),e.on("deviceOrientation",function(t){var e=(t.username,{});e.gamma=t.gamma,e.beta=t.beta,e.alpha=t.alpha}),t.usernames={},t.checkUserCount=!1,e.on("updateusers",function(e){i.setPlayers(e),t.usernames=e,t.checkUserCount=Object.keys(t.usernames).length<0}),t.startGame=function(){e.emit("startGame",null),a.setLCShow(!1),a.setPCShow(!0)},function(){n()}()};angular.module("app").controller("loginController",["$scope","socketService","displayService","playerService",t])}(),function(){"use strict";var t=function(t,e,a,i,n,o){function r(t,e){return e.username==t.userName?!0:!1}function s(){l.clearRect(0,0,p.width,p.height);var t=p.width/100;if(0!=m.length){var e=p.width/100,a=e*m[0].image.height/m[0].image.width;for(var i in m){var n=m[i];n.width=e,n.height=a,l.save(),l.translate(n.x*t,n.y*t),l.rotate(n.rotation/180*Math.PI),l.drawImage(n.image,-e/2,-a/2,e,a),l.restore(),m[i].x=Math.cos((n.rotation-90)/180*Math.PI)+n.x,m[i].y=Math.sin((n.rotation-90)/180*Math.PI)+n.y}}if(0!=g.length){var o=p.width/20,r=o*g[0].image.height/g[0].image.width;for(var s in g){var u=g[s];u.width=o,u.height=r,l.save(),l.translate(u.x*t,u.y*t),l.rotate(u.rotation/180*Math.PI),l.drawImage(u.image,-o/2,-r/2,o,r),u.damage>0&&l.drawImage(u.damageImage,-o/2,-r/2,o,r),l.restore(),g[s].x=Math.cos((u.rotation-90)/180*Math.PI)/10*u.speed+u.x,g[s].y=Math.sin((u.rotation-90)/180*Math.PI)/10*u.speed+u.y}}h(),c()}function h(){for(var t in m)(m[t].x<0||m[t].x>p.width||m[t].y<0||m[t].y>p.height)&&m.splice(t,1)}function c(){for(var t in g)for(var e in m)if(m[e].player!=g[t].userName){var a=Math.sqrt(2)/2*(m[e].height/2-m[e].width/2),i=(360-m[e].rotation)/180*Math.PI,n=m[e].x*p.width/100-a*Math.sin(i),o=m[e].y*p.width/100-a*Math.cos(i),r=g[t].x*p.width/100,s=g[t].y*p.width/100,h=Math.sqrt((n-r)*(n-r)+(o-s)*(o-s));h<m[e].width/2+g[t].width/2&&(g[t].increaseDamage(),m.splice(e,1))}}t.PCShow=n.getPCShow,t.startGame=!1;var u,p=document.getElementById("game"),l=p.getContext("2d"),g=new Array,m=new Array;i.on("initGame",function(){var t=o.getPlayers();for(var a in t){var i=t[a];g.push(new Spaceship(i.username,i.x,i.y,i.color,i.rotation))}u=e(s,10)}),i.on("updateGameData",function(t){var e=null;for(var a in g)1==r(g[a],t)&&(e=a);null!=e&&g[e].rotateSpaceshipRelative(t.orientation)}),i.on("playerShot",function(t){var e=null;for(var a in g)1==r(g[a],t)&&(e=a);if(null!=e){var i=g[e],n=(360-(i.rotation+180))/180*Math.PI,o=i.x+p.width/400*Math.sin(n),s=i.y+p.width/400*Math.cos(n);m.push(new Bullet(o,s,i.rotation,i.color,i.userName))}})};angular.module("app").controller("playController",["$scope","$interval","$window","socketService","displayService","playerService",t])}();var Bullet=function(t,e,a,i,n){this.x=t,this.y=e,this.rotation=a,this.image=new Image,this.color=i,this.width=0,this.height=0,this.player=n,"orange"==this.color&&(this.color="red"),this.image.src="../assets/PNG/Lasers/laser"+this.color.charAt(0).toUpperCase()+this.color.slice(1)+"01.png"},Spaceship=function(t,e,a,i,n){this.userName=t,this.x=e,this.y=a,this.speed=1,this.color=i,this.rotation=n,this.image=new Image,this.damage=0,this.width=0,this.height=0,this.damageImage=new Image,this.image.src="../assets/PNG/playerShip1_"+this.color+".png"};Spaceship.prototype.moveSpaceship=function(t,e){this.x=t,this.y=e},Spaceship.prototype.moveSpaceshipRelative=function(t,e){this.x=this.x+t,this.y=this.y+e},Spaceship.prototype.rotateSpaceship=function(t){this.rotation=t},Spaceship.prototype.rotateSpaceshipRelative=function(t){this.rotation=this.rotation+t/5,this.rotation<-360&&(this.rotation=this.rotation+720),this.rotation>360&&(this.rotation=this.rotation-720)},Spaceship.prototype.increaseDamage=function(){this.damage<4&&(this.damage+=1),this.damage<=3&&this.damage>0&&(this.damageImage.src="../assets/PNG/Damage/playerShip1_damage"+this.damage+".png")},Spaceship.prototype.decreaseDamage=function(){this.damage>0&&(this.damage-=1),this.damage<=3&&this.damage>0&&(this.damageImage.src="../assets/PNG/Damage/playerShip1_damage"+this.damage+".png")},function(){var t=function(t){function e(e,a,i){t.innerWidth<t.innerHeight?e.width=t.innerWidth-20:e.width=t.innerHeight-20,angular.element(t).bind("resize",function(){t.innerWidth<t.innerHeight?e.width=t.innerWidth-20:e.width=t.innerHeight-20,e.$digest()})}return{restrict:"E",link:e,replace:!0,template:'<canvas id="game" class="playArea" width="{{width}}" height="{{width}}" />'}};angular.module("app").directive("canvasDirective",["$window",t])}(),function(){var t=function(){var t=!0,e=!1;return{getLCShow:function(){return t},setLCShow:function(e){t=e},getPCShow:function(){return e},setPCShow:function(t){e=t}}};angular.module("app").factory("displayService",[t])}(),function(){var t=function(){var t=[];return{getPlayers:function(){return t},setPlayers:function(e){t=e}}};angular.module("app").factory("playerService",[t])}(),function(){var t=function(t){"use strict";var e=io.connect(window.location.host),a=function(a,i){e.on(a,function(){var a=arguments;t.$apply(function(){i.apply(e,a)})})},i=function(a,i,n){e.emit(a,i,function(){var a=arguments;t.$apply(function(){n&&n.apply(e,a)})})};return{on:a,emit:i,socket:e}};angular.module("app").factory("socketService",["$rootScope",t])}();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyIsImNvbnRyb2xsZXIvbG9naW5Db250cm9sbGVyLmpzIiwiY29udHJvbGxlci9wbGF5Q29udHJvbGxlci5qcyIsIm1vZGVscy9CdWxsZXQuanMiLCJtb2RlbHMvU3BhY2VzaGlwLmpzIiwiZGlyZWN0aXZlcy9jYW52YXNEaXJlY3RpdmUuanMiLCJzZXJ2aWNlcy9kaXNwbGF5U2VydmljZS5qcyIsInNlcnZpY2VzL3BsYXllclNlcnZpY2UuanMiLCJzZXJ2aWNlcy9zb2NrZXRTZXJ2aWNlLmpzIl0sIm5hbWVzIjpbImFuZ3VsYXIiLCJtb2R1bGUiLCJsb2dpbkNvbnRyb2xsZXIiLCIkc2NvcGUiLCJzb2NrZXRTZXJ2aWNlIiwiZGlzcGxheVNlcnZpY2UiLCJwbGF5ZXJTZXJ2aWNlIiwiTENTaG93IiwiZ2V0TENTaG93IiwibWFrZVJvb20iLCJlbWl0Iiwicm9vbSIsIm9uIiwiZGF0YSIsImRldmljZU9yaWVudGF0aW9uIiwidXNlcm5hbWUiLCJnYW1tYSIsImJldGEiLCJhbHBoYSIsInVzZXJuYW1lcyIsImNoZWNrVXNlckNvdW50Iiwic2V0UGxheWVycyIsIk9iamVjdCIsImtleXMiLCJsZW5ndGgiLCJzdGFydEdhbWUiLCJzZXRMQ1Nob3ciLCJzZXRQQ1Nob3ciLCJjb250cm9sbGVyIiwicGxheUNvbnRyb2xsZXIiLCIkaW50ZXJ2YWwiLCIkd2luZG93IiwiZmlsdGVyUGxheWVycyIsIm9iaiIsInVzZXJOYW1lIiwiZHJhdyIsImN0eCIsImNsZWFyUmVjdCIsImNhbnYiLCJ3aWR0aCIsImhlaWdodCIsInJhdGlvIiwiQWxsQnVsbGV0cyIsIkJ1bGxldFdpZHRoIiwiQnVsbGV0SGVpZ2h0IiwiaW1hZ2UiLCJidWxsZXQiLCJiIiwic2F2ZSIsInRyYW5zbGF0ZSIsIngiLCJ5Iiwicm90YXRlIiwicm90YXRpb24iLCJNYXRoIiwiUEkiLCJkcmF3SW1hZ2UiLCJyZXN0b3JlIiwiY29zIiwic2luIiwiQWxsUGxheWVycyIsIlNwYWNlc2hpcFdpZHRoIiwiU3BhY2VzaGlwSGVpZ2h0IiwicGxheWVyIiwicCIsImRhbWFnZSIsImRhbWFnZUltYWdlIiwic3BlZWQiLCJjaGVja0J1bGxldHMiLCJjb2xsaXNpb25EZXRlY3Rpb24iLCJzcGxpY2UiLCJyYWRpdXMiLCJzcXJ0IiwiYW5nbGUiLCJidWxsZXRIZWFkWCIsImJ1bGxldEhlYWRZIiwic3BhY2VTaGlwWCIsInNwYWNlU2hpcFkiLCJkaXN0YW5jZSIsImluY3JlYXNlRGFtYWdlIiwiUENTaG93IiwiZ2V0UENTaG93IiwiY3ljbGUiLCJkb2N1bWVudCIsImdldEVsZW1lbnRCeUlkIiwiZ2V0Q29udGV4dCIsIkFycmF5IiwiQnVmZmVyUGxheWVyIiwiZ2V0UGxheWVycyIsInB1c2giLCJTcGFjZXNoaXAiLCJjb2xvciIsImkiLCJyb3RhdGVTcGFjZXNoaXBSZWxhdGl2ZSIsIm9yaWVudGF0aW9uIiwidGVtcCIsIkJ1bGxldCIsInRoaXMiLCJJbWFnZSIsInNyYyIsImNoYXJBdCIsInRvVXBwZXJDYXNlIiwic2xpY2UiLCJwcm90b3R5cGUiLCJtb3ZlU3BhY2VzaGlwIiwibW92ZVNwYWNlc2hpcFJlbGF0aXZlIiwicm90YXRlU3BhY2VzaGlwIiwiZGVncmVlIiwiZGVjcmVhc2VEYW1hZ2UiLCJjYW52YXNEaXJlY3RpdmUiLCJsaW5rIiwic2NvcGUiLCJlbGVtZW50IiwiYXR0cnMiLCJpbm5lcldpZHRoIiwiaW5uZXJIZWlnaHQiLCJiaW5kIiwiJGRpZ2VzdCIsInJlc3RyaWN0IiwicmVwbGFjZSIsInRlbXBsYXRlIiwiZGlyZWN0aXZlIiwidmFsdWUiLCJmYWN0b3J5IiwicGxheWVycyIsInBsYXllcnNBcnJheSIsIiRyb290U2NvcGUiLCJzb2NrZXQiLCJpbyIsImNvbm5lY3QiLCJ3aW5kb3ciLCJsb2NhdGlvbiIsImhvc3QiLCJldmVudE5hbWUiLCJjYWxsYmFjayIsImFyZ3MiLCJhcmd1bWVudHMiLCIkYXBwbHkiLCJhcHBseSJdLCJtYXBwaW5ncyI6IkNBR0EsV0FFQUEsUUFBQUMsT0FBQSxhQ0RBLFdBQ0EsR0FBQUMsR0FBQSxTQUFBQyxFQUFBQyxFQUFBQyxFQUFBQyxHQUVBSCxFQUFBSSxPQUFBRixFQUFBRyxTQUdBLElBQUFDLEdBQUEsV0FDQUwsRUFBQU0sS0FBQSxZQUFBLE1BRUFQLEdBQUFRLEtBQUEsR0FDQVAsRUFBQVEsR0FBQSxjQUFBLFNBQUFDLEdBQ0FWLEVBQUFRLEtBQUFFLElBRUFULEVBQUFRLEdBQUEsb0JBQUEsU0FBQUMsR0FDQSxHQUNBQyxJQURBRCxFQUFBRSxZQUVBRCxHQUFBRSxNQUFBSCxFQUFBRyxNQUNBRixFQUFBRyxLQUFBSixFQUFBSSxLQUNBSCxFQUFBSSxNQUFBTCxFQUFBSyxRQUVBZixFQUFBZ0IsYUFDQWhCLEVBQUFpQixnQkFBQSxFQUNBaEIsRUFBQVEsR0FBQSxjQUFBLFNBQUFDLEdBQ0FQLEVBQUFlLFdBQUFSLEdBQ0FWLEVBQUFnQixVQUFBTixFQUNBVixFQUFBaUIsZUFBQUUsT0FBQUMsS0FBQXBCLEVBQUFnQixXQUFBSyxPQUFBLElBR0FyQixFQUFBc0IsVUFBQSxXQUNBckIsRUFBQU0sS0FBQSxZQUFBLE1BQ0FMLEVBQUFxQixXQUFBLEdBQ0FyQixFQUFBc0IsV0FBQSxJQUlBLFdBQ0FsQixPQUtBVCxTQUFBQyxPQUFBLE9BQUEyQixXQUFBLG1CQUFBLFNBQUEsZ0JBQUEsaUJBQUEsZ0JBQUExQixPQ3pDQSxXQUNBLFlBQ0EsSUFBQTJCLEdBQUEsU0FBQTFCLEVBQUEyQixFQUFBQyxFQUFBM0IsRUFBQUMsRUFBQUMsR0FpREEsUUFBQTBCLEdBQUFDLEVBQUFwQixHQUNBLE1BQUFBLEdBQUFFLFVBQUFrQixFQUFBQyxVQUNBLEdBRUEsRUFJQSxRQUFBQyxLQUNBQyxFQUFBQyxVQUFBLEVBQUEsRUFBQUMsRUFBQUMsTUFBQUQsRUFBQUUsT0FDQSxJQUFBQyxHQUFBSCxFQUFBQyxNQUFBLEdBRUEsSUFBQSxHQUFBRyxFQUFBbEIsT0FBQSxDQUNBLEdBQUFtQixHQUFBTCxFQUFBQyxNQUFBLElBQ0FLLEVBQUFELEVBQUFELEVBQUEsR0FBQUcsTUFBQUwsT0FBQUUsRUFBQSxHQUFBRyxNQUFBTixLQUVBLEtBQUEsR0FBQU8sS0FBQUosR0FBQSxDQUNBLEdBQUFLLEdBQUFMLEVBQUFJLEVBQ0FDLEdBQUFSLE1BQUFJLEVBQ0FJLEVBQUFQLE9BQUFJLEVBQ0FSLEVBQUFZLE9BQ0FaLEVBQUFhLFVBQUFGLEVBQUFHLEVBQUFULEVBQUFNLEVBQUFJLEVBQUFWLEdBQ0FMLEVBQUFnQixPQUFBTCxFQUFBTSxTQUFBLElBQUFDLEtBQUFDLElBQ0FuQixFQUFBb0IsVUFBQVQsRUFBQUYsT0FBQUYsRUFBQSxHQUFBQyxFQUFBLEVBQUFELEVBQUFDLEdBQ0FSLEVBQUFxQixVQUNBZixFQUFBSSxHQUFBSSxFQUFBSSxLQUFBSSxLQUFBWCxFQUFBTSxTQUFBLElBQUEsSUFBQUMsS0FBQUMsSUFBQVIsRUFBQUcsRUFDQVIsRUFBQUksR0FBQUssRUFBQUcsS0FBQUssS0FBQVosRUFBQU0sU0FBQSxJQUFBLElBQUFDLEtBQUFDLElBQUFSLEVBQUFJLEdBSUEsR0FBQSxHQUFBUyxFQUFBcEMsT0FBQSxDQUNBLEdBQUFxQyxHQUFBdkIsRUFBQUMsTUFBQSxHQUNBdUIsRUFBQUQsRUFBQUQsRUFBQSxHQUFBZixNQUFBTCxPQUFBb0IsRUFBQSxHQUFBZixNQUFBTixLQUVBLEtBQUEsR0FBQXdCLEtBQUFILEdBQUEsQ0FDQSxHQUFBSSxHQUFBSixFQUFBRyxFQUNBQyxHQUFBekIsTUFBQXNCLEVBQ0FHLEVBQUF4QixPQUFBc0IsRUFDQTFCLEVBQUFZLE9BQ0FaLEVBQUFhLFVBQUFlLEVBQUFkLEVBQUFULEVBQUF1QixFQUFBYixFQUFBVixHQUNBTCxFQUFBZ0IsT0FBQVksRUFBQVgsU0FBQSxJQUFBQyxLQUFBQyxJQUNBbkIsRUFBQW9CLFVBQUFRLEVBQUFuQixPQUFBZ0IsRUFBQSxHQUFBQyxFQUFBLEVBQUFELEVBQUFDLEdBQ0FFLEVBQUFDLE9BQUEsR0FDQTdCLEVBQUFvQixVQUFBUSxFQUFBRSxhQUFBTCxFQUFBLEdBQUFDLEVBQUEsRUFBQUQsRUFBQUMsR0FFQTFCLEVBQUFxQixVQUNBRyxFQUFBRyxHQUFBYixFQUFBSSxLQUFBSSxLQUFBTSxFQUFBWCxTQUFBLElBQUEsSUFBQUMsS0FBQUMsSUFBQSxHQUFBUyxFQUFBRyxNQUFBSCxFQUFBZCxFQUNBVSxFQUFBRyxHQUFBWixFQUFBRyxLQUFBSyxLQUFBSyxFQUFBWCxTQUFBLElBQUEsSUFBQUMsS0FBQUMsSUFBQSxHQUFBUyxFQUFBRyxNQUFBSCxFQUFBYixHQUlBaUIsSUFFQUMsSUFHQSxRQUFBRCxLQUVBLElBQUEsR0FBQXJCLEtBQUFMLElBQ0FBLEVBQUFLLEdBQUFHLEVBQUEsR0FBQVIsRUFBQUssR0FBQUcsRUFBQVosRUFBQUMsT0FBQUcsRUFBQUssR0FBQUksRUFBQSxHQUFBVCxFQUFBSyxHQUFBSSxFQUFBYixFQUFBRSxTQUNBRSxFQUFBNEIsT0FBQXZCLEVBQUEsR0FNQSxRQUFBc0IsS0FDQSxJQUFBLEdBQUFMLEtBQUFKLEdBQ0EsSUFBQSxHQUFBYixLQUFBTCxHQUNBLEdBQUFBLEVBQUFLLEdBQUFnQixRQUFBSCxFQUFBSSxHQUFBOUIsU0FBQSxDQUNBLEdBQUFxQyxHQUFBakIsS0FBQWtCLEtBQUEsR0FBQSxHQUFBOUIsRUFBQUssR0FBQVAsT0FBQSxFQUFBRSxFQUFBSyxHQUFBUixNQUFBLEdBQ0FrQyxHQUFBLElBQUEvQixFQUFBSyxHQUFBLFVBQUEsSUFBQU8sS0FBQUMsR0FDQW1CLEVBQUFoQyxFQUFBSyxHQUFBRyxFQUFBWixFQUFBQyxNQUFBLElBQUFnQyxFQUFBakIsS0FBQUssSUFBQWMsR0FDQUUsRUFBQWpDLEVBQUFLLEdBQUFJLEVBQUFiLEVBQUFDLE1BQUEsSUFBQWdDLEVBQUFqQixLQUFBSSxJQUFBZSxHQUVBRyxFQUFBaEIsRUFBQUksR0FBQWQsRUFBQVosRUFBQUMsTUFBQSxJQUNBc0MsRUFBQWpCLEVBQUFJLEdBQUFiLEVBQUFiLEVBQUFDLE1BQUEsSUFpQkF1QyxFQUFBeEIsS0FBQWtCLE1BQUFFLEVBQUFFLElBQUFGLEVBQUFFLElBQUFELEVBQUFFLElBQUFGLEVBQUFFLEdBQ0FDLEdBQUFwQyxFQUFBSyxHQUFBUixNQUFBLEVBQUFxQixFQUFBSSxHQUFBekIsTUFBQSxJQUNBcUIsRUFBQUksR0FBQWUsaUJBQ0FyQyxFQUFBNEIsT0FBQXZCLEVBQUEsS0FoSkE1QyxFQUFBNkUsT0FBQTNFLEVBQUE0RSxVQUNBOUUsRUFBQXNCLFdBQUEsQ0FDQSxJQU1BeUQsR0FOQTVDLEVBQUE2QyxTQUFBQyxlQUFBLFFBQ0FoRCxFQUFBRSxFQUFBK0MsV0FBQSxNQUVBekIsRUFBQSxHQUFBMEIsT0FDQTVDLEVBQUEsR0FBQTRDLE1BSUFsRixHQUFBUSxHQUFBLFdBQUEsV0FDQSxHQUFBMkUsR0FBQWpGLEVBQUFrRixZQUNBLEtBQUEsR0FBQXpCLEtBQUF3QixHQUFBLENBQ0EsR0FBQXZCLEdBQUF1QixFQUFBeEIsRUFDQUgsR0FBQTZCLEtBQUEsR0FBQUMsV0FBQTFCLEVBQUFqRCxTQUFBaUQsRUFBQWQsRUFBQWMsRUFBQWIsRUFBQWEsRUFBQTJCLE1BQUEzQixFQUFBWCxXQUdBNkIsRUFBQXBELEVBQUFLLEVBQUEsTUFHQS9CLEVBQUFRLEdBQUEsaUJBQUEsU0FBQUMsR0FDQSxHQUFBbUQsR0FBQSxJQUNBLEtBQUEsR0FBQTRCLEtBQUFoQyxHQUNBLEdBQUE1QixFQUFBNEIsRUFBQWdDLEdBQUEvRSxLQUNBbUQsRUFBQTRCLEVBR0EsT0FBQTVCLEdBQ0FKLEVBQUFJLEdBQUE2Qix3QkFBQWhGLEVBQUFpRixlQUlBMUYsRUFBQVEsR0FBQSxhQUFBLFNBQUFDLEdBQ0EsR0FBQW1ELEdBQUEsSUFDQSxLQUFBLEdBQUE0QixLQUFBaEMsR0FDQSxHQUFBNUIsRUFBQTRCLEVBQUFnQyxHQUFBL0UsS0FDQW1ELEVBQUE0QixFQUdBLElBQUEsTUFBQTVCLEVBQUEsQ0FDQSxHQUFBK0IsR0FBQW5DLEVBQUFJLEdBQ0FTLEdBQUEsS0FBQXNCLEVBQUExQyxTQUFBLE1BQUEsSUFBQUMsS0FBQUMsR0FDQUwsRUFBQTZDLEVBQUE3QyxFQUFBWixFQUFBQyxNQUFBLElBQUFlLEtBQUFLLElBQUFjLEdBQ0F0QixFQUFBNEMsRUFBQTVDLEVBQUFiLEVBQUFDLE1BQUEsSUFBQWUsS0FBQUksSUFBQWUsRUFDQS9CLEdBQUErQyxLQUFBLEdBQUFPLFFBQUE5QyxFQUFBQyxFQUFBNEMsRUFBQTFDLFNBQUEwQyxFQUFBSixNQUFBSSxFQUFBN0QsY0E0R0FsQyxTQUFBQyxPQUFBLE9BQUEyQixXQUFBLGtCQUFBLFNBQUEsWUFBQSxVQUFBLGdCQUFBLGlCQUFBLGdCQUFBQyxNQzNKQSxJQUFBbUUsUUFBQSxTQUFBOUMsRUFBQUMsRUFBQUUsRUFBQXNDLEVBQUE1QixHQUNBa0MsS0FBQS9DLEVBQUFBLEVBQ0ErQyxLQUFBOUMsRUFBQUEsRUFDQThDLEtBQUE1QyxTQUFBQSxFQUNBNEMsS0FBQXBELE1BQUEsR0FBQXFELE9BQ0FELEtBQUFOLE1BQUFBLEVBQ0FNLEtBQUExRCxNQUFBLEVBQ0EwRCxLQUFBekQsT0FBQSxFQUNBeUQsS0FBQWxDLE9BQUFBLEVBQ0EsVUFBQWtDLEtBQUFOLFFBQ0FNLEtBQUFOLE1BQUEsT0FFQU0sS0FBQXBELE1BQUFzRCxJQUFBLDZCQUFBRixLQUFBTixNQUFBUyxPQUFBLEdBQUFDLGNBQUFKLEtBQUFOLE1BQUFXLE1BQUEsR0FBQSxVQ1pBWixVQUFBLFNBQUF4RCxFQUFBZ0IsRUFBQUMsRUFBQXdDLEVBQUF0QyxHQUNBNEMsS0FBQS9ELFNBQUFBLEVBQ0ErRCxLQUFBL0MsRUFBQUEsRUFDQStDLEtBQUE5QyxFQUFBQSxFQUNBOEMsS0FBQTlCLE1BQUEsRUFDQThCLEtBQUFOLE1BQUFBLEVBQ0FNLEtBQUE1QyxTQUFBQSxFQUNBNEMsS0FBQXBELE1BQUEsR0FBQXFELE9BQ0FELEtBQUFoQyxPQUFBLEVBQ0FnQyxLQUFBMUQsTUFBQSxFQUNBMEQsS0FBQXpELE9BQUEsRUFDQXlELEtBQUEvQixZQUFBLEdBQUFnQyxPQUNBRCxLQUFBcEQsTUFBQXNELElBQUEsNkJBQUFGLEtBQUFOLE1BQUEsT0FHQUQsV0FBQWEsVUFBQUMsY0FBQSxTQUFBdEQsRUFBQUMsR0FDQThDLEtBQUEvQyxFQUFBQSxFQUNBK0MsS0FBQTlDLEVBQUFBLEdBR0F1QyxVQUFBYSxVQUFBRSxzQkFBQSxTQUFBdkQsRUFBQUMsR0FDQThDLEtBQUEvQyxFQUFBK0MsS0FBQS9DLEVBQUFBLEVBQ0ErQyxLQUFBOUMsRUFBQThDLEtBQUE5QyxFQUFBQSxHQUdBdUMsVUFBQWEsVUFBQUcsZ0JBQUEsU0FBQUMsR0FDQVYsS0FBQTVDLFNBQUFzRCxHQUdBakIsVUFBQWEsVUFBQVYsd0JBQUEsU0FBQWMsR0FDQVYsS0FBQTVDLFNBQUE0QyxLQUFBNUMsU0FBQXNELEVBQUEsRUFDQVYsS0FBQTVDLFNBQUEsT0FDQTRDLEtBQUE1QyxTQUFBNEMsS0FBQTVDLFNBQUEsS0FFQTRDLEtBQUE1QyxTQUFBLE1BQ0E0QyxLQUFBNUMsU0FBQTRDLEtBQUE1QyxTQUFBLE1BSUFxQyxVQUFBYSxVQUFBeEIsZUFBQSxXQUNBa0IsS0FBQWhDLE9BQUEsSUFDQWdDLEtBQUFoQyxRQUFBLEdBR0FnQyxLQUFBaEMsUUFBQSxHQUFBZ0MsS0FBQWhDLE9BQUEsSUFDQWdDLEtBQUEvQixZQUFBaUMsSUFBQSwwQ0FBQUYsS0FBQWhDLE9BQUEsU0FJQXlCLFVBQUFhLFVBQUFLLGVBQUEsV0FDQVgsS0FBQWhDLE9BQUEsSUFDQWdDLEtBQUFoQyxRQUFBLEdBR0FnQyxLQUFBaEMsUUFBQSxHQUFBZ0MsS0FBQWhDLE9BQUEsSUFDQWdDLEtBQUEvQixZQUFBaUMsSUFBQSwwQ0FBQUYsS0FBQWhDLE9BQUEsU0N4REEsV0FDQSxHQUFBNEMsR0FBQSxTQUFBOUUsR0FRQSxRQUFBK0UsR0FBQUMsRUFBQUMsRUFBQUMsR0FDQWxGLEVBQUFtRixXQUFBbkYsRUFBQW9GLFlBQ0FKLEVBQUF4RSxNQUFBUixFQUFBbUYsV0FBQSxHQUVBSCxFQUFBeEUsTUFBQVIsRUFBQW9GLFlBQUEsR0FHQW5ILFFBQUFnSCxRQUFBakYsR0FBQXFGLEtBQUEsU0FBQSxXQUNBckYsRUFBQW1GLFdBQUFuRixFQUFBb0YsWUFDQUosRUFBQXhFLE1BQUFSLEVBQUFtRixXQUFBLEdBRUFILEVBQUF4RSxNQUFBUixFQUFBb0YsWUFBQSxHQUdBSixFQUFBTSxZQXJCQSxPQUNBQyxTQUFBLElBQ0FSLEtBQUFBLEVBQ0FTLFNBQUEsRUFDQUMsU0FBQSw4RUFzQkF4SCxTQUFBQyxPQUFBLE9BQUF3SCxVQUFBLG1CQUFBLFVBQUFaLE9DdkJBLFdBQ0EsR0FBQXhHLEdBQUEsV0FFQSxHQUFBRSxJQUFBLEVBRUF5RSxHQUFBLENBRUEsUUFDQXhFLFVBQUEsV0FDQSxNQUFBRCxJQUVBbUIsVUFBQSxTQUFBZ0csR0FDQW5ILEVBQUFtSCxHQUVBekMsVUFBQSxXQUNBLE1BQUFELElBRUFyRCxVQUFBLFNBQUErRixHQUNBMUMsRUFBQTBDLElBS0ExSCxTQUFBQyxPQUFBLE9BQUEwSCxRQUFBLGtCQUFBdEgsT0MzQkEsV0FDQSxHQUFBQyxHQUFBLFdBRUEsR0FBQXNILEtBRUEsUUFDQXBDLFdBQUEsV0FDQSxNQUFBb0MsSUFFQXZHLFdBQUEsU0FBQXdHLEdBQ0FELEVBQUFDLElBS0E3SCxTQUFBQyxPQUFBLE9BQUEwSCxRQUFBLGlCQUFBckgsT0NmQSxXQUVBLEdBQUFGLEdBQUEsU0FBQTBILEdBQ0EsWUFFQSxJQUFBQyxHQUFBQyxHQUFBQyxRQUFBQyxPQUFBQyxTQUFBQyxNQUVBeEgsRUFBQSxTQUFBeUgsRUFBQUMsR0FDQVAsRUFBQW5ILEdBQUF5SCxFQUFBLFdBQ0EsR0FBQUUsR0FBQUMsU0FDQVYsR0FBQVcsT0FBQSxXQUNBSCxFQUFBSSxNQUFBWCxFQUFBUSxRQUtBN0gsRUFBQSxTQUFBMkgsRUFBQXhILEVBQUF5SCxHQUNBUCxFQUFBckgsS0FBQTJILEVBQUF4SCxFQUFBLFdBQ0EsR0FBQTBILEdBQUFDLFNBQ0FWLEdBQUFXLE9BQUEsV0FDQUgsR0FDQUEsRUFBQUksTUFBQVgsRUFBQVEsT0FPQSxRQUNBM0gsR0FBQUEsRUFDQUYsS0FBQUEsRUFDQXFILE9BQUFBLEdBSUEvSCxTQUFBQyxPQUFBLE9BQUEwSCxRQUFBLGlCQUFBLGFBQUF2SCIsImZpbGUiOiJhcHAubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBDcmVhdGVkIGJ5IE1pY2hpZWwgb24gMjUvMTEvMjAxNS5cbiAqL1xuKGZ1bmN0aW9uKCl7XG5cbiAgICB2YXIgYXBwID0gYW5ndWxhci5tb2R1bGUoXCJhcHBcIixbXSk7XG59KSgpOyIsIi8qKlxuICogQ3JlYXRlZCBieSBNaWNoaWVsIG9uIDExLzEyLzIwMTUuXG4gKi9cblxuKGZ1bmN0aW9uKCl7XG4gICAgdmFyIGxvZ2luQ29udHJvbGxlciA9IGZ1bmN0aW9uKCRzY29wZSwgc29ja2V0U2VydmljZSwgZGlzcGxheVNlcnZpY2UsIHBsYXllclNlcnZpY2Upe1xuXG4gICAgICAgICRzY29wZS5MQ1Nob3cgPSBkaXNwbGF5U2VydmljZS5nZXRMQ1Nob3c7XG5cbiAgICAgICAgLy9mdW5jdGlvbnNcbiAgICAgICAgdmFyIG1ha2VSb29tID0gZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHNvY2tldFNlcnZpY2UuZW1pdChcInBjY29ubmVjdFwiLCBudWxsKTtcbiAgICAgICAgfTtcbiAgICAgICAgJHNjb3BlLnJvb20gPSBcIlwiO1xuICAgICAgICBzb2NrZXRTZXJ2aWNlLm9uKCdyZXF1ZXN0Um9vbScsZnVuY3Rpb24oZGF0YSl7XG4gICAgICAgICAgICAkc2NvcGUucm9vbSA9IGRhdGE7XG4gICAgICAgIH0pO1xuICAgICAgICBzb2NrZXRTZXJ2aWNlLm9uKCdkZXZpY2VPcmllbnRhdGlvbicsIGZ1bmN0aW9uKGRhdGEpe1xuICAgICAgICAgICAgdmFyIHVzZXJuYW1lID0gZGF0YS51c2VybmFtZTtcbiAgICAgICAgICAgIHZhciBkZXZpY2VPcmllbnRhdGlvbiA9IHt9O1xuICAgICAgICAgICAgZGV2aWNlT3JpZW50YXRpb24uZ2FtbWEgPSBkYXRhLmdhbW1hO1xuICAgICAgICAgICAgZGV2aWNlT3JpZW50YXRpb24uYmV0YSA9IGRhdGEuYmV0YTtcbiAgICAgICAgICAgIGRldmljZU9yaWVudGF0aW9uLmFscGhhID0gZGF0YS5hbHBoYTtcbiAgICAgICAgfSk7XG4gICAgICAgICRzY29wZS51c2VybmFtZXMgPSB7fTtcbiAgICAgICAgJHNjb3BlLmNoZWNrVXNlckNvdW50ID0gZmFsc2U7XG4gICAgICAgIHNvY2tldFNlcnZpY2Uub24oJ3VwZGF0ZXVzZXJzJywgZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgIHBsYXllclNlcnZpY2Uuc2V0UGxheWVycyhkYXRhKTtcbiAgICAgICAgICAgICRzY29wZS51c2VybmFtZXMgPSBkYXRhO1xuICAgICAgICAgICAgJHNjb3BlLmNoZWNrVXNlckNvdW50ID0gT2JqZWN0LmtleXMoJHNjb3BlLnVzZXJuYW1lcykubGVuZ3RoIDwgMDtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgJHNjb3BlLnN0YXJ0R2FtZT0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgc29ja2V0U2VydmljZS5lbWl0KFwic3RhcnRHYW1lXCIsIG51bGwpO1xuICAgICAgICAgICAgZGlzcGxheVNlcnZpY2Uuc2V0TENTaG93KGZhbHNlKTtcbiAgICAgICAgICAgIGRpc3BsYXlTZXJ2aWNlLnNldFBDU2hvdyh0cnVlKTtcbiAgICAgICAgfTtcblxuXG4gICAgICAgIChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIG1ha2VSb29tKCk7XG4gICAgICAgIH0pKCk7XG5cbiAgICB9O1xuXG4gICAgYW5ndWxhci5tb2R1bGUoXCJhcHBcIikuY29udHJvbGxlcihcImxvZ2luQ29udHJvbGxlclwiLCBbXCIkc2NvcGVcIiwgXCJzb2NrZXRTZXJ2aWNlXCIgLCBcImRpc3BsYXlTZXJ2aWNlXCIsIFwicGxheWVyU2VydmljZVwiLCBsb2dpbkNvbnRyb2xsZXJdKTtcbn0pKCk7IiwiLyoqXG4gKiBDcmVhdGVkIGJ5IE1pY2hpZWwgb24gMTYvMTIvMjAxNS5cbiAqL1xuXG4oZnVuY3Rpb24oKXtcbiAgICBcInVzZSBzdHJpY3RcIjtcbiAgICB2YXIgcGxheUNvbnRyb2xsZXIgPSBmdW5jdGlvbigkc2NvcGUsICRpbnRlcnZhbCwgJHdpbmRvdywgc29ja2V0U2VydmljZSwgZGlzcGxheVNlcnZpY2UsIHBsYXllclNlcnZpY2Upe1xuICAgICAgICAkc2NvcGUuUENTaG93ID0gZGlzcGxheVNlcnZpY2UuZ2V0UENTaG93O1xuICAgICAgICAkc2NvcGUuc3RhcnRHYW1lID0gZmFsc2U7XG4gICAgICAgIHZhciBjYW52ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2dhbWUnKTtcbiAgICAgICAgdmFyIGN0eCA9IGNhbnYuZ2V0Q29udGV4dCgnMmQnKTtcblxuICAgICAgICB2YXIgQWxsUGxheWVycyA9IG5ldyBBcnJheSgpO1xuICAgICAgICB2YXIgQWxsQnVsbGV0cyA9IG5ldyBBcnJheSgpO1xuXG4gICAgICAgIHZhciBjeWNsZTtcblxuICAgICAgICBzb2NrZXRTZXJ2aWNlLm9uKFwiaW5pdEdhbWVcIiwgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciBCdWZmZXJQbGF5ZXIgPSBwbGF5ZXJTZXJ2aWNlLmdldFBsYXllcnMoKTtcbiAgICAgICAgICAgIGZvcih2YXIgcGxheWVyIGluIEJ1ZmZlclBsYXllcil7XG4gICAgICAgICAgICAgICAgdmFyIHAgPSBCdWZmZXJQbGF5ZXJbcGxheWVyXTtcbiAgICAgICAgICAgICAgICBBbGxQbGF5ZXJzLnB1c2gobmV3IFNwYWNlc2hpcChwLnVzZXJuYW1lLCBwLngsIHAueSwgcC5jb2xvciwgcC5yb3RhdGlvbikpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBjeWNsZSA9ICRpbnRlcnZhbChkcmF3LCAxMCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHNvY2tldFNlcnZpY2Uub24oXCJ1cGRhdGVHYW1lRGF0YVwiLCBmdW5jdGlvbihkYXRhKXtcbiAgICAgICAgICAgIHZhciBwID0gbnVsbDtcbiAgICAgICAgICAgIGZvcih2YXIgaSBpbiBBbGxQbGF5ZXJzKXtcbiAgICAgICAgICAgICAgICBpZihmaWx0ZXJQbGF5ZXJzKEFsbFBsYXllcnNbaV0sZGF0YSkgPT0gdHJ1ZSl7XG4gICAgICAgICAgICAgICAgICAgIHAgPSBpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmKHAgIT0gbnVsbCl7XG4gICAgICAgICAgICAgICAgQWxsUGxheWVyc1twXS5yb3RhdGVTcGFjZXNoaXBSZWxhdGl2ZShkYXRhLm9yaWVudGF0aW9uKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgc29ja2V0U2VydmljZS5vbihcInBsYXllclNob3RcIiwgZnVuY3Rpb24oZGF0YSl7XG4gICAgICAgICAgICB2YXIgcCA9IG51bGw7XG4gICAgICAgICAgICBmb3IodmFyIGkgaW4gQWxsUGxheWVycyl7XG4gICAgICAgICAgICAgICAgaWYoZmlsdGVyUGxheWVycyhBbGxQbGF5ZXJzW2ldLGRhdGEpID09IHRydWUpe1xuICAgICAgICAgICAgICAgICAgICBwID0gaTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZihwICE9IG51bGwpe1xuICAgICAgICAgICAgICAgIHZhciB0ZW1wID0gQWxsUGxheWVyc1twXTtcbiAgICAgICAgICAgICAgICB2YXIgYW5nbGUgPSAoMzYwIC0odGVtcC5yb3RhdGlvbiArIDE4MCkpLzE4MCpNYXRoLlBJO1xuICAgICAgICAgICAgICAgIHZhciB4ID0gdGVtcC54ICsgKGNhbnYud2lkdGgvNDAwICogTWF0aC5zaW4oYW5nbGUpKTtcbiAgICAgICAgICAgICAgICB2YXIgeSA9IHRlbXAueSArIChjYW52LndpZHRoLzQwMCAqIE1hdGguY29zKGFuZ2xlKSk7XG4gICAgICAgICAgICAgICAgQWxsQnVsbGV0cy5wdXNoKG5ldyBCdWxsZXQoeCwgeSwgdGVtcC5yb3RhdGlvbiwgdGVtcC5jb2xvciwgdGVtcC51c2VyTmFtZSkpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICBmdW5jdGlvbiBmaWx0ZXJQbGF5ZXJzKG9iaixkYXRhKXtcbiAgICAgICAgICAgIGlmKGRhdGEudXNlcm5hbWUgPT0gb2JqLnVzZXJOYW1lKXtcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIH1lbHNle1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGRyYXcoKXtcbiAgICAgICAgICAgIGN0eC5jbGVhclJlY3QoMCwwLGNhbnYud2lkdGgsIGNhbnYuaGVpZ2h0KTtcbiAgICAgICAgICAgIHZhciByYXRpbyA9IGNhbnYud2lkdGgvMTAwO1xuXG4gICAgICAgICAgICBpZihBbGxCdWxsZXRzLmxlbmd0aCAhPSAwKXtcbiAgICAgICAgICAgICAgICB2YXIgQnVsbGV0V2lkdGggPSBjYW52LndpZHRoLzEwMDtcbiAgICAgICAgICAgICAgICB2YXIgQnVsbGV0SGVpZ2h0ID0gQnVsbGV0V2lkdGggKiBBbGxCdWxsZXRzWzBdLmltYWdlLmhlaWdodC9BbGxCdWxsZXRzWzBdLmltYWdlLndpZHRoO1xuXG4gICAgICAgICAgICAgICAgZm9yKHZhciBidWxsZXQgaW4gQWxsQnVsbGV0cyl7XG4gICAgICAgICAgICAgICAgICAgIHZhciBiID0gQWxsQnVsbGV0c1tidWxsZXRdO1xuICAgICAgICAgICAgICAgICAgICBiLndpZHRoID0gQnVsbGV0V2lkdGg7XG4gICAgICAgICAgICAgICAgICAgIGIuaGVpZ2h0ID0gQnVsbGV0SGVpZ2h0O1xuICAgICAgICAgICAgICAgICAgICBjdHguc2F2ZSgpO1xuICAgICAgICAgICAgICAgICAgICBjdHgudHJhbnNsYXRlKGIueCpyYXRpbywgYi55KnJhdGlvKTtcbiAgICAgICAgICAgICAgICAgICAgY3R4LnJvdGF0ZShiLnJvdGF0aW9uLzE4MCpNYXRoLlBJKTtcbiAgICAgICAgICAgICAgICAgICAgY3R4LmRyYXdJbWFnZShiLmltYWdlLCAtQnVsbGV0V2lkdGgvMiwgLUJ1bGxldEhlaWdodC8yLCBCdWxsZXRXaWR0aCwgQnVsbGV0SGVpZ2h0KTtcbiAgICAgICAgICAgICAgICAgICAgY3R4LnJlc3RvcmUoKTtcbiAgICAgICAgICAgICAgICAgICAgQWxsQnVsbGV0c1tidWxsZXRdLnggPSBNYXRoLmNvcygoYi5yb3RhdGlvbiAtIDkwKS8xODAqTWF0aC5QSSkgKyBiLng7XG4gICAgICAgICAgICAgICAgICAgIEFsbEJ1bGxldHNbYnVsbGV0XS55ID0gTWF0aC5zaW4oKGIucm90YXRpb24gLSA5MCkvMTgwKk1hdGguUEkpKyBiLnk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZihBbGxQbGF5ZXJzLmxlbmd0aCAhPSAwKXtcbiAgICAgICAgICAgICAgICB2YXIgU3BhY2VzaGlwV2lkdGggPSBjYW52LndpZHRoLzIwO1xuICAgICAgICAgICAgICAgIHZhciBTcGFjZXNoaXBIZWlnaHQgPSBTcGFjZXNoaXBXaWR0aCAqIEFsbFBsYXllcnNbMF0uaW1hZ2UuaGVpZ2h0LyBBbGxQbGF5ZXJzWzBdLmltYWdlLndpZHRoO1xuXG4gICAgICAgICAgICAgICAgZm9yKHZhciBwbGF5ZXIgaW4gQWxsUGxheWVycyl7XG4gICAgICAgICAgICAgICAgICAgIHZhciBwID0gQWxsUGxheWVyc1twbGF5ZXJdO1xuICAgICAgICAgICAgICAgICAgICBwLndpZHRoID0gU3BhY2VzaGlwV2lkdGg7XG4gICAgICAgICAgICAgICAgICAgIHAuaGVpZ2h0ID0gU3BhY2VzaGlwSGVpZ2h0O1xuICAgICAgICAgICAgICAgICAgICBjdHguc2F2ZSgpO1xuICAgICAgICAgICAgICAgICAgICBjdHgudHJhbnNsYXRlKHAueCpyYXRpbywgcC55KnJhdGlvKTtcbiAgICAgICAgICAgICAgICAgICAgY3R4LnJvdGF0ZShwLnJvdGF0aW9uLzE4MCpNYXRoLlBJKTtcbiAgICAgICAgICAgICAgICAgICAgY3R4LmRyYXdJbWFnZShwLmltYWdlLCAtU3BhY2VzaGlwV2lkdGgvMiwgLVNwYWNlc2hpcEhlaWdodC8yLCBTcGFjZXNoaXBXaWR0aCwgU3BhY2VzaGlwSGVpZ2h0KTtcbiAgICAgICAgICAgICAgICAgICAgaWYocC5kYW1hZ2UgPiAwKXtcbiAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5kcmF3SW1hZ2UocC5kYW1hZ2VJbWFnZSwgLVNwYWNlc2hpcFdpZHRoLzIsIC1TcGFjZXNoaXBIZWlnaHQvMiwgU3BhY2VzaGlwV2lkdGgsIFNwYWNlc2hpcEhlaWdodCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgY3R4LnJlc3RvcmUoKTtcbiAgICAgICAgICAgICAgICAgICAgQWxsUGxheWVyc1twbGF5ZXJdLnggPSBNYXRoLmNvcygocC5yb3RhdGlvbiAtIDkwKS8xODAqTWF0aC5QSSkvMTAqIHAuc3BlZWQgKyBwLng7XG4gICAgICAgICAgICAgICAgICAgIEFsbFBsYXllcnNbcGxheWVyXS55ID0gTWF0aC5zaW4oKHAucm90YXRpb24gLSA5MCkvMTgwKk1hdGguUEkpLzEwKiBwLnNwZWVkICsgcC55O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgY2hlY2tCdWxsZXRzKCk7XG5cbiAgICAgICAgICAgIGNvbGxpc2lvbkRldGVjdGlvbigpO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gY2hlY2tCdWxsZXRzKCl7XG5cbiAgICAgICAgICAgIGZvcih2YXIgYiBpbiBBbGxCdWxsZXRzKXtcbiAgICAgICAgICAgICAgICBpZihBbGxCdWxsZXRzW2JdLnggPCAwIHx8IEFsbEJ1bGxldHNbYl0ueCA+IGNhbnYud2lkdGggfHwgQWxsQnVsbGV0c1tiXS55IDwgMCB8fCBBbGxCdWxsZXRzW2JdLnkgPiBjYW52LmhlaWdodCl7XG4gICAgICAgICAgICAgICAgICAgIEFsbEJ1bGxldHMuc3BsaWNlKGIsIDEpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gY29sbGlzaW9uRGV0ZWN0aW9uKCl7XG4gICAgICAgICAgICBmb3IodmFyIHAgaW4gQWxsUGxheWVycyl7XG4gICAgICAgICAgICAgICAgZm9yKHZhciBiIGluIEFsbEJ1bGxldHMpe1xuICAgICAgICAgICAgICAgICAgICBpZihBbGxCdWxsZXRzW2JdLnBsYXllciAhPSBBbGxQbGF5ZXJzW3BdLnVzZXJOYW1lKXtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciByYWRpdXMgPSBNYXRoLnNxcnQoMikvMiooQWxsQnVsbGV0c1tiXS5oZWlnaHQvMiAtIEFsbEJ1bGxldHNbYl0ud2lkdGgvMik7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgYW5nbGUgPSAoMzYwIC0oQWxsQnVsbGV0c1tiXS5yb3RhdGlvbikpLzE4MCpNYXRoLlBJO1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGJ1bGxldEhlYWRYID0gKEFsbEJ1bGxldHNbYl0ueCpjYW52LndpZHRoLzEwMCAtIChyYWRpdXMgKiBNYXRoLnNpbihhbmdsZSkpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBidWxsZXRIZWFkWSA9IChBbGxCdWxsZXRzW2JdLnkqY2Fudi53aWR0aC8xMDAgLSAocmFkaXVzICogTWF0aC5jb3MoYW5nbGUpKSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzcGFjZVNoaXBYID0gQWxsUGxheWVyc1twXS54KmNhbnYud2lkdGgvMTAwO1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHNwYWNlU2hpcFkgPSBBbGxQbGF5ZXJzW3BdLnkqY2Fudi53aWR0aC8xMDA7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIC8qY3R4LnNhdmUoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5iZWdpblBhdGgoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5hcmMoc3BhY2VTaGlwWCwgc3BhY2VTaGlwWSwgQWxsUGxheWVyc1twXS53aWR0aC8yLCAwLCBNYXRoLlBJKjIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgY3R4LmxpbmVXaWR0aCA9IDE7XG4gICAgICAgICAgICAgICAgICAgICAgICBjdHguc3Ryb2tlU3R5bGUgPSAnIzAwMDBGRic7XG4gICAgICAgICAgICAgICAgICAgICAgICBjdHguc3Ryb2tlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBjdHgucmVzdG9yZSgpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBjdHguc2F2ZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgY3R4LmJlZ2luUGF0aCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgY3R4LmFyYyhidWxsZXRIZWFkWCwgYnVsbGV0SGVhZFksIEFsbEJ1bGxldHNbYl0ud2lkdGgvMiwgMCwgTWF0aC5QSSoyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5saW5lV2lkdGggPSAxO1xuICAgICAgICAgICAgICAgICAgICAgICAgY3R4LnN0cm9rZVN0eWxlID0gJyNGRjAwMDAnO1xuICAgICAgICAgICAgICAgICAgICAgICAgY3R4LnN0cm9rZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgY3R4LnJlc3RvcmUoKTsqL1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGRpc3RhbmNlID0gTWF0aC5zcXJ0KChidWxsZXRIZWFkWC1zcGFjZVNoaXBYKSooYnVsbGV0SGVhZFgtc3BhY2VTaGlwWCkgKyAoYnVsbGV0SGVhZFktc3BhY2VTaGlwWSkqKGJ1bGxldEhlYWRZLXNwYWNlU2hpcFkpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmKGRpc3RhbmNlIDwgKEFsbEJ1bGxldHNbYl0ud2lkdGgvMiArIEFsbFBsYXllcnNbcF0ud2lkdGgvMikpe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIEFsbFBsYXllcnNbcF0uaW5jcmVhc2VEYW1hZ2UoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBBbGxCdWxsZXRzLnNwbGljZShiLCAxKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH07XG5cbiAgICBhbmd1bGFyLm1vZHVsZShcImFwcFwiKS5jb250cm9sbGVyKFwicGxheUNvbnRyb2xsZXJcIiwgW1wiJHNjb3BlXCIsIFwiJGludGVydmFsXCIsIFwiJHdpbmRvd1wiLCBcInNvY2tldFNlcnZpY2VcIiwgXCJkaXNwbGF5U2VydmljZVwiLCBcInBsYXllclNlcnZpY2VcIiwgcGxheUNvbnRyb2xsZXJdKVxufSkoKTsiLCIvKipcbiAqIENyZWF0ZWQgYnkganVzdGlqbmRlcG92ZXIgb24gMjIvMTIvMTUuXG4gKi9cblxudmFyIEJ1bGxldCA9IGZ1bmN0aW9uKHgsIHkscm90YXRpb24sIGNvbG9yLCBwbGF5ZXIpe1xuICAgIHRoaXMueCA9IHg7XG4gICAgdGhpcy55ID0geTtcbiAgICB0aGlzLnJvdGF0aW9uID0gcm90YXRpb247XG4gICAgdGhpcy5pbWFnZSA9IG5ldyBJbWFnZSgpO1xuICAgIHRoaXMuY29sb3IgPSBjb2xvcjtcbiAgICB0aGlzLndpZHRoID0gMDtcbiAgICB0aGlzLmhlaWdodCA9IDA7XG4gICAgdGhpcy5wbGF5ZXIgPSBwbGF5ZXI7XG4gICAgaWYodGhpcy5jb2xvciA9PSBcIm9yYW5nZVwiKXtcbiAgICAgICAgdGhpcy5jb2xvciA9ICdyZWQnO1xuICAgIH1cbiAgICB0aGlzLmltYWdlLnNyYyA9ICcuLi9hc3NldHMvUE5HL0xhc2Vycy9sYXNlcicrIHRoaXMuY29sb3IuY2hhckF0KDApLnRvVXBwZXJDYXNlKCkgKyB0aGlzLmNvbG9yLnNsaWNlKDEpICsnMDEucG5nJ1xufTsiLCIvKipcbiAqIENyZWF0ZWQgYnkganVzdGlqbmRlcG92ZXIgb24gMDkvMTIvMTUuXG4gKi9cblxudmFyIFNwYWNlc2hpcCA9IGZ1bmN0aW9uKHVzZXJOYW1lLCB4LCB5LCBjb2xvciwgcm90YXRpb24pe1xuICAgIHRoaXMudXNlck5hbWUgPSB1c2VyTmFtZTtcbiAgICB0aGlzLnggPSB4O1xuICAgIHRoaXMueSA9IHk7XG4gICAgdGhpcy5zcGVlZCA9IDE7XG4gICAgdGhpcy5jb2xvciA9IGNvbG9yO1xuICAgIHRoaXMucm90YXRpb24gPSByb3RhdGlvbjtcbiAgICB0aGlzLmltYWdlID0gbmV3IEltYWdlKCk7XG4gICAgdGhpcy5kYW1hZ2UgPSAwO1xuICAgIHRoaXMud2lkdGggPSAwO1xuICAgIHRoaXMuaGVpZ2h0ID0gMDtcbiAgICB0aGlzLmRhbWFnZUltYWdlID0gbmV3IEltYWdlKCk7XG4gICAgdGhpcy5pbWFnZS5zcmMgPSAnLi4vYXNzZXRzL1BORy9wbGF5ZXJTaGlwMV8nKyB0aGlzLmNvbG9yICsnLnBuZydcbn07XG5cblNwYWNlc2hpcC5wcm90b3R5cGUubW92ZVNwYWNlc2hpcCA9IGZ1bmN0aW9uKHgsIHkpe1xuICAgIHRoaXMueCA9IHg7XG4gICAgdGhpcy55ID0geTtcbn07XG5cblNwYWNlc2hpcC5wcm90b3R5cGUubW92ZVNwYWNlc2hpcFJlbGF0aXZlID0gZnVuY3Rpb24oeCwgeSl7XG4gICAgdGhpcy54ID0gdGhpcy54K3g7XG4gICAgdGhpcy55ID0gdGhpcy55K3k7XG59O1xuXG5TcGFjZXNoaXAucHJvdG90eXBlLnJvdGF0ZVNwYWNlc2hpcCA9IGZ1bmN0aW9uKGRlZ3JlZSl7XG4gICAgdGhpcy5yb3RhdGlvbiA9IGRlZ3JlZTtcbn07XG5cblNwYWNlc2hpcC5wcm90b3R5cGUucm90YXRlU3BhY2VzaGlwUmVsYXRpdmUgPSBmdW5jdGlvbihkZWdyZWUpe1xuICAgIHRoaXMucm90YXRpb24gPSB0aGlzLnJvdGF0aW9uICsgZGVncmVlLzU7XG4gICAgaWYodGhpcy5yb3RhdGlvbiA8IC0zNjApe1xuICAgICAgICB0aGlzLnJvdGF0aW9uID0gdGhpcy5yb3RhdGlvbiArIDcyMDtcbiAgICB9XG4gICAgaWYodGhpcy5yb3RhdGlvbiA+IDM2MCl7XG4gICAgICAgIHRoaXMucm90YXRpb24gPSB0aGlzLnJvdGF0aW9uIC0gNzIwO1xuICAgIH1cbn07XG5cblNwYWNlc2hpcC5wcm90b3R5cGUuaW5jcmVhc2VEYW1hZ2UgPSBmdW5jdGlvbigpe1xuICAgIGlmKHRoaXMuZGFtYWdlIDwgNCl7XG4gICAgICAgIHRoaXMuZGFtYWdlICs9IDE7XG4gICAgfVxuXG4gICAgaWYodGhpcy5kYW1hZ2UgPD0gMyAmJiB0aGlzLmRhbWFnZSA+IDApe1xuICAgICAgICB0aGlzLmRhbWFnZUltYWdlLnNyYyA9ICcuLi9hc3NldHMvUE5HL0RhbWFnZS9wbGF5ZXJTaGlwMV9kYW1hZ2UnKyB0aGlzLmRhbWFnZSArICcucG5nJztcbiAgICB9XG59O1xuXG5TcGFjZXNoaXAucHJvdG90eXBlLmRlY3JlYXNlRGFtYWdlID0gZnVuY3Rpb24oKXtcbiAgICBpZih0aGlzLmRhbWFnZSA+IDApe1xuICAgICAgICB0aGlzLmRhbWFnZSAtPSAxO1xuICAgIH1cblxuICAgIGlmKHRoaXMuZGFtYWdlIDw9IDMgJiYgdGhpcy5kYW1hZ2UgPiAwKXtcbiAgICAgICAgdGhpcy5kYW1hZ2VJbWFnZS5zcmMgPSAnLi4vYXNzZXRzL1BORy9EYW1hZ2UvcGxheWVyU2hpcDFfZGFtYWdlJysgdGhpcy5kYW1hZ2UgKyAnLnBuZyc7XG4gICAgfVxufTtcblxuIiwiLyoqXG4gKiBDcmVhdGVkIGJ5IGp1c3Rpam5kZXBvdmVyIG9uIDE2LzEyLzE1LlxuICovXG4oZnVuY3Rpb24oKXtcbiAgICB2YXIgY2FudmFzRGlyZWN0aXZlID0gZnVuY3Rpb24oJHdpbmRvdyl7XG4gICAgICAgIHJldHVybntcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnRScsXG4gICAgICAgICAgICBsaW5rOmxpbmssXG4gICAgICAgICAgICByZXBsYWNlOnRydWUsXG4gICAgICAgICAgICB0ZW1wbGF0ZTonPGNhbnZhcyBpZD1cImdhbWVcIiBjbGFzcz1cInBsYXlBcmVhXCIgd2lkdGg9XCJ7e3dpZHRofX1cIiBoZWlnaHQ9XCJ7e3dpZHRofX1cIiAvPidcbiAgICAgICAgfTtcblxuICAgICAgICBmdW5jdGlvbiBsaW5rKHNjb3BlLCBlbGVtZW50LCBhdHRycyl7XG4gICAgICAgICAgICBpZigkd2luZG93LmlubmVyV2lkdGggPCAkd2luZG93LmlubmVySGVpZ2h0KXtcbiAgICAgICAgICAgICAgICBzY29wZS53aWR0aCA9ICR3aW5kb3cuaW5uZXJXaWR0aCAtIDIwO1xuICAgICAgICAgICAgfWVsc2V7XG4gICAgICAgICAgICAgICAgc2NvcGUud2lkdGggPSAkd2luZG93LmlubmVySGVpZ2h0IC0gMjA7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGFuZ3VsYXIuZWxlbWVudCgkd2luZG93KS5iaW5kKCdyZXNpemUnLCBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIGlmKCR3aW5kb3cuaW5uZXJXaWR0aCA8ICR3aW5kb3cuaW5uZXJIZWlnaHQpe1xuICAgICAgICAgICAgICAgICAgICBzY29wZS53aWR0aCA9ICR3aW5kb3cuaW5uZXJXaWR0aCAtIDIwO1xuICAgICAgICAgICAgICAgIH1lbHNle1xuICAgICAgICAgICAgICAgICAgICBzY29wZS53aWR0aCA9ICR3aW5kb3cuaW5uZXJIZWlnaHQgLSAyMDtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBzY29wZS4kZGlnZXN0KCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwJykuZGlyZWN0aXZlKFwiY2FudmFzRGlyZWN0aXZlXCIsIFtcIiR3aW5kb3dcIiwgY2FudmFzRGlyZWN0aXZlXSk7XG59KSgpOyIsIi8qKlxuICogQ3JlYXRlZCBieSBNaWNoaWVsIG9uIDE2LzEyLzIwMTUuXG4gKi9cbi8qKlxuICogQ3JlYXRlZCBieSBqdXN0aWpuZGVwb3ZlciBvbiAxNi8xMi8xNS5cbiAqL1xuXG5cbihmdW5jdGlvbigpe1xuICAgIHZhciBkaXNwbGF5U2VydmljZSA9IGZ1bmN0aW9uKCl7XG4gICAgICAgIC8vTG9naW4gQ29udHJvbGxlclxuICAgICAgICB2YXIgTENTaG93ID0gdHJ1ZTtcbiAgICAgICAgLy9QbGF5IGNvbnRyb2xsZXJcbiAgICAgICAgdmFyIFBDU2hvdyA9IGZhbHNlO1xuXG4gICAgICAgIHJldHVybntcbiAgICAgICAgICAgIGdldExDU2hvdzogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICByZXR1cm4gTENTaG93O1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHNldExDU2hvdzogZnVuY3Rpb24odmFsdWUpe1xuICAgICAgICAgICAgICAgIExDU2hvdyA9IHZhbHVlO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldFBDU2hvdzogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICByZXR1cm4gUENTaG93O1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHNldFBDU2hvdzogZnVuY3Rpb24odmFsdWUpe1xuICAgICAgICAgICAgICAgIFBDU2hvdyA9IHZhbHVlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfTtcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdhcHAnKS5mYWN0b3J5KCdkaXNwbGF5U2VydmljZScsIFtkaXNwbGF5U2VydmljZV0pO1xufSkoKTsiLCIvKipcbiAqIENyZWF0ZWQgYnkganVzdGlqbmRlcG92ZXIgb24gMTcvMTIvMTUuXG4gKi9cblxuKGZ1bmN0aW9uKCl7XG4gICAgdmFyIHBsYXllclNlcnZpY2UgPSBmdW5jdGlvbigpe1xuICAgICAgICAvL0xvZ2luIENvbnRyb2xsZXJcbiAgICAgICAgdmFyIHBsYXllcnMgPSBbXTtcblxuICAgICAgICByZXR1cm57XG4gICAgICAgICAgICBnZXRQbGF5ZXJzOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIHJldHVybiBwbGF5ZXJzO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHNldFBsYXllcnM6IGZ1bmN0aW9uKHBsYXllcnNBcnJheSl7XG4gICAgICAgICAgICAgICAgcGxheWVycyA9IHBsYXllcnNBcnJheTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH07XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwJykuZmFjdG9yeSgncGxheWVyU2VydmljZScsIFtwbGF5ZXJTZXJ2aWNlXSk7XG59KSgpOyIsIi8qKlxuICogQ3JlYXRlZCBieSBqdXN0aWpuZGVwb3ZlciBvbiAwOS8xMi8xNS5cbiAqL1xuXG4oZnVuY3Rpb24oKXtcblxuICAgIHZhciBzb2NrZXRTZXJ2aWNlID0gZnVuY3Rpb24oJHJvb3RTY29wZSl7XG4gICAgICAgIFwidXNlIHN0cmljdFwiO1xuICAgICAgICAvL3ByaXZhdGVcbiAgICAgICAgdmFyIHNvY2tldCA9IGlvLmNvbm5lY3Qod2luZG93LmxvY2F0aW9uLmhvc3QpO1xuICAgICAgICAvL2Z1bmN0aW9uc1xuICAgICAgICB2YXIgb24gPSBmdW5jdGlvbiAoZXZlbnROYW1lLCBjYWxsYmFjaykge1xuICAgICAgICAgICAgc29ja2V0Lm9uKGV2ZW50TmFtZSwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHZhciBhcmdzID0gYXJndW1lbnRzO1xuICAgICAgICAgICAgICAgICRyb290U2NvcGUuJGFwcGx5KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2suYXBwbHkoc29ja2V0LCBhcmdzKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBlbWl0ID0gZnVuY3Rpb24gKGV2ZW50TmFtZSwgZGF0YSwgY2FsbGJhY2spIHtcbiAgICAgICAgICAgIHNvY2tldC5lbWl0KGV2ZW50TmFtZSwgZGF0YSwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHZhciBhcmdzID0gYXJndW1lbnRzO1xuICAgICAgICAgICAgICAgICRyb290U2NvcGUuJGFwcGx5KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNhbGxiYWNrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFjay5hcHBseShzb2NrZXQsIGFyZ3MpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KVxuICAgICAgICB9O1xuXG4gICAgICAgIC8vcHVibGljXG4gICAgICAgIHJldHVybntcbiAgICAgICAgICAgIG9uOiBvbixcbiAgICAgICAgICAgIGVtaXQ6IGVtaXQsXG4gICAgICAgICAgICBzb2NrZXQ6IHNvY2tldFxuICAgICAgICB9XG4gICAgfTtcblxuICAgIGFuZ3VsYXIubW9kdWxlKFwiYXBwXCIpLmZhY3RvcnkoXCJzb2NrZXRTZXJ2aWNlXCIsIFtcIiRyb290U2NvcGVcIiwgc29ja2V0U2VydmljZV0pO1xuXG59KSgpOyJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
