!function(){angular.module("app",[])}(),function(){var t=function(t,e,a,i){t.LCShow=a.getLCShow;var n=function(){e.emit("pcconnect",null)};t.room="",e.on("requestRoom",function(e){t.room=e}),e.on("deviceOrientation",function(t){var e=(t.username,{});e.gamma=t.gamma,e.beta=t.beta,e.alpha=t.alpha}),t.usernames={},t.checkUserCount=!1,e.on("updateusers",function(e){i.setPlayers(e),t.usernames=e,t.checkUserCount=Object.keys(t.usernames).length<0}),t.startGame=function(){e.emit("startGame",null),a.setLCShow(!1),a.setPCShow(!0)},function(){n()}()};angular.module("app").controller("loginController",["$scope","socketService","displayService","playerService",t])}(),function(){"use strict";var t=function(t,e,a,i,n,o){function r(t,e){return e.username==t.userName?!0:!1}function s(){p.clearRect(0,0,c.width,c.height);var t=c.width/100;if(0!=l.length){var e=c.width/100,a=e*l[0].image.height/l[0].image.width;for(var i in l){var n=l[i];p.save(),p.translate(n.x*t,n.y*t),p.rotate(n.rotation/180*Math.PI),p.drawImage(n.image,-e/2,-a/2,e,a),p.restore(),l[i].x=Math.cos((n.rotation-90)/180*Math.PI)+n.x,l[i].y=Math.sin((n.rotation-90)/180*Math.PI)+n.y}}if(0!=u.length){var o=c.width/20,r=o*u[0].image.height/u[0].image.width;for(var s in u){var h=u[s];p.save(),p.translate(h.x*t,h.y*t),p.rotate(h.rotation/180*Math.PI),p.drawImage(h.image,-o/2,-r/2,o,r),p.restore(),u[s].x=Math.cos((h.rotation-90)/180*Math.PI)/10*h.speed+h.x,u[s].y=Math.sin((h.rotation-90)/180*Math.PI)/10*h.speed+h.y}}}t.PCShow=n.getPCShow,t.startGame=!1;var h,c=document.getElementById("game"),p=c.getContext("2d"),u=new Array,l=new Array;i.on("initGame",function(){var t=o.getPlayers();for(var a in t){var i=t[a];u.push(new Spaceship(i.username,i.posX,i.posY,i.color,i.rotation))}h=e(s,10),console.log(u)}),i.on("updateGameData",function(t){var e=null;for(var a in u)1==r(u[a],t)&&(e=a);null!=e&&u[e].rotateSpaceshipRelative(t.orientation)}),i.on("playerShot",function(t){var e=null;for(var a in u)1==r(u[a],t)&&(e=a);if(null!=e){var i=u[e];l.push(new Bullet(i.x,i.y,i.rotation,i.color))}})};angular.module("app").controller("playController",["$scope","$interval","$window","socketService","displayService","playerService",t])}(),function(){var t=function(t){function e(e,a,i){t.innerWidth<t.innerHeight?e.width=t.innerWidth-20:e.width=t.innerHeight-20,angular.element(t).bind("resize",function(){t.innerWidth<t.innerHeight?e.width=t.innerWidth-20:e.width=t.innerHeight-20,e.$digest()})}return{restrict:"E",link:e,replace:!0,template:'<canvas id="game" class="playArea" width="{{width}}" height="{{width}}" />'}};angular.module("app").directive("canvasDirective",["$window",t])}(),function(){var t=function(){var t=!0,e=!1;return{getLCShow:function(){return t},setLCShow:function(e){t=e},getPCShow:function(){return e},setPCShow:function(t){e=t}}};angular.module("app").factory("displayService",[t])}(),function(){var t=function(){var t=[];return{getPlayers:function(){return t},setPlayers:function(e){t=e}}};angular.module("app").factory("playerService",[t])}();var Bullet=function(t,e,a,i){this.x=t,this.y=e,this.rotation=a,this.image=new Image,this.color=i,"orange"==this.color&&(this.color="red"),this.image.src="../assets/PNG/Lasers/laser"+this.color.charAt(0).toUpperCase()+this.color.slice(1)+"01.png"},Spaceship=function(t,e,a,i,n){this.userName=t,this.x=e,this.y=a,this.speed=1,this.color=i,this.rotation=n,this.image=new Image,this.damage=0,this.damageImage=new Image,this.image.src="../assets/PNG/playerShip1_"+this.color+".png"};Spaceship.prototype.moveSpaceship=function(t,e){this.x=t,this.y=e},Spaceship.prototype.moveSpaceshipRelative=function(t,e){this.x=this.x+t,this.y=this.y+e},Spaceship.prototype.rotateSpaceship=function(t){this.rotation=t},Spaceship.prototype.rotateSpaceshipRelative=function(t){this.rotation=this.rotation+t/5,this.rotation<-360&&(this.rotation=this.rotation+720),this.rotation>360&&(this.rotation=this.rotation-720)},Spaceship.prototype.increaseDamage=function(){this.damage<4&&(this.damage+=1),this.damage<=3&&this.damage>0&&(this.damageImage.src="../assets/PNG/Damage/playerShip1_damage"+this.damage+".png")},Spaceship.prototype.increaseDamage=function(){this.damage>0&&(this.damage-=1),this.damage<=3&&this.damage>0&&(this.damageImage.src="../assets/PNG/Damage/playerShip1_damage"+this.damage+".png")},function(){var t=function(t){"use strict";var e=io.connect(window.location.host),a=function(a,i){e.on(a,function(){var a=arguments;t.$apply(function(){i.apply(e,a)})})},i=function(a,i,n){e.emit(a,i,function(){var a=arguments;t.$apply(function(){n&&n.apply(e,a)})})};return{on:a,emit:i,socket:e}};angular.module("app").factory("socketService",["$rootScope",t])}();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyIsImNvbnRyb2xsZXIvbG9naW5Db250cm9sbGVyLmpzIiwiY29udHJvbGxlci9wbGF5Q29udHJvbGxlci5qcyIsImRpcmVjdGl2ZXMvY2FudmFzRGlyZWN0aXZlLmpzIiwic2VydmljZXMvZGlzcGxheVNlcnZpY2UuanMiLCJzZXJ2aWNlcy9wbGF5ZXJTZXJ2aWNlLmpzIiwibW9kZWxzL0J1bGxldC5qcyIsIm1vZGVscy9TcGFjZXNoaXAuanMiLCJzZXJ2aWNlcy9zb2NrZXRTZXJ2aWNlLmpzIl0sIm5hbWVzIjpbImFuZ3VsYXIiLCJtb2R1bGUiLCJsb2dpbkNvbnRyb2xsZXIiLCIkc2NvcGUiLCJzb2NrZXRTZXJ2aWNlIiwiZGlzcGxheVNlcnZpY2UiLCJwbGF5ZXJTZXJ2aWNlIiwiTENTaG93IiwiZ2V0TENTaG93IiwibWFrZVJvb20iLCJlbWl0Iiwicm9vbSIsIm9uIiwiZGF0YSIsImRldmljZU9yaWVudGF0aW9uIiwidXNlcm5hbWUiLCJnYW1tYSIsImJldGEiLCJhbHBoYSIsInVzZXJuYW1lcyIsImNoZWNrVXNlckNvdW50Iiwic2V0UGxheWVycyIsIk9iamVjdCIsImtleXMiLCJsZW5ndGgiLCJzdGFydEdhbWUiLCJzZXRMQ1Nob3ciLCJzZXRQQ1Nob3ciLCJjb250cm9sbGVyIiwicGxheUNvbnRyb2xsZXIiLCIkaW50ZXJ2YWwiLCIkd2luZG93IiwiZmlsdGVyUGxheWVycyIsIm9iaiIsInVzZXJOYW1lIiwiZHJhdyIsImN0eCIsImNsZWFyUmVjdCIsImNhbnYiLCJ3aWR0aCIsImhlaWdodCIsInJhdGlvIiwiQWxsQnVsbGV0cyIsIkJ1bGxldFdpZHRoIiwiQnVsbGV0SGVpZ2h0IiwiaW1hZ2UiLCJidWxsZXQiLCJiIiwic2F2ZSIsInRyYW5zbGF0ZSIsIngiLCJ5Iiwicm90YXRlIiwicm90YXRpb24iLCJNYXRoIiwiUEkiLCJkcmF3SW1hZ2UiLCJyZXN0b3JlIiwiY29zIiwic2luIiwiQWxsUGxheWVycyIsIlNwYWNlc2hpcFdpZHRoIiwiU3BhY2VzaGlwSGVpZ2h0IiwicGxheWVyIiwicCIsInNwZWVkIiwiUENTaG93IiwiZ2V0UENTaG93IiwiY3ljbGUiLCJkb2N1bWVudCIsImdldEVsZW1lbnRCeUlkIiwiZ2V0Q29udGV4dCIsIkFycmF5IiwiQnVmZmVyUGxheWVyIiwiZ2V0UGxheWVycyIsInB1c2giLCJTcGFjZXNoaXAiLCJwb3NYIiwicG9zWSIsImNvbG9yIiwiY29uc29sZSIsImxvZyIsImkiLCJyb3RhdGVTcGFjZXNoaXBSZWxhdGl2ZSIsIm9yaWVudGF0aW9uIiwidGVtcCIsIkJ1bGxldCIsImNhbnZhc0RpcmVjdGl2ZSIsImxpbmsiLCJzY29wZSIsImVsZW1lbnQiLCJhdHRycyIsImlubmVyV2lkdGgiLCJpbm5lckhlaWdodCIsImJpbmQiLCIkZGlnZXN0IiwicmVzdHJpY3QiLCJyZXBsYWNlIiwidGVtcGxhdGUiLCJkaXJlY3RpdmUiLCJ2YWx1ZSIsImZhY3RvcnkiLCJwbGF5ZXJzIiwicGxheWVyc0FycmF5IiwidGhpcyIsIkltYWdlIiwic3JjIiwiY2hhckF0IiwidG9VcHBlckNhc2UiLCJzbGljZSIsImRhbWFnZSIsImRhbWFnZUltYWdlIiwicHJvdG90eXBlIiwibW92ZVNwYWNlc2hpcCIsIm1vdmVTcGFjZXNoaXBSZWxhdGl2ZSIsInJvdGF0ZVNwYWNlc2hpcCIsImRlZ3JlZSIsImluY3JlYXNlRGFtYWdlIiwiJHJvb3RTY29wZSIsInNvY2tldCIsImlvIiwiY29ubmVjdCIsIndpbmRvdyIsImxvY2F0aW9uIiwiaG9zdCIsImV2ZW50TmFtZSIsImNhbGxiYWNrIiwiYXJncyIsImFyZ3VtZW50cyIsIiRhcHBseSIsImFwcGx5Il0sIm1hcHBpbmdzIjoiQ0FHQSxXQUVBQSxRQUFBQyxPQUFBLGFDREEsV0FDQSxHQUFBQyxHQUFBLFNBQUFDLEVBQUFDLEVBQUFDLEVBQUFDLEdBRUFILEVBQUFJLE9BQUFGLEVBQUFHLFNBR0EsSUFBQUMsR0FBQSxXQUNBTCxFQUFBTSxLQUFBLFlBQUEsTUFFQVAsR0FBQVEsS0FBQSxH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MENBQUFGLEtBQUFNLE9BQUEsU0NyREEsV0FFQSxHQUFBMUcsR0FBQSxTQUFBa0gsR0FDQSxZQUVBLElBQUFDLEdBQUFDLEdBQUFDLFFBQUFDLE9BQUFDLFNBQUFDLE1BRUFoSCxFQUFBLFNBQUFpSCxFQUFBQyxHQUNBUCxFQUFBM0csR0FBQWlILEVBQUEsV0FDQSxHQUFBRSxHQUFBQyxTQUNBVixHQUFBVyxPQUFBLFdBQ0FILEVBQUFJLE1BQUFYLEVBQUFRLFFBS0FySCxFQUFBLFNBQUFtSCxFQUFBaEgsRUFBQWlILEdBQ0FQLEVBQUE3RyxLQUFBbUgsRUFBQWhILEVBQUEsV0FDQSxHQUFBa0gsR0FBQUMsU0FDQVYsR0FBQVcsT0FBQSxXQUNBSCxHQUNBQSxFQUFBSSxNQUFBWCxFQUFBUSxPQU9BLFFBQ0FuSCxHQUFBQSxFQUNBRixLQUFBQSxFQUNBNkcsT0FBQUEsR0FJQXZILFNBQUFDLE9BQUEsT0FBQW9HLFFBQUEsaUJBQUEsYUFBQWpHIiwiZmlsZSI6ImFwcC5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIENyZWF0ZWQgYnkgTWljaGllbCBvbiAyNS8xMS8yMDE1LlxuICovXG4oZnVuY3Rpb24oKXtcblxuICAgIHZhciBhcHAgPSBhbmd1bGFyLm1vZHVsZShcImFwcFwiLFtdKTtcbn0pKCk7IiwiLyoqXG4gKiBDcmVhdGVkIGJ5IE1pY2hpZWwgb24gMTEvMTIvMjAxNS5cbiAqL1xuXG4oZnVuY3Rpb24oKXtcbiAgICB2YXIgbG9naW5Db250cm9sbGVyID0gZnVuY3Rpb24oJHNjb3BlLCBzb2NrZXRTZXJ2aWNlLCBkaXNwbGF5U2VydmljZSwgcGxheWVyU2VydmljZSl7XG5cbiAgICAgICAgJHNjb3BlLkxDU2hvdyA9IGRpc3BsYXlTZXJ2aWNlLmdldExDU2hvdztcblxuICAgICAgICAvL2Z1bmN0aW9uc1xuICAgICAgICB2YXIgbWFrZVJvb20gPSBmdW5jdGlvbigpe1xuICAgICAgICAgICAgc29ja2V0U2VydmljZS5lbWl0KFwicGNjb25uZWN0XCIsIG51bGwpO1xuICAgICAgICB9O1xuICAgICAgICAkc2NvcGUucm9vbSA9IFwiXCI7XG4gICAgICAgIHNvY2tldFNlcnZpY2Uub24oJ3JlcXVlc3RSb29tJyxmdW5jdGlvbihkYXRhKXtcbiAgICAgICAgICAgICRzY29wZS5yb29tID0gZGF0YTtcbiAgICAgICAgfSk7XG4gICAgICAgIHNvY2tldFNlcnZpY2Uub24oJ2RldmljZU9yaWVudGF0aW9uJywgZnVuY3Rpb24oZGF0YSl7XG4gICAgICAgICAgICB2YXIgdXNlcm5hbWUgPSBkYXRhLnVzZXJuYW1lO1xuICAgICAgICAgICAgdmFyIGRldmljZU9yaWVudGF0aW9uID0ge307XG4gICAgICAgICAgICBkZXZpY2VPcmllbnRhdGlvbi5nYW1tYSA9IGRhdGEuZ2FtbWE7XG4gICAgICAgICAgICBkZXZpY2VPcmllbnRhdGlvbi5iZXRhID0gZGF0YS5iZXRhO1xuICAgICAgICAgICAgZGV2aWNlT3JpZW50YXRpb24uYWxwaGEgPSBkYXRhLmFscGhhO1xuICAgICAgICB9KTtcbiAgICAgICAgJHNjb3BlLnVzZXJuYW1lcyA9IHt9O1xuICAgICAgICAkc2NvcGUuY2hlY2tVc2VyQ291bnQgPSBmYWxzZTtcbiAgICAgICAgc29ja2V0U2VydmljZS5vbigndXBkYXRldXNlcnMnLCBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgcGxheWVyU2VydmljZS5zZXRQbGF5ZXJzKGRhdGEpO1xuICAgICAgICAgICAgJHNjb3BlLnVzZXJuYW1lcyA9IGRhdGE7XG4gICAgICAgICAgICAkc2NvcGUuY2hlY2tVc2VyQ291bnQgPSBPYmplY3Qua2V5cygkc2NvcGUudXNlcm5hbWVzKS5sZW5ndGggPCAwO1xuICAgICAgICB9KTtcblxuICAgICAgICAkc2NvcGUuc3RhcnRHYW1lPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBzb2NrZXRTZXJ2aWNlLmVtaXQoXCJzdGFydEdhbWVcIiwgbnVsbCk7XG4gICAgICAgICAgICBkaXNwbGF5U2VydmljZS5zZXRMQ1Nob3coZmFsc2UpO1xuICAgICAgICAgICAgZGlzcGxheVNlcnZpY2Uuc2V0UENTaG93KHRydWUpO1xuICAgICAgICB9O1xuXG5cbiAgICAgICAgKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgbWFrZVJvb20oKTtcbiAgICAgICAgfSkoKTtcblxuICAgIH07XG5cbiAgICBhbmd1bGFyLm1vZHVsZShcImFwcFwiKS5jb250cm9sbGVyKFwibG9naW5Db250cm9sbGVyXCIsIFtcIiRzY29wZVwiLCBcInNvY2tldFNlcnZpY2VcIiAsIFwiZGlzcGxheVNlcnZpY2VcIiwgXCJwbGF5ZXJTZXJ2aWNlXCIsIGxvZ2luQ29udHJvbGxlcl0pO1xufSkoKTsiLCIvKipcbiAqIENyZWF0ZWQgYnkgTWljaGllbCBvbiAxNi8xMi8yMDE1LlxuICovXG5cbihmdW5jdGlvbigpe1xuICAgIFwidXNlIHN0cmljdFwiO1xuICAgIHZhciBwbGF5Q29udHJvbGxlciA9IGZ1bmN0aW9uKCRzY29wZSwgJGludGVydmFsLCAkd2luZG93LCBzb2NrZXRTZXJ2aWNlLCBkaXNwbGF5U2VydmljZSwgcGxheWVyU2VydmljZSl7XG4gICAgICAgICRzY29wZS5QQ1Nob3cgPSBkaXNwbGF5U2VydmljZS5nZXRQQ1Nob3c7XG4gICAgICAgICRzY29wZS5zdGFydEdhbWUgPSBmYWxzZTtcbiAgICAgICAgdmFyIGNhbnYgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZ2FtZScpO1xuICAgICAgICB2YXIgY3R4ID0gY2Fudi5nZXRDb250ZXh0KCcyZCcpO1xuXG4gICAgICAgIHZhciBBbGxQbGF5ZXJzID0gbmV3IEFycmF5KCk7XG4gICAgICAgIHZhciBBbGxCdWxsZXRzID0gbmV3IEFycmF5KCk7XG5cbiAgICAgICAgdmFyIGN5Y2xlO1xuXG4gICAgICAgIHNvY2tldFNlcnZpY2Uub24oXCJpbml0R2FtZVwiLCBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIEJ1ZmZlclBsYXllciA9IHBsYXllclNlcnZpY2UuZ2V0UGxheWVycygpO1xuICAgICAgICAgICAgZm9yKHZhciBwbGF5ZXIgaW4gQnVmZmVyUGxheWVyKXtcbiAgICAgICAgICAgICAgICB2YXIgcCA9IEJ1ZmZlclBsYXllcltwbGF5ZXJdO1xuICAgICAgICAgICAgICAgIEFsbFBsYXllcnMucHVzaChuZXcgU3BhY2VzaGlwKHAudXNlcm5hbWUsIHAucG9zWCwgcC5wb3NZLCBwLmNvbG9yLCBwLnJvdGF0aW9uKSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGN5Y2xlID0gJGludGVydmFsKGRyYXcsIDEwKTtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKEFsbFBsYXllcnMpO1xuICAgICAgICB9KTtcblxuICAgICAgICBzb2NrZXRTZXJ2aWNlLm9uKFwidXBkYXRlR2FtZURhdGFcIiwgZnVuY3Rpb24oZGF0YSl7XG4gICAgICAgICAgICB2YXIgcCA9IG51bGw7XG4gICAgICAgICAgICBmb3IodmFyIGkgaW4gQWxsUGxheWVycyl7XG4gICAgICAgICAgICAgICAgaWYoZmlsdGVyUGxheWVycyhBbGxQbGF5ZXJzW2ldLGRhdGEpID09IHRydWUpe1xuICAgICAgICAgICAgICAgICAgICBwID0gaTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZihwICE9IG51bGwpe1xuICAgICAgICAgICAgICAgIEFsbFBsYXllcnNbcF0ucm90YXRlU3BhY2VzaGlwUmVsYXRpdmUoZGF0YS5vcmllbnRhdGlvbik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHNvY2tldFNlcnZpY2Uub24oXCJwbGF5ZXJTaG90XCIsIGZ1bmN0aW9uKGRhdGEpe1xuICAgICAgICAgICAgdmFyIHAgPSBudWxsO1xuICAgICAgICAgICAgZm9yKHZhciBpIGluIEFsbFBsYXllcnMpe1xuICAgICAgICAgICAgICAgIGlmKGZpbHRlclBsYXllcnMoQWxsUGxheWVyc1tpXSxkYXRhKSA9PSB0cnVlKXtcbiAgICAgICAgICAgICAgICAgICAgcCA9IGk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYocCAhPSBudWxsKXtcbiAgICAgICAgICAgICAgICB2YXIgdGVtcCA9IEFsbFBsYXllcnNbcF07XG4gICAgICAgICAgICAgICAgLy92YXIgeCAgPSBNYXRoLnNpbigodGVtcC5yb3RhdGlvbiAtIDkwKS8xODAqTWF0aC5QSSkrdGVtcC54O1xuICAgICAgICAgICAgICAgIC8vdmFyIHkgPSBNYXRoLmNvcygodGVtcC5yb3RhdGlvbiAtIDkwKS8xODAqTWF0aC5QSSkrdGVtcC55O1xuICAgICAgICAgICAgICAgIEFsbEJ1bGxldHMucHVzaChuZXcgQnVsbGV0KHRlbXAueCwgdGVtcC55LCB0ZW1wLnJvdGF0aW9uLCB0ZW1wLmNvbG9yKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGZ1bmN0aW9uIGZpbHRlclBsYXllcnMob2JqLGRhdGEpe1xuICAgICAgICAgICAgaWYoZGF0YS51c2VybmFtZSA9PSBvYmoudXNlck5hbWUpe1xuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfWVsc2V7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gZHJhdygpe1xuICAgICAgICAgICAgY3R4LmNsZWFyUmVjdCgwLDAsY2Fudi53aWR0aCwgY2Fudi5oZWlnaHQpO1xuICAgICAgICAgICAgdmFyIHJhdGlvID0gY2Fudi53aWR0aC8xMDA7XG5cbiAgICAgICAgICAgIGlmKEFsbEJ1bGxldHMubGVuZ3RoICE9IDApe1xuICAgICAgICAgICAgICAgIHZhciBCdWxsZXRXaWR0aCA9IGNhbnYud2lkdGgvMTAwO1xuICAgICAgICAgICAgICAgIHZhciBCdWxsZXRIZWlnaHQgPSBCdWxsZXRXaWR0aCAqIEFsbEJ1bGxldHNbMF0uaW1hZ2UuaGVpZ2h0L0FsbEJ1bGxldHNbMF0uaW1hZ2Uud2lkdGg7XG5cbiAgICAgICAgICAgICAgICBmb3IodmFyIGJ1bGxldCBpbiBBbGxCdWxsZXRzKXtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGIgPSBBbGxCdWxsZXRzW2J1bGxldF07XG4gICAgICAgICAgICAgICAgICAgIGN0eC5zYXZlKCk7XG4gICAgICAgICAgICAgICAgICAgIGN0eC50cmFuc2xhdGUoYi54KnJhdGlvLCBiLnkqcmF0aW8pO1xuICAgICAgICAgICAgICAgICAgICBjdHgucm90YXRlKGIucm90YXRpb24vMTgwKk1hdGguUEkpO1xuICAgICAgICAgICAgICAgICAgICBjdHguZHJhd0ltYWdlKGIuaW1hZ2UsIC1CdWxsZXRXaWR0aC8yLCAtQnVsbGV0SGVpZ2h0LzIsIEJ1bGxldFdpZHRoLCBCdWxsZXRIZWlnaHQpO1xuICAgICAgICAgICAgICAgICAgICBjdHgucmVzdG9yZSgpO1xuICAgICAgICAgICAgICAgICAgICBBbGxCdWxsZXRzW2J1bGxldF0ueCA9IE1hdGguY29zKChiLnJvdGF0aW9uIC0gOTApLzE4MCpNYXRoLlBJKSArIGIueDtcbiAgICAgICAgICAgICAgICAgICAgQWxsQnVsbGV0c1tidWxsZXRdLnkgPSBNYXRoLnNpbigoYi5yb3RhdGlvbi05MCkvMTgwKk1hdGguUEkpKyBiLnk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZihBbGxQbGF5ZXJzLmxlbmd0aCAhPSAwKXtcbiAgICAgICAgICAgICAgICB2YXIgU3BhY2VzaGlwV2lkdGggPSBjYW52LndpZHRoLzIwO1xuICAgICAgICAgICAgICAgIHZhciBTcGFjZXNoaXBIZWlnaHQgPSBTcGFjZXNoaXBXaWR0aCAqIEFsbFBsYXllcnNbMF0uaW1hZ2UuaGVpZ2h0LyBBbGxQbGF5ZXJzWzBdLmltYWdlLndpZHRoO1xuXG4gICAgICAgICAgICAgICAgZm9yKHZhciBwbGF5ZXIgaW4gQWxsUGxheWVycyl7XG4gICAgICAgICAgICAgICAgICAgIHZhciBwID0gQWxsUGxheWVyc1twbGF5ZXJdO1xuICAgICAgICAgICAgICAgICAgICBjdHguc2F2ZSgpO1xuICAgICAgICAgICAgICAgICAgICBjdHgudHJhbnNsYXRlKHAueCpyYXRpbywgcC55KnJhdGlvKTtcbiAgICAgICAgICAgICAgICAgICAgY3R4LnJvdGF0ZShwLnJvdGF0aW9uLzE4MCpNYXRoLlBJKTtcbiAgICAgICAgICAgICAgICAgICAgY3R4LmRyYXdJbWFnZShwLmltYWdlLCAtU3BhY2VzaGlwV2lkdGgvMiwgLVNwYWNlc2hpcEhlaWdodC8yLCBTcGFjZXNoaXBXaWR0aCwgU3BhY2VzaGlwSGVpZ2h0KTtcbiAgICAgICAgICAgICAgICAgICAgY3R4LnJlc3RvcmUoKTtcbiAgICAgICAgICAgICAgICAgICAgQWxsUGxheWVyc1twbGF5ZXJdLnggPSBNYXRoLmNvcygocC5yb3RhdGlvbiAtIDkwKS8xODAqTWF0aC5QSSkvMTAqIHAuc3BlZWQgKyBwLng7XG4gICAgICAgICAgICAgICAgICAgIEFsbFBsYXllcnNbcGxheWVyXS55ID0gTWF0aC5zaW4oKHAucm90YXRpb24tOTApLzE4MCpNYXRoLlBJKS8xMCogcC5zcGVlZCArIHAueTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgYW5ndWxhci5tb2R1bGUoXCJhcHBcIikuY29udHJvbGxlcihcInBsYXlDb250cm9sbGVyXCIsIFtcIiRzY29wZVwiLCBcIiRpbnRlcnZhbFwiLCBcIiR3aW5kb3dcIiwgXCJzb2NrZXRTZXJ2aWNlXCIsIFwiZGlzcGxheVNlcnZpY2VcIiwgXCJwbGF5ZXJTZXJ2aWNlXCIsIHBsYXlDb250cm9sbGVyXSlcbn0pKCk7IiwiLyoqXG4gKiBDcmVhdGVkIGJ5IGp1c3Rpam5kZXBvdmVyIG9uIDE2LzEyLzE1LlxuICovXG4oZnVuY3Rpb24oKXtcbiAgICB2YXIgY2FudmFzRGlyZWN0aXZlID0gZnVuY3Rpb24oJHdpbmRvdyl7XG4gICAgICAgIHJldHVybntcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnRScsXG4gICAgICAgICAgICBsaW5rOmxpbmssXG4gICAgICAgICAgICByZXBsYWNlOnRydWUsXG4gICAgICAgICAgICB0ZW1wbGF0ZTonPGNhbnZhcyBpZD1cImdhbWVcIiBjbGFzcz1cInBsYXlBcmVhXCIgd2lkdGg9XCJ7e3dpZHRofX1cIiBoZWlnaHQ9XCJ7e3dpZHRofX1cIiAvPidcbiAgICAgICAgfTtcblxuICAgICAgICBmdW5jdGlvbiBsaW5rKHNjb3BlLCBlbGVtZW50LCBhdHRycyl7XG4gICAgICAgICAgICBpZigkd2luZG93LmlubmVyV2lkdGggPCAkd2luZG93LmlubmVySGVpZ2h0KXtcbiAgICAgICAgICAgICAgICBzY29wZS53aWR0aCA9ICR3aW5kb3cuaW5uZXJXaWR0aCAtIDIwO1xuICAgICAgICAgICAgfWVsc2V7XG4gICAgICAgICAgICAgICAgc2NvcGUud2lkdGggPSAkd2luZG93LmlubmVySGVpZ2h0IC0gMjA7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGFuZ3VsYXIuZWxlbWVudCgkd2luZG93KS5iaW5kKCdyZXNpemUnLCBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIGlmKCR3aW5kb3cuaW5uZXJXaWR0aCA8ICR3aW5kb3cuaW5uZXJIZWlnaHQpe1xuICAgICAgICAgICAgICAgICAgICBzY29wZS53aWR0aCA9ICR3aW5kb3cuaW5uZXJXaWR0aCAtIDIwO1xuICAgICAgICAgICAgICAgIH1lbHNle1xuICAgICAgICAgICAgICAgICAgICBzY29wZS53aWR0aCA9ICR3aW5kb3cuaW5uZXJIZWlnaHQgLSAyMDtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBzY29wZS4kZGlnZXN0KCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwJykuZGlyZWN0aXZlKFwiY2FudmFzRGlyZWN0aXZlXCIsIFtcIiR3aW5kb3dcIiwgY2FudmFzRGlyZWN0aXZlXSk7XG59KSgpOyIsIi8qKlxuICogQ3JlYXRlZCBieSBNaWNoaWVsIG9uIDE2LzEyLzIwMTUuXG4gKi9cbi8qKlxuICogQ3JlYXRlZCBieSBqdXN0aWpuZGVwb3ZlciBvbiAxNi8xMi8xNS5cbiAqL1xuXG5cbihmdW5jdGlvbigpe1xuICAgIHZhciBkaXNwbGF5U2VydmljZSA9IGZ1bmN0aW9uKCl7XG4gICAgICAgIC8vTG9naW4gQ29udHJvbGxlclxuICAgICAgICB2YXIgTENTaG93ID0gdHJ1ZTtcbiAgICAgICAgLy9QbGF5IGNvbnRyb2xsZXJcbiAgICAgICAgdmFyIFBDU2hvdyA9IGZhbHNlO1xuXG4gICAgICAgIHJldHVybntcbiAgICAgICAgICAgIGdldExDU2hvdzogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICByZXR1cm4gTENTaG93O1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHNldExDU2hvdzogZnVuY3Rpb24odmFsdWUpe1xuICAgICAgICAgICAgICAgIExDU2hvdyA9IHZhbHVlO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldFBDU2hvdzogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICByZXR1cm4gUENTaG93O1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHNldFBDU2hvdzogZnVuY3Rpb24odmFsdWUpe1xuICAgICAgICAgICAgICAgIFBDU2hvdyA9IHZhbHVlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfTtcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdhcHAnKS5mYWN0b3J5KCdkaXNwbGF5U2VydmljZScsIFtkaXNwbGF5U2VydmljZV0pO1xufSkoKTsiLCIvKipcbiAqIENyZWF0ZWQgYnkganVzdGlqbmRlcG92ZXIgb24gMTcvMTIvMTUuXG4gKi9cblxuKGZ1bmN0aW9uKCl7XG4gICAgdmFyIHBsYXllclNlcnZpY2UgPSBmdW5jdGlvbigpe1xuICAgICAgICAvL0xvZ2luIENvbnRyb2xsZXJcbiAgICAgICAgdmFyIHBsYXllcnMgPSBbXTtcblxuICAgICAgICByZXR1cm57XG4gICAgICAgICAgICBnZXRQbGF5ZXJzOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIHJldHVybiBwbGF5ZXJzO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHNldFBsYXllcnM6IGZ1bmN0aW9uKHBsYXllcnNBcnJheSl7XG4gICAgICAgICAgICAgICAgcGxheWVycyA9IHBsYXllcnNBcnJheTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH07XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwJykuZmFjdG9yeSgncGxheWVyU2VydmljZScsIFtwbGF5ZXJTZXJ2aWNlXSk7XG59KSgpOyIsIi8qKlxuICogQ3JlYXRlZCBieSBqdXN0aWpuZGVwb3ZlciBvbiAyMi8xMi8xNS5cbiAqL1xuXG52YXIgQnVsbGV0ID0gZnVuY3Rpb24oeCwgeSxyb3RhdGlvbiwgY29sb3Ipe1xuICAgIHRoaXMueCA9IHg7XG4gICAgdGhpcy55ID0geTtcbiAgICB0aGlzLnJvdGF0aW9uID0gcm90YXRpb247XG4gICAgdGhpcy5pbWFnZSA9IG5ldyBJbWFnZSgpO1xuICAgIHRoaXMuY29sb3IgPSBjb2xvcjtcbiAgICBpZih0aGlzLmNvbG9yID09IFwib3JhbmdlXCIpe1xuICAgICAgICB0aGlzLmNvbG9yID0gJ3JlZCc7XG4gICAgfVxuICAgIHRoaXMuaW1hZ2Uuc3JjID0gJy4uL2Fzc2V0cy9QTkcvTGFzZXJzL2xhc2VyJysgdGhpcy5jb2xvci5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArIHRoaXMuY29sb3Iuc2xpY2UoMSkgKycwMS5wbmcnXG59OyIsIi8qKlxuICogQ3JlYXRlZCBieSBqdXN0aWpuZGVwb3ZlciBvbiAwOS8xMi8xNS5cbiAqL1xuXG52YXIgU3BhY2VzaGlwID0gZnVuY3Rpb24odXNlck5hbWUsIHgsIHksIGNvbG9yLCByb3RhdGlvbil7XG4gICAgdGhpcy51c2VyTmFtZSA9IHVzZXJOYW1lO1xuICAgIHRoaXMueCA9IHg7XG4gICAgdGhpcy55ID0geTtcbiAgICB0aGlzLnNwZWVkID0gMTtcbiAgICB0aGlzLmNvbG9yID0gY29sb3I7XG4gICAgdGhpcy5yb3RhdGlvbiA9IHJvdGF0aW9uO1xuICAgIHRoaXMuaW1hZ2UgPSBuZXcgSW1hZ2UoKTtcbiAgICB0aGlzLmRhbWFnZSA9IDA7XG4gICAgdGhpcy5kYW1hZ2VJbWFnZSA9IG5ldyBJbWFnZSgpO1xuICAgIHRoaXMuaW1hZ2Uuc3JjID0gJy4uL2Fzc2V0cy9QTkcvcGxheWVyU2hpcDFfJysgdGhpcy5jb2xvciArJy5wbmcnXG59O1xuXG5TcGFjZXNoaXAucHJvdG90eXBlLm1vdmVTcGFjZXNoaXAgPSBmdW5jdGlvbih4LCB5KXtcbiAgICB0aGlzLnggPSB4O1xuICAgIHRoaXMueSA9IHk7XG59O1xuXG5TcGFjZXNoaXAucHJvdG90eXBlLm1vdmVTcGFjZXNoaXBSZWxhdGl2ZSA9IGZ1bmN0aW9uKHgsIHkpe1xuICAgIHRoaXMueCA9IHRoaXMueCt4O1xuICAgIHRoaXMueSA9IHRoaXMueSt5O1xufTtcblxuU3BhY2VzaGlwLnByb3RvdHlwZS5yb3RhdGVTcGFjZXNoaXAgPSBmdW5jdGlvbihkZWdyZWUpe1xuICAgIHRoaXMucm90YXRpb24gPSBkZWdyZWU7XG59O1xuXG5TcGFjZXNoaXAucHJvdG90eXBlLnJvdGF0ZVNwYWNlc2hpcFJlbGF0aXZlID0gZnVuY3Rpb24oZGVncmVlKXtcbiAgICB0aGlzLnJvdGF0aW9uID0gdGhpcy5yb3RhdGlvbiArIGRlZ3JlZS81O1xuICAgIGlmKHRoaXMucm90YXRpb24gPCAtMzYwKXtcbiAgICAgICAgdGhpcy5yb3RhdGlvbiA9IHRoaXMucm90YXRpb24gKyA3MjA7XG4gICAgfVxuICAgIGlmKHRoaXMucm90YXRpb24gPiAzNjApe1xuICAgICAgICB0aGlzLnJvdGF0aW9uID0gdGhpcy5yb3RhdGlvbiAtIDcyMDtcbiAgICB9XG59O1xuXG5TcGFjZXNoaXAucHJvdG90eXBlLmluY3JlYXNlRGFtYWdlID0gZnVuY3Rpb24oKXtcbiAgICBpZih0aGlzLmRhbWFnZSA8IDQpe1xuICAgICAgICB0aGlzLmRhbWFnZSArPSAxO1xuICAgIH1cblxuICAgIGlmKHRoaXMuZGFtYWdlIDw9IDMgJiYgdGhpcy5kYW1hZ2UgPiAwKXtcbiAgICAgICAgdGhpcy5kYW1hZ2VJbWFnZS5zcmMgPSAnLi4vYXNzZXRzL1BORy9EYW1hZ2UvcGxheWVyU2hpcDFfZGFtYWdlJysgdGhpcy5kYW1hZ2UgKyAnLnBuZyc7XG4gICAgfVxufTtcblxuU3BhY2VzaGlwLnByb3RvdHlwZS5pbmNyZWFzZURhbWFnZSA9IGZ1bmN0aW9uKCl7XG4gICAgaWYodGhpcy5kYW1hZ2UgPiAwKXtcbiAgICAgICAgdGhpcy5kYW1hZ2UgLT0gMTtcbiAgICB9XG5cbiAgICBpZih0aGlzLmRhbWFnZSA8PSAzICYmIHRoaXMuZGFtYWdlID4gMCl7XG4gICAgICAgIHRoaXMuZGFtYWdlSW1hZ2Uuc3JjID0gJy4uL2Fzc2V0cy9QTkcvRGFtYWdlL3BsYXllclNoaXAxX2RhbWFnZScrIHRoaXMuZGFtYWdlICsgJy5wbmcnO1xuICAgIH1cbn07XG5cbiIsIi8qKlxuICogQ3JlYXRlZCBieSBqdXN0aWpuZGVwb3ZlciBvbiAwOS8xMi8xNS5cbiAqL1xuXG4oZnVuY3Rpb24oKXtcblxuICAgIHZhciBzb2NrZXRTZXJ2aWNlID0gZnVuY3Rpb24oJHJvb3RTY29wZSl7XG4gICAgICAgIFwidXNlIHN0cmljdFwiO1xuICAgICAgICAvL3ByaXZhdGVcbiAgICAgICAgdmFyIHNvY2tldCA9IGlvLmNvbm5lY3Qod2luZG93LmxvY2F0aW9uLmhvc3QpO1xuICAgICAgICAvL2Z1bmN0aW9uc1xuICAgICAgICB2YXIgb24gPSBmdW5jdGlvbiAoZXZlbnROYW1lLCBjYWxsYmFjaykge1xuICAgICAgICAgICAgc29ja2V0Lm9uKGV2ZW50TmFtZSwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHZhciBhcmdzID0gYXJndW1lbnRzO1xuICAgICAgICAgICAgICAgICRyb290U2NvcGUuJGFwcGx5KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2suYXBwbHkoc29ja2V0LCBhcmdzKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBlbWl0ID0gZnVuY3Rpb24gKGV2ZW50TmFtZSwgZGF0YSwgY2FsbGJhY2spIHtcbiAgICAgICAgICAgIHNvY2tldC5lbWl0KGV2ZW50TmFtZSwgZGF0YSwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHZhciBhcmdzID0gYXJndW1lbnRzO1xuICAgICAgICAgICAgICAgICRyb290U2NvcGUuJGFwcGx5KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNhbGxiYWNrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFjay5hcHBseShzb2NrZXQsIGFyZ3MpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KVxuICAgICAgICB9O1xuXG4gICAgICAgIC8vcHVibGljXG4gICAgICAgIHJldHVybntcbiAgICAgICAgICAgIG9uOiBvbixcbiAgICAgICAgICAgIGVtaXQ6IGVtaXQsXG4gICAgICAgICAgICBzb2NrZXQ6IHNvY2tldFxuICAgICAgICB9XG4gICAgfTtcblxuICAgIGFuZ3VsYXIubW9kdWxlKFwiYXBwXCIpLmZhY3RvcnkoXCJzb2NrZXRTZXJ2aWNlXCIsIFtcIiRyb290U2NvcGVcIiwgc29ja2V0U2VydmljZV0pO1xuXG59KSgpOyJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
