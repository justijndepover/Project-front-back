!function(){angular.module("app",[])}();var Bullet=function(t,e,a,i,n){this.x=t,this.y=e,this.rotation=a,this.image=new Image,this.color=i,this.width=0,this.height=0,this.player=n,"orange"==this.color&&(this.color="red"),this.image.src="../assets/PNG/Lasers/laser"+this.color.charAt(0).toUpperCase()+this.color.slice(1)+"01.png"},Spaceship=function(t,e,a,i,n){this.userName=t,this.x=e,this.y=a,this.speed=1,this.color=i,this.rotation=n,this.image=new Image,this.damage=0,this.width=0,this.height=0,this.damageImage=new Image,this.image.src="../assets/PNG/playerShip1_"+this.color+".png"};Spaceship.prototype.moveSpaceship=function(t,e){this.x=t,this.y=e},Spaceship.prototype.moveSpaceshipRelative=function(t,e){this.x=this.x+t,this.y=this.y+e},Spaceship.prototype.rotateSpaceship=function(t){this.rotation=t},Spaceship.prototype.rotateSpaceshipRelative=function(t){this.rotation=this.rotation+t/5,this.rotation<-360&&(this.rotation=this.rotation+720),this.rotation>360&&(this.rotation=this.rotation-720)},Spaceship.prototype.increaseDamage=function(){this.damage<4&&(this.damage+=1),this.damage<=3&&this.damage>0&&(this.damageImage.src="../assets/PNG/Damage/playerShip1_damage"+this.damage+".png")},Spaceship.prototype.decreaseDamage=function(){this.damage>0&&(this.damage-=1),this.damage<=3&&this.damage>0&&(this.damageImage.src="../assets/PNG/Damage/playerShip1_damage"+this.damage+".png")},function(){var t=function(t){function e(e,a,i){t.innerWidth<t.innerHeight?e.width=t.innerWidth-20:e.width=t.innerHeight-20,angular.element(t).bind("resize",function(){t.innerWidth<t.innerHeight?e.width=t.innerWidth-20:e.width=t.innerHeight-20,e.$digest()})}return{restrict:"E",link:e,replace:!0,template:'<canvas id="game" class="playArea" width="{{width}}" height="{{width}}" />'}};angular.module("app").directive("canvasDirective",["$window",t])}(),function(){var t=function(t,e,a,i){t.LCShow=a.getLCShow;var n=function(){e.emit("pcconnect",null)};t.room="",e.on("requestRoom",function(e){t.room=e}),e.on("deviceOrientation",function(t){var e=(t.username,{});e.gamma=t.gamma,e.beta=t.beta,e.alpha=t.alpha}),t.usernames={},t.checkUserCount=!1,e.on("updateusers",function(e){i.setPlayers(e),t.usernames=e,t.checkUserCount=Object.keys(t.usernames).length<0}),t.startGame=function(){e.emit("startGame",null),a.setLCShow(!1),a.setPCShow(!0)},function(){n()}()};angular.module("app").controller("loginController",["$scope","socketService","displayService","playerService",t])}(),function(){"use strict";var t=function(t,e,a,i,n,o){function r(t,e){return e.username==t.userName?!0:!1}function s(){l.clearRect(0,0,u.width,u.height);var t=u.width/100;if(0!=m.length){var e=u.width/100,a=e*m[0].image.height/m[0].image.width;for(var i in m){var n=m[i];n.width=e,n.height=a,l.save(),l.translate(n.x*t,n.y*t),l.rotate(n.rotation/180*Math.PI),l.drawImage(n.image,-e/2,-a/2,e,a),l.restore(),m[i].x=Math.cos((n.rotation-90)/180*Math.PI)+n.x,m[i].y=Math.sin((n.rotation-90)/180*Math.PI)+n.y}}if(0!=g.length){g[1].speed=0,g[0].speed=0;var o=u.width/20,r=o*g[0].image.height/g[0].image.width;for(var s in g){var p=g[s];p.width=o,p.height=r,l.save(),l.translate(p.x*t,p.y*t),l.rotate(p.rotation/180*Math.PI),l.drawImage(p.image,-o/2,-r/2,o,r),p.damage>0&&l.drawImage(p.damageImage,-o/2,-r/2,o,r),l.restore(),g[s].x=Math.cos((p.rotation-90)/180*Math.PI)/10*p.speed+p.x,g[s].y=Math.sin((p.rotation-90)/180*Math.PI)/10*p.speed+p.y}}h(),c()}function h(){for(var t in m)(m[t].x<0||m[t].x>u.width||m[t].y<0||m[t].y>u.height)&&m.splice(t,1)}function c(){for(var t in g)for(var e in m)if(m[e].player!=g[t].userName){var a=Math.sqrt(2)/2*m[e].width/2,i=(360-(m[e].rotation-90)-90)/180*Math.PI,n=m[e].x+a*Math.sin(i),o=m[e].y+a*Math.cos(i),r=Math.sqrt(2)/2*g[t].height/2,s=(360-(g[t].rotation-90)-90)/180*Math.PI,h=g[t].x+r*Math.sin(s),c=g[t].y+r*Math.cos(s),p=Math.sqrt(Math.pow(n-h,2)+Math.pow(o-c,2));a+r>p&&(g[t].increaseDamage(),m.splice(e,1))}}t.PCShow=n.getPCShow,t.startGame=!1;var p,u=document.getElementById("game"),l=u.getContext("2d"),g=new Array,m=new Array;i.on("initGame",function(){var t=o.getPlayers();for(var a in t){var i=t[a];g.push(new Spaceship(i.username,i.x,i.y,i.color,i.rotation))}p=e(s,10)}),i.on("updateGameData",function(t){var e=null;for(var a in g)1==r(g[a],t)&&(e=a);null!=e&&g[e].rotateSpaceshipRelative(t.orientation)}),i.on("playerShot",function(t){var e=null;for(var a in g)1==r(g[a],t)&&(e=a);if(null!=e){var i=g[e];m.push(new Bullet(i.x,i.y,i.rotation,i.color,i.userName))}})};angular.module("app").controller("playController",["$scope","$interval","$window","socketService","displayService","playerService",t])}(),function(){var t=function(){var t=!0,e=!1;return{getLCShow:function(){return t},setLCShow:function(e){t=e},getPCShow:function(){return e},setPCShow:function(t){e=t}}};angular.module("app").factory("displayService",[t])}(),function(){var t=function(){var t=[];return{getPlayers:function(){return t},setPlayers:function(e){t=e}}};angular.module("app").factory("playerService",[t])}(),function(){var t=function(t){"use strict";var e=io.connect(window.location.host),a=function(a,i){e.on(a,function(){var a=arguments;t.$apply(function(){i.apply(e,a)})})},i=function(a,i,n){e.emit(a,i,function(){var a=arguments;t.$apply(function(){n&&n.apply(e,a)})})};return{on:a,emit:i,socket:e}};angular.module("app").factory("socketService",["$rootScope",t])}();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyIsIm1vZGVscy9CdWxsZXQuanMiLCJtb2RlbHMvU3BhY2VzaGlwLmpzIiwiZGlyZWN0aXZlcy9jYW52YXNEaXJlY3RpdmUuanMiLCJjb250cm9sbGVyL2xvZ2luQ29udHJvbGxlci5qcyIsImNvbnRyb2xsZXIvcGxheUNvbnRyb2xsZXIuanMiLCJzZXJ2aWNlcy9kaXNwbGF5U2VydmljZS5qcyIsInNlcnZpY2VzL3BsYXllclNlcnZpY2UuanMiLCJzZXJ2aWNlcy9zb2NrZXRTZXJ2aWNlLmpzIl0sIm5hbWVzIjpbImFuZ3VsYXIiLCJtb2R1bGUiLCJCdWxsZXQiLCJ4IiwieSIsInJvdGF0aW9uIiwiY29sb3IiLCJwbGF5ZXIiLCJ0aGlzIiwiaW1hZ2UiLCJJbWFnZSIsIndpZHRoIiwiaGVpZ2h0Iiwic3JjIiwiY2hhckF0IiwidG9VcHBlckNhc2UiLCJzbGljZSIsIlNwYWNlc2hpcCIsInVzZXJOYW1lIiwic3BlZWQiLCJkYW1hZ2UiLCJkYW1hZ2VJbWFnZSIsInByb3RvdHlwZSIsIm1vdmVTcGFjZXNoaXAiLCJtb3ZlU3BhY2VzaGlwUmVsYXRpdmUiLCJyb3RhdGVTcGFjZXNoaXAiLCJkZWdyZWUiLCJyb3RhdGVTcGFjZXNoaXBSZWxhdGl2ZSIsImluY3JlYXNlRGFtYWdlIiwiZGVjcmVhc2VEYW1hZ2UiLCJjYW52YXNEaXJlY3RpdmUiLCIkd2luZG93IiwibGluayIsInNjb3BlIiwiZWxlbWVudCIsImF0dHJzIiwiaW5uZXJXaWR0aCIsImlubmVySGVpZ2h0IiwiYmluZCIsIiRkaWdlc3QiLCJyZXN0cmljdCIsInJlcGxhY2UiLCJ0ZW1wbGF0ZSIsImRpcmVjdGl2ZSIsImxvZ2luQ29udHJvbGxlciIsIiRzY29wZSIsInNvY2tldFNlcnZpY2UiLCJkaXNwbGF5U2VydmljZSIsInBsYXllclNlcnZpY2UiLCJMQ1Nob3ciLCJnZXRMQ1Nob3ciLCJtYWtlUm9vbSIsImVtaXQiLCJyb29tIiwib24iLCJkYXRhIiwiZGV2aWNlT3JpZW50YXRpb24iLCJ1c2VybmFtZSIsImdhbW1hIiwiYmV0YSIsImFscGhhIiwidXNlcm5hbWVzIiwiY2hlY2tVc2VyQ291bnQiLCJzZXRQbGF5ZXJzIiwiT2JqZWN0Iiwia2V5cyIsImxlbmd0aCIsInN0YXJ0R2FtZSIsInNldExDU2hvdyIsInNldFBDU2hvdyIsImNvbnRyb2xsZXIiLCJwbGF5Q29udHJvbGxlciIsIiRpbnRlcnZhbCIsImZpbHRlclBsYXllcnMiLCJvYmoiLCJkcmF3IiwiY3R4IiwiY2xlYXJSZWN0IiwiY2FudiIsInJhdGlvIiwiQWxsQnVsbGV0cyIsIkJ1bGxldFdpZHRoIiwiQnVsbGV0SGVpZ2h0IiwiYnVsbGV0IiwiYiIsInNhdmUiLCJ0cmFuc2xhdGUiLCJyb3RhdGUiLCJNYXRoIiwiUEkiLCJkcmF3SW1hZ2UiLCJyZXN0b3JlIiwiY29zIiwic2luIiwiQWxsUGxheWVycyIsIlNwYWNlc2hpcFdpZHRoIiwiU3BhY2VzaGlwSGVpZ2h0IiwicCIsImNoZWNrQnVsbGV0cyIsImNvbGxpc2lvbkRldGVjdGlvbiIsInNwbGljZSIsInJhZGl1cyIsInNxcnQiLCJhbmdsZSIsImJ1bGxldEhlYWRYIiwiYnVsbGV0SGVhZFkiLCJyYWRpdXNTIiwiYW5nbGVTIiwiYnVsbGV0SGVhZFhTIiwiYnVsbGV0SGVhZFlTIiwiZGlzdGFuY2UiLCJwb3ciLCJQQ1Nob3ciLCJnZXRQQ1Nob3ciLCJjeWNsZSIsImRvY3VtZW50IiwiZ2V0RWxlbWVudEJ5SWQiLCJnZXRDb250ZXh0IiwiQXJyYXkiLCJCdWZmZXJQbGF5ZXIiLCJnZXRQbGF5ZXJzIiwicHVzaCIsImkiLCJvcmllbnRhdGlvbiIsInRlbXAiLCJ2YWx1ZSIsImZhY3RvcnkiLCJwbGF5ZXJzIiwicGxheWVyc0FycmF5IiwiJHJvb3RTY29wZSIsInNvY2tldCIsImlvIiwiY29ubmVjdCIsIndpbmRvdyIsImxvY2F0aW9uIiwiaG9zdCIsImV2ZW50TmFtZSIsImNhbGxiYWNrIiwiYXJncyIsImFyZ3VtZW50cyIsIiRhcHBseSIsImFwcGx5Il0sIm1hcHBpbmdz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QUExRyxjQWlHQWxCLFNBQUFDLE9BQUEsT0FBQXFFLFdBQUEsa0JBQUEsU0FBQSxZQUFBLFVBQUEsZ0JBQUEsaUJBQUEsZ0JBQUFDLE9DM0lBLFdBQ0EsR0FBQXhCLEdBQUEsV0FFQSxHQUFBRSxJQUFBLEVBRUErRCxHQUFBLENBRUEsUUFDQTlELFVBQUEsV0FDQSxNQUFBRCxJQUVBbUIsVUFBQSxTQUFBeUQsR0FDQTVFLEVBQUE0RSxHQUVBWixVQUFBLFdBQ0EsTUFBQUQsSUFFQTNDLFVBQUEsU0FBQXdELEdBQ0FiLEVBQUFhLElBS0E3SCxTQUFBQyxPQUFBLE9BQUE2SCxRQUFBLGtCQUFBL0UsT0MzQkEsV0FDQSxHQUFBQyxHQUFBLFdBRUEsR0FBQStFLEtBRUEsUUFDQVAsV0FBQSxXQUNBLE1BQUFPLElBRUFoRSxXQUFBLFNBQUFpRSxHQUNBRCxFQUFBQyxJQUtBaEksU0FBQUMsT0FBQSxPQUFBNkgsUUFBQSxpQkFBQTlFLE9DZkEsV0FFQSxHQUFBRixHQUFBLFNBQUFtRixHQUNBLFlBRUEsSUFBQUMsR0FBQUMsR0FBQUMsUUFBQUMsT0FBQUMsU0FBQUMsTUFFQWpGLEVBQUEsU0FBQWtGLEVBQUFDLEdBQ0FQLEVBQUE1RSxHQUFBa0YsRUFBQSxXQUNBLEdBQUFFLEdBQUFDLFNBQ0FWLEdBQUFXLE9BQUEsV0FDQUgsRUFBQUksTUFBQVgsRUFBQVEsUUFLQXRGLEVBQUEsU0FBQW9GLEVBQUFqRixFQUFBa0YsR0FDQVAsRUFBQTlFLEtBQUFvRixFQUFBakYsRUFBQSxXQUNBLEdBQUFtRixHQUFBQyxTQUNBVixHQUFBVyxPQUFBLFdBQ0FILEdBQ0FBLEVBQUFJLE1BQUFYLEVBQUFRLE9BT0EsUUFDQXBGLEdBQUFBLEVBQ0FGLEtBQUFBLEVBQ0E4RSxPQUFBQSxHQUlBbEksU0FBQUMsT0FBQSxPQUFBNkgsUUFBQSxpQkFBQSxhQUFBaEYiLCJmaWxlIjoiYXBwLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQ3JlYXRlZCBieSBNaWNoaWVsIG9uIDI1LzExLzIwMTUuXG4gKi9cbihmdW5jdGlvbigpe1xuXG4gICAgdmFyIGFwcCA9IGFuZ3VsYXIubW9kdWxlKFwiYXBwXCIsW10pO1xufSkoKTsiLCIvKipcbiAqIENyZWF0ZWQgYnkganVzdGlqbmRlcG92ZXIgb24gMjIvMTIvMTUuXG4gKi9cblxudmFyIEJ1bGxldCA9IGZ1bmN0aW9uKHgsIHkscm90YXRpb24sIGNvbG9yLCBwbGF5ZXIpe1xuICAgIHRoaXMueCA9IHg7XG4gICAgdGhpcy55ID0geTtcbiAgICB0aGlzLnJvdGF0aW9uID0gcm90YXRpb247XG4gICAgdGhpcy5pbWFnZSA9IG5ldyBJbWFnZSgpO1xuICAgIHRoaXMuY29sb3IgPSBjb2xvcjtcbiAgICB0aGlzLndpZHRoID0gMDtcbiAgICB0aGlzLmhlaWdodCA9IDA7XG4gICAgdGhpcy5wbGF5ZXIgPSBwbGF5ZXI7XG4gICAgaWYodGhpcy5jb2xvciA9PSBcIm9yYW5nZVwiKXtcbiAgICAgICAgdGhpcy5jb2xvciA9ICdyZWQnO1xuICAgIH1cbiAgICB0aGlzLmltYWdlLnNyYyA9ICcuLi9hc3NldHMvUE5HL0xhc2Vycy9sYXNlcicrIHRoaXMuY29sb3IuY2hhckF0KDApLnRvVXBwZXJDYXNlKCkgKyB0aGlzLmNvbG9yLnNsaWNlKDEpICsnMDEucG5nJ1xufTsiLCIvKipcbiAqIENyZWF0ZWQgYnkganVzdGlqbmRlcG92ZXIgb24gMDkvMTIvMTUuXG4gKi9cblxudmFyIFNwYWNlc2hpcCA9IGZ1bmN0aW9uKHVzZXJOYW1lLCB4LCB5LCBjb2xvciwgcm90YXRpb24pe1xuICAgIHRoaXMudXNlck5hbWUgPSB1c2VyTmFtZTtcbiAgICB0aGlzLnggPSB4O1xuICAgIHRoaXMueSA9IHk7XG4gICAgdGhpcy5zcGVlZCA9IDE7XG4gICAgdGhpcy5jb2xvciA9IGNvbG9yO1xuICAgIHRoaXMucm90YXRpb24gPSByb3RhdGlvbjtcbiAgICB0aGlzLmltYWdlID0gbmV3IEltYWdlKCk7XG4gICAgdGhpcy5kYW1hZ2UgPSAwO1xuICAgIHRoaXMud2lkdGggPSAwO1xuICAgIHRoaXMuaGVpZ2h0ID0gMDtcbiAgICB0aGlzLmRhbWFnZUltYWdlID0gbmV3IEltYWdlKCk7XG4gICAgdGhpcy5pbWFnZS5zcmMgPSAnLi4vYXNzZXRzL1BORy9wbGF5ZXJTaGlwMV8nKyB0aGlzLmNvbG9yICsnLnBuZydcbn07XG5cblNwYWNlc2hpcC5wcm90b3R5cGUubW92ZVNwYWNlc2hpcCA9IGZ1bmN0aW9uKHgsIHkpe1xuICAgIHRoaXMueCA9IHg7XG4gICAgdGhpcy55ID0geTtcbn07XG5cblNwYWNlc2hpcC5wcm90b3R5cGUubW92ZVNwYWNlc2hpcFJlbGF0aXZlID0gZnVuY3Rpb24oeCwgeSl7XG4gICAgdGhpcy54ID0gdGhpcy54K3g7XG4gICAgdGhpcy55ID0gdGhpcy55K3k7XG59O1xuXG5TcGFjZXNoaXAucHJvdG90eXBlLnJvdGF0ZVNwYWNlc2hpcCA9IGZ1bmN0aW9uKGRlZ3JlZSl7XG4gICAgdGhpcy5yb3RhdGlvbiA9IGRlZ3JlZTtcbn07XG5cblNwYWNlc2hpcC5wcm90b3R5cGUucm90YXRlU3BhY2VzaGlwUmVsYXRpdmUgPSBmdW5jdGlvbihkZWdyZWUpe1xuICAgIHRoaXMucm90YXRpb24gPSB0aGlzLnJvdGF0aW9uICsgZGVncmVlLzU7XG4gICAgaWYodGhpcy5yb3RhdGlvbiA8IC0zNjApe1xuICAgICAgICB0aGlzLnJvdGF0aW9uID0gdGhpcy5yb3RhdGlvbiArIDcyMDtcbiAgICB9XG4gICAgaWYodGhpcy5yb3RhdGlvbiA+IDM2MCl7XG4gICAgICAgIHRoaXMucm90YXRpb24gPSB0aGlzLnJvdGF0aW9uIC0gNzIwO1xuICAgIH1cbn07XG5cblNwYWNlc2hpcC5wcm90b3R5cGUuaW5jcmVhc2VEYW1hZ2UgPSBmdW5jdGlvbigpe1xuICAgIGlmKHRoaXMuZGFtYWdlIDwgNCl7XG4gICAgICAgIHRoaXMuZGFtYWdlICs9IDE7XG4gICAgfVxuXG4gICAgaWYodGhpcy5kYW1hZ2UgPD0gMyAmJiB0aGlzLmRhbWFnZSA+IDApe1xuICAgICAgICB0aGlzLmRhbWFnZUltYWdlLnNyYyA9ICcuLi9hc3NldHMvUE5HL0RhbWFnZS9wbGF5ZXJTaGlwMV9kYW1hZ2UnKyB0aGlzLmRhbWFnZSArICcucG5nJztcbiAgICB9XG59O1xuXG5TcGFjZXNoaXAucHJvdG90eXBlLmRlY3JlYXNlRGFtYWdlID0gZnVuY3Rpb24oKXtcbiAgICBpZih0aGlzLmRhbWFnZSA+IDApe1xuICAgICAgICB0aGlzLmRhbWFnZSAtPSAxO1xuICAgIH1cblxuICAgIGlmKHRoaXMuZGFtYWdlIDw9IDMgJiYgdGhpcy5kYW1hZ2UgPiAwKXtcbiAgICAgICAgdGhpcy5kYW1hZ2VJbWFnZS5zcmMgPSAnLi4vYXNzZXRzL1BORy9EYW1hZ2UvcGxheWVyU2hpcDFfZGFtYWdlJysgdGhpcy5kYW1hZ2UgKyAnLnBuZyc7XG4gICAgfVxufTtcblxuIiwiLyoqXG4gKiBDcmVhdGVkIGJ5IGp1c3Rpam5kZXBvdmVyIG9uIDE2LzEyLzE1LlxuICovXG4oZnVuY3Rpb24oKXtcbiAgICB2YXIgY2FudmFzRGlyZWN0aXZlID0gZnVuY3Rpb24oJHdpbmRvdyl7XG4gICAgICAgIHJldHVybntcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnRScsXG4gICAgICAgICAgICBsaW5rOmxpbmssXG4gICAgICAgICAgICByZXBsYWNlOnRydWUsXG4gICAgICAgICAgICB0ZW1wbGF0ZTonPGNhbnZhcyBpZD1cImdhbWVcIiBjbGFzcz1cInBsYXlBcmVhXCIgd2lkdGg9XCJ7e3dpZHRofX1cIiBoZWlnaHQ9XCJ7e3dpZHRofX1cIiAvPidcbiAgICAgICAgfTtcblxuICAgICAgICBmdW5jdGlvbiBsaW5rKHNjb3BlLCBlbGVtZW50LCBhdHRycyl7XG4gICAgICAgICAgICBpZigkd2luZG93LmlubmVyV2lkdGggPCAkd2luZG93LmlubmVySGVpZ2h0KXtcbiAgICAgICAgICAgICAgICBzY29wZS53aWR0aCA9ICR3aW5kb3cuaW5uZXJXaWR0aCAtIDIwO1xuICAgICAgICAgICAgfWVsc2V7XG4gICAgICAgICAgICAgICAgc2NvcGUud2lkdGggPSAkd2luZG93LmlubmVySGVpZ2h0IC0gMjA7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGFuZ3VsYXIuZWxlbWVudCgkd2luZG93KS5iaW5kKCdyZXNpemUnLCBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIGlmKCR3aW5kb3cuaW5uZXJXaWR0aCA8ICR3aW5kb3cuaW5uZXJIZWlnaHQpe1xuICAgICAgICAgICAgICAgICAgICBzY29wZS53aWR0aCA9ICR3aW5kb3cuaW5uZXJXaWR0aCAtIDIwO1xuICAgICAgICAgICAgICAgIH1lbHNle1xuICAgICAgICAgICAgICAgICAgICBzY29wZS53aWR0aCA9ICR3aW5kb3cuaW5uZXJIZWlnaHQgLSAyMDtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBzY29wZS4kZGlnZXN0KCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwJykuZGlyZWN0aXZlKFwiY2FudmFzRGlyZWN0aXZlXCIsIFtcIiR3aW5kb3dcIiwgY2FudmFzRGlyZWN0aXZlXSk7XG59KSgpOyIsIi8qKlxuICogQ3JlYXRlZCBieSBNaWNoaWVsIG9uIDExLzEyLzIwMTUuXG4gKi9cblxuKGZ1bmN0aW9uKCl7XG4gICAgdmFyIGxvZ2luQ29udHJvbGxlciA9IGZ1bmN0aW9uKCRzY29wZSwgc29ja2V0U2VydmljZSwgZGlzcGxheVNlcnZpY2UsIHBsYXllclNlcnZpY2Upe1xuXG4gICAgICAgICRzY29wZS5MQ1Nob3cgPSBkaXNwbGF5U2VydmljZS5nZXRMQ1Nob3c7XG5cbiAgICAgICAgLy9mdW5jdGlvbnNcbiAgICAgICAgdmFyIG1ha2VSb29tID0gZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHNvY2tldFNlcnZpY2UuZW1pdChcInBjY29ubmVjdFwiLCBudWxsKTtcbiAgICAgICAgfTtcbiAgICAgICAgJHNjb3BlLnJvb20gPSBcIlwiO1xuICAgICAgICBzb2NrZXRTZXJ2aWNlLm9uKCdyZXF1ZXN0Um9vbScsZnVuY3Rpb24oZGF0YSl7XG4gICAgICAgICAgICAkc2NvcGUucm9vbSA9IGRhdGE7XG4gICAgICAgIH0pO1xuICAgICAgICBzb2NrZXRTZXJ2aWNlLm9uKCdkZXZpY2VPcmllbnRhdGlvbicsIGZ1bmN0aW9uKGRhdGEpe1xuICAgICAgICAgICAgdmFyIHVzZXJuYW1lID0gZGF0YS51c2VybmFtZTtcbiAgICAgICAgICAgIHZhciBkZXZpY2VPcmllbnRhdGlvbiA9IHt9O1xuICAgICAgICAgICAgZGV2aWNlT3JpZW50YXRpb24uZ2FtbWEgPSBkYXRhLmdhbW1hO1xuICAgICAgICAgICAgZGV2aWNlT3JpZW50YXRpb24uYmV0YSA9IGRhdGEuYmV0YTtcbiAgICAgICAgICAgIGRldmljZU9yaWVudGF0aW9uLmFscGhhID0gZGF0YS5hbHBoYTtcbiAgICAgICAgfSk7XG4gICAgICAgICRzY29wZS51c2VybmFtZXMgPSB7fTtcbiAgICAgICAgJHNjb3BlLmNoZWNrVXNlckNvdW50ID0gZmFsc2U7XG4gICAgICAgIHNvY2tldFNlcnZpY2Uub24oJ3VwZGF0ZXVzZXJzJywgZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgIHBsYXllclNlcnZpY2Uuc2V0UGxheWVycyhkYXRhKTtcbiAgICAgICAgICAgICRzY29wZS51c2VybmFtZXMgPSBkYXRhO1xuICAgICAgICAgICAgJHNjb3BlLmNoZWNrVXNlckNvdW50ID0gT2JqZWN0LmtleXMoJHNjb3BlLnVzZXJuYW1lcykubGVuZ3RoIDwgMDtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgJHNjb3BlLnN0YXJ0R2FtZT0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgc29ja2V0U2VydmljZS5lbWl0KFwic3RhcnRHYW1lXCIsIG51bGwpO1xuICAgICAgICAgICAgZGlzcGxheVNlcnZpY2Uuc2V0TENTaG93KGZhbHNlKTtcbiAgICAgICAgICAgIGRpc3BsYXlTZXJ2aWNlLnNldFBDU2hvdyh0cnVlKTtcbiAgICAgICAgfTtcblxuXG4gICAgICAgIChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIG1ha2VSb29tKCk7XG4gICAgICAgIH0pKCk7XG5cbiAgICB9O1xuXG4gICAgYW5ndWxhci5tb2R1bGUoXCJhcHBcIikuY29udHJvbGxlcihcImxvZ2luQ29udHJvbGxlclwiLCBbXCIkc2NvcGVcIiwgXCJzb2NrZXRTZXJ2aWNlXCIgLCBcImRpc3BsYXlTZXJ2aWNlXCIsIFwicGxheWVyU2VydmljZVwiLCBsb2dpbkNvbnRyb2xsZXJdKTtcbn0pKCk7IiwiLyoqXG4gKiBDcmVhdGVkIGJ5IE1pY2hpZWwgb24gMTYvMTIvMjAxNS5cbiAqL1xuXG4oZnVuY3Rpb24oKXtcbiAgICBcInVzZSBzdHJpY3RcIjtcbiAgICB2YXIgcGxheUNvbnRyb2xsZXIgPSBmdW5jdGlvbigkc2NvcGUsICRpbnRlcnZhbCwgJHdpbmRvdywgc29ja2V0U2VydmljZSwgZGlzcGxheVNlcnZpY2UsIHBsYXllclNlcnZpY2Upe1xuICAgICAgICAkc2NvcGUuUENTaG93ID0gZGlzcGxheVNlcnZpY2UuZ2V0UENTaG93O1xuICAgICAgICAkc2NvcGUuc3RhcnRHYW1lID0gZmFsc2U7XG4gICAgICAgIHZhciBjYW52ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2dhbWUnKTtcbiAgICAgICAgdmFyIGN0eCA9IGNhbnYuZ2V0Q29udGV4dCgnMmQnKTtcblxuICAgICAgICB2YXIgQWxsUGxheWVycyA9IG5ldyBBcnJheSgpO1xuICAgICAgICB2YXIgQWxsQnVsbGV0cyA9IG5ldyBBcnJheSgpO1xuXG4gICAgICAgIHZhciBjeWNsZTtcblxuICAgICAgICBzb2NrZXRTZXJ2aWNlLm9uKFwiaW5pdEdhbWVcIiwgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciBCdWZmZXJQbGF5ZXIgPSBwbGF5ZXJTZXJ2aWNlLmdldFBsYXllcnMoKTtcbiAgICAgICAgICAgIGZvcih2YXIgcGxheWVyIGluIEJ1ZmZlclBsYXllcil7XG4gICAgICAgICAgICAgICAgdmFyIHAgPSBCdWZmZXJQbGF5ZXJbcGxheWVyXTtcbiAgICAgICAgICAgICAgICBBbGxQbGF5ZXJzLnB1c2gobmV3IFNwYWNlc2hpcChwLnVzZXJuYW1lLCBwLngsIHAueSwgcC5jb2xvciwgcC5yb3RhdGlvbikpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBjeWNsZSA9ICRpbnRlcnZhbChkcmF3LCAxMCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHNvY2tldFNlcnZpY2Uub24oXCJ1cGRhdGVHYW1lRGF0YVwiLCBmdW5jdGlvbihkYXRhKXtcbiAgICAgICAgICAgIHZhciBwID0gbnVsbDtcbiAgICAgICAgICAgIGZvcih2YXIgaSBpbiBBbGxQbGF5ZXJzKXtcbiAgICAgICAgICAgICAgICBpZihmaWx0ZXJQbGF5ZXJzKEFsbFBsYXllcnNbaV0sZGF0YSkgPT0gdHJ1ZSl7XG4gICAgICAgICAgICAgICAgICAgIHAgPSBpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmKHAgIT0gbnVsbCl7XG4gICAgICAgICAgICAgICAgQWxsUGxheWVyc1twXS5yb3RhdGVTcGFjZXNoaXBSZWxhdGl2ZShkYXRhLm9yaWVudGF0aW9uKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgc29ja2V0U2VydmljZS5vbihcInBsYXllclNob3RcIiwgZnVuY3Rpb24oZGF0YSl7XG4gICAgICAgICAgICB2YXIgcCA9IG51bGw7XG4gICAgICAgICAgICBmb3IodmFyIGkgaW4gQWxsUGxheWVycyl7XG4gICAgICAgICAgICAgICAgaWYoZmlsdGVyUGxheWVycyhBbGxQbGF5ZXJzW2ldLGRhdGEpID09IHRydWUpe1xuICAgICAgICAgICAgICAgICAgICBwID0gaTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZihwICE9IG51bGwpe1xuICAgICAgICAgICAgICAgIHZhciB0ZW1wID0gQWxsUGxheWVyc1twXTtcbiAgICAgICAgICAgICAgICAvL3ZhciB4ICA9IE1hdGguc2luKCh0ZW1wLnJvdGF0aW9uIC0gOTApLzE4MCpNYXRoLlBJKSt0ZW1wLng7XG4gICAgICAgICAgICAgICAgLy92YXIgeSA9IE1hdGguY29zKCh0ZW1wLnJvdGF0aW9uIC0gOTApLzE4MCpNYXRoLlBJKSt0ZW1wLnk7XG4gICAgICAgICAgICAgICAgQWxsQnVsbGV0cy5wdXNoKG5ldyBCdWxsZXQodGVtcC54LCB0ZW1wLnksIHRlbXAucm90YXRpb24sIHRlbXAuY29sb3IsIHRlbXAudXNlck5hbWUpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgZnVuY3Rpb24gZmlsdGVyUGxheWVycyhvYmosZGF0YSl7XG4gICAgICAgICAgICBpZihkYXRhLnVzZXJuYW1lID09IG9iai51c2VyTmFtZSl7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9ZWxzZXtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBkcmF3KCl7XG4gICAgICAgICAgICBjdHguY2xlYXJSZWN0KDAsMCxjYW52LndpZHRoLCBjYW52LmhlaWdodCk7XG4gICAgICAgICAgICB2YXIgcmF0aW8gPSBjYW52LndpZHRoLzEwMDtcblxuICAgICAgICAgICAgaWYoQWxsQnVsbGV0cy5sZW5ndGggIT0gMCl7XG4gICAgICAgICAgICAgICAgdmFyIEJ1bGxldFdpZHRoID0gY2Fudi53aWR0aC8xMDA7XG4gICAgICAgICAgICAgICAgdmFyIEJ1bGxldEhlaWdodCA9IEJ1bGxldFdpZHRoICogQWxsQnVsbGV0c1swXS5pbWFnZS5oZWlnaHQvQWxsQnVsbGV0c1swXS5pbWFnZS53aWR0aDtcblxuICAgICAgICAgICAgICAgIGZvcih2YXIgYnVsbGV0IGluIEFsbEJ1bGxldHMpe1xuICAgICAgICAgICAgICAgICAgICB2YXIgYiA9IEFsbEJ1bGxldHNbYnVsbGV0XTtcbiAgICAgICAgICAgICAgICAgICAgYi53aWR0aCA9IEJ1bGxldFdpZHRoO1xuICAgICAgICAgICAgICAgICAgICBiLmhlaWdodCA9IEJ1bGxldEhlaWdodDtcbiAgICAgICAgICAgICAgICAgICAgY3R4LnNhdmUoKTtcbiAgICAgICAgICAgICAgICAgICAgY3R4LnRyYW5zbGF0ZShiLngqcmF0aW8sIGIueSpyYXRpbyk7XG4gICAgICAgICAgICAgICAgICAgIGN0eC5yb3RhdGUoYi5yb3RhdGlvbi8xODAqTWF0aC5QSSk7XG4gICAgICAgICAgICAgICAgICAgIGN0eC5kcmF3SW1hZ2UoYi5pbWFnZSwgLUJ1bGxldFdpZHRoLzIsIC1CdWxsZXRIZWlnaHQvMiwgQnVsbGV0V2lkdGgsIEJ1bGxldEhlaWdodCk7XG4gICAgICAgICAgICAgICAgICAgIGN0eC5yZXN0b3JlKCk7XG4gICAgICAgICAgICAgICAgICAgIEFsbEJ1bGxldHNbYnVsbGV0XS54ID0gTWF0aC5jb3MoKGIucm90YXRpb24gLSA5MCkvMTgwKk1hdGguUEkpICsgYi54O1xuICAgICAgICAgICAgICAgICAgICBBbGxCdWxsZXRzW2J1bGxldF0ueSA9IE1hdGguc2luKChiLnJvdGF0aW9uIC0gOTApLzE4MCpNYXRoLlBJKSsgYi55O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYoQWxsUGxheWVycy5sZW5ndGggIT0gMCl7XG4gICAgICAgICAgICAgICAgQWxsUGxheWVyc1sxXS5zcGVlZCA9IDA7XG4gICAgICAgICAgICAgICAgQWxsUGxheWVyc1swXS5zcGVlZCA9IDA7XG4gICAgICAgICAgICAgICAgdmFyIFNwYWNlc2hpcFdpZHRoID0gY2Fudi53aWR0aC8yMDtcbiAgICAgICAgICAgICAgICB2YXIgU3BhY2VzaGlwSGVpZ2h0ID0gU3BhY2VzaGlwV2lkdGggKiBBbGxQbGF5ZXJzWzBdLmltYWdlLmhlaWdodC8gQWxsUGxheWVyc1swXS5pbWFnZS53aWR0aDtcblxuICAgICAgICAgICAgICAgIGZvcih2YXIgcGxheWVyIGluIEFsbFBsYXllcnMpe1xuICAgICAgICAgICAgICAgICAgICB2YXIgcCA9IEFsbFBsYXllcnNbcGxheWVyXTtcbiAgICAgICAgICAgICAgICAgICAgcC53aWR0aCA9IFNwYWNlc2hpcFdpZHRoO1xuICAgICAgICAgICAgICAgICAgICBwLmhlaWdodCA9IFNwYWNlc2hpcEhlaWdodDtcbiAgICAgICAgICAgICAgICAgICAgY3R4LnNhdmUoKTtcbiAgICAgICAgICAgICAgICAgICAgY3R4LnRyYW5zbGF0ZShwLngqcmF0aW8sIHAueSpyYXRpbyk7XG4gICAgICAgICAgICAgICAgICAgIGN0eC5yb3RhdGUocC5yb3RhdGlvbi8xODAqTWF0aC5QSSk7XG4gICAgICAgICAgICAgICAgICAgIGN0eC5kcmF3SW1hZ2UocC5pbWFnZSwgLVNwYWNlc2hpcFdpZHRoLzIsIC1TcGFjZXNoaXBIZWlnaHQvMiwgU3BhY2VzaGlwV2lkdGgsIFNwYWNlc2hpcEhlaWdodCk7XG4gICAgICAgICAgICAgICAgICAgIGlmKHAuZGFtYWdlID4gMCl7XG4gICAgICAgICAgICAgICAgICAgICAgICBjdHguZHJhd0ltYWdlKHAuZGFtYWdlSW1hZ2UsIC1TcGFjZXNoaXBXaWR0aC8yLCAtU3BhY2VzaGlwSGVpZ2h0LzIsIFNwYWNlc2hpcFdpZHRoLCBTcGFjZXNoaXBIZWlnaHQpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGN0eC5yZXN0b3JlKCk7XG4gICAgICAgICAgICAgICAgICAgIEFsbFBsYXllcnNbcGxheWVyXS54ID0gTWF0aC5jb3MoKHAucm90YXRpb24gLSA5MCkvMTgwKk1hdGguUEkpLzEwKiBwLnNwZWVkICsgcC54O1xuICAgICAgICAgICAgICAgICAgICBBbGxQbGF5ZXJzW3BsYXllcl0ueSA9IE1hdGguc2luKChwLnJvdGF0aW9uIC0gOTApLzE4MCpNYXRoLlBJKS8xMCogcC5zcGVlZCArIHAueTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGNoZWNrQnVsbGV0cygpO1xuXG4gICAgICAgICAgICBjb2xsaXNpb25EZXRlY3Rpb24oKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGNoZWNrQnVsbGV0cygpe1xuXG4gICAgICAgICAgICBmb3IodmFyIGIgaW4gQWxsQnVsbGV0cyl7XG4gICAgICAgICAgICAgICAgaWYoQWxsQnVsbGV0c1tiXS54IDwgMCB8fCBBbGxCdWxsZXRzW2JdLnggPiBjYW52LndpZHRoIHx8IEFsbEJ1bGxldHNbYl0ueSA8IDAgfHwgQWxsQnVsbGV0c1tiXS55ID4gY2Fudi5oZWlnaHQpe1xuICAgICAgICAgICAgICAgICAgICBBbGxCdWxsZXRzLnNwbGljZShiLCAxKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGNvbGxpc2lvbkRldGVjdGlvbigpe1xuICAgICAgICAgICAgZm9yKHZhciBwIGluIEFsbFBsYXllcnMpe1xuICAgICAgICAgICAgICAgIGZvcih2YXIgYiBpbiBBbGxCdWxsZXRzKXtcbiAgICAgICAgICAgICAgICAgICAgaWYoQWxsQnVsbGV0c1tiXS5wbGF5ZXIgIT0gQWxsUGxheWVyc1twXS51c2VyTmFtZSl7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgcmFkaXVzID0gTWF0aC5zcXJ0KDIpLzIqQWxsQnVsbGV0c1tiXS53aWR0aC8yO1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGFuZ2xlID0gKCgzNjAgLShBbGxCdWxsZXRzW2JdLnJvdGF0aW9uIC0gOTApKSAtIDkwKS8xODAqTWF0aC5QSTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBidWxsZXRIZWFkWCA9IEFsbEJ1bGxldHNbYl0ueCArIChyYWRpdXMgKiBNYXRoLnNpbihhbmdsZSkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGJ1bGxldEhlYWRZID0gQWxsQnVsbGV0c1tiXS55ICsgKHJhZGl1cyAqIE1hdGguY29zKGFuZ2xlKSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciByYWRpdXNTID0gTWF0aC5zcXJ0KDIpLzIqQWxsUGxheWVyc1twXS5oZWlnaHQvMjtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBhbmdsZVMgPSAoKDM2MCAtKEFsbFBsYXllcnNbcF0ucm90YXRpb24gLSA5MCkpIC0gOTApLzE4MCpNYXRoLlBJO1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGJ1bGxldEhlYWRYUyA9IEFsbFBsYXllcnNbcF0ueCArIChyYWRpdXNTICogTWF0aC5zaW4oYW5nbGVTKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgYnVsbGV0SGVhZFlTID0gQWxsUGxheWVyc1twXS55ICsgKHJhZGl1c1MgKiBNYXRoLmNvcyhhbmdsZVMpKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGRpc3RhbmNlID0gTWF0aC5zcXJ0KE1hdGgucG93KChidWxsZXRIZWFkWC1idWxsZXRIZWFkWFMpLCAyKSArIE1hdGgucG93KChidWxsZXRIZWFkWS1idWxsZXRIZWFkWVMpLCAyKSlcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmKGRpc3RhbmNlIDwgKHJhZGl1cyArIHJhZGl1c1MpKXtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBBbGxQbGF5ZXJzW3BdLmluY3JlYXNlRGFtYWdlKClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBBbGxCdWxsZXRzLnNwbGljZShiLCAxKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH07XG5cbiAgICBhbmd1bGFyLm1vZHVsZShcImFwcFwiKS5jb250cm9sbGVyKFwicGxheUNvbnRyb2xsZXJcIiwgW1wiJHNjb3BlXCIsIFwiJGludGVydmFsXCIsIFwiJHdpbmRvd1wiLCBcInNvY2tldFNlcnZpY2VcIiwgXCJkaXNwbGF5U2VydmljZVwiLCBcInBsYXllclNlcnZpY2VcIiwgcGxheUNvbnRyb2xsZXJdKVxufSkoKTsiLCIvKipcbiAqIENyZWF0ZWQgYnkgTWljaGllbCBvbiAxNi8xMi8yMDE1LlxuICovXG4vKipcbiAqIENyZWF0ZWQgYnkganVzdGlqbmRlcG92ZXIgb24gMTYvMTIvMTUuXG4gKi9cblxuXG4oZnVuY3Rpb24oKXtcbiAgICB2YXIgZGlzcGxheVNlcnZpY2UgPSBmdW5jdGlvbigpe1xuICAgICAgICAvL0xvZ2luIENvbnRyb2xsZXJcbiAgICAgICAgdmFyIExDU2hvdyA9IHRydWU7XG4gICAgICAgIC8vUGxheSBjb250cm9sbGVyXG4gICAgICAgIHZhciBQQ1Nob3cgPSBmYWxzZTtcblxuICAgICAgICByZXR1cm57XG4gICAgICAgICAgICBnZXRMQ1Nob3c6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgcmV0dXJuIExDU2hvdztcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzZXRMQ1Nob3c6IGZ1bmN0aW9uKHZhbHVlKXtcbiAgICAgICAgICAgICAgICBMQ1Nob3cgPSB2YWx1ZTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXRQQ1Nob3c6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgcmV0dXJuIFBDU2hvdztcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzZXRQQ1Nob3c6IGZ1bmN0aW9uKHZhbHVlKXtcbiAgICAgICAgICAgICAgICBQQ1Nob3cgPSB2YWx1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH07XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwJykuZmFjdG9yeSgnZGlzcGxheVNlcnZpY2UnLCBbZGlzcGxheVNlcnZpY2VdKTtcbn0pKCk7IiwiLyoqXG4gKiBDcmVhdGVkIGJ5IGp1c3Rpam5kZXBvdmVyIG9uIDE3LzEyLzE1LlxuICovXG5cbihmdW5jdGlvbigpe1xuICAgIHZhciBwbGF5ZXJTZXJ2aWNlID0gZnVuY3Rpb24oKXtcbiAgICAgICAgLy9Mb2dpbiBDb250cm9sbGVyXG4gICAgICAgIHZhciBwbGF5ZXJzID0gW107XG5cbiAgICAgICAgcmV0dXJue1xuICAgICAgICAgICAgZ2V0UGxheWVyczogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICByZXR1cm4gcGxheWVycztcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzZXRQbGF5ZXJzOiBmdW5jdGlvbihwbGF5ZXJzQXJyYXkpe1xuICAgICAgICAgICAgICAgIHBsYXllcnMgPSBwbGF5ZXJzQXJyYXk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcCcpLmZhY3RvcnkoJ3BsYXllclNlcnZpY2UnLCBbcGxheWVyU2VydmljZV0pO1xufSkoKTsiLCIvKipcbiAqIENyZWF0ZWQgYnkganVzdGlqbmRlcG92ZXIgb24gMDkvMTIvMTUuXG4gKi9cblxuKGZ1bmN0aW9uKCl7XG5cbiAgICB2YXIgc29ja2V0U2VydmljZSA9IGZ1bmN0aW9uKCRyb290U2NvcGUpe1xuICAgICAgICBcInVzZSBzdHJpY3RcIjtcbiAgICAgICAgLy9wcml2YXRlXG4gICAgICAgIHZhciBzb2NrZXQgPSBpby5jb25uZWN0KHdpbmRvdy5sb2NhdGlvbi5ob3N0KTtcbiAgICAgICAgLy9mdW5jdGlvbnNcbiAgICAgICAgdmFyIG9uID0gZnVuY3Rpb24gKGV2ZW50TmFtZSwgY2FsbGJhY2spIHtcbiAgICAgICAgICAgIHNvY2tldC5vbihldmVudE5hbWUsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB2YXIgYXJncyA9IGFyZ3VtZW50cztcbiAgICAgICAgICAgICAgICAkcm9vdFNjb3BlLiRhcHBseShmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrLmFwcGx5KHNvY2tldCwgYXJncyk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgZW1pdCA9IGZ1bmN0aW9uIChldmVudE5hbWUsIGRhdGEsIGNhbGxiYWNrKSB7XG4gICAgICAgICAgICBzb2NrZXQuZW1pdChldmVudE5hbWUsIGRhdGEsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB2YXIgYXJncyA9IGFyZ3VtZW50cztcbiAgICAgICAgICAgICAgICAkcm9vdFNjb3BlLiRhcHBseShmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChjYWxsYmFjaykge1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2suYXBwbHkoc29ja2V0LCBhcmdzKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgfTtcblxuICAgICAgICAvL3B1YmxpY1xuICAgICAgICByZXR1cm57XG4gICAgICAgICAgICBvbjogb24sXG4gICAgICAgICAgICBlbWl0OiBlbWl0LFxuICAgICAgICAgICAgc29ja2V0OiBzb2NrZXRcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICBhbmd1bGFyLm1vZHVsZShcImFwcFwiKS5mYWN0b3J5KFwic29ja2V0U2VydmljZVwiLCBbXCIkcm9vdFNjb3BlXCIsIHNvY2tldFNlcnZpY2VdKTtcblxufSkoKTsiXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
